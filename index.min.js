!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).karas=e()}(this,function(){"use strict";function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function a(t,e,i){return e&&r(t.prototype,e),i&&r(t,i),t}function e(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,r)}return i}function n(n){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?e(a,!0).forEach(function(t){var e,i,r;e=n,r=a[i=t],i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):e(a).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(a,t))})}return n}function t(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&i(t,e)}function L(t){return(L=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function i(t,e){return(i=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function o(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function C(t,e,i){return(C="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=L(t)););return t}(t,e);if(r){var n=Object.getOwnPropertyDescriptor(r,e);return n.get?n.get.call(i):n.value}})(t,e,i||t)}function U(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if(!(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)))return;var i=[],r=!0,n=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(r=(o=s.next()).done)&&(i.push(o.value),!e||i.length!==e);r=!0);}catch(t){n=!0,a=t}finally{try{r||null==s.return||s.return()}finally{if(n)throw a}}return i}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function $e(t){return function(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var h,l=function(){function t(){s(this,t),this.__x=0,this.__y=0,this.__ox=0,this.__oy=0,this.__width=0,this.__height=0,this.__prev=null,this.__next=null,this.__ctx=null,this.__defs=null,this.__parent=null,this.__style={},this.__baseLine=0,this.__virtualDom={}}return a(t,[{key:"__offsetX",value:function(t){this.__ox+=t}},{key:"__offsetY",value:function(t){this.__oy+=t}},{key:"x",get:function(){return this.__x}},{key:"y",get:function(){return this.__y}},{key:"ox",get:function(){return this.__ox}},{key:"oy",get:function(){return this.__oy}},{key:"rx",get:function(){return this.x+this.ox}},{key:"ry",get:function(){return this.y+this.oy}},{key:"width",get:function(){return this.__width}},{key:"height",get:function(){return this.__height}},{key:"outerWidth",get:function(){return this.__width}},{key:"outerHeight",get:function(){return this.__height}},{key:"prev",get:function(){return this.__prev}},{key:"next",get:function(){return this.__next}},{key:"parent",get:function(){return this.__parent}},{key:"root",get:function(){return this.parent?this.parent.root:this}},{key:"style",get:function(){return this.__style}},{key:"ctx",get:function(){return this.__ctx}},{key:"defs",get:function(){return this.__defs}},{key:"baseLine",get:function(){return this.__baseLine}},{key:"virtualDom",get:function(){return this.__virtualDom}}]),t}(),qe={CANVAS:0,SVG:1,measure:function(t,e){h||((h=document.createElement("div")).style.position="absolute",h.style.left="99999px",h.style.top="-99999px",h.style.visibility="hidden",document.body.appendChild(h)),h.style.fontSize=e.fontSize+"px",h.innerText=t;var i=window.getComputedStyle(h,null);return parseFloat(i.width)}},Qe={AUTO:0,PX:1,PERCENT:2,POSITION:3},u={}.toString;function f(e){return function(t){return u.call(t)==="[object "+e+"]"}}var c=f("Number");function d(t){return p(t)?"":t.toString()}function p(t){return null==t}function _(t){if("item"===t.type){var e="";return t.props.forEach(function(t){e+=" ".concat(t[0],'="').concat(t[1],'"')}),"text"===t.tagName?"<text".concat(e,">").concat(t.content,"</text>"):"<".concat(t.tagName).concat(e,"/>")}if("text"===t.type){var i="";return t.children.forEach(function(t){i+=_(t)}),"<g>".concat(i,"</g>")}if("dom"===t.type||"geom"===t.type){var r="<g>";return t.bb.forEach(function(t){r+=_(t)}),r+="</g><g>",t.children.forEach(function(t){r+=_(t)}),r+="</g>",'<g transform="'.concat(v(t.transform),'">').concat(r,"</g>")}}function v(t){var e="";return t.forEach(function(t){e+="".concat(t[0],"(").concat(t[1],") ")}),e}function y(t){var e="<".concat(t.tagName,' id="').concat(t.uuid,'" gradientUnits="userSpaceOnUse"');return t.props.forEach(function(t){e+=" ".concat(t[0],'="').concat(t[1],'"')}),e+=">",t.stop.forEach(function(t){e+='<stop stop-color="'.concat(t[0],'" offset="').concat(100*t[1],'%"/>')}),e+="</".concat(t.tagName,">")}var Ze={isObject:f("Object"),isString:f("String"),isFunction:f("Function"),isNumber:c,isBoolean:f("Boolean"),isDate:f("Date"),stringify:d,joinSourceArray:function(t){return function t(e){for(var i="",r=0,n=e.length;r<n;r++){var a=e[r];Array.isArray(a)?i+=t(a):i+=d(a)}return i}(t)},encodeHtml:function(t,e){return e?t.replace(/"/g,"&quot;"):t.replace(/&/g,"&amp;").replace(/</g,"&lt;")},isNil:p,joinVirtualDom:function(t,e){var i="<defs>";return e.forEach(function(t){i+=y(t)}),i+="</defs><g>",t.bb.forEach(function(t){i+=_(t)}),i+="</g><g>",t.children.forEach(function(t){i+=_(t)}),i+="</g>"},joinVd:_,joinTransform:v,joinDef:y,r2d:function(t){return t*Math.PI/180},rgb2int:function(t){var e=[];if("#"===t.charAt(0))3===(t=t.slice(1)).length?(e.push(parseInt(t.charAt(0)+t.charAt(0),16)),e.push(parseInt(t.charAt(1)+t.charAt(1),16)),e.push(parseInt(t.charAt(2)+t.charAt(2),16))):6===t.length&&(e.push(parseInt(t.slice(0,2),16)),e.push(parseInt(t.slice(2,4),16)),e.push(parseInt(t.slice(4),16)));else{var i=t.match(/rgba?\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)(?:\s*,\s*([\d.]+))?\s*\)/i);i&&(e=[parseInt(i[1]),parseInt(i[2]),parseInt(i[3])],i[4]&&(e[3]=parseFloat(i[4])))}return e},arr2hash:function(t){for(var e={},i=0,r=t.length;i<r;i++){var n=t[i];if(Array.isArray(n))e[n[0]]=n[1];else for(var a=Object.keys(n),o=a.length-1;0<=o;o--){var s=a[o];e[s]=n[s]}}return e},hash2arr:function(t){for(var e=[],i=Object.keys(t),r=0,n=i.length;r<n;r++){var a=i[r];e.push([a,t[a]])}return e}};function g(t,e,i){var r=U(t,6),n=r[0],a=r[1],o=r[2],s=r[3];return[n*e+o*i+r[4],a*e+s*i+r[5]]}function m(t,e,i,r){return t*r-i*e}var Je={calMatrix:function(t,n,a){var o,e=[1,0,0,1,0,0],s=0,h=0,l=0,u=0,f=0,c=1,d=1;return t.forEach(function(t){var e=U(t,2),i=e[0],r=e[1];"translateX"===i?(s+=r,o&&(n-=r)):"translateY"===i?(h+=r,o&&(a-=r)):"scaleX"===i?c*=r:"scaleY"===i?d*=r:"skewX"===i?u+=r:"skewY"===i?f+=r:"rotate"===i&&(l+=r,o=!0)}),l=Ze.r2d(l),u=Ze.r2d(u),f=Ze.r2d(f),e[0]=c*Math.cos(l),e[1]=d*Math.sin(l)+d*Math.tan(f),e[2]=-c*Math.sin(l)+c*Math.tan(u),e[3]=d*Math.cos(l),e[4]=(-n*Math.cos(l)+a*Math.sin(l)+n)*c+s+n-c*n,e[5]=(-n*Math.sin(l)-a*Math.cos(l)+a)*d+h+a-d*a,e},pointInQuadrilateral:function(t,e,i,r,n,a,o,s,h,l,u){if(!u)return i<=t&&r<=e&&t<=h&&e<=l;var f=U(g(u,i,r),2);i=f[0],r=f[1];var c=U(g(u,n,a),2);n=c[0],a=c[1];var d=U(g(u,o,s),2);o=d[0],s=d[1];var p=U(g(u,h,l),2);return h=p[0],l=p[1],0<m(n-i,a-r,t-i,e-r)&&0<m(h-n,l-a,t-n,e-a)&&0<m(o-h,s-l,t-h,e-l)&&0<m(i-o,r-s,t-o,e-s)||void 0},normalize:function(t,e,i,n,a){return t.forEach(function(t){var e=U(t,2),i=e[0],r=e[1];"translateX"===i?r.unit===Qe.PERCENT?t[1]=r.value*n*.01:t[1]=r.value:"translateY"===i&&(r.unit===Qe.PERCENT?t[1]=r.value*a*.01:t[1]=r.value)}),t},alphaBlend:function(t,e){for(var i=t.data,r=e.data,n=0,a=i.length;n<a;n+=4){var o=i[n],s=i[n+1],h=i[n+2],l=i[n+3],u=r[n],f=r[n+1],c=r[n+2],d=r[n+3];0===d||(0===l?(i[n]=u,i[n+1]=f,i[n+2]=c,i[n+3]=d):(o=o*(l/=255)+u*(d/=255)*(1-l),h=(h=s*l+f*d*(1-l))*l+c*d*(1-l),o/=l=1-(1-l)*(1-d),s/=l,h/=l,i[n]=o,i[n+1]=s,i[n+2]=h,i[n+3]=l))}}};function w(t,e,i,r,n,a,o,s){var h=1,l=1,u=1;t:for(var f=a;n<=f;f--)for(var c=s;o<=c;c--){var d=f+c,p=Math.floor((t+c)/d),_=c;if(p*d<c+t)if(s<(_=(t-p*f)/(p-1)))continue;if(d=f+_,1<e&&f<e){if(f<e%d)continue;if(1<i)if(f<(e+r)%d)continue}if(1<i)if(f<(e+r)%d)continue;0<p&&(h=p,l=f,u=_);break t}return{n:h,ps:l,pd:u}}function Ke(t,e,i,r,n,a){var o=n-e,s=r-i,h=i-e,l=n-r;if("dotted"===t)return w(o,h,l,s,a,a,Math.max(1,.25*a),2*a);var u=w(o,h,l,s,a,3*a,Math.max(1,.25*a),2*a),f=u.n,c=u.ps,d=u.pd;return 1===f?w(o,h,l,s,a,a,Math.max(1,.25*a),2*a):{n:f,ps:c,pd:d}}function ti(t,e,r,n,i){if(t===qe.CANVAS)e.forEach(function(t){n.beginPath(),n.fillStyle=r,n.moveTo(t[0],t[1]);for(var e=2,i=t.length;e<i;e+=2)n.lineTo(t[e],t[e+1]);n.fill(),n.closePath()});else if(t===qe.SVG){var a="";e.forEach(function(t){a+="M ".concat(t[0]," ").concat(t[1]);for(var e=2,i=t.length;e<i;e+=2)a+="L ".concat(t[e]," ").concat(t[e+1]," ")}),i.addBorder([["d",a],["fill",r]])}}function ei(t,e){for(var i=[],r=1,n=t.length;r<n;r++){var a=t[r].trim().split(/\s+/);if(1<a.length){var o=a[0],s=a[1];/%$/.test(s)?i.push([o,.01*parseFloat(s)]):i.push([o,parseFloat(s)/e])}else i.push(a[0])}1<i.length?(Array.isArray(i[0])||(i[0]=[i[0],0]),Array.isArray(i[i.length-1])||(i[i.length-1]=[i[i.length-1],1])):Array.isArray(i[0])||(i[0]=[i[0],0]);for(var h=i[0][1],l=1,u=i.length;l<u-1;l++){var f=i[l];if(Array.isArray(f))h=f[1];else{for(var c=l+1,d=i[i.length-1][1];c<u-1;c++){var p=i[c];if(Array.isArray(p)){d=p[1];break}}for(var _=(d-h)/(c-l+1),v=l;v<c;v++){var y=i[v];i[v]=[y,h+_*(v+1-l)]}l=c}}for(var g=1,m=i.length;g<m;g++){var w=i[g],b=i[g-1];w[1]<b[1]&&(w[1]=b[1])}for(var x=0,k=i.length;x<k-1;x++){if(1<i[x][1]){i.splice(x+1);break}}for(var A=i.length-1;0<A;A--){if(i[A][1]<0){i.splice(0,A);break}}var T=i.length;if(1===T)i[0][1]=0;else{for(var M=!0,O=!0,P=T-1;0<=P;P--){var W=i[P][1];0<W&&(M=!1),W<1&&(O=!1)}if(M)i.splice(0,T-1),i[0][1]=0;else if(O)i.splice(1),i[0][1]=0;else{var E=i[0],S=i[T-1];if(2===T)E[1]<0&&1<S[1]&&function(t,e,i){var r=Ze.rgb2int(t[0]),n=Ze.rgb2int(e[0]),a=U(r,4),o=a[0],s=a[1],h=a[2],l=a[3],u=void 0===l?1:l,f=U(n,4),c=f[0],d=f[1],p=f[2],_=f[3],v=void 0===_?1:_,y=Math.abs(t[1])*i,g=e[1]*i,m=y/(y+g),w=Math.floor(o+(c-o)*m),b=Math.floor(s+(d-s)*m),x=Math.floor(h+(p-h)*m),k=u+(v-u)*m;t[0]="rgba(".concat(w,",").concat(b,",").concat(x,",").concat(k,")"),t[1]=0,m=(i+y)/(y+g),w=Math.floor(o+(c-o)*m),b=Math.floor(s+(d-s)*m),x=Math.floor(h+(p-h)*m),k=u+(v-u)*m,e[0]="rgba(".concat(w,",").concat(b,",").concat(x,",").concat(k,")"),e[1]=1}(E,S,e);else{if(E[1]<0){var N=i[1],L=Ze.rgb2int(E[0]),C=Ze.rgb2int(N[0]),X=function(t,e,i,r,n){var a=U(t,4),o=a[0],s=a[1],h=a[2],l=a[3],u=void 0===l?1:l,f=U(i,4),c=f[0],d=f[1],p=f[2],_=f[3],v=void 0===_?1:_,y=Math.abs(e)*n,g=y/(r*n+y);return[Math.floor(o+(c-o)*g),Math.floor(s+(d-s)*g),Math.floor(h+(p-h)*g),u+(v-u)*g]}(L,E[1],C,N[1],e);E[0]="rgba(".concat(X[0],",").concat(X[1],",").concat(X[2],",").concat(X[3],")"),E[1]=0}if(1<S[1]){var B=i[T-2],R=Ze.rgb2int(B[0]),D=Ze.rgb2int(S[0]),I=function(t,e,i,r,n){var a=U(t,4),o=a[0],s=a[1],h=a[2],l=a[3],u=void 0===l?1:l,f=U(i,4),c=f[0],d=f[1],p=f[2],_=f[3],v=void 0===_?1:_,y=e*n,g=(n-y)/(r*n-y);return[Math.floor(o+(c-o)*g),Math.floor(s+(d-s)*g),Math.floor(h+(p-h)*g),u+(v-u)*g]}(R,B[1],D,S[1],e);S[0]="rgba(".concat(I[0],",").concat(I[1],",").concat(I[2],",").concat(I[3],")"),S[1]=1}}}}return i.forEach(function(t){t[1]<0?t[1]=0:1<t[1]&&(t[1]=1)}),i}var Q=function(){function m(t,e){var i;return s(this,m),i=o(this,L(m).call(this)),e=e||[],Array.isArray(e)?(i.props=Ze.arr2hash(e),i.__props=e):(i.props=e,i.__props=Ze.hash2arr(e)),i.__tagName=t,i.__style=i.props.style||{},i.__listener={},i.__props.forEach(function(t){var e=t[0];/^on[a-zA-Z]/.test(e)&&(i.__listener[e.slice(2).toLowerCase()]=t[1])}),i.__mtw=0,i.__mrw=0,i.__mbw=0,i.__mlw=0,i.__ptw=0,i.__prw=0,i.__pbw=0,i.__plw=0,i}return t(m,l),a(m,[{key:"__layout",value:function(t){var e=t.w,i=this.style,r=i.display,n=i.width,a=i.marginTop,o=i.marginRight,s=i.marginBottom,h=i.marginLeft,l=i.paddingTop,u=i.paddingRight,f=i.paddingBottom,c=i.paddingLeft;if("none"!==r){if(n&&n.unit!==Qe.AUTO)switch(n.unit){case Qe.PX:e=n.value;break;case Qe.PERCENT:e*=.01*n.value}this.__mlw=this.__mpWidth(h,e),this.__mtw=this.__mpWidth(a,e),this.__mrw=this.__mpWidth(o,e),this.__mbw=this.__mpWidth(s,e),this.__plw=this.__mpWidth(c,e),this.__ptw=this.__mpWidth(l,e),this.__prw=this.__mpWidth(u,e),this.__pbw=this.__mpWidth(f,e),"block"===r?this.__layoutBlock(t):"flex"===r?this.__layoutFlex(t):"inline"===r&&this.__layoutInline(t)}}},{key:"isGeom",value:function(){return"$"===this.tagName.charAt(0)}},{key:"__mpWidth",value:function(t,e){return t.unit===Qe.PX?t.value:t.unit===Qe.PERCENT?t.value*e*.01:0}},{key:"render",value:function(t){(this.__renderMode=t)===qe.SVG&&(this.__virtualDom={bb:[],children:[],transform:[]});var e=this.ctx,i=this.style,r=this.width,n=this.height,a=this.mlw,o=this.mrw,s=this.mtw,h=this.mbw,l=this.plw,u=this.ptw,f=this.prw,c=this.pbw;t===qe.CANVAS&&e.setTransform(1,0,0,1,0,0);var d=i.display,p=i.position,_=i.top,v=i.right,y=i.bottom,g=i.left,m=i.backgroundGradient,w=i.backgroundColor,b=i.borderTopWidth,x=i.borderTopColor,k=i.borderTopStyle,A=i.borderRightWidth,T=i.borderRightColor,M=i.borderRightStyle,O=i.borderBottomWidth,P=i.borderBottomColor,W=i.borderBottomStyle,E=i.borderLeftWidth,S=i.borderLeftColor,N=i.borderLeftStyle,L=i.transform,C=i.transformOrigin;if("none"!==d){var X=this.rx,B=this.ry,R=b.value,D=A.value,I=O.value,U=E.value,V=X+a,j=V+U,F=j+r+l+f,G=F+D,Y=B+s,H=Y+R,z=H+n+u+c,$=z+I,q=r+l+f,Q=n+u+c;if("relative"===p&&this.parent){var Z=this.parent,J=Z.width,K=Z.height,tt=this.parent.style.height;if(g.unit!==Qe.AUTO){var et=g.unit===Qe.PX?g.value:g.value*J*.01;this.__offsetX(et)}else if(v.unit!==Qe.AUTO){var it=v.unit===Qe.PX?v.value:v.value*J*.01;this.__offsetX(-it)}if(_.unit!==Qe.AUTO){var rt=_.unit===Qe.PX?_.value:_.value*K*.01*(tt.unit===Qe.AUTO?0:1);this.__offsetY(rt)}else if(y.unit!==Qe.AUTO){var nt=y.unit===Qe.PX?y.value:y.value*K*.01*(tt.unit===Qe.AUTO?0:1);this.__offsetY(-nt)}}if(L){var at=X+a+U+q+D+o,ot=B+s+R+Q+I+h,st=[];C.forEach(function(t,e){t.unit===Qe.PX?st.push(t.value):t.unit===Qe.PERCENT?st.push(t.value*(e?at-X:ot-B)*.01):"left"===t.value?st.push(X):"right"===t.value?st.push(at):"top"===t.value?st.push(B):"bottom"===t.value?st.push(B+ot):st.push(e?B+.5*(ot-B):X+.5*(at-X))}),this.__tox=st[0],this.__toy=st[1];var ht=Je.normalize(L,st[0],st[1],at-X,ot-B),lt=Je.calMatrix(ht,st[0],st[1]);t===qe.CANVAS?e.setTransform.apply(e,$e(lt)):t===qe.SVG&&this.addTransform(["matrix",lt.join(",")])}if(m){var ut=m.k,ft=m.v;if("linear"===ut){var ct=180;if("to top"===ft[0])ct=0;else if("to top right"===ft[0])ct=45;else if("to right"===ft[0])ct=90;else if("to bottom right"===ft[0])ct=135;else if("to bottom"===ft[0]);else if("to bottom left"===ft[0])ct=225;else if("to left"===ft[0])ct=270;else if("to top left"===ft[0])ct=315;else{var dt=/([\d.]+)deg/.exec(ft[0]);dt?ct=parseFloat(dt[1]):ft.unshift(null)}var pt=Ze.r2d(ct),_t=Math.abs(q*Math.sin(pt))+Math.abs(Q*Math.cos(pt)),vt=.5*_t;for(360<=ct&&(ct%=360);ct<0;)ct+=360;var yt=j+.5*q,gt=H+.5*Q,mt=F,wt=z,bt=j,xt=H;if(270<=ct){var kt=Ze.r2d(360-ct);mt=yt+Math.sin(kt)*vt,wt=gt+Math.cos(kt)*vt,bt=yt-Math.sin(kt)*vt,xt=gt-Math.cos(kt)*vt}else if(180<=ct){var At=Ze.r2d(ct-180);mt=yt+Math.sin(At)*vt,wt=gt-Math.cos(At)*vt,bt=yt-Math.sin(At)*vt,xt=gt+Math.cos(At)*vt}else if(90<=ct){var Tt=Ze.r2d(180-ct);mt=yt-Math.sin(Tt)*vt,wt=gt-Math.cos(Tt)*vt,bt=yt+Math.sin(Tt)*vt,xt=gt+Math.cos(Tt)*vt}else if(0<=ct){var Mt=Ze.r2d(ct);mt=yt-Math.sin(Mt)*vt,wt=gt+Math.cos(Mt)*vt,bt=yt+Math.sin(Mt)*vt,xt=gt-Math.cos(Mt)*vt}var Ot=ei(ft,_t);if(t===qe.CANVAS){var Pt=e.createLinearGradient(mt,wt,bt,xt);Ot.forEach(function(t){Pt.addColorStop(t[1],t[0])}),e.beginPath(),e.fillStyle=Pt,e.rect(j,H,q,Q),e.fill(),e.closePath()}else if(t===qe.SVG){var Wt=this.defs.add({tagName:"linearGradient",props:[["x1",mt],["y1",wt],["x2",bt],["y2",xt]],stop:Ot});this.addBackground([["x",j],["y",H],["width",q],["height",Q],["fill","url(#".concat(Wt,")")]])}}else if("radial"===ut){var Et,St,Nt,Lt=j+.5*q,Ct=H+.5*Q,Xt="farthest-corner";if(/circle|ellipse|at|closest|farthest/i.test(ft[0])||!/#[0-9a-f]{3,6}/i.test(ft[0])&&!/\brgba?\(.*\)/i.test(ft[0])){var Bt,Rt,Dt=ft[0].indexOf("at");if(-1<Dt&&(Bt=ft[0].slice(Dt+2),Rt=ft[0].slice(0,Dt-1)),(Rt=/(closest|farthest)-(side|corner)/.exec(Rt))?Xt=Rt[0]:(Rt=/\s+(-?[\d.]+(?:px|%))\s*(-?[\d.]+(?:px|%))?/.exec(Rt))&&(Xt=null,Et=-1<Rt[1].indexOf("px")?.5*parseFloat(Rt[1]):parseFloat(Rt[1])*q*.005),Bt&&(Rt=/\s+(-?[\d.]+(?:px|%))\s*(-?[\d.]+(?:px|%))?/.exec(Bt))){Lt=-1<Rt[1].indexOf("px")?j+parseFloat(Rt[1]):j+parseFloat(Rt[1])*q*.01;var It=Rt[2]||Rt[1];Ct=-1<It.indexOf("px")?H+parseFloat(It):H+parseFloat(It)*Q*.01}}else ft.unshift(null);if(Xt)if("closest-side"===Xt)if(Lt<=j||F<=Lt||Ct<=H||z<=Ct)Et=0;else St=Lt<j+.5*q?Lt-j:F-Lt,Nt=Ct<H+.5*Q?Ct-H:z-Ct,Et=Math.min(St,Nt);else if("closest-corner"===Xt){var Ut,Vt;Ut=Lt<j+.5*q?Lt-j:F-Lt,Vt=Ct<H+.5*Q?Ct-H:z-Ct,Et=Math.sqrt(Math.pow(Ut,2)+Math.pow(Vt,2))}else if("farthest-side"===Xt)if(Lt<=j)Et=j-Lt+q;else if(F<=Lt)Et=Lt-F+q;else if(Ct<=H)Et=H-Ct+Q;else if(z<=Lt)Et=Ct-z+Q;else{var jt=Math.max(F-Lt,Lt-j),Ft=Math.max(z-Ct,Ct-H);Et=Math.max(jt,Ft)}else{var Gt,Yt;Gt=Lt<j+.5*q?F-Lt:Lt-j,Yt=Ct<H+.5*Q?z-Ct:Ct-H,Et=Math.sqrt(Math.pow(Gt,2)+Math.pow(Yt,2))}var Ht=ei(ft,2*Et);if(Et<=0){var zt=Ht[Ht.length-1];zt[1]=0,Ht=[zt],Lt=j,Ct=H,Et=q+Q}if(t===qe.CANVAS){var $t=e.createRadialGradient(Lt,Ct,0,Lt,Ct,Et);Ht.forEach(function(t){$t.addColorStop(t[1],t[0])}),e.beginPath(),e.fillStyle=$t,e.rect(j,H,q,Q),e.fill(),e.closePath()}else if(t===qe.SVG){var qt=this.defs.add({tagName:"radialGradient",props:[["cx",Lt],["cy",Ct],["r",Et]],stop:Ht});this.addBackground([["x",j],["y",H],["width",q],["height",Q],["fill","url(#".concat(qt,")")]])}}}else w&&"transparent"!==w&&(t===qe.CANVAS?(e.beginPath(),e.fillStyle=w,e.rect(j,H,q,Q),e.fill(),e.closePath()):t===qe.SVG&&this.addBackground([["x",j],["y",H],["width",q],["height",Q],["fill",w]]));if(0<R&&"transparent"!==x){var Qt=[];if(-1<["dashed","dotted"].indexOf(k)){var Zt=Ke(k,V,j,F,G,R),Jt=Zt.n,Kt=Zt.ps,te=Zt.pd;if(Jt<=1)Qt.push([V,Y,G,Y,F,H,j,H]);else for(var ee=Math.atan(R/U),ie=Math.atan(R/D),re=0;re<Jt;re++){var ne=re===Jt-1,ae=re?V+Kt*re+te*re:V,oe=ae+Kt,se=void 0,he=void 0;oe<j?ne?Qt.push([V,Y,G,Y,F,H,j,H]):(se=Y+(ae-V)*Math.tan(ee),he=Y+(oe-V)*Math.tan(ee),Qt.push([ae,Y,oe,Y,oe,he,ae,se])):F<ae?(se=Y+(G-ae)*Math.tan(ie),he=Y+(G-oe)*Math.tan(ie),ne?Qt.push([ae,Y,G,Y,ae,se]):Qt.push([ae,Y,oe,Y,oe,he,ae,se])):ae<j?(se=Y+(ae-V)*Math.tan(ee),ne?Qt.push([ae,Y,G,Y,F,H,j,H,ae,se]):F<oe?Qt.push([ae,Y,oe,Y,F,H,j,H,ae,se]):Qt.push([ae,Y,oe,Y,oe,H,j,H,ae,se])):F<oe?(se=Y+(G-oe)*Math.tan(ie),ae<j?ne?Qt.push([ae,Y,G,Y,F,H,j,H,ae,se]):Qt.push([ae,Y,oe,Y,oe,se,F,H,j,H,ae,se]):ne?Qt.push([ae,Y,G,Y,F,H,ae,H]):Qt.push([ae,Y,oe,Y,oe,se,F,H,ae,H])):ne?Qt.push([ae,Y,G,Y,F,H,ae,H]):Qt.push([ae,Y,oe,Y,oe,H,ae,H])}}else Qt.push([V,Y,G,Y,F,H,j,H]);ti(t,Qt,x,e,this)}if(0<D&&"transparent"!==T){var le=[];if(-1<["dashed","dotted"].indexOf(M)){var ue=Ke(M,Y,H,z,$,D),fe=ue.n,ce=ue.ps,de=ue.pd;if(fe<=1)le.push([F,H,G,Y,G,$,F,z]);else for(var pe=Math.atan(D/R),_e=Math.atan(D/I),ve=0;ve<fe;ve++){var ye=ve===fe-1,ge=ve?Y+ce*ve+de*ve:Y,me=ge+ce,we=void 0,be=void 0;me<H?ye?le.push([F,H,G,Y,G,$,F,z]):(we=G-(me-Y)*Math.tan(pe),be=G-(ge-Y)*Math.tan(pe),le.push([we,me,be,ge,G,ge,G,me])):z<ge?(we=F+(ge-z)*Math.tan(_e),be=F+(me-z)*Math.tan(_e),ye?le.push([we,ge,G,ge,G,$]):le.push([we,ge,G,ge,G,me,be,me])):ge<H?(we=F+(H-ge)*Math.tan(pe),ye?le.push([F,H,we,ge,G,ge,G,$,F,$]):z<me?le.push([F,H,we,ge,G,ge,G,me,we,me,F,z]):le.push([F,H,we,ge,G,ge,G,me,F,me])):z<me?(we=F+(me-z)*Math.tan(_e),ge<H?ye?le.push([F,H,we,ge,G,ge,G,$,F,z]):le.push([F,H,we,ge,G,ge,G,me,we,me,F,z]):ye?le.push([F,ge,G,ge,G,$,F,z]):le.push([F,ge,G,ge,G,me,we,me,F,z])):ye?le.push([F,ge,G,ge,G,$,F,z]):le.push([F,ge,G,ge,G,me,F,me])}}else le.push([F,H,G,Y,G,$,F,z]);ti(t,le,T,e,this)}if(0<I&&"transparent"!==P){var xe=[];if(-1<["dashed","dotted"].indexOf(W))for(var ke=Ke(W,V,j,F,G,I),Ae=ke.n,Te=ke.ps,Me=ke.pd,Oe=Math.atan(I/U),Pe=Math.atan(I/D),We=0;We<Ae;We++){var Ee=We===Ae-1,Se=We?V+Te*We+Me*We:V,Ne=Se+Te,Le=void 0,Ce=void 0;Ne<j?Ee?xe.push([V,$,j,z,F,z,G,$]):(Le=$-(Se-V)*Math.tan(Oe),Ce=$-(Ne-V)*Math.tan(Oe),xe.push([Se,Le,Ne,Ce,Ne,$,Se,$])):F<Se?(Le=$-(Se-V)*Math.tan(Pe),Ce=$-(Ne-V)*Math.tan(Pe),Ee?xe.push([Se,Le,G,$,Se,$]):xe.push([Se,Le,Ne,Ce,Ne,$,Se,$])):Se<j?(Le=z+(Se-V)*Math.tan(Oe),Ee?xe.push([Se,Le,j,z,F,z,G,$,Se,$]):F<Ne?xe.push([Se,Le,j,z,F,z,Ne,$,Se,$]):xe.push([Se,Le,j,z,Ne,z,Ne,$,Se,$])):F<Ne?(Le=$-(G-Ne)*Math.tan(Pe),Se<j?Ee?xe.push([Se,Le,F,z,G,$,Se,$]):xe.push([Se,Le,F,z,Ne,Le,Ne,$,Se,$]):Ee?xe.push([Se,z,F,z,G,$,Se,$]):xe.push([Se,z,F,z,Ne,Le,Ne,$,Se,$])):Ee?xe.push([Se,z,F,z,G,$,Se,$]):xe.push([Se,z,Ne,z,Ne,$,Se,$])}else xe.push([V,$,j,z,F,z,G,$]);ti(t,xe,P,e,this)}if(0<U&&"transparent"!==S){var Xe=[];if(-1<["dashed","dotted"].indexOf(N)){var Be=Ke(N,Y,H,z,$,U),Re=Be.n,De=Be.ps,Ie=Be.pd;if(Re<=1)Xe.push([V,Y,j,H,j,z,V,$]);else for(var Ue=Math.atan(U/R),Ve=Math.atan(U/I),je=0;je<Re;je++){var Fe=je===Re-1,Ge=je?Y+De*je+Ie*je:Y,Ye=Ge+De,He=void 0,ze=void 0;Ye<H?Fe?Xe.push([V,Y,j,H,j,z,V,$]):(He=V+(Ge-Y)*Math.tan(Ue),ze=V+(Ye-Y)*Math.tan(Ue),Xe.push([V,Ge,He,Ge,ze,Ye,V,Ye])):z<Ge?(He=V+($-Ge)*Math.tan(Ve),ze=V+($-Ye)*Math.tan(Ve),Fe?Xe.push([V,Ge,He,Ge,V,$]):Xe.push([V,Ge,He,Ge,ze,Ye,V,Ye])):Ge<H?(He=V+(Ge-Y)*Math.tan(Ue),Fe?Xe.push([V,Ge,He,Ge,j,H,j,z,V,$]):z<Ye?Xe.push([V,Ge,He,Ge,j,H,j,z,He,Ye,V,Ye]):Xe.push([V,Ge,He,Ge,j,H,j,Ye,V,Ye])):z<Ye?(He=V+($-Ye)*Math.tan(Ve),Ge<H?Fe?Xe.push([V,Ge,He,Ge,j,H,j,z,V,$]):Xe.push([V,Ge,He,Ge,j,H,j,z,He,Ye,V,Ye]):Fe?Xe.push([V,Ge,j,Ge,j,z,V,$]):Xe.push([V,Ge,j,Ge,j,z,He,Ye,V,Ye])):Fe?Xe.push([V,Ge,j,Ge,j,z,V,$]):Xe.push([V,Ge,j,Ge,j,Ye,V,Ye])}}else Xe.push([V,Y,j,H,j,z,V,$]);ti(t,Xe,S,e,this)}}}},{key:"__emitEvent",value:function(e,i,r){var t=e.event.type,n=e.x,a=e.y,o=e.covers,s=this.listener,h=this.children,l=this.style,u=this.outerWidth,f=this.outerHeight,c=this.matrix;if("none"!==l.display){var d,p;if(s.hasOwnProperty(t)&&(d=s[t]),i)return h.forEach(function(t){t instanceof m&&!t.isGeom()&&t.__emitEvent(e,i,r)}),void(d&&d(e));if(!this.isGeom()){for(var _=h.length-1;0<=_;_--){var v=h[_];v instanceof m&&-1<["absolute","relative"].indexOf(v.style.position)&&v.__emitEvent(e)&&(p=!0)}for(var y=h.length-1;0<=y;y--){var g=h[y];g instanceof m&&-1===["absolute","relative"].indexOf(g.style.position)&&g.__emitEvent(e)&&(p=!0)}}(p||this.willResponseEvent(e))&&(o.push({x:n,y:a,w:u,h:f,matrix:c}),e.target||(e.target=this),d&&d(e))}}},{key:"willResponseEvent",value:function(t){var e=t.x,i=t.y,r=t.covers,n=this.rx,a=this.ry,o=this.outerWidth,s=this.outerHeight,h=this.matrix;if(Je.pointInQuadrilateral(e-n,i-a,0,0,o,0,0,s,o,s,h)){for(var l=0,u=r.length;l<u;l++){var f=r[l],c=f.x,d=f.y,p=f.w,_=f.h,v=f.matrix;if(Je.pointInQuadrilateral(e-n,i-a,c-n,d-a,c-n+p,d-a,c-n,d-a+_,c-n+p,d-a+_,v))return}return t.target||(t.target=this),!0}}},{key:"addBorder",value:function(t){this.virtualDom.bb.push({type:"item",tagName:"path",props:t})}},{key:"addBackground",value:function(t){this.virtualDom.bb.push({type:"item",tagName:"rect",props:t})}},{key:"addTransform",value:function(t){this.virtualDom.transform.push(t)}},{key:"tagName",get:function(){return this.__tagName}},{key:"mtw",get:function(){return this.__mtw}},{key:"mrw",get:function(){return this.__mrw}},{key:"mbw",get:function(){return this.__mbw}},{key:"mlw",get:function(){return this.__mlw}},{key:"ptw",get:function(){return this.__ptw}},{key:"prw",get:function(){return this.__prw}},{key:"pbw",get:function(){return this.__pbw}},{key:"plw",get:function(){return this.__plw}},{key:"outerWidth",get:function(){var t=this.mlw,e=this.mrw,i=this.plw,r=this.prw,n=this.style,a=n.borderLeftWidth,o=n.borderRightWidth;return this.width+a.value+o.value+t+e+i+r}},{key:"outerHeight",get:function(){var t=this.mtw,e=this.mbw,i=this.ptw,r=this.pbw,n=this.style,a=n.borderTopWidth,o=n.borderBottomWidth;return this.height+a.value+o.value+t+e+i+r}},{key:"listener",get:function(){return this.__listener}},{key:"renderMode",get:function(){return this.__renderMode}}]),m}(),b={lhr:1.14990234375,car:1.1171875,blr:.9052734375,mdr:.64599609375,lgr:.03271484375},x={position:"static",display:"block",borderSizing:"content-box",top:"auto",right:"auto",bottom:"auto",left:"auto",marginTop:0,marginRight:0,marginBottom:0,marginLeft:0,paddingTop:0,paddingRight:0,paddingBottom:0,paddingLeft:0,fontSize:16,fontFamily:"arial",color:"#000",fontStyle:"normal",fontWeight:400,lineHeight:"normal",borderTopWidth:0,borderRightWidth:0,borderBottomWidth:0,borderLeftWidth:0,borderTopColor:"#000",borderRightColor:"#000",borderBottomColor:"#000",borderLeftColor:"#000",borderTopStyle:"solid",borderRightStyle:"solid",borderBottomStyle:"solid",borderLeftStyle:"solid",borderTopLeftRadius:0,borderTopRightRadius:0,borderBottomLeftRadius:0,borderBottomRightRadius:0,verticalAlign:"baseline",width:"auto",height:"auto",flexGrow:0,flexShrink:1,flexBasis:"auto",flexDirection:"row",justifyContent:"flex-start",alignItems:"stretch",textAlign:"left",visibility:"visible",transformOrigin:"center",fill:"#000",stroke:"#000",strokeWidth:0,strokeDasharray:[]},k=[];function A(t,e){var i="border".concat(e);if(t[i]){var r=/\b\d+px\b/i.exec(t[i]);r&&(t[i+"Width"]=r[0]);var n=/\b(solid|dashed|dotted)\b/i.exec(t[i]);n&&(t[i+"Style"]=n[1]);var a=/#[0-9a-f]{3,6}/i.exec(t[i]);a&&-1<[4,7].indexOf(a[0].length)?t[i+"Color"]=a[0]:/\btransparent\b/i.test(t[i])?t[i+"Color"]="transparent":(a=/rgba?\(.+\)/i.exec(t[i]))&&(t[i+"Color"]=a[0])}}function T(t,e,i){return"auto"===i?t[e]={unit:Qe.AUTO}:/px$/.test(i)?(i=parseFloat(i)||0,t[e]={value:i,unit:Qe.PX}):/%$/.test(i)?0===e.indexOf("border")?t[e]={value:0,unit:Qe.PX}:(i=parseFloat(i)||0,t[e]={value:i,unit:Qe.PERCENT}):(i=parseFloat(i)||0,t[e]={value:i,unit:Qe.PX}),t}Object.keys(x).forEach(function(t){var e=x[t];k.push({k:t,v:e})});var M={normalize:function(i){k.forEach(function(t){i.hasOwnProperty(t.k)||(i[t.k]=t.v)});var t=i.background;if(t){var e=/\b(\w+)-gradient\((.+)\)/.exec(t);if(e)i.backgroundGradient={k:e[1],v:e[2].split(/\s*,\s*/)};else{var r=/#[0-9a-f]{3,6}/i.exec(t);r&&-1<[4,7].indexOf(r[0].length)?i.backgroundColor=r[0]:(r=/rgba?\(.+\)/i.exec(t))&&(i.backgroundColor=r[0])}}if((t=i.flex)&&("none"===t?(i.flexGrow=0,i.flexShrink=0,i.flexBasis="auto"):"auto"===t?(i.flexGrow=1,i.flexShrink=1,i.flexBasis="auto"):/^[\d.]+$/.test(t)?(i.flexGrow=parseFloat(t),i.flexShrink=1,i.flexBasis=0):/^[\d.]+px$/.test(t)||/^[\d.]+%$/.test(t)||(i.flexGrow=0,i.flexShrink=1,i.flexBasis="auto")),(t=i.border)&&(i.borderTop=i.borderRight=i.borderBottom=i.borderLeft=t),t=i.margin){var n=t.toString().match(/(-?[\d.]+(px|%)?)|(auto)/gi);n&&(1===n.length?n[3]=n[2]=n[1]=n[0]:2===n.length?(n[2]=n[0],n[3]=n[1]):3===n.length&&(n[3]=n[1]),i.marginTop=n[0],i.marginRight=n[1],i.marginBottom=n[2],i.marginLeft=n[3])}if(t=i.padding){var a=t.toString().match(/(-?[\d.]+(px|%)?)|(auto)/gi);a&&(1===a.length?a[3]=a[2]=a[1]=a[0]:2===a.length?(a[2]=a[0],a[3]=a[1]):3===a.length&&(a[3]=a[1]),i.paddingTop=a[0],i.paddingRight=a[1],i.paddingBottom=a[2],i.paddingLeft=a[3])}if((t=i.borderRadius)&&(i.borderTopRightRadius=i.borderTopLeftRadius=i.borderBottomRightRadius=i.borderBottomLeftRadius=t),t=i.transform){var o=t.toString().match(/\w+\(.+?\)/g);if(o){var c=i.transform=[];o.forEach(function(t){var e=t.indexOf("("),i=t.slice(0,e),r=t.slice(e+1,t.length-1);if("matrix"===i){var n=r.split(/\s*,\s*/);if(6<(n=n.map(function(t){return parseFloat(t)})).length)n=n.slice(0,6);else if(n.length<6)for(;n.length<6;)n.push(0);c.push(["matrix",n])}else if("translateX"===i){var a=["translateX",r];c.push(T(a,1,r))}else if("translateY"===i){var o=["translateY",r];c.push(T(o,1,r))}else if("translate"===i){var s=r.split(/\s*,\s*/),h=["translateX",s[0]],l=["translateY",s[1]];c.push(T(h,1,r)),c.push(T(l,1,r))}else if("scaleX"===i)c.push(["scaleX",parseFloat(r)||0]);else if("scaleY"===i)c.push(["scaleY",parseFloat(r)||0]);else if("scale"===i){var u=r.split(/\s*,\s*/);c.push(["scaleX",parseFloat(u[0])||0]),c.push(["scaleX",parseFloat(u[1])||0])}else if("rotateZ"===i||"rotate"===i)c.push(["rotate",parseFloat(r)||0]);else if("skewX"===i)c.push(["skewX",parseFloat(r)||0]);else if("skewY"===i)c.push(["skewY",parseFloat(r)||0]);else if("skew"===i){var f=r.split(/\s*,\s*/);c.push(["skewX",parseFloat(f[0])||0]),c.push(["skewY",parseFloat(f[1])||0])}})}}if(t=i.transformOrigin){var s=t.toString().match(/(-?[\d.]+(px|%)?)|(left|top|right|bottom|center)/gi);if(s){1===s.length&&(s[1]=s[0]);for(var h=[],l=0;l<2;l++){var u=s[l];/px$/.test(u)?h.push({value:parseFloat(u),unit:Qe.PX}):/%$/.test(u)?h.push({value:parseFloat(u),unit:Qe.PERCENT}):h.push({value:u,unit:Qe.POSITION})}i.transformOrigin=h}}A(i,"Top"),A(i,"Right"),A(i,"Bottom"),A(i,"Left"),["marginTop","marginRight","marginBottom","marginLeft","paddingTop","paddingRight","paddingBottom","paddingLeft","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius","top","right","bottom","left","width","height","flexBasis"].forEach(function(t){var e=i[t];T(i,t,e)});var f=i.lineHeight;f="normal"===f?{value:i.fontSize*b.lhr,unit:Qe.PX}:/px$/.test(f)?(f=parseFloat(f),{value:Math.max(i.fontSize,f),unit:Qe.PX}):"normal"===(f=parseFloat(f)||"normal")?{value:i.fontSize*b.lhr,unit:Qe.PX}:{value:f*i.fontSize,unit:Qe.PX},i.lineHeight=f},setFontStyle:function(t){var e=t.fontStyle,i=t.fontWeight,r=t.fontSize,n=t.fontFamily;return"".concat(e," ").concat(i," ").concat(r,"px/").concat(r,"px ").concat(n)},getBaseLine:function(t){var e=t.fontSize*b.lhr;return.5*(t.lineHeight.value-e)+t.fontSize*b.blr}},O=function(){function o(t,e,i,r,n,a){s(this,o),this.__parent=t,this.__x=e,this.__y=i,this.__width=r,this.__content=n,this.__style=a,this.__virtualDom={}}return a(o,[{key:"render",value:function(t,e){var i=this.style,r=this.content,n=this.x,a=this.y,o=this.parent,s=o.ox,h=o.oy;a+=M.getBaseLine(i),n+=s,a+=h,t===qe.CANVAS?e.fillText(r,n,a):t===qe.SVG&&(this.__virtualDom={type:"item",tagName:"text",props:[["x",n],["y",a],["fill",i.color],["font-size","".concat(i.fontSize,"px")]],content:r})}},{key:"__offsetX",value:function(t){this.__x+=t}},{key:"__offsetY",value:function(t){this.__y+=t}},{key:"x",get:function(){return this.__x}},{key:"y",get:function(){return this.__y}},{key:"width",get:function(){return this.__width}},{key:"content",get:function(){return this.__content}},{key:"style",get:function(){return this.__style}},{key:"baseLine",get:function(){return M.getBaseLine(this.style)}},{key:"virtualDom",get:function(){return this.__virtualDom}},{key:"parent",get:function(){return this.__parent}}]),o}(),P={},W=function(){function i(t){var e;return s(this,i),(e=o(this,L(i).call(this))).__content=t.toString(),e.__lineBoxes=[],e.__charWidthList=[],e.__charWidth=0,e.__textWidth=0,e}return t(i,l),a(i,[{key:"__measure",value:function(){this.__charWidthList=[];var t=this.ctx,e=this.content,i=this.style,r=this.charWidthList,n=this.renderMode;n===qe.CANVAS&&(t.font=M.setFontStyle(i));for(var a=P[i.fontSize]=P[i.fontSize]||{},o=e.length,s=0,h=0;h<o;h++){var l=e.charAt(h),u=void 0;a.hasOwnProperty(l)?u=a[l]:n===qe.CANVAS?u=a[l]=t.measureText(l).width:n===qe.SVG&&(u=a[l]=qe.measure(l,i)),r.push(u),s+=u,this.__charWidth=Math.max(this.charWidth,u)}this.__textWidth=s}},{key:"__layout",value:function(t,e){var i=this,r=t.x,n=t.y,a=t.w;t.h;this.__x=r,this.__y=n;for(var o=r,s=(this.ctx,this.content),h=this.style,l=this.lineBoxes,u=this.charWidthList,f=(this.renderMode,0),c=0,d=0,p=s.length;c<p;)if((d+=u[c])===a){var _=new O(this,r,n,d,s.slice(f,c+1),h);l.push(_),o=Math.max(o,r+d),n+=this.style.lineHeight.value,c=(f=c+1)+1,d=0}else if(a<d){c===f&&(c=f+1);var v=new O(this,r,n,d-u[c],s.slice(f,c),h);l.push(v),o=Math.max(o,r+d-u[c]),n+=this.style.lineHeight.value,f=c,c+=1,d=0}else c++;if(f<p&&f<c){for(d=0,c=f;c<p;c++)d+=u[c];var y=new O(this,r,n,d,s.slice(f,p),h);l.push(y),o=Math.max(o,r+d),n+=h.lineHeight.value}if(this.__width=o-r,this.__height=n-t.y,e)this.__lineBoxes=[];else{var g=h.textAlign;-1<["center","right"].indexOf(g)&&l.forEach(function(t){var e=i.__width-t.width;0<e&&t.__offsetX("center"===g?.5*e:e)})}}},{key:"render",value:function(e){var i=this.ctx,t=this.style;e===qe.CANVAS&&(i.font=M.setFontStyle(t),i.fillStyle=t.color),this.lineBoxes.forEach(function(t){t.render(e,i)}),e===qe.SVG&&(this.__virtualDom={type:"text",children:this.lineBoxes.map(function(t){return t.virtualDom})})}},{key:"__tryLayInline",value:function(t){return t-this.textWidth}},{key:"__calMaxAndMinWidth",value:function(){var e=0;return this.charWidthList.forEach(function(t){e=Math.max(e,t)}),{max:this.textWidth,min:e}}},{key:"content",get:function(){return this.__content},set:function(t){this.__content=t}},{key:"lineBoxes",get:function(){return this.__lineBoxes}},{key:"charWidthList",get:function(){return this.__charWidthList}},{key:"charWidth",get:function(){return this.__charWidth}},{key:"textWidth",get:function(){return this.__textWidth}},{key:"baseLine",get:function(){var t=this.lineBoxes[this.lineBoxes.length-1];return t.y-this.y+t.baseLine}},{key:"renderMode",get:function(){return this.__renderMode}}]),i}(),S=function(){function i(t,e){s(this,i),this.__list=[],this.__x=t,this.__y=e,this.__baseLine=0}return a(i,[{key:"add",value:function(t){this.list.push(t)}},{key:"__calBaseLine",value:function(){var e=0;return this.list.forEach(function(t){e=Math.max(e,t.baseLine)}),e}},{key:"verticalAlign",value:function(){var e=this;this.__baseLine=this.__calBaseLine(),1<this.list.length&&this.list.forEach(function(t){t.baseLine!==e.baseLine&&t.__offsetY(e.baseLine-t.baseLine)})}},{key:"horizonAlign",value:function(e){this.list.forEach(function(t){t.__offsetX(e)})}},{key:"list",get:function(){return this.__list}},{key:"x",get:function(){return this.__x}},{key:"y",get:function(){return this.__y}},{key:"width",get:function(){var e=0;return this.list.forEach(function(t){e+=t.width}),e}},{key:"height",get:function(){var e=0;return this.list.forEach(function(t){e=Math.max(e,t.height)}),e}},{key:"baseLine",get:function(){return this.__baseLine}},{key:"size",get:function(){return this.__list.length}}]),i}(),E={},X=function(){function i(t,e){return s(this,i),o(this,L(i).call(this,t,e))}return t(i,Q),a(i,[{key:"__initStyle",value:function(){M.normalize(this.style)}},{key:"__tryLayInline",value:function(t,e){var i=this.style.width;return i.unit===Qe.PX?t-i.value:i.unit===Qe.PERCENT?t-e*i.value*.01:t}},{key:"__calAutoBasis",value:function(t,e,i){var r=0,n=0,a=0,o=this.style,s=o.width,h=o.height,l=o.borderTopWidth,u=o.borderRightWidth,f=o.borderBottomWidth,c=o.borderLeftWidth,d=t?s:h;if(d.unit!==Qe.AUTO&&(r=a+=d.value),t){var p=u.value+c.value;r+=p,a+=p,n+=p}else{var _=l.value+f.value;r+=_,a+=_,n+=_}return{b:r,min:n,max:a}}},{key:"__layoutBlock",value:function(t){var e=t.x,i=t.y,r=t.w,n=t.h;this.__x=e,this.__y=i,this.__width=r;var a,o=this.style,s=o.width,h=o.height,l=o.borderTopWidth,u=o.borderRightWidth,f=o.borderBottomWidth,c=o.borderLeftWidth;if(s&&s.unit!==Qe.AUTO)switch(s.unit){case Qe.PX:r=s.value}if(h&&h.unit!==Qe.AUTO)switch(a=!0,h.unit){case Qe.PX:n=h.value;break;case Qe.PERCENT:n*=.01*h.value}e+=c.value,t.x=e,i+=l.value,t.y=i,r-=c.value+u.value,n-=l.value+f.value,this.__width=r,this.__height=a?n:0}},{key:"__layoutFlex",value:function(t){this.__layoutBlock(t)}},{key:"__layoutInline",value:function(t){var e=t.x,i=t.y,r=t.w,n=t.h;this.__x=e,this.__y=i;var a,o,s=this.style,h=s.width,l=s.height,u=s.borderTopWidth,f=s.borderRightWidth,c=s.borderBottomWidth,d=s.borderLeftWidth;if(h&&h.unit!==Qe.AUTO)switch(a=!0,h.unit){case Qe.PX:r=h.value}if(l&&l.unit!==Qe.AUTO)switch(o=!0,l.unit){case Qe.PX:n=l.value}e+=d.value,t.x=e,i+=u.value,t.y=i,r-=d.value+f.value,n-=u.value+c.value,this.__width=a?r:e-t.x,this.__height=o?n:i-t.y}},{key:"__calAbs",value:function(){return 0}},{key:"render",value:function(t){C(L(i.prototype),"render",this).call(this,t),t===qe.SVG&&(this.__virtualDom=n({},C(L(i.prototype),"virtualDom",this),{type:"geom"}))}},{key:"tagName",get:function(){return this.__tagName}},{key:"baseLine",get:function(){return this.__height}}],[{key:"getImplement",value:function(t){if(!E.hasOwnProperty(t))throw new Error("Geom has not register: ".concat(t));return E[t]}},{key:"register",value:function(t,e){if(E.hasOwnProperty(t))throw new Error("Geom has already register: ".concat(t));E[t]=e}}]),i}(),N={div:!0,span:!0},B={span:!0},R=function(){function u(t,e,i){var r;return s(this,u),(r=o(this,L(u).call(this,t,e))).__children=i,r.__flowChildren=[],r.__absChildren=[],r.__lineGroups=[],r.__flowY=0,r}return t(u,Q),a(u,[{key:"__traverse",value:function(e,i,t){var r=this,n=[];this.__traverseChildren(this.children,n,e,i,t);for(var a=n.length-1;0<a;a--){var o=n[a];if(o instanceof W){var s=n[a-1];s instanceof W?(s.content+=o.content,n.splice(a,1)):a--}}if("inline"===this.style.display&&"flex"!==this.parent.style.display)for(var h=n.length-1;0<=h;h--){var l=n[h];if(l instanceof u&&"inline"!==l.style.display)throw new Error("inline can not contain block/flex")}n.forEach(function(t){t.__ctx=e,t.__defs=i,t.__parent=r,t.__prev=null,t instanceof W||"absolute"!==t.style.position?r.__flowChildren.push(t):r.__absChildren.push(t)}),this.__children=n}},{key:"__traverseChildren",value:function(t,e,i,r,n){var a=this;if(Array.isArray(t))t.forEach(function(t){a.__traverseChildren(t,e,i,r,n)});else if(t instanceof u)e.push(t),t.__traverse(i,r,n);else if(t instanceof X)e.push(t);else if(!Ze.isNil(t)){var o=new W(t);o.__renderMode=n,e.push(o)}}},{key:"__initStyle",value:function(){var e=this.__style;e.display&&-1!==["flex","block","inline","none"].indexOf(e.display)||(B.hasOwnProperty(this.tagName)?e.display="inline":e.display="block");var t=this.parent;if(t){var i=t.style;["fontSize","fontWeight","fontStyle","lineHeight","wordBreak","color","textAlign"].forEach(function(t){!e.hasOwnProperty(t)&&i.hasOwnProperty(t)&&(e[t]=i[t])})}M.normalize(e),this.children.forEach(function(t){t instanceof Q?t.__initStyle():(t.__style=e,t.__measure())})}},{key:"__tryLayInline",value:function(t,e){var i=this.flowChildren,r=this.style.width;if(r.unit===Qe.PX)return t-r.value;if(r.unit===Qe.PERCENT)return t-e*r.value*.01;for(var n=0;n<i.length;n++){if(t<0)return t;var a=i[n];t-=a instanceof Q?a.__tryLayInline(t,e):a.textWidth}return t}},{key:"__offsetX",value:function(e){C(L(u.prototype),"__offsetX",this).call(this,e),this.flowChildren.forEach(function(t){t&&t.__offsetX(e)})}},{key:"__offsetY",value:function(e){C(L(u.prototype),"__offsetY",this).call(this,e),this.flowChildren.forEach(function(t){t&&t.__offsetY(e)})}},{key:"__calAutoBasis",value:function(a,o,s,t){var h=0,l=0,u=0,e=this.mtw,i=this.mrw,r=this.mbw,n=this.mlw,f=this.ptw,c=this.prw,d=this.pbw,p=this.plw,_=this.flowChildren,v=this.style,y=v.width,g=v.height,m=v.borderTopWidth,w=v.borderRightWidth,b=v.borderBottomWidth,x=v.borderLeftWidth,k=a?y:g;if(k.unit===Qe.PX&&(h=u=k.value,t&&(l=h)),_.forEach(function(t){if(t instanceof Q){var e=t.__calAutoBasis(a,o,s,!0),i=e.b,r=e.min,n=e.max;h=Math.max(h,i),l=Math.max(l,r),u=Math.max(u,n)}else u=a?(l=Math.max(t.charWidth,l),Math.max(t.textWidth,u)):(t.__layout({x:0,y:0,w:o,h:s},!0),l=Math.max(l,t.height),Math.max(u,t.height))}),a){var A=w.value+x.value+n+i+p+c;h+=A,u+=A,l+=A}else{var T=m.value+b.value+e+r+f+d;h+=T,u+=T,l+=T}return{b:h,min:l,max:u}}},{key:"__calAbs",value:function(i){var r=0,t=this.mtw,e=this.mrw,n=this.mbw,a=this.mlw,o=this.ptw,s=this.prw,h=this.pbw,l=this.plw,u=this.flowChildren,f=this.style,c=f.width,d=f.height,p=f.borderTopWidth,_=f.borderRightWidth,v=f.borderBottomWidth,y=f.borderLeftWidth,g=i?c:d;if(g.unit===Qe.PX&&(r=g.value),u.forEach(function(t){if(t instanceof Q){var e=t.__calAbs(i);r=Math.max(r,e)}else r=i?Math.max(t.textWidth,r):(t.__layout({x:0,y:0,w:1/0,h:1/0},!0),Math.max(r,t.height))}),i){var m=_.value+y.value+a+e+l+s;r+=m}else{var w=p.value+v.value+t+n+o+h;r+=w}return r}},{key:"__layoutBlock",value:function(e){var i=e.x,r=e.y,n=e.w,a=e.h;this.__x=i,this.__y=r,this.__width=n;var t,o=this.flowChildren,s=this.style,h=this.lineGroups,l=this.mlw,u=this.mtw,f=this.mrw,c=this.mbw,d=this.plw,p=this.ptw,_=this.prw,v=this.pbw,y=s.width,g=s.height,m=s.marginLeft,w=s.marginRight,b=s.borderTopWidth,x=s.borderRightWidth,k=s.borderBottomWidth,A=s.borderLeftWidth,T=s.textAlign;if(y&&y.unit!==Qe.AUTO)switch(y.unit){case Qe.PX:n=y.value;break;case Qe.PERCENT:n*=.01*y.value}if(g&&g.unit!==Qe.AUTO)switch(t=!0,g.unit){case Qe.PX:a=g.value;break;case Qe.PERCENT:a*=.01*g.value}i+=A.value+l+d,e.x=i,r+=b.value+u+p,e.y=r,y.unit===Qe.AUTO&&(n-=A.value+x.value+l+f+d+_),g.unit===Qe.AUTO&&(a-=b.value+k.value+u+c+p+v);var M=new S(i,r);if(o.forEach(function(t){t instanceof Q?"inline"===t.style.display?i===e.x?(M.add(t),t.__layout({x:i,y:r,w:n,h:a}),i+=t.outerWidth):(0<=t.__tryLayInline(n-i,n)?t.__layout({x:i,y:r,w:n,h:a}):(h.push(M),M.verticalAlign(),i=e.x,r+=M.height,t.__layout({x:e.x,y:r,w:n,h:a}),M=new S(i,r)),i+=t.outerWidth,M.add(t)):(M.size&&(h.push(M),M.verticalAlign(),r+=M.height,M=new S(e.x,r)),t.__layout({x:e.x,y:r,w:n,h:a}),i=e.x,r+=t.outerHeight):i===e.x?(M.add(t),t.__layout({x:i,y:r,w:n,h:a}),i+=t.width):(0<=t.__tryLayInline(n-i,n)?t.__layout({x:i,y:r,w:n,h:a}):(h.push(M),M.verticalAlign(),i=e.x,r+=M.height,t.__layout({x:e.x,y:r,w:n,h:a}),M=new S(i,r)),i+=t.width,M.add(t))}),M.size&&(h.push(M),M.verticalAlign(),r+=M.height),-1<["center","right"].indexOf(T)&&h.forEach(function(t){var e=n-t.width;0<e&&t.horizonAlign("center"===T?.5*e:e)}),this.__width=n,this.__height=t?a:r-e.y,this.__flowY=r,m.unit===Qe.AUTO&&w.unit===Qe.AUTO&&y.unit!==Qe.AUTO){var O=this.outerWidth;O<e.w&&this.__offsetX(.5*(e.w-O))}}},{key:"__layoutFlex",value:function(t){var T=t.x,M=t.y,O=t.w,P=t.h;this.__x=T,this.__y=M,this.__width=O;var e,W,i=this.flowChildren,r=this.style,n=this.mlw,a=this.mtw,o=this.mrw,s=this.mbw,h=this.plw,l=this.ptw,u=this.prw,f=this.pbw,c=r.width,d=r.height,p=r.flexDirection,_=r.borderTopWidth,v=r.borderRightWidth,y=r.borderBottomWidth,g=r.borderLeftWidth,m=r.justifyContent,w=r.alignItems;if(c&&c.unit!==Qe.AUTO)switch(e=!0,c.unit){case Qe.PX:O=c.value;break;case Qe.PERCENT:O*=.01*c.value}if(d&&d.unit!==Qe.AUTO)switch(W=!0,d.unit){case Qe.PX:P=d.value;break;case Qe.PERCENT:P*=.01*d.value}T+=g.value+n+h,t.x=T,M+=_.value+a+l,t.y=M,c.unit===Qe.AUTO&&(O-=g.value+v.value+n+o+h+u),d.unit===Qe.AUTO&&(P-=_.value+y.value+a+s+l+f);var E="row"===p;if(!E&&!W)return i.forEach(function(t){if(t instanceof Q){var e=t.style,i=t.style,r=i.display,n=i.flexDirection,a=i.width;"inline"===r?e.display="block":"flex"===r&&"row"===n&&a.unit===Qe.AUTO&&(a.value=O,a.unit=Qe.PX),t.__layout({x:T,y:M,w:O,h:P}),M+=t.outerHeight}else t.__layout({x:T,y:M,w:O,h:P}),M+=t.outerHeight}),this.__width=O,void(this.__height=M-t.y);var S=[],N=[],L=[],C=[],X=0,B=0,R=0,b=0;i.forEach(function(t){if(t instanceof Q){var e=t.style,i=e.flexGrow,r=e.flexShrink,n=e.flexBasis;S.push(i),N.push(r),X+=i,B+=r;var a=t.__calAutoBasis(E,O,P),o=a.b,s=a.min,h=a.max;n.unit===Qe.AUTO?(L.push(h),R+=h):n.unit===Qe.PX?(o=n.value,L.push(o),R+=o):n.unit===Qe.PERCENT&&(o=(E?O:P)*n.value,L.push(o),R+=o),b+=h,C.push(s)}else S.push(0),N.push(1),B+=1,E?(L.push(t.textWidth),R+=t.textWidth,b+=t.textWidth,C.push(t.charWidth)):(t.__layout({x:0,y:0,w:O,h:P},!0),L.push(t.height),R+=t.height,b+=t.height,C.push(t.height))});var D=0,I=(E?O:P)<b;i.forEach(function(t,e){var i,r=N[e],n=S[e];if(I){var a=R-(E?O:P);i=r?L[e]-a*r/B:L[e]}else{var o=(E?O:P)-R;i=n?L[e]+o*n/X:L[e]}if(i=Math.max(i,C[e]),t instanceof Q){var s=t.style,h=t.mlw,l=t.mtw,u=t.mrw,f=t.mbw,c=t.plw,d=t.ptw,p=t.prw,_=t.pbw,v=t.style,y=v.display,g=v.flexDirection,m=v.width,w=v.height,b=v.borderTopWidth,x=v.borderRightWidth,k=v.borderBottomWidth,A=v.borderLeftWidth;E?("inline"===y?s.display="block":"flex"===y&&"column"===g&&W&&w.unit===Qe.AUTO&&(w.value=P,w.unit=Qe.PX),t.__layout({x:T,y:M,w:i,h:P})):("inline"===y?s.display="block":"flex"===y&&"row"===g&&m.unit===Qe.AUTO&&(m.value=O,m.unit=Qe.PX),t.__layout({x:T,y:M,w:O,h:i})),I&&r?E?t.__width=i-h-u-c-p-A.value-x.value:t.__height=i-l-f-d-_-b.value-k.value:!I&&n&&(E?t.__width=i-h-u-c-p-A.value-x.value:t.__height=i-l-f-d-_-b.value-k.value)}else t.__layout({x:T,y:M,w:E?i:O,h:E?P:i});D=E?(T+=t.outerWidth,Math.max(D,t.outerHeight)):(M+=t.outerHeight,Math.max(D,t.outerWidth))});var x=E?O-T+t.x:P-M+t.y;if(!I&&0===X&&0<x){var k=i.length;if("flex-end"===m)for(var A=0;A<k;A++){var U=i[A];E?U.__offsetX(x):U.__offsetY(x)}else if("center"===m)for(var V=.5*x,j=0;j<k;j++){var F=i[j];E?F.__offsetX(V):F.__offsetY(V)}else if("space-between"===m)for(var G=x/(k-1),Y=1;Y<k;Y++){var H=i[Y];E?H.__offsetX(G*Y):H.__offsetY(G*Y)}else if("space-around"===m)for(var z=x/(k+1),$=0;$<k;$++){var q=i[$];E?q.__offsetX(z*($+1)):q.__offsetY(z*($+1))}}E?(W&&(D=P),M+=D):e&&(D=O),"stretch"===w?i.forEach(function(t){var e=t.style,i=t.mlw,r=t.mtw,n=t.mrw,a=t.mbw,o=t.ptw,s=t.prw,h=t.plw,l=t.pbw;E?e.height.unit===Qe.AUTO&&(t.__height=D-r-a-o-l-e.borderTopWidth.value-e.borderBottomWidth.value):e.width.unit===Qe.AUTO&&(t.__width=D-i-n-h-s-v.value-g.value)}):"center"===w?i.forEach(function(t){var e=D-t.outerHeight;0<e&&t.__offsetY(.5*e)}):"flex-end"===w&&i.forEach(function(t){var e=D-t.outerHeight;0<e&&t.__offsetY(e)}),this.__width=O,this.__height=W?P:M-t.y,this.__flowY=M}},{key:"__layoutInline",value:function(e){var i=this,r=e.x,n=e.y,a=e.w,o=e.h;this.__x=r,this.__y=n;var t,s,h=r,l=this.flowChildren,u=this.style,f=this.lineGroups,c=this.mlw,d=this.mtw,p=this.mrw,_=this.mbw,v=this.plw,y=this.ptw,g=this.prw,m=this.pbw,w=u.width,b=u.height,x=u.marginLeft,k=u.marginRight,A=u.borderTopWidth,T=u.borderRightWidth,M=u.borderBottomWidth,O=u.borderLeftWidth,P=u.textAlign;if(w&&w.unit!==Qe.AUTO)switch(t=!0,w.unit){case Qe.PX:a=w.value;break;case Qe.PERCENT:a*=.01*w.value}if(b&&b.unit!==Qe.AUTO)switch(s=!0,b.unit){case Qe.PX:o=b.value;break;case Qe.PERCENT:o*=.01*b.value}r+=O.value+c+v,e.x=r,n+=A.value+d+y,e.y=n,w.unit===Qe.AUTO&&(a-=O.value+T.value+c+p+v+g),b.unit===Qe.AUTO&&(o-=A.value+M.value+d+_+y+m);var W=new S(r,n);if(l.forEach(function(t){if(t instanceof Q){if("absolute"===t.style.position)return void i.absChildren.push(t);if(t.style.display="inline",r===e.x)W.add(t),t.__layout({x:r,y:n,w:a,h:o}),r+=t.outerWidth,h=Math.max(h,r);else 0<=t.__tryLayInline(a-r,a)?t.__layout({x:r,y:n,w:a,h:o}):(f.push(W),W.verticalAlign(),r=e.x,n+=W.height,t.__layout({x:e.x,y:n,w:a,h:o}),W=new S(r,n)),r+=t.outerWidth,h=Math.max(h,r),W.add(t)}else{if(r===e.x)W.add(t),t.__layout({x:r,y:n,w:a,h:o}),r+=t.width,h=Math.max(h,r);else 0<=t.__tryLayInline(a-r,a)?t.__layout({x:r,y:n,w:a,h:o}):(f.push(W),W.verticalAlign(),r=e.x,n+=W.height,t.__layout({x:e.x,y:n,w:a,h:o}),W=new S(r,n)),r+=t.width,h=Math.max(h,r),W.add(t)}}),W.size&&(f.push(W),W.verticalAlign(),n+=W.height),-1<["center","right"].indexOf(P)&&f.forEach(function(t){var e=a-t.width;0<e&&t.horizonAlign("center"===P?.5*e:e)}),this.__width=t?a:h-e.x,this.__height=s?o:n-e.y,this.__flowY=n,x.unit===Qe.AUTO&&k.unit===Qe.AUTO&&w.unit!==Qe.AUTO){var E=this.outerWidth;E<e.w&&this.__offsetX(.5*(e.w-E))}}},{key:"__layoutAbs",value:function(e){var y=this.x,g=this.y,m=this.flowY,w=this.width,b=this.height,t=this.children,i=this.absChildren,r=this.style,n=(this.mlw,this.mtw,this.mrw,this.mbw,this.plw),a=this.ptw,o=this.prw,s=this.pbw,x=r.borderTopWidth,k=r.borderLeftWidth,A=w+n+o,T=b+a+s;t.forEach(function(t){t instanceof u&&t.__layoutAbs(-1<["absolute","relative"].indexOf(t.style.position)?t:e)}),i.forEach(function(t){var e,i,r,n,a=t.mtw,o=t.mlw,s=t.style,h=t.style,l=h.left,u=h.top,f=h.right,c=h.bottom,d=h.width,p=h.height;if(l.unit!==Qe.AUTO&&f.unit!==Qe.AUTO)e=l.unit===Qe.PX?y+o+k.value+l.value:y+o+k.value+w*l.value*.01,r=f.unit===Qe.PX?y+o+k.value+A-f.value-e:y+o+k.value+A-w*f.value*.01-e;else if(l.unit!==Qe.AUTO&&d.unit!==Qe.AUTO)e=l.unit===Qe.PX?y+o+k.value+l.value:y+o+k.value+w*l.value*.01,r=d.unit===Qe.PX?d.value:w;else if(f.unit!==Qe.AUTO&&d.unit!==Qe.AUTO){r=d.unit===Qe.PX?d.value:w;var _=d.unit===Qe.PX?d.value:w*d.value*.01;e=f.unit===Qe.PX?y+o+k.value+A-f.value-_:y+o+k.value+A-w*f.value*.01-_}else l.unit!==Qe.AUTO?(e=l.unit===Qe.PX?y+l.value:y+o+k.value+w*l.value*.01,r=t.__calAbs(!0)):f.unit!==Qe.AUTO?(r=t.__calAbs(!0),e=f.unit===Qe.PX?y+o+k.value+A-f.value-r:y+o+k.value+A-w*f.value*.01-r):r=d.unit!==Qe.AUTO?(e=y+o+k.value,d.unit===Qe.PX?d.value:w):(e=y+o+k.value,t.__calAbs(!0));if(u.unit!==Qe.AUTO&&c.unit!==Qe.AUTO)i=u.unit===Qe.PX?g+u.value:g+a+x.value+b*u.value*.01,n=c.unit===Qe.PX?g+a+x.value+T-c.value-i:g+a+x.value+T-b*c.value*.01-i,s.height={value:n,unit:Qe.PX};else if(u.unit!==Qe.AUTO&&p.unit!==Qe.AUTO)i=u.unit===Qe.PX?g+u.value:g+a+x.value+b*u.value*.01,n=p.unit===Qe.PX?p.value:b;else if(c.unit!==Qe.AUTO&&p.unit!==Qe.AUTO){n=p.unit===Qe.PX?p.value:b;var v=p.unit===Qe.PX?p.value:b*p.value*.01;i=c.unit===Qe.PX?g+a+x.value+T-c.value-v:g+a+x.value+T-b*c.value*.01-v}else u.unit!==Qe.AUTO?(i=u.unit===Qe.PX?g+u.value:g+a+x.value+b*u.value*.01,n=t.__calAbs()):c.unit!==Qe.AUTO?(n=t.__calAbs(),i=c.unit===Qe.PX?g+a+x.value+T-c.value-n:g+a+x.value+T-b*c.value*.01-n):n=p.unit!==Qe.AUTO?(i=m+a+x.value,p.unit===Qe.PX?p.value:b):(i=m+a+x.value,t.__calAbs());"inline"===s.display&&(s.display="block"),t.__layout({x:e,y:i,w:r,h:n})})}},{key:"render",value:function(e){C(L(u.prototype),"render",this).call(this,e);var t=this.style.display,i=this.flowChildren,r=this.children;"none"!==t&&(i.forEach(function(t){(t instanceof W||"static"===t.style.position)&&t.render(e)}),r.forEach(function(t){t instanceof Q&&-1<["relative","absolute"].indexOf(t.style.position)&&t.render(e)}),e===qe.SVG&&(this.__virtualDom=n({},C(L(u.prototype),"virtualDom",this),{type:"dom",children:this.children.map(function(t){return t.virtualDom})})))}},{key:"tagName",get:function(){return this.__tagName}},{key:"children",get:function(){return this.__children}},{key:"flowChildren",get:function(){return this.__flowChildren}},{key:"absChildren",get:function(){return this.__absChildren}},{key:"lineGroups",get:function(){return this.__lineGroups}},{key:"baseLine",get:function(){var t=this.lineGroups.length;if(t){var e=this.lineGroups[t-1];return e.y-this.y+e.baseLine}return this.y}},{key:"flowY",get:function(){return this.__flowY}}],[{key:"isValid",value:function(t){return N.hasOwnProperty(t)}}]),u}();function D(t,e,i){var r=t.childNodes;!function(t,e,i){for(var r=e.length,n=i.length,a=0,o=t.childNodes;a<Math.min(r,n);a++)I(o[a],e[a],i[a])}(r[0],e.defs,i.defs),F(r[1],e.bb,i.bb),j(t,e,i,!0)}function I(t,e,i){if(e.k!==i.k)t.insertAdjacentHTML("afterend",Ze.joinDef(i)),t.parentNode.removeChild(t);else{for(var r=0;r<4;r++)e.c[r]!==i.c[r]&&t.setAttribute(["x1","y1","x2","y2"][r],i.c[r]);for(var n=e.v.length,a=i.v.length,o=0,s=t.childNodes;o<Math.min(n,a);o++){var h=e.v[o],l=i.v[o];h[0]!==l[0]&&s[o].setAttribute("stop-color",l[0]),h[1]!==l[1]&&s[o].setAttribute("offset",l[1])}if(o<n)for(;o<n;o++)z(t,s,o);else if(o<a)for(;o<a;o++)H(t,s,o,Ze.joinDef(i.v[o]))}}function V(t,e,i){"dom"===e.type?"dom"===i.type?j(t,e,i):"text"===i.type?Y(t,i):"geom"===i.type&&function(t,e,i){F(t.firstChild,e.bb,i.bb),Y(t.lastChild,i.content)}(t,e,i):"text"===i.type?"dom"===i.type?Y(t,i):"text"===i.type?function(t,e,i){for(var r=e.children.length,n=i.children.length,a=0;a<Math.min(r,n);a++)G(t,a,e.children[a],i.children[a],!0);var o=t.childNodes;if(a<r)for(;a<r;a++)z(t,o,a);else if(a<n)for(;a<n;a++)H(t,o,a,Ze.joinVd(i.children[a]))}(t,e,i):"geom"===i.type&&Y(t,i):"geom"===i.type&&("dom"===i.type?function(t,e,i){F(t.firstChild,e.bb,i.bb),Y(t.lastChild,i.children)}(t,e,i):"text"===i.type?Y(t,i):"geom"===i.type&&function(t,e,i){if(!function(t,e){if(t.length!==e.length)return!1;for(var i=0,r=t.length;i<r;i++)if(t[i]!==e[i])return!1;return!0}(e.transform,i.transform)){var r=Ze.joinTransform(i.transform);t.getAttribute("transform")!==r&&t.setAttribute("transform",r)}F(t.firstChild,e.bb,i.bb);for(var n=e.content.length,a=i.content.length,o=0,s=t.lastChild,h=s.childNodes;o<Math.min(n,a);o++)G(s,o,e.content[o],i.content[o]);if(o<n)for(;o<n;o++)z(s,h,o);else if(o<a)for(;o<a;o++)H(s,h,o,Ze.joinVd(i.content[o]))}(t,e,i))}function j(t,e,i,r){r||F(t.firstChild,e.bb,i.bb);for(var n=e.children.length,a=i.children.length,o=0,s=t.lastChild,h=s.childNodes;o<Math.min(n,a);o++)V(h[o],e.children[o],i.children[o]);if(o<n)for(;o<n;o++)z(s,h,o);else if(o<a)for(;o<a;o++)H(s,h,o,Ze.joinVd(i.children[o]))}function F(t,e,i){for(var r=e.length,n=i.length,a=0;a<Math.min(r,n);a++)G(t,a,e[a],i[a]);var o=t.childNodes;if(a<r)for(;a<r;a++)z(t,o,a);else if(a<n)for(;a<n;a++)H(t,o,a,Ze.joinVd(i[a]))}function G(t,e,i,r,n){var a=t.childNodes;if(i.tagName!==r.tagName)Y(a[e],r);else{for(var o={},s=0,h=i.props.length;s<h;s++){var l=U(i.props[s],2),u=l[0],f=l[1];o[u]=f}for(var c=0,d=r.props.length;c<d;c++){var p=U(r.props[c],2),_=p[0];f=p[1];o.hasOwnProperty(_)?(o[_]!==f&&a[e].setAttribute(_,f),delete o[_]):a[e].setAttribute(_,f)}for(var v in o)o.hasOwnProperty(v)&&a[e].removeAttribute(v);n&&i.content!==r.content&&(a[e].textContent=r.content)}}function Y(t,e){var i;Array.isArray(e)?(i="",e.forEach(function(t){i+=Ze.joinVd(t)})):i=Ze.joinVd(e),t.insertAdjacentHTML("afterend",i),t.parentNode.removeChild(t)}function H(t,e,i,r){i>=e.length?t.insertAdjacentHTML("beforeend",r):e[i].insertAdjacentHTML("beforebegin",r)}function z(t,e,i){e[i]&&t.removeChild(e[i])}var $=function(){function e(t){s(this,e),this.id=t,this.count=0,this.list=[]}return a(e,[{key:"add",value:function(t){return t.uuid="karas-defs-".concat(this.id,"-").concat(this.count++),this.list.push(t),t.uuid}},{key:"clear",value:function(){this.list=[],this.count=0}},{key:"value",get:function(){return this.list}}],[{key:"getInstance",value:function(t){return new e(t)}}]),e}();var q=0,Z=function(){function n(t,e,i){var r;return s(this,n),(r=o(this,L(n).call(this,t,e,i))).__node=null,r}return t(n,R),a(n,[{key:"__initProps",value:function(){if(void 0!==this.props.width){var t=parseInt(this.props.width);!isNaN(t)&&0<t&&(this.__width=t)}if(void 0!==this.props.height){var e=parseInt(this.props.height);!isNaN(e)&&0<e&&(this.__height=e)}}},{key:"__genHtml",value:function(){for(var t,e,i,r="<".concat(this.tagName),n=0,a=this.__props.length;n<a;n++){var o=this.__props[n];r+=(t=o[0],e=o[1],void 0,i=Array.isArray(e)?Ze.joinSourceArray(e):Ze.stringify(e),"className"===t&&(t="class")," "+t+'="'+Ze.encodeHtml(i,!0)+'"')}return r+="></".concat(this.tagName,">")}},{key:"__cb",value:function(t,e){if(!(t.touches&&1<t.touches.length)){var i=this.node.getBoundingClientRect(),r=i.x,n=i.y,a=i.top,o=i.right;r=r||a||0,n=n||o||0;var s=t.touches?t.touches[0]||{}:t;r=s.clientX-r,n=s.clientY-n,this.__emitEvent({event:t,x:r,y:n,covers:[]},e)}}},{key:"__initEvent",value:function(){var i=this,t=this.node;["click","dblclick","mousedown","mousemove","mouseup","touchstart","touchmove","touchend","touchcancel"].forEach(function(e){t.addEventListener(e,function(t){i.__cb(t,-1<["touchend","touchcancel"].indexOf(e))})})}},{key:"appendTo",value:function(t){if(t=function(t){if(Ze.isString(t)){var e=document.querySelector(t);if(!e)throw new Error("can not find dom of selector: "+t);return e}if(!t)throw new Error("can not find dom: "+t);return t}(t),this.__initProps(),t.nodeName.toUpperCase()===this.tagName.toUpperCase()?(this.__node=t,this.width&&t.setAttribute("width",this.width),this.height&&t.setAttribute("height",this.height)):(this.__node=t.querySelector(this.tagName),this.__node||(t.innerHTML=this.__genHtml(),this.__node=t.querySelector(this.tagName))),this.__uuid=this.__node.__uuid||q++,this.__defs=$.getInstance(this.__uuid),this.__defs.clear(),!this.width||!this.height){var e=window.getComputedStyle(t,null);this.width||(this.__width=parseInt(e.getPropertyValue("width")),t.setAttribute("width",this.width)),this.height||(this.__height=parseInt(e.getPropertyValue("height")),t.setAttribute("height",this.height))}var i;"canvas"===this.tagName?(this.__ctx=this.__node.getContext("2d"),this.__ctx.clearRect(0,0,this.width,this.height),i=qe.CANVAS):"svg"===this.tagName&&(i=qe.SVG);var r=this.style;if(-1===["flex","block"].indexOf(r.display)&&(r.display="block"),"absolute"===r.position&&(r.position="static"),this.__traverse(this.__ctx,this.__defs,i),r.width=this.width,r.height=this.height,this.__initStyle(),this.__layout({x:0,y:0,w:this.width,h:this.height}),this.__layoutAbs(this),this.render(i),i===qe.SVG){var n=this.virtualDom,a=this.__defs.value;n.defs=a,this.node.__karasInit?D(this.node,this.node.__ovd,n):this.node.innerHTML=Ze.joinVirtualDom(n,a),this.node.__ovd=n,this.node.__od=a}this.node.__karasInit||(this.node.__karasInit=!0,this.__initEvent())}},{key:"node",get:function(){return this.__node}},{key:"imageData",get:function(){return this.__imageData}}]),n}(),J=function(){function N(t,e){var i;return s(this,N),(i=o(this,L(N).call(this,t,e))).__start=[],i.__end=[],i.__control=[],Array.isArray(i.props.start)&&(i.__start=i.props.start),Array.isArray(i.props.end)&&(i.__end=i.props.end),Array.isArray(i.props.control)&&(i.__control=i.props.control),i}return t(N,X),a(N,[{key:"render",value:function(t){C(L(N.prototype),"render",this).call(this,t);var e=this.rx,i=this.ry,r=this.width,n=this.height,a=this.mlw,o=this.mtw,s=this.plw,h=this.ptw,l=this.style,u=this.ctx,f=this.start,c=this.end,d=this.control,p=this.virtualDom;if(!(f.length<2||c.length<2)){var _=l.display,v=l.borderTopWidth,y=(l.borderRightWidth,l.borderBottomWidth,l.borderLeftWidth),g=l.stroke,m=l.strokeWidth,w=l.strokeDasharray;if("none"!==_){var b,x,k,A,T=e+y.value+a+s,M=i+v.value+o+h,O=T+f[0]*r,P=M+f[1]*n,W=T+c[0]*r,E=M+c[1]*n,S=0;Array.isArray(d[0])&&(S++,b=T+d[0][0]*r,x=M+d[0][1]*n),Array.isArray(d[1])&&(S++,k=T+d[1][0]*r,A=M+d[1][1]*n),t===qe.CANVAS?(u.strokeStyle=g,u.lineWidth=m,u.setLineDash(w),u.beginPath(),u.moveTo(O,P),2===S?u.bezierCurveTo(b,x,k,A,W,E):1===S?u.quadraticCurveTo(b,x,W,E):u.lineTo(W,E),u.stroke(),u.closePath()):t===qe.SVG&&(2===S?p.children.push({type:"item",tagName:"path",props:[["d","M".concat(O," ").concat(P," C").concat(b," ").concat(x," ").concat(k," ").concat(A," ").concat(W," ").concat(E)],["fill","none"],["stroke",g],["stroke-width",m],["stroke-dasharray",w]]}):1===S?p.children.push({type:"item",tagName:"path",props:[["d","M".concat(O," ").concat(P," Q").concat(b," ").concat(x," ").concat(W," ").concat(E)],["fill","none"],["stroke",g],["stroke-width",m],["stroke-dasharray",w]]}):p.children.push({type:"item",tagName:"line",props:[["x1",O],["y1",P],["x2",W],["y2",E],["stroke",g],["stroke-width",m],["stroke-dasharray",w]]}))}}}},{key:"start",get:function(){return this.__start}},{key:"end",get:function(){return this.__end}},{key:"control",get:function(){return this.__control}}]),N}(),K=function(){function N(t,e){var i;return s(this,N),(i=o(this,L(N).call(this,t,e))).__points=[],Array.isArray(i.props.points)&&(i.__points=i.props.points),-1<["TOP_LEFT","TOP_RIGHT","BOTTOM_LEFT","BOTTOM_RIGHT"].indexOf(i.props.origin)?i.__origin=i.props.origin:i.__origin="BOTTOM_LEFT",i}return t(N,X),a(N,[{key:"render",value:function(t){C(L(N.prototype),"render",this).call(this,t);var e=this.rx,i=this.ry,r=this.width,n=this.height,a=this.mlw,o=this.mtw,s=this.plw,h=this.ptw,l=this.style,u=this.ctx,f=this.points,c=this.origin,d=this.virtualDom;if(!(f.length<2)){for(var p=0,_=f.length;p<_;p++)if(!Array.isArray(f[p])||f[p].length<2)return;var v=l.display,y=l.borderTopWidth,g=l.borderLeftWidth,m=l.stroke,w=l.strokeWidth,b=l.strokeDasharray;if("none"!==v){var x=e+g.value+a+s,k=i+y.value+o+h,A=this.__pts=[];if("TOP_LEFT"===c?f.forEach(function(t){A.push([x+t[0]*r,k+t[1]*n])}):"TOP_RIGHT"===c?f.forEach(function(t){A.push([x+r-t[0]*r,k+t[1]*n])}):"BOTTOM_LEFT"===c?f.forEach(function(t){A.push([x+t[0]*r,k+n-t[1]*n])}):"BOTTOM_RIGHT"===c&&f.forEach(function(t){A.push([x+r-t[0]*r,k+n-t[1]*n])}),t===qe.CANVAS){u.strokeStyle=m,u.lineWidth=w,u.setLineDash(b),u.beginPath(),u.moveTo(A[0][0],k+A[0][1]);for(var T=1,M=A.length;T<M;T++){var O=A[T];u.lineTo(O[0],O[1])}w&&"transparent"!==m&&u.stroke(),u.closePath()}else if(t===qe.SVG){for(var P="",W=0,E=A.length;W<E;W++){var S=A[W];P+="".concat(S[0],",").concat(S[1]," ")}d.children.push({type:"item",tagName:"polyline",props:[["points",P],["fill","none"],["stroke",m],["stroke-width",w],["stroke-dasharray",b]]})}}}}},{key:"getPointsByX",value:function(t){for(var e=1/0,i=this.__pts.length,r=[],n=0;n<i;n++){var a=Math.abs(this.__pts[n][0]-t);a<e&&(e=a)}for(var o=0;o<i;o++){Math.abs(this.__pts[o][0]-t)===e&&r.push({index:o,x:this.__pts[o][0],y:this.__pts[o][1]})}return r}},{key:"points",get:function(){return this.__points}},{key:"origin",get:function(){return this.__origin}}]),N}(),tt=function(){function S(t,e){var i;return s(this,S),(i=o(this,L(S).call(this,t,e))).__points=[],Array.isArray(i.props.points)&&(i.__points=i.props.points),i}return t(S,X),a(S,[{key:"render",value:function(t){C(L(S.prototype),"render",this).call(this,t);var e=this.rx,i=this.ry,r=this.width,n=this.height,a=this.mlw,o=this.mtw,s=this.plw,h=this.ptw,l=this.style,u=this.ctx,f=this.points,c=this.virtualDom;if(!(f.length<3)){for(var d=0,p=f.length;d<p;d++)if(!Array.isArray(f[d])||f[d].length<2)return;var _=l.display,v=l.borderTopWidth,y=l.borderLeftWidth,g=l.stroke,m=l.strokeWidth,w=l.strokeDasharray,b=l.fill;if("none"!==_){var x=e+y.value+a+s,k=i+v.value+o+h;if(f.forEach(function(t){t[0]=x+t[0]*r,t[1]=k+t[1]*n}),t===qe.CANVAS){u.strokeStyle=g,u.lineWidth=m,u.fillStyle=b,u.setLineDash(w),u.beginPath(),u.moveTo(f[0][0],k+f[0][1]);for(var A=1,T=f.length;A<T;A++){var M=f[A];u.lineTo(M[0],M[1])}u.fill(),m&&"transparent"!==g&&u.stroke(),u.closePath()}else if(t===qe.SVG){for(var O="",P=0,W=O.length;P<W;P++){var E=O[P];O+="".concat(E[0],",").concat(E[1]," ")}c.children.push({type:"item",tagName:"polygon",props:[["points",O],["fill",b],["stroke",g],["stroke-width",m],["stroke-dasharray",w]]})}}}}},{key:"points",get:function(){return this.__points}}]),S}(),et=.5*Math.PI;function it(t,e,i,r){for(;360<r;)r-=360;for(;r<0;)r+=360;return 0<=r&&r<90?[t+Math.sin(r*Math.PI/180)*i,e-Math.cos(r*Math.PI/180)*i]:90<=r&&r<180?[t+Math.cos((r-90)*Math.PI/180)*i,e+Math.sin((r-90)*Math.PI/180)*i]:180<=r&&r<270?[t-Math.cos((270-r)*Math.PI/180)*i,e+Math.sin((270-r)*Math.PI/180)*i]:[t-Math.sin((360-r)*Math.PI/180)*i,e-Math.cos((360-r)*Math.PI/180)*i]}var rt=function(){function S(t,e){var i;return s(this,S),(i=o(this,L(S).call(this,t,e))).__start=0,i.__end=0,i.props.start&&(i.__start=parseFloat(i.props.start),isNaN(i.start)&&(i.__start=0)),i.props.end&&(i.__end=parseFloat(i.props.end),isNaN(i.end)&&(i.__end=0)),i.__r=1,i.props.r&&(i.__r=parseFloat(i.props.r),isNaN(i.r)&&(i.__r=1)),i}return t(S,X),a(S,[{key:"render",value:function(t){C(L(S.prototype),"render",this).call(this,t);var e=this.rx,i=this.ry,r=this.width,n=this.height,a=this.mlw,o=this.mtw,s=this.plw,h=this.ptw,l=this.style,u=this.ctx,f=this.start,c=this.end,d=this.r,p=this.virtualDom;if(f!==c){var _=l.display,v=l.borderTopWidth,y=l.borderLeftWidth,g=l.stroke,m=l.strokeWidth,w=l.strokeDasharray,b=l.fill;if("none"!==_){var x=e+y.value+a+s,k=i+v.value+o+h;if(x+=.5*r,k+=.5*n,d*=.5*Math.min(r,n),t===qe.CANVAS)u.strokeStyle=g,u.lineWidth=m,u.fillStyle=b,u.setLineDash(w),u.beginPath(),u.moveTo(x,k),u.arc(x,k,d,f*Math.PI/180-et,c*Math.PI/180-et),u.fill(),m&&"transparent"!==g&&u.stroke(),u.closePath();else if(t===qe.SVG){var A,T,M,O,P=U(it(x,k,d,f),2);A=P[0],T=P[1];var W=U(it(x,k,d,c),2);M=W[0],O=W[1];var E=180<c-f?1:0;p.children.push({type:"item",tagName:"path",props:[["d","M".concat(x," ").concat(k," L").concat(A," ").concat(T," A").concat(d," ").concat(d," 0 ").concat(E," 1 ").concat(M," ").concat(O," z")],["fill",b],["stroke",g],["stroke-width",m],["stroke-dasharray",w]]})}}}}},{key:"start",get:function(){return this.__start}},{key:"end",get:function(){return this.__end}},{key:"r",get:function(){return this.__r}}]),S}(),nt=function(){function b(t,e){return s(this,b),o(this,L(b).call(this,t,e))}return t(b,X),a(b,[{key:"render",value:function(t){C(L(b.prototype),"render",this).call(this,t);var e=this.rx,i=this.ry,r=this.width,n=this.height,a=this.mlw,o=this.mtw,s=this.plw,h=this.ptw,l=this.style,u=this.ctx,f=this.virtualDom,c=l.display,d=l.borderTopWidth,p=l.borderLeftWidth,_=l.stroke,v=l.strokeWidth,y=l.strokeDasharray,g=l.fill;if("none"!==c){var m=e+p.value+a+s,w=i+d.value+o+h;t===qe.CANVAS?(u.strokeStyle=_,u.lineWidth=v,u.fillStyle=g,u.setLineDash(y),u.beginPath(),u.moveTo(m,w),u.lineTo(m+r,w),u.lineTo(m+r,w+n),u.lineTo(m,w+n),u.fill(),v&&"transparent"!==_&&u.stroke(),u.closePath()):t===qe.SVG&&f.children.push({type:"item",tagName:"rect",props:[["x",e],["y",i],["width",r],["height",n],["fill",g],["stroke",_],["stroke-width",v],["stroke-dasharray",y]]})}}}]),b}(),at=function(){function x(t,e){var i;return s(this,x),(i=o(this,L(x).call(this,t,e))).__r=1,i.props.r&&(i.__r=parseFloat(i.props.r),isNaN(i.r)&&(i.__r=1)),i}return t(x,X),a(x,[{key:"render",value:function(t){C(L(x.prototype),"render",this).call(this,t);var e=this.rx,i=this.ry,r=this.width,n=this.height,a=this.mlw,o=this.mtw,s=this.plw,h=this.ptw,l=this.style,u=this.ctx,f=this.r,c=this.virtualDom,d=l.display,p=l.borderTopWidth,_=l.borderLeftWidth,v=l.stroke,y=l.strokeWidth,g=l.strokeDasharray,m=l.fill;if("none"!==d){var w=e+_.value+a+s,b=i+p.value+o+h;w+=.5*r,b+=.5*n,f*=.5*Math.min(r,n),t===qe.CANVAS?(u.strokeStyle=v,u.lineWidth=y,u.fillStyle=m,u.setLineDash(g),u.beginPath(),u.arc(w,b,f,0,2*Math.PI),"transparent"!==m&&u.fill(),y&&"transparent"!==v&&u.stroke(),u.closePath()):t===qe.SVG&&c.children.push({type:"item",tagName:"circle",props:[["cx",w],["cy",b],["r",f],["fill",m],["stroke",v],["stroke-width",y],["stroke-dasharray",g]]})}}},{key:"r",get:function(){return this.__r}}]),x}(),ot=function(){function k(t,e){var i;return s(this,k),(i=o(this,L(k).call(this,t,e))).__rx=1,i.props.rx&&(i.__rx=parseFloat(i.props.rx),isNaN(i.rx)&&(i.__rx=1)),i.__ry=1,i.props.ry&&(i.__ry=parseFloat(i.props.ry),isNaN(i.rx)&&(i.__ry=1)),i}return t(k,X),a(k,[{key:"render",value:function(t){C(L(k.prototype),"render",this).call(this,t);var e=this.rx,i=this.ry,r=this.width,n=this.height,a=this.mlw,o=this.mtw,s=this.plw,h=this.ptw,l=this.style,u=this.ctx,f=this.rx,c=this.ry,d=this.virtualDom,p=l.display,_=l.borderTopWidth,v=l.borderLeftWidth,y=l.stroke,g=l.strokeWidth,m=l.strokeDasharray,w=l.fill;if("none"!==p){var b=e+v.value+a+s,x=i+_.value+o+h;b+=.5*r,x+=.5*n,f*=.5*r,c*=.5*n,t===qe.CANVAS?(u.strokeStyle=y,u.lineWidth=g,u.fillStyle=w,u.setLineDash(m),u.beginPath(),u.moveTo(b,x),u.ellipse&&u.ellipse(b,x,f,c,0,0,2*Math.PI),u.fill(),g&&"transparent"!==y&&u.stroke(),u.closePath()):t===qe.SVG&&d.children.push({type:"item",tagName:"ellipse",props:[["cx",b],["cy",x],["rx",f],["ry",c],["fill",w],["stroke",y],["stroke-width",g],["stroke-dasharray",m]]})}}},{key:"rx",get:function(){return this.__rx}},{key:"ry",get:function(){return this.__ry}}]),k}(),st=function(){function E(t,e){var i;return s(this,E),(i=o(this,L(E).call(this,t,e))).__nx=0,i.props.nx&&(i.__nx=parseFloat(i.props.nx),isNaN(i.nx)&&(i.__nx=0)),i.__ny=0,i.props.ny&&(i.__ny=parseFloat(i.props.ny),isNaN(i.ny)&&(i.__ny=0)),i}return t(E,X),a(E,[{key:"render",value:function(t){C(L(E.prototype),"render",this).call(this,t);var e=this.rx,i=this.ry,r=this.width,n=this.height,a=this.mlw,o=this.mtw,s=this.plw,h=this.ptw,l=this.style,u=this.ctx,f=this.nx,c=this.ny,d=this.virtualDom;if(!(r<=0||n<=0||f<3&&c<3)){var p=l.display,_=l.borderTopWidth,v=l.borderLeftWidth,y=l.stroke,g=l.strokeWidth,m=l.strokeDasharray;if("none"!==p){var w=e+v.value+a+s,b=i+_.value+o+h,x=w+r,k=b+n,A=[],T=[];if(3<=f)for(var M=r/(f-1),O=0;O<f;O++)T.push(w+O*M);if(3<=c)for(var P=n/(c-1),W=0;W<c;W++)A.push(b+W*P);t===qe.CANVAS?(u.strokeStyle=y,u.lineWidth=g,u.setLineDash(m),u.beginPath(),A.forEach(function(t){u.moveTo(w,t),u.lineTo(x,t)}),T.forEach(function(t){u.moveTo(t,b),u.lineTo(t,k)}),g&&"transparent"!==y&&u.stroke(),u.closePath()):t===qe.SVG&&(A.forEach(function(t){d.children.push({type:"item",tagName:"line",props:[["x1",w],["y1",t],["x2",x],["y2",t],["stroke",y],["stroke-width",g],["stroke-dasharray",m]]})}),T.forEach(function(t){d.children.push({type:"item",tagName:"line",props:[["x1",t],["y1",b],["x2",t],["y2",k],["stroke",y],["stroke-width",g],["stroke-dasharray",m]]})}))}}}},{key:"nx",get:function(){return this.__nx}},{key:"ny",get:function(){return this.__ny}},{key:"dash",get:function(){return this.__dash}}]),E}();X.register("$line",J),X.register("$polyline",K),X.register("$polygon",tt),X.register("$sector",rt),X.register("$rect",nt),X.register("$circle",at),X.register("$ellipse",ot),X.register("$grid",st);var ht={render:function(t,e){if(!(t instanceof Z))throw new Error("render root muse be canvas or svg");return e&&t.appendTo(e),t},createVd:function(t,e,i){if(-1<["canvas","svg"].indexOf(t))return new Z(t,e,i);if(R.isValid(t))return new R(t,e,i);throw new Error("can not use marker: "+t)},createGm:function(t,e){return new(X.getImplement(t))(t,e)},createCp:function(t,e){return new t(e)},Geom:X,mode:qe};return"undefined"!=typeof window&&(window.karas=ht),ht});
//# sourceMappingURL=index.min.js.map
