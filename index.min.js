!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).karas=e()}(this,function(){"use strict";function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function e(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}function t(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&i(t,e)}function b(t){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function i(t,e){return(i=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function a(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function k(t,e,i){return(k="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=b(t)););return t}(t,e);if(n){var r=Object.getOwnPropertyDescriptor(n,e);return r.get?r.get.call(i):r.value}})(t,e,i||t)}var r,h,s=function(){function t(){o(this,t),this.__x=0,this.__y=0,this.__width=0,this.__height=0,this.__prev=null,this.__next=null,this.__ctx=null,this.__parent=null,this.__style={},this.__baseLine=0}return e(t,[{key:"__offsetX",value:function(t){this.__x+=t}},{key:"__offsetY",value:function(t){this.__y+=t}},{key:"x",get:function(){return this.__x}},{key:"y",get:function(){return this.__y}},{key:"width",get:function(){return this.__width}},{key:"height",get:function(){return this.__height}},{key:"outerWidth",get:function(){return this.__width}},{key:"outerHeight",get:function(){return this.__height}},{key:"prev",get:function(){return this.__prev}},{key:"next",get:function(){return this.__next}},{key:"parent",get:function(){return this.__parent}},{key:"style",get:function(){return this.__style}},{key:"ctx",get:function(){return this.__ctx}},{key:"baseLine",get:function(){return this.__baseLine}}]),t}(),l=0,L={setCanvas:function(){l=0},setSvg:function(){l=1,h=""},isCanvas:function(){return 0===l},isSvg:function(){return 1===l},appendHtml:function(t){h+=t},get html(){return h},get measure(){return r||((r=document.createElement("div")).style.position="absolute",r.style.left="99999px",r.style.top="-99999px",r.style.visibility="hidden",document.body.appendChild(r)),r}};var u=function(){function n(t,e){var i;return o(this,n),i=a(this,b(n).call(this)),e=e||[],Array.isArray(e)?(i.props=function(t){for(var e={},i=0,n=t.length;i<n;i++){var r=t[i];if(Array.isArray(r))e[r[0]]=r[1];else for(var a=Object.keys(r),o=a.length-1;0<=o;o--){var h=a[o];e[h]=r[h]}}return e}(e),i.__props=function(t){for(var e=0,i=t.length;e<i;e++){var n=t[e];if(!Array.isArray(n)){for(var r=[],a=Object.keys(n),o=0,h=a.length;o<h;o++){var s=a[o];r.push([s,n[s]])}t.splice.apply(t,[e,1].concat(r))}}return t}(e)):(i.props=e,i.__props=function(t){for(var e=[],i=Object.keys(t),n=0,r=i.length;n<r;n++){var a=i[n];e.push([a,t[a]])}return e}(e)),i.__tagName=t,i.__style=i.props.style||{},i}return t(n,s),e(n,[{key:"__preLay",value:function(t){var e=this.style;"block"===e.display?this.__preLayBlock(t):"flex"===e.display?this.__preLayFlex(t):this.__preLayInline(t)}},{key:"render",value:function(){var t=this.ctx,e=this.style,i=this.x,n=this.y,r=this.width,a=this.height,o=this.outerWidth,h=this.outerHeight,s=e.backgroundColor,l=e.borderTopWidth,u=e.borderTopColor,c=e.borderRightWidth,f=e.borderRightColor,_=e.borderBottomWidth,d=e.borderBottomColor,y=e.borderLeftWidth,v=e.borderLeftColor;if(s){var p=i;y&&(p+=y.value);var g=n;l&&(g+=l.value),L.isCanvas()?(t.beginPath(),t.fillStyle=s,t.rect(p,g,r,a),t.fill(),t.closePath()):L.isSvg()&&L.appendHtml('<rect x="'.concat(p,'" y="').concat(g,'" width="').concat(r,'" height="').concat(a,'" fill="').concat(s,'"/>'))}if(l.value){var x=n+.5*l.value;L.isCanvas()?(t.beginPath(),t.lineWidth=l.value,t.strokeStyle=u,t.moveTo(i+y.value,x),t.lineTo(i+y.value+r,x),t.stroke(),t.closePath()):L.appendHtml('<line x1="'.concat(i,'" y1="').concat(x,'" x2="').concat(i+o,'" y2="').concat(x,'" stroke-width="').concat(l.value,'" stroke="').concat(u,'"/>'))}if(c.value){var w=i+r+y.value+.5*c.value,b=n+h;L.isCanvas()?(t.beginPath(),t.lineWidth=c.value,t.strokeStyle=f,t.moveTo(w,n),t.lineTo(w,b),t.stroke(),t.closePath()):L.appendHtml('<line x1="'.concat(w,'" y1="').concat(n,'" x2="').concat(w,'" y2="').concat(b,'" stroke-width="').concat(c.value,'" stroke="').concat(f,'"/>'))}if(_.value){var k=n+a+l.value+.5*_.value;L.isCanvas()?(t.beginPath(),t.lineWidth=_.value,t.strokeStyle=d,t.moveTo(i+y.value,k),t.lineTo(i+y.value+r,k),t.stroke(),t.closePath()):L.appendHtml('<line x1="'.concat(i,'" y1="').concat(k,'" x2="').concat(i+o,'" y2="').concat(k,'" stroke-width="').concat(_.value,'" stroke="').concat(d,'"/>'))}if(y.value){var m=i+.5*y.value;L.isCanvas()?(t.beginPath(),t.lineWidth=y.value,t.strokeStyle=v,t.moveTo(m,n),t.lineTo(m,n+a+l.value+_.value),t.stroke(),t.closePath()):L.appendHtml('<line x1="'.concat(m,'" y1="').concat(n,'" x2="').concat(m,'" y2="').concat(n+h,'" stroke-width="').concat(y.value,'" stroke="').concat(v,'"/>'))}}},{key:"tagName",get:function(){return this.__tagName}},{key:"outerWidth",get:function(){var t=this.style,e=t.borderLeftWidth,i=t.borderRightWidth;return this.width+e.value+i.value}},{key:"outerHeight",get:function(){var t=this.style,e=t.borderTopWidth,i=t.borderBottomWidth;return this.height+e.value+i.value}}]),n}(),G=0,F=1,Y=2,c={lhr:1.14990234375,car:1.1171875,blr:.9052734375,mdr:.64599609375,lgr:.03271484375},f={display:"block",borderSizing:"content-box",marginTop:0,marginRight:0,marginBottom:0,marginLeft:0,paddingTop:0,paddingRight:0,paddingBottom:0,paddingLeft:0,fontSize:24,fontFamily:"arial",color:"#000",fontStyle:"normal",fontWeight:400,lineHeight:"normal",borderTopWidth:0,borderRightWidth:0,borderBottomWidth:0,borderLeftWidth:0,borderTopStyle:"solid",borderRightStyle:"solid",borderBottomStyle:"solid",borderLeftStyle:"solid",verticalAlign:"baseline",width:"auto",height:"auto",flexGrow:0,flexShrink:1,flexBasis:"auto",flexDirection:"row",justifyContent:"flex-start",alignItem:"stretch",textAlign:"left",stroke:"#000",strokeWidth:1},_=[];Object.keys(f).forEach(function(t){var e=f[t];_.push({k:t,v:e})});var d={}.toString;function y(e){return function(t){return d.call(t)==="[object "+e+"]"}}var v=y("Number");function p(t){return g(t)?"":t.toString()}function g(t){return null==t}var x={isObject:y("Object"),isString:y("String"),isFunction:y("Function"),isNumber:v,isBoolean:y("Boolean"),isDate:y("Date"),stringify:p,joinSourceArray:function(t){return function t(e){for(var i="",n=0,r=e.length;n<r;n++){var a=e[n];Array.isArray(a)?i+=t(a):i+=p(a)}return i}(t)},encodeHtml:function(t,e){return e?t.replace(/"/g,"&quot;"):t.replace(/&/g,"&amp;").replace(/</g,"&lt;")},isNil:g};function w(t,e){var i="border".concat(e);if(t[i]){var n=/\b\d+px\b/i.exec(t[i]);n&&(t[i+"Width"]=n[0]);var r=/\bsolid\b/i.exec(t[i]);r&&(t[i+"Style"]=r[0]);var a=/#[0-9a-f]{3,6}/i.exec(t[i]);a&&-1<[4,7].indexOf(a[0].length)&&(t[i+"Color"]=a[0])}}var m={normalize:function(i){if(_.forEach(function(t){i.hasOwnProperty(t.k)||(i[t.k]=t.v)}),i.background){var t=/#[0-9a-f]{3,6}/i.exec(i.background);t&&-1<[4,7].indexOf(t[0].length)&&(i.backgroundColor=t[0])}i.flex&&("none"===i.flex?(i.flexGrow=0,i.flexShrink=0,i.flexBasis="auto"):"auto"===i.flex?(i.flexGrow=1,i.flexShrink=1,i.flexBasis="auto"):/^[\d.]+$/.test(i.flex)?(i.flexGrow=parseFloat(i.flex),i.flexShrink=1,i.flexBasis=0):/^[\d.]+px$/.test(i.flex)||/^[\d.]+%$/.test(i.flex)||(i.flexGrow=0,i.flexShrink=1,i.flexBasis="auto")),i.border&&(i.borderTop=i.borderRight=i.borderBottom=i.borderLeft=i.border),w(i,"Top"),w(i,"Right"),w(i,"Bottom"),w(i,"Left"),["marginTop","marginRight","marginDown","marginLeft","paddingTop","paddingRight","paddingDown","paddingLeft","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","width","height","flexBasis"].forEach(function(t){var e=i[t];!x.isNil(e)&&e.unit||("auto"===e?i[t]={unit:G}:/%$/.test(e)?(e=parseFloat(e)||0,i[t]=e<=0?{value:0,unit:F}:{value:e,unit:Y}):(e=parseFloat(e)||0,i[t]={value:Math.max(e,0),unit:F}))});var e=i.lineHeight;e="normal"===e?{value:i.fontSize*c.lhr,unit:F}:/px$/.test(e)?(e=parseFloat(e),{value:Math.max(i.fontSize,e),unit:F}):"normal"===(e=parseFloat(e)||"normal")?{value:i.fontSize*c.lhr,unit:F}:{value:e*i.fontSize,unit:F},i.lineHeight=e},setFontStyle:function(t){var e=t.fontStyle,i=t.fontWeight,n=t.fontSize,r=t.fontFamily;return"".concat(e," ").concat(i," ").concat(n,"px/").concat(n,"px ").concat(r)},getBaseLine:function(t){var e=t.fontSize*c.lhr;return.5*(t.lineHeight.value-e)+t.fontSize*c.blr}},W=function(){function a(t,e,i,n,r){o(this,a),this.__ctx=t,this.__x=e,this.__y=i,this.__content=n,this.__style=r}return e(a,[{key:"render",value:function(){var t=this.ctx,e=this.style,i=this.content,n=this.x,r=this.y;L.isCanvas()?(t.fillStyle=e.color,t.fillText(i,n,r+m.getBaseLine(e))):L.isSvg()&&L.appendHtml('<text x="'.concat(n,'" y="').concat(r+m.getBaseLine(e),'" fill="').concat(e.color,'" font-size="').concat(e.fontSize,'px">').concat(i,"</text>"))}},{key:"__offsetX",value:function(t){this.__x+=t}},{key:"__offsetY",value:function(t){this.__y+=t}},{key:"ctx",get:function(){return this.__ctx}},{key:"x",get:function(){return this.__x}},{key:"y",get:function(){return this.__y}},{key:"content",get:function(){return this.__content}},{key:"style",get:function(){return this.__style}},{key:"baseLine",get:function(){return m.getBaseLine(this.style)}}]),a}(),S={},B=function(){function i(t){var e;return o(this,i),(e=a(this,b(i).call(this))).__content=t.toString(),e.__lineBoxes=[],e.__charWidthList=[],e.__charWidth=0,e.__textWidth=0,e}return t(i,s),e(i,[{key:"__measure",value:function(){this.__charWidthList=[];var t=this.ctx,e=this.content,i=this.style,n=this.charWidthList;L.isCanvas()&&(t.font=m.setFontStyle(i));for(var r=S[i.fontSize]=S[i.fontSize]||{},a=e.length,o=0,h=0;h<a;h++){var s=e.charAt(h),l=void 0;if(r.hasOwnProperty(s))l=r[s];else if(L.isCanvas())l=t.measureText(s).width;else if(L.isSvg()){var u=L.measure;u.style.fontSize=i.fontSize+"px",u.innerText=s;var c=window.getComputedStyle(u,null);l=parseFloat(c.width)}n.push(l),o+=l,this.__charWidth=Math.max(this.charWidth,l)}this.__textWidth=o}},{key:"__preLay",value:function(t,e){var i=t.x,n=t.y,r=t.w;t.h;this.__x=i,this.__y=n;for(var a=i,o=this.ctx,h=this.content,s=this.style,l=this.lineBoxes,u=this.charWidthList,c=0,f=0,_=0,d=h.length;f<d;)if((_+=u[f])===r){var y=new W(o,i,n,h.slice(c,f+1),s);l.push(y),a=Math.max(a,i+_),n+=this.style.lineHeight.value,f=(c=f+1)+1,_=0}else if(r<_){f===c&&(f=c+1);var v=new W(o,i,n,h.slice(c,f),s);l.push(v),a=Math.max(a,i+_-u[f]),n+=this.style.lineHeight.value,c=f,f+=1,_=0}else f++;if(c<d&&c<f){var p=new W(o,i,n,h.slice(c,f),s);l.push(p),a=Math.max(a,i+_),n+=this.style.lineHeight.value}this.__width=a-i,this.__height=n-t.y,e&&(this.__lineBoxes=[])}},{key:"render",value:function(){L.isCanvas()&&(this.ctx.font=m.setFontStyle(this.style)),this.lineBoxes.forEach(function(t){t.render()})}},{key:"__tryLayInline",value:function(t){return this.ctx.font=m.setFontStyle(this.style),t-this.ctx.measureText(this.content).width}},{key:"__offsetX",value:function(e){k(b(i.prototype),"__offsetX",this).call(this,e),this.lineBoxes.forEach(function(t){t.__offsetX(e)})}},{key:"__offsetY",value:function(e){k(b(i.prototype),"__offsetY",this).call(this,e),this.lineBoxes.forEach(function(t){t.__offsetY(e)})}},{key:"__calMaxAndMinWidth",value:function(){var e=0;return this.charWidthList.forEach(function(t){e=Math.max(e,t)}),{max:this.textWidth,min:e}}},{key:"content",get:function(){return this.__content},set:function(t){this.__content=t}},{key:"lineBoxes",get:function(){return this.__lineBoxes}},{key:"charWidthList",get:function(){return this.__charWidthList}},{key:"charWidth",get:function(){return this.__charWidth}},{key:"textWidth",get:function(){return this.__textWidth}},{key:"baseLine",get:function(){var t=this.lineBoxes[this.lineBoxes.length-1];return t.y-this.y+t.baseLine}}]),i}(),A=function(){function i(t,e){o(this,i),this.__list=[],this.__x=t,this.__y=e,this.__height=0,this.__baseLine=0}return e(i,[{key:"add",value:function(t){this.list.push(t)}},{key:"__calBaseLine",value:function(){var e=0;return this.list.forEach(function(t){e=Math.max(e,t.baseLine)}),e}},{key:"__calHeight",value:function(){var e=0;return this.list.forEach(function(t){e=Math.max(e,t.height)}),e}},{key:"verticalAlign",value:function(){var e=this;this.__height=this.__calHeight(),this.__baseLine=this.__calBaseLine(),1<this.list.length&&this.list.forEach(function(t){t.baseLine!==e.baseLine&&t.__offsetY(e.baseLine-t.baseLine)})}},{key:"list",get:function(){return this.__list}},{key:"x",get:function(){return this.__x}},{key:"y",get:function(){return this.__y}},{key:"height",get:function(){return this.__height}},{key:"baseLine",get:function(){return this.__baseLine}},{key:"size",get:function(){return this.__list.length}}]),i}(),T={$line:!0,$polygon:!0},X=function(){function i(t,e){return o(this,i),a(this,b(i).call(this,t,e))}return t(i,u),e(i,[{key:"__initStyle",value:function(){m.normalize(this.style)}},{key:"__calAutoBasis",value:function(t,e,i){var n=0,r=0,a=0,o=this.style,h=o.width,s=o.height,l=o.borderTopWidth,u=o.borderRightWidth,c=o.borderBottomWidth,f=o.borderLeftWidth,_=t?h:s;if(_.unit!==G&&(n=a+=_.value),t){var d=u.value+f.value;n+=d,a+=d,r+=d}else{var y=l.value+c.value;n+=y,a+=y,r+=y}return{b:n,min:r,max:a}}},{key:"__preLayBlock",value:function(t){}},{key:"__preLayFlex",value:function(t){}},{key:"__preLayInline",value:function(t){var e=t.x,i=t.y,n=t.w,r=t.h;this.__x=e,this.__y=i;var a,o,h=this.style,s=h.width,l=h.height,u=h.borderTopWidth,c=h.borderRightWidth,f=h.borderBottomWidth,_=h.borderLeftWidth;if(s&&s.unit!==G)switch(a=!0,s.unit){case F:n=s.value}if(l&&l.unit!==G)switch(o=!0,l.unit){case F:r=l.value}e+=_.value,t.x=e,i+=u.value,t.y=i,n-=_.value+c.value,r-=u.value+f.value,this.__width=a?n:e-t.x,this.__height=o?r:i-t.y}},{key:"render",value:function(){k(b(i.prototype),"render",this).call(this)}},{key:"tagName",get:function(){return this.__tagName}},{key:"baseLine",get:function(){return 0}}],[{key:"isValid",value:function(t){return T.hasOwnProperty(t)}}]),i}(),C={div:!0,span:!0},E={span:!0},H=function(){function I(t,e,i){var n;return o(this,I),(n=a(this,b(I).call(this,t,e))).__children=i,n.__lineGroups=[],n}return t(I,u),e(I,[{key:"__traverse",value:function(e){var i=this,t=[];this.__traverseChildren(this.children,t,e);for(var n=t.length-1;0<n;n--){var r=t[n];if(r instanceof B){var a=t[n-1];a instanceof B?(a.content+=r.content,t.splice(n,1)):n--}}if("inline"===this.style.display&&"flex"!==this.parent.style.display)for(var o=t.length-1;0<=o;o--){var h=t[o];if(h instanceof I&&"inline"!==h.style.display)throw new Error("inline can not contain block")}t.forEach(function(t){t.__ctx=e,t.__parent=i,t.__prev=null}),this.__children=t}},{key:"__traverseChildren",value:function(t,e,i){var n=this;Array.isArray(t)?t.forEach(function(t){n.__traverseChildren(t,e,i)}):t instanceof I?(e.push(t),t.__traverse(i)):t instanceof X?e.push(t):x.isNil(t)||e.push(new B(t))}},{key:"__initStyle",value:function(){var e=this.__style;e.display&&-1!==["flex","block","inline","none"].indexOf(e.display)||(E.hasOwnProperty(this.tagName)?e.display="inline":e.display="block");var t=this.parent;if(t){var i=t.style;["fontSize","fontWeight","fontStyle","lineHeight","wordBreak","color","textAlign"].forEach(function(t){!e.hasOwnProperty(t)&&i.hasOwnProperty(t)&&(e[t]=i[t])})}m.normalize(e),this.children.forEach(function(t){t instanceof I||t instanceof X?t.__initStyle():(t.__style=e,t.__measure())})}},{key:"__tryLayInline",value:function(t){for(var e=this.children,i=0;i<e.length;i++){if(t<0)return t;var n=e[i];n instanceof I||n instanceof X?t=n.__tryLayInline(t):t-=n.textWidth}return t}},{key:"__offsetX",value:function(e){k(b(I.prototype),"__offsetX",this).call(this,e),this.children.forEach(function(t){t&&t.__offsetX(e)})}},{key:"__offsetY",value:function(e){k(b(I.prototype),"__offsetY",this).call(this,e),this.children.forEach(function(t){t&&t.__offsetY(e)})}},{key:"__calAutoBasis",value:function(a,o,h,t){var s=0,l=0,u=0,e=this.children,i=this.style,n=i.width,r=i.height,c=i.borderTopWidth,f=i.borderRightWidth,_=i.borderBottomWidth,d=i.borderLeftWidth,y=a?n:r;if(y.unit!==G&&(s=u+=y.value,t&&(l=s)),e.forEach(function(t){if(t instanceof I||t instanceof X){var e=t.__calAutoBasis(a,o,h,!0),i=e.b,n=e.min,r=e.max;s=Math.max(s,i),l=Math.max(l,n),u=Math.max(u,r)}else u=a?(l=Math.max(t.charWidth,l),Math.max(t.textWidth,u)):(t.__preLay({x:0,y:0,w:o,h:h},!0),l=Math.max(l,t.height),Math.max(u,t.height))}),a){var v=f.value+d.value;s+=v,u+=v,l+=v}else{var p=c.value+_.value;s+=p,u+=p,l+=p}return{b:s,min:l,max:u}}},{key:"__preLayBlock",value:function(e){var i=this,n=e.x,r=e.y,a=e.w,o=e.h;this.__x=n,this.__y=r,this.__width=a;var t,h=this.children,s=this.style,l=s.width,u=s.height,c=s.borderTopWidth,f=s.borderRightWidth,_=s.borderBottomWidth,d=s.borderLeftWidth;if(l&&l.unit!==G)switch(l.unit){case F:a=l.value}if(u&&u.unit!==G)switch(t=!0,u.unit){case F:o=u.value;break;case Y:o*=.01*u.value}n+=d.value,e.x=n,r+=c.value,e.y=r,a-=d.value+f.value,o-=c.value+_.value;var y=new A(n,r);h.forEach(function(t){if(t instanceof I)"inline"===t.style.display?n===e.x?(y.add(t),t.__preLayInline({x:n,y:r,w:a,h:o}),n+=t.outerWidth):(0<=t.__tryLayInline(a-n)?t.__preLayInline({x:n,y:r,w:a}):(i.lineGroups.push(y),y.verticalAlign(),n=e.x,r+=y.height,t.__preLayInline({x:e.x,y:r,w:a}),y=new A(n,r)),n+=t.outerWidth,y.add(t)):(y.size&&(i.lineGroups.push(y),y.verticalAlign(),r+=y.height,y=new A(e.x,r)),t.__preLay({x:e.x,y:r,w:a,h:o}),n=e.x,r+=t.outerHeight);else if(t instanceof X)y.size&&(i.lineGroups.push(y),y.verticalAlign(),r+=y.height,y=new A(e.x,r)),t.__preLay({x:e.x,y:r,w:a}),n=e.x,r+=t.outerHeight;else{if(n===e.x)y.add(t),t.__preLay({x:n,y:r,w:a,h:o}),n+=t.width;else 0<=t.__tryLayInline(a-n)?t.__preLay({x:n,y:r,w:a,h:o}):(i.lineGroups.push(y),y.verticalAlign(),n=e.x,r+=y.height,t.__preLay({x:e.x,y:r,w:a,h:o}),y=new A(n,r)),n+=t.width,y.add(t)}}),y.size&&(this.lineGroups.push(y),y.verticalAlign(),r+=y.height),this.__width=a,this.__height=t?o:r-e.y}},{key:"__preLayFlex",value:function(f){var _=f.x,d=f.y,y=f.w,v=f.h;this.__x=_,this.__y=d,this.__width=y;var p,t=this.children,e=this.style,i=e.width,n=e.height,r=e.flexDirection,a=e.borderTopWidth,o=e.borderRightWidth,h=e.borderBottomWidth,s=e.borderLeftWidth,l=e.justifyContent;if(i&&i.unit!==G)switch(i.unit){case F:y=i.value}if(n&&n.unit!==G)switch(p=!0,n.unit){case F:v=n.value;break;case Y:v*=.01*n.value}_+=s.value,f.x=_,d+=a.value,f.y=d,y-=s.value+o.value,v-=a.value+h.value;var g="row"===r;if(!g&&!p)return t.forEach(function(t){if(t instanceof I||t instanceof X){var e=t.style,i=t.style,n=i.display,r=i.flexDirection,a=i.width;i.height;"inline"===n?e.display="block":"flex"===n&&"row"===r&&a.unit===G&&(a.value=y,a.unit=F),t.__preLay({x:_,y:d,w:y,h:v}),d+=t.outerHeight}else t.__preLay({x:_,y:d,w:y,h:v}),d+=t.outerHeight}),this.__width=y,void(this.__height=d-f.y);var x=[],w=[],b=[],k=[],m=0,L=0,W=0,u=0;t.forEach(function(t){if(t instanceof I||t instanceof X){var e=t.style,i=e.flexGrow,n=e.flexShrink,r=e.flexBasis;x.push(i),w.push(n),m+=i,L+=n;var a=t.__calAutoBasis(g,y,v),o=a.b,h=a.min,s=a.max;r.unit===G?(b.push(s),W+=s):r.unit===F?(o=r.value,b.push(o),W+=o):r.unit===Y&&(o=(g?y:v)*r.value,b.push(o),W+=o),u+=s,k.push(h)}else x.push(0),w.push(1),L+=1,g?(b.push(t.textWidth),W+=t.textWidth,u+=t.textWidth,k.push(t.charWidth)):(t.__preLay({x:0,y:0,w:y,h:v},!0),b.push(t.height),W+=t.height,u+=t.height,k.push(t.height))});var S=0,B=0,A=(g?y:v)<u;if(t.forEach(function(t,e){var i,n=w[e],r=x[e];if(A){var a=W-(g?y:v);i=n?b[e]-a*n/L:b[e]}else B=(g?y:v)-W,i=r?b[e]+B*r/m:b[e];if(i=Math.max(i,k[e]),t instanceof I||t instanceof X){var o=t.style,h=t.style,s=h.display,l=h.flexDirection,u=h.width,c=h.height;g?("block"===s?o.display="inline":"flex"===s&&"column"===l&&p&&c.unit===G&&(c.value=v,c.unit=F),t.__preLay({x:_,y:d,w:i,h:v})):("inline"===s?o.display="block":"flex"===s&&"row"===l&&u.unit===G&&(u.value=y,u.unit=F),t.__preLay({x:_,y:d,w:y,h:i})),A&&n?g?t.__width=i:t.__height=i:!A&&r&&(g?t.__width=i:t.__height=i)}else t.__preLay({x:_,y:d,w:g?i:y,h:g?v:i});S=g?(_+=t.outerWidth,Math.max(S,t.outerHeight)):(d+=t.outerHeight,_=f.x,Math.max(S,t.outerWidth))}),!A&&0===m&&0<B){var c=t.length;if("flex-end"===l)for(var T=0;T<c;T++){var C=t[T];g?C.__offsetX(B):C.__offsetY(B)}else if("center"===l)for(var E=.5*B,H=0;H<c;H++){var O=t[H];g?O.__offsetX(E):O.__offsetY(E)}else if("space-between"===l)for(var P=B/(c-1),M=1;M<c;M++){var N=t[M];g?N.__offsetX(P*M):N.__offsetY(P*M)}else if("space-around"===l)for(var z=B/(c+1),R=0;R<c;R++){var j=t[R];g?j.__offsetX(z*(R+1)):j.__offsetY(z*(R+1))}}g&&(p&&(S=v),d+=S),t.forEach(function(t){var e=t.style;g?t.style.height.unit===G&&(t.__height=S-e.borderTopWidth.value-e.borderBottomWidth.value):t.style.width.unit===G&&(t.__width=S-e.borderRightWidth.value-e.borderLeftWidth.value)}),this.__width=y,this.__height=p?v:d-f.y}},{key:"__preLayInline",value:function(e){var i=this,n=e.x,r=e.y,a=e.w,o=e.h;this.__x=n,this.__y=r;var t,h,s=n,l=this.children,u=this.style,c=u.width,f=u.height,_=u.borderTopWidth,d=u.borderRightWidth,y=u.borderBottomWidth,v=u.borderLeftWidth;if(c&&c.unit!==G)switch(t=!0,c.unit){case F:a=c.value}if(f&&f.unit!==G)switch(h=!0,f.unit){case F:o=f.value}n+=v.value,e.x=n,r+=_.value,e.y=r,a-=v.value+d.value,o-=_.value+y.value;var p=new A(n,r);l.forEach(function(t){t instanceof I?n===e.x?(p.add(t),t.__preLayInline({x:n,y:r,w:a}),n+=t.outerWidth,s=Math.max(s,n)):(0<=t.__tryLayInline(a-n)?t.__preLayInline({x:n,y:r,w:a}):(i.lineGroups.push(p),p.verticalAlign(),n=e.x,r+=p.height,t.__preLayInline({x:e.x,y:r,w:a}),p=new A(n,r)),n+=t.outerWidth,s=Math.max(s,n),p.add(t)):n===e.x?(p.add(t),t.__preLay({x:n,y:r,w:a,h:o}),n+=t.width,s=Math.max(s,n)):(0<=t.__tryLayInline(a-n)?t.__preLay({x:n,y:r,w:a,h:o}):(i.lineGroups.push(p),p.verticalAlign(),n=e.x,r+=p.height,t.__preLay({x:e.x,y:r,w:a,h:o}),p=new A(n,r)),n+=t.width,s=Math.max(s,n),p.add(t))}),p.size&&(this.lineGroups.push(p),p.verticalAlign(),r+=p.height),this.__width=t?a:s-e.x,this.__height=h?o:r-e.y}},{key:"render",value:function(){k(b(I.prototype),"render",this).call(this),this.children.forEach(function(t){t&&t.render()})}},{key:"tagName",get:function(){return this.__tagName}},{key:"children",get:function(){return this.__children}},{key:"lineGroups",get:function(){return this.__lineGroups}},{key:"baseLine",get:function(){var t=this.lineGroups.length;if(t){var e=this.lineGroups[t-1];return e.y-this.y+e.baseLine}return this.y}}],[{key:"isValid",value:function(t){return C.hasOwnProperty(t)}}]),I}();var O=function(){function r(t,e,i){var n;return o(this,r),(n=a(this,b(r).call(this,t,e,i))).__node=null,n}return t(r,H),e(r,[{key:"__initProps",value:function(){if(void 0!==this.props.width){var t=parseInt(this.props.width);!isNaN(t)&&0<t&&(this.__width=t)}if(void 0!==this.props.height){var e=parseInt(this.props.height);!isNaN(e)&&0<e&&(this.__height=e)}}},{key:"__genHtml",value:function(){for(var t,e,i,n="<".concat(this.tagName),r=0,a=this.__props.length;r<a;r++){var o=this.__props[r];n+=(t=o[0],e=o[1],void 0,i=Array.isArray(e)?x.joinSourceArray(e):x.stringify(e),"className"===t&&(t="class")," "+t+'="'+x.encodeHtml(i,!0)+'"')}return n+="></".concat(this.tagName,">")}},{key:"appendTo",value:function(t){if(t=function(t){if(x.isString(t)){var e=document.querySelector(t);if(!e)throw new Error("can not find dom of selector: "+t);return e}if(!t)throw new Error("can not find dom: "+t);return t}(t),this.__initProps(),t.nodeName.toUpperCase()===this.tagName.toUpperCase())this.__node=t,this.width&&t.setAttribute("width",this.width),this.height&&t.setAttribute("height",this.height);else{var e=this.__genHtml();t.insertAdjacentHTML("beforeend",e);var i=t.querySelectorAll(this.tagName);this.__node=i[i.length-1]}if(!this.width||!this.height){var n=window.getComputedStyle(t,null);this.width||(this.__width=parseInt(n.getPropertyValue("width")),t.setAttribute("width",this.width)),this.height||(this.__height=parseInt(n.getPropertyValue("height")),t.setAttribute("height",this.height))}var r=this.style;-1===["flex","block"].indexOf(r.display)&&(r.display="block"),"canvas"===this.tagName?(this.__ctx=this.__node.getContext("2d"),L.setCanvas()):"svg"===this.tagName&&L.setSvg(),this.__traverse(this.__ctx),r.width=this.width,r.height=this.height,this.__initStyle(),this.__preLay({x:0,y:0,w:this.width,h:this.height}),this.render(),L.isSvg()&&(this.__node.innerHTML=L.html)}},{key:"node",get:function(){return this.__node}}]),r}(),P=function(){function g(t){var e;return o(this,g),(e=a(this,b(g).call(this,"$line",t))).__start=[0,0],e.__end=[1,1],Array.isArray(e.props.start)&&(e.__start=e.props.start),Array.isArray(e.props.end)&&(e.__end=e.props.end),e}return t(g,X),e(g,[{key:"render",value:function(){k(b(g.prototype),"render",this).call(this);var t=this.x,e=this.y,i=this.width,n=this.height,r=this.style,a=this.ctx,o=this.start,h=this.end,s=r.borderTopWidth,l=r.borderLeftWidth,u=r.stroke,c=r.strokeWidth,f=t+l.value,_=e+s.value,d=f+o[0]*i,y=_+o[1]*n,v=f+h[0]*i,p=_+h[1]*n;L.isCanvas()?(a.strokeStyle=u,a.lineWidth=c,a.beginPath(),a.moveTo(d,y),a.lineTo(v,p),a.stroke(),a.closePath()):L.isSvg()&&L.appendHtml('<line x1="'.concat(d,'" y1="').concat(y,'" x2="').concat(v,'" y2="').concat(p,'" stroke-width="').concat(c,'" stroke="').concat(u,'"/>'))}},{key:"start",get:function(){return this.__start}},{key:"end",get:function(){return this.__end}}]),g}(),M=function(){function w(t){var e;return o(this,w),(e=a(this,b(w).call(this,"$polygon",t))).__pointList=[],Array.isArray(e.props.pointList)&&(e.__pointList=e.props.pointList),e}return t(w,X),e(w,[{key:"render",value:function(){k(b(w.prototype),"render",this).call(this);var t=this.x,e=this.y,i=this.width,n=this.height,r=this.style,a=this.ctx,o=this.pointList,h=r.borderTopWidth,s=r.borderLeftWidth,l=r.stroke,u=r.strokeWidth,c=t+s.value,f=e+h.value;if(L.isCanvas()){a.strokeStyle=l,a.lineWidth=u,a.beginPath(),a.moveTo(c+o[0][0]*i,f+o[0][1]*n);for(var _=1,d=o.length;_<d;_++){var y=o[_];a.lineTo(c+y[0]*i,f+y[1]*n)}a.stroke(),a.closePath()}else if(L.isSvg()){for(var v="",p=0,g=o.length;p<g;p++){var x=o[p];v+="".concat(c+x[0]*i,",").concat(f+x[1]*n," ")}L.appendHtml('<polyline fill="none" points="'.concat(v,'" stroke-width="').concat(u,'" stroke="').concat(l,'"/>'))}}},{key:"pointList",get:function(){return this.__pointList}}]),w}(),N={render:function(t,e){if(!(t instanceof O))throw new Error("render root muse be canvas or svg");return e&&t.appendTo(e),t},createVd:function(t,e,i){if(-1<["canvas","svg"].indexOf(t))return new O(t,e,i);if(H.isValid(t))return new H(t,e,i);throw new Error("can not use marker: "+t)},createGm:function(t,e){if(X.isValid(t))switch(t){case"$line":return new P(e);case"$polygon":return new M(e)}throw new Error("can not use geom marker: "+t)},createCp:function(t,e,i){}};return"undefined"!=typeof window&&(window.karas=N),N});
//# sourceMappingURL=index.min.js.map
