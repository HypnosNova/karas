!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).karas=e()}(this,function(){"use strict";function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function e(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}function t(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&i(t,e)}function P(t){return(P=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function i(t,e){return(i=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function a(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function M(t,e,i){return(M="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=P(t)););return t}(t,e);if(n){var r=Object.getOwnPropertyDescriptor(n,e);return r.get?r.get.call(i):r.value}})(t,e,i||t)}function E(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if(!(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)))return;var i=[],n=!0,r=!1,a=void 0;try{for(var o,h=t[Symbol.iterator]();!(n=(o=h.next()).done)&&(i.push(o.value),!e||i.length!==e);n=!0);}catch(t){r=!0,a=t}finally{try{n||null==h.return||h.return()}finally{if(r)throw a}}return i}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var r,o="",I={CANVAS:0,SVG:1,appendHtml:function(t){o+=t},get html(){return o},reset:function(){o=""},measure:function(t,e){r||((r=document.createElement("div")).style.position="absolute",r.style.left="99999px",r.style.top="-99999px",r.style.visibility="hidden",document.body.appendChild(r)),r.style.fontSize=e.fontSize+"px",r.innerText=t;var i=window.getComputedStyle(r,null);return parseFloat(i.width)}},h=function(){function t(){s(this,t),this.__x=0,this.__y=0,this.__width=0,this.__height=0,this.__prev=null,this.__next=null,this.__ctx=null,this.__parent=null,this.__style={},this.__baseLine=0,this.__mode=I.CANVAS}return e(t,[{key:"__offsetX",value:function(t){this.__x+=t}},{key:"__offsetY",value:function(t){this.__y+=t}},{key:"x",get:function(){return this.__x}},{key:"y",get:function(){return this.__y}},{key:"width",get:function(){return this.__width}},{key:"height",get:function(){return this.__height}},{key:"outerWidth",get:function(){return this.__width}},{key:"outerHeight",get:function(){return this.__height}},{key:"prev",get:function(){return this.__prev}},{key:"next",get:function(){return this.__next}},{key:"parent",get:function(){return this.__parent}},{key:"style",get:function(){return this.__style}},{key:"ctx",get:function(){return this.__ctx}},{key:"baseLine",get:function(){return this.__baseLine}},{key:"mode",get:function(){return this.__mode}}]),t}(),Z=0,J=1,K=2;var Q=function(){function n(t,e){var i;return s(this,n),i=a(this,P(n).call(this)),e=e||[],Array.isArray(e)?(i.props=function(t){for(var e={},i=0,n=t.length;i<n;i++){var r=t[i];if(Array.isArray(r))e[r[0]]=r[1];else for(var a=Object.keys(r),o=a.length-1;0<=o;o--){var h=a[o];e[h]=r[h]}}return e}(e),i.__props=function(t){for(var e=0,i=t.length;e<i;e++){var n=t[e];if(!Array.isArray(n)){for(var r=[],a=Object.keys(n),o=0,h=a.length;o<h;o++){var s=a[o];r.push([s,n[s]])}t.splice.apply(t,[e,1].concat(r))}}return t}(e)):(i.props=e,i.__props=function(t){for(var e=[],i=Object.keys(t),n=0,r=i.length;n<r;n++){var a=i[n];e.push([a,t[a]])}return e}(e)),i.__tagName=t,i.__style=i.props.style||{},i.__listener={},i.__props.forEach(function(t){var e=t[0];/^on[a-zA-Z]/.test(e)&&(i.__listener[e.slice(2).toLowerCase()]=t[1])}),i}return t(n,h),e(n,[{key:"__preLay",value:function(t){var e=this.style,i=this.style.display;if("none"!==i){"block"===i?this.__preLayBlock(t):"flex"===i?this.__preLayFlex(t):"inline"===i&&this.__preLayInline(t);var n=this.parent||this,r=n.width,a=n.height,o=e.position,h=e.top,s=e.right,l=e.bottom,u=e.left;if("relative"===o){if(u.unit!==Z){var c=u.unit===J?u.value:u.value*r*.01;this.__offsetX(c)}else if(s.unit!==Z){var d=s.unit===J?s.value:s.value*r*.01;this.__offsetX(-d)}if(h.unit!==Z){var f=h.unit===J?h.value:h.value*a*.01;this.__offsetY(f)}else if(l.unit!==Z){var v=l.unit===J?l.value:l.value*a*.01;this.__offsetY(-v)}}}}},{key:"render",value:function(){var t=this.ctx,e=this.style,i=this.x,n=this.y,r=this.width,a=this.height,o=e.display,h=e.backgroundColor,s=e.borderTopWidth,l=e.borderTopColor,u=e.borderRightWidth,c=e.borderRightColor,d=e.borderBottomWidth,f=e.borderBottomColor,v=e.borderLeftWidth,_=e.borderLeftColor,p=e.marginTop,y=e.marginLeft,g=e.paddingTop,m=e.paddingRight,x=e.paddingBottom,b=e.paddingLeft;if("none"!==o){if(y&&(i+=y.value),p&&(n+=p.value),h){var k=i;v&&(k+=v.value);var w=n;s&&(w+=s.value);var L=r+b.value+m.value,T=a+g.value+x.value;this.mode===I.CANVAS?(t.beginPath(),t.fillStyle=h,t.rect(k,w,L,T),t.fill(),t.closePath()):this.mode===I.SVG&&I.appendHtml('<rect x="'.concat(k,'" y="').concat(w,'" width="').concat(L,'" height="').concat(T,'" fill="').concat(h,'"/>'))}if(s.value){var W=i+v.value,A=n+.5*s.value,S=W+r;b&&(S+=b.value),m&&(S+=m.value),this.mode===I.CANVAS?(t.beginPath(),t.lineWidth=s.value,t.strokeStyle=l,t.moveTo(W,A),t.lineTo(S,A),t.stroke(),t.closePath()):this.mode===I.SVG&&I.appendHtml('<line x1="'.concat(W,'" y1="').concat(A,'" x2="').concat(S,'" y2="').concat(A,'" stroke-width="').concat(s.value,'" stroke="').concat(l,'"/>'))}if(u.value){var B=i+r+v.value+.5*u.value,E=n,O=E+a+s.value+d.value;b&&(B+=b.value),m&&(B+=m.value),g&&(O+=g.value),x&&(O+=x.value),this.mode===I.CANVAS?(t.beginPath(),t.lineWidth=u.value,t.strokeStyle=c,t.moveTo(B,E),t.lineTo(B,O),t.stroke(),t.closePath()):this.mode===I.SVG&&I.appendHtml('<line x1="'.concat(B,'" y1="').concat(E,'" x2="').concat(B,'" y2="').concat(O,'" stroke-width="').concat(u.value,'" stroke="').concat(c,'"/>'))}if(d.value){var P=i+v.value,M=n+a+s.value+.5*d.value,C=P+r;b&&(C+=b.value),m&&(C+=m.value),g&&(M+=g.value),x&&(M+=x.value),this.mode===I.CANVAS?(t.beginPath(),t.lineWidth=d.value,t.strokeStyle=f,t.moveTo(P,M),t.lineTo(C,M),t.stroke(),t.closePath()):this.mode===I.SVG&&I.appendHtml('<line x1="'.concat(P,'" y1="').concat(M,'" x2="').concat(C,'" y2="').concat(M,'" stroke-width="').concat(d.value,'" stroke="').concat(f,'"/>'))}if(v.value){var N=i+.5*v.value,R=n,H=R+a+s.value+d.value;g&&(H+=g.value),x&&(H+=x.value),this.mode===I.CANVAS?(t.beginPath(),t.lineWidth=v.value,t.strokeStyle=_,t.moveTo(N,R),t.lineTo(N,H),t.stroke(),t.closePath()):this.mode===I.SVG&&I.appendHtml('<line x1="'.concat(N,'" y1="').concat(R,'" x2="').concat(N,'" y2="').concat(H,'" stroke-width="').concat(v.value,'" stroke="').concat(_,'"/>'))}}}},{key:"tagName",get:function(){return this.__tagName}},{key:"outerWidth",get:function(){var t=this.style,e=t.borderLeftWidth,i=t.borderRightWidth,n=t.marginLeft,r=t.marginRight,a=t.paddingLeft,o=t.paddingRight;return this.width+e.value+i.value+n.value+r.value+a.value+o.value}},{key:"outerHeight",get:function(){var t=this.style,e=t.borderTopWidth,i=t.borderBottomWidth,n=t.marginTop,r=t.marginBottom,a=t.paddingTop,o=t.paddingBottom;return this.height+e.value+i.value+n.value+r.value+a.value+o.value}},{key:"listener",get:function(){return this.__listener}}]),n}(),l={lhr:1.14990234375,car:1.1171875,blr:.9052734375,mdr:.64599609375,lgr:.03271484375},u={position:"static",display:"block",borderSizing:"content-box",top:"auto",right:"auto",bottom:"auto",left:"auto",marginTop:0,marginRight:0,marginBottom:0,marginLeft:0,paddingTop:0,paddingRight:0,paddingBottom:0,paddingLeft:0,fontSize:16,fontFamily:"arial",color:"#000",fontStyle:"normal",fontWeight:400,lineHeight:"normal",borderTopWidth:0,borderRightWidth:0,borderBottomWidth:0,borderLeftWidth:0,borderTopStyle:"solid",borderRightStyle:"solid",borderBottomStyle:"solid",borderLeftStyle:"solid",verticalAlign:"baseline",width:"auto",height:"auto",flexGrow:0,flexShrink:1,flexBasis:"auto",flexDirection:"row",justifyContent:"flex-start",alignItems:"stretch",textAlign:"left",visibility:"visible",fill:"#000",stroke:"#000",strokeWidth:0},c=[];Object.keys(u).forEach(function(t){var e=u[t];c.push({k:t,v:e})});var d={}.toString;function f(e){return function(t){return d.call(t)==="[object "+e+"]"}}var v=f("Number");function _(t){return p(t)?"":t.toString()}function p(t){return null==t}var y={isObject:f("Object"),isString:f("String"),isFunction:f("Function"),isNumber:v,isBoolean:f("Boolean"),isDate:f("Date"),stringify:_,joinSourceArray:function(t){return function t(e){for(var i="",n=0,r=e.length;n<r;n++){var a=e[n];Array.isArray(a)?i+=t(a):i+=_(a)}return i}(t)},encodeHtml:function(t,e){return e?t.replace(/"/g,"&quot;"):t.replace(/&/g,"&amp;").replace(/</g,"&lt;")},isNil:p};function g(t,e){var i="border".concat(e);if(t[i]){var n=/\b\d+px\b/i.exec(t[i]);n&&(t[i+"Width"]=n[0]);var r=/\bsolid\b/i.exec(t[i]);r&&(t[i+"Style"]=r[0]);var a=/#[0-9a-f]{3,6}/i.exec(t[i]);a&&-1<[4,7].indexOf(a[0].length)&&(t[i+"Color"]=a[0])}}var m={normalize:function(i){if(c.forEach(function(t){i.hasOwnProperty(t.k)||(i[t.k]=t.v)}),i.background){var t=/#[0-9a-f]{3,6}/i.exec(i.background);t&&-1<[4,7].indexOf(t[0].length)&&(i.backgroundColor=t[0])}i.flex&&("none"===i.flex?(i.flexGrow=0,i.flexShrink=0,i.flexBasis="auto"):"auto"===i.flex?(i.flexGrow=1,i.flexShrink=1,i.flexBasis="auto"):/^[\d.]+$/.test(i.flex)?(i.flexGrow=parseFloat(i.flex),i.flexShrink=1,i.flexBasis=0):/^[\d.]+px$/.test(i.flex)||/^[\d.]+%$/.test(i.flex)||(i.flexGrow=0,i.flexShrink=1,i.flexBasis="auto")),i.border&&(i.borderTop=i.borderRight=i.borderBottom=i.borderLeft=i.border),i.margin&&(i.marginTop=i.marginRight=i.marginBottom=i.marginLeft=i.margin),i.padding&&(i.paddingTop=i.paddingRight=i.paddingBottom=i.paddingLeft=i.padding),g(i,"Top"),g(i,"Right"),g(i,"Bottom"),g(i,"Left"),["marginTop","marginRight","marginBottom","marginLeft","paddingTop","paddingRight","paddingBottom","paddingLeft","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","top","right","bottom","left","width","height","flexBasis"].forEach(function(t){var e=i[t];!y.isNil(e)&&e.unit||("auto"===e?i[t]={unit:Z}:/%$/.test(e)?(e=parseFloat(e)||0,i[t]={value:e,unit:K}):(e=parseFloat(e)||0,i[t]={value:e,unit:J}))});var e=i.lineHeight;e="normal"===e?{value:i.fontSize*l.lhr,unit:J}:/px$/.test(e)?(e=parseFloat(e),{value:Math.max(i.fontSize,e),unit:J}):"normal"===(e=parseFloat(e)||"normal")?{value:i.fontSize*l.lhr,unit:J}:{value:e*i.fontSize,unit:J},i.lineHeight=e},setFontStyle:function(t){var e=t.fontStyle,i=t.fontWeight,n=t.fontSize,r=t.fontFamily;return"".concat(e," ").concat(i," ").concat(n,"px/").concat(n,"px ").concat(r)},getBaseLine:function(t){var e=t.fontSize*l.lhr;return.5*(t.lineHeight.value-e)+t.fontSize*l.blr}},x=function(){function h(t,e,i,n,r,a,o){s(this,h),this.__mode=t,this.__ctx=e,this.__x=i,this.__y=n,this.__width=r,this.__content=a,this.__style=o}return e(h,[{key:"render",value:function(){var t=this.ctx,e=this.style,i=this.content,n=this.x,r=this.y;this.mode===I.CANVAS?(t.fillStyle=e.color,t.fillText(i,n,r+m.getBaseLine(e))):this.mode===I.SVG&&I.appendHtml('<text x="'.concat(n,'" y="').concat(r+m.getBaseLine(e),'" fill="').concat(e.color,'" font-size="').concat(e.fontSize,'px">').concat(i,"</text>"))}},{key:"__offsetX",value:function(t){this.__x+=t}},{key:"__offsetY",value:function(t){this.__y+=t}},{key:"ctx",get:function(){return this.__ctx}},{key:"x",get:function(){return this.__x}},{key:"y",get:function(){return this.__y}},{key:"width",get:function(){return this.__width}},{key:"content",get:function(){return this.__content}},{key:"style",get:function(){return this.__style}},{key:"baseLine",get:function(){return m.getBaseLine(this.style)}},{key:"mode",get:function(){return this.__mode}}]),h}(),b={},k=function(){function i(t){var e;return s(this,i),(e=a(this,P(i).call(this))).__content=t.toString(),e.__lineBoxes=[],e.__charWidthList=[],e.__charWidth=0,e.__textWidth=0,e}return t(i,h),e(i,[{key:"__measure",value:function(){this.__charWidthList=[];var t=this.ctx,e=this.content,i=this.style,n=this.charWidthList;this.mode===I.CANVAS&&(t.font=m.setFontStyle(i));for(var r=b[i.fontSize]=b[i.fontSize]||{},a=e.length,o=0,h=0;h<a;h++){var s=e.charAt(h),l=void 0;r.hasOwnProperty(s)?l=r[s]:this.mode===I.CANVAS?l=t.measureText(s).width:this.mode===I.SVG&&(l=I.measure(s,i)),n.push(l),o+=l,this.__charWidth=Math.max(this.charWidth,l)}this.__textWidth=o}},{key:"__preLay",value:function(t,e){var i=this,n=t.x,r=t.y,a=t.w;t.h;this.__x=n,this.__y=r;for(var o=n,h=this.ctx,s=this.content,l=this.style,u=this.lineBoxes,c=this.charWidthList,d=0,f=0,v=0,_=s.length;f<_;)if((v+=c[f])===a){var p=new x(this.mode,h,n,r,v,s.slice(d,f+1),l);u.push(p),o=Math.max(o,n+v),r+=this.style.lineHeight.value,f=(d=f+1)+1,v=0}else if(a<v){f===d&&(f=d+1);var y=new x(this.mode,h,n,r,v-c[f],s.slice(d,f),l);u.push(y),o=Math.max(o,n+v-c[f]),r+=this.style.lineHeight.value,d=f,f+=1,v=0}else f++;if(d<_&&d<f){for(v=0,f=d;f<_;f++)v+=c[f];var g=new x(this.mode,h,n,r,v,s.slice(d,_),l);u.push(g),o=Math.max(o,n+v),r+=l.lineHeight.value}if(this.__width=o-n,this.__height=r-t.y,e)this.__lineBoxes=[];else{var m=l.textAlign;-1<["center","right"].indexOf(m)&&u.forEach(function(t){var e=i.__width-t.width;0<e&&t.__offsetX("center"===m?.5*e:e)})}}},{key:"render",value:function(){this.mode===I.CANVAS&&(this.ctx.font=m.setFontStyle(this.style)),this.lineBoxes.forEach(function(t){t.render()})}},{key:"__tryLayInline",value:function(t){return t-this.textWidth}},{key:"__offsetX",value:function(e){M(P(i.prototype),"__offsetX",this).call(this,e),this.lineBoxes.forEach(function(t){t.__offsetX(e)})}},{key:"__offsetY",value:function(e){M(P(i.prototype),"__offsetY",this).call(this,e),this.lineBoxes.forEach(function(t){t.__offsetY(e)})}},{key:"__calMaxAndMinWidth",value:function(){var e=0;return this.charWidthList.forEach(function(t){e=Math.max(e,t)}),{max:this.textWidth,min:e}}},{key:"content",get:function(){return this.__content},set:function(t){this.__content=t}},{key:"lineBoxes",get:function(){return this.__lineBoxes}},{key:"charWidthList",get:function(){return this.__charWidthList}},{key:"charWidth",get:function(){return this.__charWidth}},{key:"textWidth",get:function(){return this.__textWidth}},{key:"baseLine",get:function(){var t=this.lineBoxes[this.lineBoxes.length-1];return t.y-this.y+t.baseLine}}]),i}(),S=function(){function i(t,e){s(this,i),this.__list=[],this.__x=t,this.__y=e,this.__baseLine=0}return e(i,[{key:"add",value:function(t){this.list.push(t)}},{key:"__calBaseLine",value:function(){var e=0;return this.list.forEach(function(t){e=Math.max(e,t.baseLine)}),e}},{key:"verticalAlign",value:function(){var e=this;this.__baseLine=this.__calBaseLine(),1<this.list.length&&this.list.forEach(function(t){t.baseLine!==e.baseLine&&t.__offsetY(e.baseLine-t.baseLine)})}},{key:"horizonAlign",value:function(e){this.list.forEach(function(t){t.__offsetX(e)})}},{key:"list",get:function(){return this.__list}},{key:"x",get:function(){return this.__x}},{key:"y",get:function(){return this.__y}},{key:"width",get:function(){var e=0;return this.list.forEach(function(t){e+=t.width}),e}},{key:"height",get:function(){var e=0;return this.list.forEach(function(t){e=Math.max(e,t.height)}),e}},{key:"baseLine",get:function(){return this.__baseLine}},{key:"size",get:function(){return this.__list.length}}]),i}(),w=function(){function n(t,e){var i;return s(this,n),(i=a(this,P(n).call(this,t,e))).__dash=null,Array.isArray(i.props.dash)&&(i.__dash=i.props.dash),i}return t(n,Q),e(n,[{key:"__initStyle",value:function(){m.normalize(this.style)}},{key:"__tryLayInline",value:function(t,e){var i=this.style.width;return i.unit===J?t-i.value:i.unit===K?t-e*i.value*.01:t}},{key:"__calAutoBasis",value:function(t,e,i){var n=0,r=0,a=0,o=this.style,h=o.width,s=o.height,l=o.borderTopWidth,u=o.borderRightWidth,c=o.borderBottomWidth,d=o.borderLeftWidth,f=t?h:s;if(f.unit!==Z&&(n=a+=f.value),t){var v=u.value+d.value;n+=v,a+=v,r+=v}else{var _=l.value+c.value;n+=_,a+=_,r+=_}return{b:n,min:r,max:a}}},{key:"__preLayBlock",value:function(t){var e=t.x,i=t.y,n=t.w,r=t.h;this.__x=e,this.__y=i,this.__width=n;var a,o=this.style,h=o.width,s=o.height,l=o.borderTopWidth,u=o.borderRightWidth,c=o.borderBottomWidth,d=o.borderLeftWidth;if(h&&h.unit!==Z)switch(h.unit){case J:n=h.value}if(s&&s.unit!==Z)switch(a=!0,s.unit){case J:r=s.value;break;case K:r*=.01*s.value}e+=d.value,t.x=e,i+=l.value,t.y=i,n-=d.value+u.value,r-=l.value+c.value,this.__width=n,this.__height=a?r:0}},{key:"__preLayFlex",value:function(t){this.__preLayBlock(t)}},{key:"__preLayInline",value:function(t){var e=t.x,i=t.y,n=t.w,r=t.h;this.__x=e,this.__y=i;var a,o,h=this.style,s=h.width,l=h.height,u=h.borderTopWidth,c=h.borderRightWidth,d=h.borderBottomWidth,f=h.borderLeftWidth;if(s&&s.unit!==Z)switch(a=!0,s.unit){case J:n=s.value}if(l&&l.unit!==Z)switch(o=!0,l.unit){case J:r=l.value}e+=f.value,t.x=e,i+=u.value,t.y=i,n-=f.value+c.value,r-=u.value+d.value,this.__width=a?n:e-t.x,this.__height=o?r:i-t.y}},{key:"__calAbs",value:function(){return 0}},{key:"__emitEvent",value:function(t,e){var i,n=t.event.type,r=t.x,a=t.y,o=t.covers,h=this.listener,s=this.style,l=this.x,u=this.y,c=this.outerWidth,d=this.outerHeight;if("none"!==s.display)if(h.hasOwnProperty(n)&&(i=h[n]),e)i&&i(t);else if(l<=r&&u<=a&&r<=l+c&&a<=u+d){for(var f=0,v=o.length;f<v;f++){var _=o[f],p=_.x,y=_.y,g=_.w,m=_.h;if(p<=r&&y<=a&&r<=p+g&&a<=y+m)return}t.target||(t.target=this),o.push({x:l,y:u,w:c,h:d}),i&&i(t)}}},{key:"render",value:function(){M(P(n.prototype),"render",this).call(this)}},{key:"tagName",get:function(){return this.__tagName}},{key:"baseLine",get:function(){return this.__height}},{key:"origin",get:function(){return this.__origin}},{key:"dash",get:function(){return this.__dash}}]),n}(),L={div:!0,span:!0},T={span:!0},W=function(){function l(t,e,i){var n;return s(this,l),(n=a(this,P(l).call(this,t,e))).__children=i,n.__flowChildren=[],n.__absChildren=[],n.__lineGroups=[],n.__flowY=0,n}return t(l,Q),e(l,[{key:"__traverse",value:function(e,t){var i=this,n=[];this.__traverseChildren(this.children,n,e,t);for(var r=n.length-1;0<r;r--){var a=n[r];if(a instanceof k){var o=n[r-1];o instanceof k?(o.content+=a.content,n.splice(r,1)):r--}}if("inline"===this.style.display&&"flex"!==this.parent.style.display)for(var h=n.length-1;0<=h;h--){var s=n[h];if(s instanceof l&&"inline"!==s.style.display)throw new Error("inline can not contain block/flex")}n.forEach(function(t){t.__ctx=e,t.__parent=i,t.__prev=null,t instanceof k||"absolute"!==t.style.position?i.__flowChildren.push(t):i.__absChildren.push(t)}),this.__children=n}},{key:"__traverseChildren",value:function(t,e,i,n){var r=this;if(Array.isArray(t))t.forEach(function(t){r.__traverseChildren(t,e,i,n)});else if(t instanceof l)e.push(t),t.__traverse(i,n),t.__mode=n;else if(t instanceof w)e.push(t),t.__mode=n;else if(!y.isNil(t)){var a=new k(t);a.__mode=n,e.push(a)}}},{key:"__initStyle",value:function(){var e=this.__style;e.display&&-1!==["flex","block","inline","none"].indexOf(e.display)||(T.hasOwnProperty(this.tagName)?e.display="inline":e.display="block");var t=this.parent;if(t){var i=t.style;["fontSize","fontWeight","fontStyle","lineHeight","wordBreak","color","textAlign"].forEach(function(t){!e.hasOwnProperty(t)&&i.hasOwnProperty(t)&&(e[t]=i[t])})}m.normalize(e),this.children.forEach(function(t){t instanceof Q?t.__initStyle():(t.__style=e,t.__measure())})}},{key:"__tryLayInline",value:function(t,e){var i=this.flowChildren,n=this.style.width;if(n.unit===J)return t-n.value;if(n.unit===K)return t-e*n.value*.01;for(var r=0;r<i.length;r++){if(t<0)return t;var a=i[r];t-=a instanceof Q?a.__tryLayInline(t,e):a.textWidth}return t}},{key:"__offsetX",value:function(e){M(P(l.prototype),"__offsetX",this).call(this,e),this.flowChildren.forEach(function(t){t&&t.__offsetX(e)})}},{key:"__offsetY",value:function(e){M(P(l.prototype),"__offsetY",this).call(this,e),this.flowChildren.forEach(function(t){t&&t.__offsetY(e)})}},{key:"__calAutoBasis",value:function(a,o,h,t){var s=0,l=0,u=0,e=this.flowChildren,i=this.style,n=i.width,r=i.height,c=i.borderTopWidth,d=i.borderRightWidth,f=i.borderBottomWidth,v=i.borderLeftWidth,_=i.marginTop,p=i.marginRight,y=i.marginBottom,g=i.marginLeft,m=i.paddingTop,x=i.paddingRight,b=i.paddingBottom,k=i.paddingLeft,w=a?n:r;if(w.unit===J&&(s=u=w.value,t&&(l=s)),e.forEach(function(t){if(t instanceof Q){var e=t.__calAutoBasis(a,o,h,!0),i=e.b,n=e.min,r=e.max;s=Math.max(s,i),l=Math.max(l,n),u=Math.max(u,r)}else u=a?(l=Math.max(t.charWidth,l),Math.max(t.textWidth,u)):(t.__preLay({x:0,y:0,w:o,h:h},!0),l=Math.max(l,t.height),Math.max(u,t.height))}),a){var L=d.value+v.value+g.value+p.value+k.value+x.value;s+=L,u+=L,l+=L}else{var T=c.value+f.value+_.value+y.value+m.value+b.value;s+=T,u+=T,l+=T}return{b:s,min:l,max:u}}},{key:"__calAbs",value:function(i){var n=0,t=this.flowChildren,e=this.style,r=e.width,a=e.height,o=e.borderTopWidth,h=e.borderRightWidth,s=e.borderBottomWidth,l=e.borderLeftWidth,u=e.marginTop,c=e.marginRight,d=e.marginBottom,f=e.marginLeft,v=e.paddingTop,_=e.paddingRight,p=e.paddingBottom,y=e.paddingLeft,g=i?r:a;if(g.unit===J&&(n=g.value),t.forEach(function(t){if(t instanceof Q){var e=t.__calAbs(i);n=Math.max(n,e)}else n=i?Math.max(t.textWidth,n):(t.__preLay({x:0,y:0,w:1/0,h:1/0},!0),Math.max(n,t.height))}),i){var m=h.value+l.value+f.value+c.value+y.value+_.value;n+=m}else{var x=o.value+s.value+u.value+d.value+v.value+p.value;n+=x}return n}},{key:"__preLayBlock",value:function(e){var i=e.x,n=e.y,r=e.w,a=e.h;this.__x=i,this.__y=n,this.__width=r;var t,o=this.flowChildren,h=this.style,s=this.lineGroups,l=h.width,u=h.height,c=h.borderTopWidth,d=h.borderRightWidth,f=h.borderBottomWidth,v=h.borderLeftWidth,_=h.marginTop,p=h.marginRight,y=h.marginBottom,g=h.marginLeft,m=h.paddingTop,x=h.paddingRight,b=h.paddingBottom,k=h.paddingLeft,w=h.textAlign;if(l&&l.unit!==Z)switch(l.unit){case J:r=l.value;break;case K:r*=.01*l.value}if(u&&u.unit!==Z)switch(t=!0,u.unit){case J:a=u.value;break;case K:a*=.01*u.value}i+=v.value+g.value+k.value,e.x=i,n+=c.value+_.value+m.value,e.y=n,r-=v.value+d.value+g.value+p.value+k.value+x.value,a-=c.value+f.value+_.value+y.value+m.value+b.value;var L=new S(i,n);o.forEach(function(t){t instanceof Q?"inline"===t.style.display?i===e.x?(L.add(t),t.__preLayInline({x:i,y:n,w:r,h:a}),i+=t.outerWidth):(0<=t.__tryLayInline(r-i,r)?t.__preLayInline({x:i,y:n,w:r,h:a}):(s.push(L),L.verticalAlign(),i=e.x,n+=L.height,t.__preLayInline({x:e.x,y:n,w:r,h:a}),L=new S(i,n)),i+=t.outerWidth,L.add(t)):(L.size&&(s.push(L),L.verticalAlign(),n+=L.height,L=new S(e.x,n)),t.__preLay({x:e.x,y:n,w:r,h:a}),i=e.x,n+=t.outerHeight):i===e.x?(L.add(t),t.__preLay({x:i,y:n,w:r,h:a}),i+=t.width):(0<=t.__tryLayInline(r-i,r)?t.__preLay({x:i,y:n,w:r,h:a}):(s.push(L),L.verticalAlign(),i=e.x,n+=L.height,t.__preLay({x:e.x,y:n,w:r,h:a}),L=new S(i,n)),i+=t.width,L.add(t))}),L.size&&(s.push(L),L.verticalAlign(),n+=L.height),-1<["center","right"].indexOf(w)&&s.forEach(function(t){var e=r-t.width;0<e&&t.horizonAlign("center"===w?.5*e:e)}),this.__width=r,this.__height=t?a:n-e.y,this.__flowY=n}},{key:"__preLayFlex",value:function(t){var T=t.x,W=t.y,A=t.w,S=t.h;this.__x=T,this.__y=W,this.__width=A;var e,B,i=this.flowChildren,n=this.style,r=n.width,a=n.height,o=n.flexDirection,h=n.borderTopWidth,s=n.borderRightWidth,l=n.borderBottomWidth,u=n.borderLeftWidth,c=n.marginTop,d=n.marginRight,f=n.marginBottom,v=n.marginLeft,_=n.paddingTop,p=n.paddingRight,y=n.paddingBottom,g=n.paddingLeft,m=n.justifyContent,x=n.alignItems;if(r&&r.unit!==Z)switch(e=!0,r.unit){case J:A=r.value;break;case K:A*=.01*r.value}if(a&&a.unit!==Z)switch(B=!0,a.unit){case J:S=a.value;break;case K:S*=.01*a.value}T+=u.value+v.value+g.value,t.x=T,W+=h.value+c.value+_.value,t.y=W,A-=u.value+s.value+v.value+d.value+g.value+p.value,S-=h.value+l.value+c.value+f.value+_.value+y.value;var E="row"===o;if(!E&&!B)return i.forEach(function(t){if(t instanceof Q){var e=t.style,i=t.style,n=i.display,r=i.flexDirection,a=i.width;"inline"===n?e.display="block":"flex"===n&&"row"===r&&a.unit===Z&&(a.value=A,a.unit=J),t.__preLay({x:T,y:W,w:A,h:S}),W+=t.outerHeight}else t.__preLay({x:T,y:W,w:A,h:S}),W+=t.outerHeight}),this.__width=A,void(this.__height=W-t.y);var O=[],P=[],M=[],C=[],N=0,R=0,H=0,b=0;i.forEach(function(t){if(t instanceof Q){var e=t.style,i=e.flexGrow,n=e.flexShrink,r=e.flexBasis;O.push(i),P.push(n),N+=i,R+=n;var a=t.__calAutoBasis(E,A,S),o=a.b,h=a.min,s=a.max;r.unit===Z?(M.push(s),H+=s):r.unit===J?(o=r.value,M.push(o),H+=o):r.unit===K&&(o=(E?A:S)*r.value,M.push(o),H+=o),b+=s,C.push(h)}else O.push(0),P.push(1),R+=1,E?(M.push(t.textWidth),H+=t.textWidth,b+=t.textWidth,C.push(t.charWidth)):(t.__preLay({x:0,y:0,w:A,h:S},!0),M.push(t.height),H+=t.height,b+=t.height,C.push(t.height))});var I=0,V=(E?A:S)<b;i.forEach(function(t,e){var i,n=P[e],r=O[e];if(V){var a=H-(E?A:S);i=n?M[e]-a*n/R:M[e]}else{var o=(E?A:S)-H;i=r?M[e]+o*r/N:M[e]}if(i=Math.max(i,C[e]),t instanceof Q){var h=t.style,s=t.style,l=s.display,u=s.flexDirection,c=s.width,d=s.height,f=s.marginTop,v=s.marginRight,_=s.marginBottom,p=s.marginLeft,y=s.borderTopWidth,g=s.borderRightWidth,m=s.borderBottomWidth,x=s.borderLeftWidth,b=s.paddingTop,k=s.paddingRight,w=s.paddingBottom,L=s.paddingLeft;E?("inline"===l?h.display="block":"flex"===l&&"column"===u&&B&&d.unit===Z&&(d.value=S,d.unit=J),t.__preLay({x:T,y:W,w:i,h:S})):("inline"===l?h.display="block":"flex"===l&&"row"===u&&c.unit===Z&&(c.value=A,c.unit=J),t.__preLay({x:T,y:W,w:A,h:i})),V&&n?E?t.__width=i-p.value-v.value-x.value-g.value-L.value-k.value:t.__height=i-f.value-_.value-y.value-m.value-b.value-w.value:!V&&r&&(E?t.__width=i-p.value-v.value-x.value-g.value-L.value-k.value:t.__height=i-f.value-_.value-y.value-m.value-b.value-w.value)}else t.__preLay({x:T,y:W,w:E?i:A,h:E?S:i});I=E?(T+=t.outerWidth,Math.max(I,t.outerHeight)):(W+=t.outerHeight,Math.max(I,t.outerWidth))});var k=E?A-T+t.x:S-W+t.y;if(!V&&0===N&&0<k){var w=i.length;if("flex-end"===m)for(var L=0;L<w;L++){var G=i[L];E?G.__offsetX(k):G.__offsetY(k)}else if("center"===m)for(var F=.5*k,z=0;z<w;z++){var Y=i[z];E?Y.__offsetX(F):Y.__offsetY(F)}else if("space-between"===m)for(var j=k/(w-1),$=1;$<w;$++){var X=i[$];E?X.__offsetX(j*$):X.__offsetY(j*$)}else if("space-around"===m)for(var D=k/(w+1),q=0;q<w;q++){var U=i[q];E?U.__offsetX(D*(q+1)):U.__offsetY(D*(q+1))}}E?(B&&(I=S),W+=I):e&&(I=A),"stretch"===x?i.forEach(function(t){var e=t.style;E?e.height.unit===Z&&(t.__height=I-e.marginTop.value-e.marginBottom.value-e.paddingTop.value-e.paddingBottom.value-e.borderTopWidth.value-e.borderBottomWidth.value):e.width.unit===Z&&(t.__width=I-e.marginLeft.value-e.marginRight.value-e.paddingLeft.value-e.paddingRight.value-s.value-u.value)}):"center"===x?i.forEach(function(t){var e=I-t.outerHeight;0<e&&t.__offsetY(.5*e)}):"flex-end"===x&&i.forEach(function(t){var e=I-t.outerHeight;0<e&&t.__offsetY(e)}),this.__width=A,this.__height=B?S:W-t.y,this.__flowY=W}},{key:"__preLayInline",value:function(e){var i=this,n=e.x,r=e.y,a=e.w,o=e.h;this.__x=n,this.__y=r;var t,h,s=n,l=this.flowChildren,u=this.style,c=this.lineGroups,d=u.width,f=u.height,v=u.borderTopWidth,_=u.borderRightWidth,p=u.borderBottomWidth,y=u.borderLeftWidth,g=u.marginTop,m=u.marginRight,x=u.marginBottom,b=u.marginLeft,k=u.paddingTop,w=u.paddingRight,L=u.paddingBottom,T=u.paddingLeft,W=u.textAlign;if(d&&d.unit!==Z)switch(t=!0,d.unit){case J:a=d.value;break;case K:a*=.01*d.value}if(f&&f.unit!==Z)switch(h=!0,f.unit){case J:o=f.value;break;case K:o*=.01*f.value}n+=y.value+b.value+T.value,e.x=n,r+=v.value+g.value+k.value,e.y=r,a-=y.value+_.value+b.value+m.value+T.value+w.value,o-=v.value+p.value+g.value+x.value+k.value+L.value;var A=new S(n,r);l.forEach(function(t){if(t instanceof Q){if("absolute"===t.style.position)return void i.absChildren.push(t);if(n===e.x)A.add(t),t.__preLayInline({x:n,y:r,w:a,h:o}),n+=t.outerWidth,s=Math.max(s,n);else 0<=t.__tryLayInline(a-n,a)?t.__preLayInline({x:n,y:r,w:a,h:o}):(c.push(A),A.verticalAlign(),n=e.x,r+=A.height,t.__preLayInline({x:e.x,y:r,w:a,h:o}),A=new S(n,r)),n+=t.outerWidth,s=Math.max(s,n),A.add(t)}else{if(n===e.x)A.add(t),t.__preLay({x:n,y:r,w:a,h:o}),n+=t.width,s=Math.max(s,n);else 0<=t.__tryLayInline(a-n,a)?t.__preLay({x:n,y:r,w:a,h:o}):(c.push(A),A.verticalAlign(),n=e.x,r+=A.height,t.__preLay({x:e.x,y:r,w:a,h:o}),A=new S(n,r)),n+=t.width,s=Math.max(s,n),A.add(t)}}),A.size&&(c.push(A),A.verticalAlign(),r+=A.height),-1<["center","right"].indexOf(W)&&c.forEach(function(t){var e=a-t.width;0<e&&t.horizonAlign("center"===W?.5*e:e)}),this.__width=t?a:s-e.x,this.__height=h?o:r-e.y,this.__flowY=r}},{key:"__preLayAbs",value:function(e){var _=this.x,p=this.y,y=this.flowY,g=this.width,m=this.height,t=this.children,i=this.absChildren,n=this.style,x=n.marginTop,b=n.marginLeft,r=n.paddingTop,a=n.paddingLeft,o=n.paddingRight,h=n.paddingBottom,k=n.borderTopWidth,w=n.borderLeftWidth,L=g+a.value+o.value,T=m+r.value+h.value;t.forEach(function(t){t instanceof l&&t.__preLayAbs(-1<["absolute","relative"].indexOf(t.style.position)?t:e)}),i.forEach(function(t){var e,i,n,r,a=t.style,o=t.style,h=o.left,s=o.top,l=o.right,u=o.bottom,c=o.width,d=o.height;if(h.unit!==Z&&l.unit!==Z)e=h.unit===J?_+b.value+w.value+h.value:_+b.value+w.value+g*h.value*.01,n=l.unit===J?_+b.value+w.value+L-l.value-e:_+b.value+w.value+L-g*l.value*.01-e;else if(h.unit!==Z&&c.unit!==Z)e=h.unit===J?_+b.value+w.value+h.value:_+b.value+w.value+g*h.value*.01,n=c.unit===J?c.value:g*c.value*.01;else if(l.unit!==Z&&c.unit!==Z){n=c.unit===J?c.value:g;var f=c.unit===J?c.value:g*c.value*.01;e=l.unit===J?_+b.value+w.value+L-l.value-f:_+b.value+w.value+L-g*l.value*.01-f}else h.unit!==Z?(e=h.unit===J?_+h.value:_+b.value+w.value+g*h.value*.01,n=t.__calAbs(!0)):l.unit!==Z?(n=t.__calAbs(!0),e=l.unit===J?_+b.value+w.value+L-l.value-n:_+b.value+w.value+L-g*l.value*.01-n):n=c.unit!==Z?(e=_+b.value+w.value,c.unit===J?c.value:g):(e=_+b.value+w.value,t.__calAbs(!0));if(s.unit!==Z&&u.unit!==Z)i=s.unit===J?p+s.value:p+x.value+k.value+m*s.value*.01,r=u.unit===J?p+x.value+k.value+T-u.value-i:p+x.value+k.value+T-m*u.value*.01-i,a.height={value:r,unit:J};else if(s.unit!==Z&&d.unit!==Z)i=s.unit===J?p+s.value:p+x.value+k.value+m*s.value*.01,r=d.unit===J?d.value:m;else if(u.unit!==Z&&d.unit!==Z){r=d.unit===J?d.value:m;var v=d.unit===J?d.value:m*d.value*.01;i=u.unit===J?p+x.value+k.value+T-u.value-v:p+x.value+k.value+T-m*u.value*.01-v}else s.unit!==Z?(i=s.unit===J?p+s.value:p+x.value+k.value+m*s.value*.01,r=t.__calAbs()):u.unit!==Z?(r=t.__calAbs(),i=u.unit===J?p+x.value+k.value+T-u.value-r:p+x.value+k.value+T-m*u.value*.01-r):r=d.unit!==Z?(i=y+x.value+k.value,d.unit===J?d.value:m):(i=y+x.value+k.value,t.__calAbs());"inline"===a.display&&(a.display="block"),t.__preLay({x:e,y:i,w:n,h:r})})}},{key:"__emitEvent",value:function(t,e){var i=t.event.type,n=t.x,r=t.y,a=t.covers,o=this.listener,h=this.children,s=this.style,l=this.x,u=this.y,c=this.outerWidth,d=this.outerHeight;if("none"!==s.display){var f,v;o.hasOwnProperty(i)&&(f=o[i]);for(var _=h.length-1;0<=_;_--){var p=h[_];p instanceof Q&&-1<["absolute","relative"].indexOf(p.style.position)&&p.__emitEvent(t,e)&&(v=!0)}for(var y=h.length-1;0<=y;y--){var g=h[y];g instanceof Q&&-1===["absolute","relative"].indexOf(g.style.position)&&g.__emitEvent(t,e)&&(v=!0)}if(e)f&&f(t);else if(v)a.push({x:l,y:u,w:c,h:d}),f&&f(t);else if(l<=n&&u<=r&&n<=l+c&&r<=u+d){for(var m=0,x=a.length;m<x;m++){var b=a[m],k=b.x,w=b.y,L=b.w,T=b.h;if(k<=n&&w<=r&&n<=k+L&&r<=w+T)return}t.target||(t.target=this),a.push({x:l,y:u,w:c,h:d}),f&&f(t)}}}},{key:"render",value:function(){M(P(l.prototype),"render",this).call(this);var t=this.style.display,e=this.flowChildren,i=this.children;"none"!==t&&(e.forEach(function(t){(t instanceof k||"static"===t.style.position)&&t.render()}),i.forEach(function(t){t instanceof Q&&-1<["relative","absolute"].indexOf(t.style.position)&&t.render()}))}},{key:"tagName",get:function(){return this.__tagName}},{key:"children",get:function(){return this.__children}},{key:"flowChildren",get:function(){return this.__flowChildren}},{key:"absChildren",get:function(){return this.__absChildren}},{key:"lineGroups",get:function(){return this.__lineGroups}},{key:"baseLine",get:function(){var t=this.lineGroups.length;if(t){var e=this.lineGroups[t-1];return e.y-this.y+e.baseLine}return this.y}},{key:"flowY",get:function(){return this.__flowY}}],[{key:"isValid",value:function(t){return L.hasOwnProperty(t)}}]),l}();var A=function(){function r(t,e,i){var n;return s(this,r),(n=a(this,P(r).call(this,t,e,i))).__node=null,n}return t(r,W),e(r,[{key:"__initProps",value:function(){if(void 0!==this.props.width){var t=parseInt(this.props.width);!isNaN(t)&&0<t&&(this.__width=t)}if(void 0!==this.props.height){var e=parseInt(this.props.height);!isNaN(e)&&0<e&&(this.__height=e)}}},{key:"__genHtml",value:function(){for(var t,e,i,n="<".concat(this.tagName),r=0,a=this.__props.length;r<a;r++){var o=this.__props[r];n+=(t=o[0],e=o[1],void 0,i=Array.isArray(e)?y.joinSourceArray(e):y.stringify(e),"className"===t&&(t="class")," "+t+'="'+y.encodeHtml(i,!0)+'"')}return n+="></".concat(this.tagName,">")}},{key:"__cb",value:function(t,e){if(!(t.touches&&1<t.touches.length)){var i=this.node.getBoundingClientRect(),n=i.x,r=i.y,a=i.top,o=i.right;n=n||a||0,r=r||o||0;var h=t.touches?t.touches[0]||{}:t;n=h.clientX-n,r=h.clientY-r,this.__emitEvent({event:t,x:n,y:r,covers:[]},e)}}},{key:"__initEvent",value:function(){var i=this,t=this.node;["click","dblclick","mousedown","mousemove","mouseup","touchstart","touchmove","touchend","touchcancel"].forEach(function(e){t.addEventListener(e,function(t){i.__cb(t,-1<["touchend","touchcancel"].indexOf(e))})})}},{key:"appendTo",value:function(t){if(t=function(t){if(y.isString(t)){var e=document.querySelector(t);if(!e)throw new Error("can not find dom of selector: "+t);return e}if(!t)throw new Error("can not find dom: "+t);return t}(t),this.__initProps(),t.nodeName.toUpperCase()===this.tagName.toUpperCase()?(this.__node=t,this.width&&t.setAttribute("width",this.width),this.height&&t.setAttribute("height",this.height)):(t.innerHTML=this.__genHtml(),this.__node=t.querySelector(this.tagName)),!this.width||!this.height){var e=window.getComputedStyle(t,null);this.width||(this.__width=parseInt(e.getPropertyValue("width")),t.setAttribute("width",this.width)),this.height||(this.__height=parseInt(e.getPropertyValue("height")),t.setAttribute("height",this.height))}"canvas"===this.tagName?(this.__ctx=this.__node.getContext("2d"),this.__ctx.clearRect(0,0,this.width,this.height),this.__mode=I.CANVAS):"svg"===this.tagName&&(this.__mode=I.SVG);var i=this.style;-1===["flex","block"].indexOf(i.display)&&(i.display="block"),"absolute"===i.position&&(i.position="static"),this.__traverse(this.__ctx,this.__mode),i.width=this.width,i.height=this.height,this.__initStyle(),this.__preLay({x:0,y:0,w:this.width,h:this.height}),this.__preLayAbs(this),this.render(),this.mode===I.SVG&&(this.node.innerHTML=I.html,I.reset()),this.node.__initEvent||(this.node.__initEvent=!0,this.__initEvent())}},{key:"node",get:function(){return this.__node}}]),r}(),B=function(){function O(t){var e;return s(this,O),(e=a(this,P(O).call(this,"$line",t))).__start=[],e.__end=[],Array.isArray(e.props.start)&&(e.__start=e.props.start),Array.isArray(e.props.end)&&(e.__end=e.props.end),-1<["TOP_LEFT","TOP_RIGHT","BOTTOM_LEFT","BOTTOM_RIGHT"].indexOf(e.props.origin)?e.__origin=e.props.origin:e.__origin="BOTTOM_LEFT",e}return t(O,w),e(O,[{key:"render",value:function(){M(P(O.prototype),"render",this).call(this);var t=this.x,e=this.y,i=this.width,n=this.height,r=this.style,a=this.ctx,o=this.start,h=this.end,s=this.origin,l=this.dash;if(!(o.length<2||h.length<2)){var u=r.display,c=r.borderTopWidth,d=r.borderRightWidth,f=r.borderBottomWidth,v=r.borderLeftWidth,_=r.marginTop,p=r.marginRight,y=r.marginBottom,g=r.marginLeft,m=r.paddingTop,x=r.paddingRight,b=r.paddingBottom,k=r.paddingLeft,w=r.stroke,L=r.strokeWidth;if("none"!==u){var T,W,A,S,B=t+v.value+g.value+k.value,E=e+c.value+_.value+m.value;i-=v.value+d.value+g.value+p.value+k.value+x.value,n-=c.value+f.value+_.value+y.value+m.value+b.value,"TOP_LEFT"===s?(T=B+o[0]*i,W=E+o[1]*n,A=B+h[0]*i,S=E+h[1]*n):"TOP_RIGHT"===s?(T=B+i-o[0]*i,W=E+o[1]*n,A=B+i-h[0]*i,S=E+h[1]*n):"BOTTOM_LEFT"===s?(T=B+o[0]*i,W=E+n-o[1]*n,A=B+h[0]*i,S=E+n-h[1]*n):"BOTTOM_RIGHT"===s&&(T=B+i-o[0]*i,W=E+n-o[1]*n,A=B+i-h[0]*i,S=E+n-h[1]*n),this.mode===I.CANVAS?(a.strokeStyle=w,a.lineWidth=L,a.setLineDash(l),a.beginPath(),a.moveTo(T,W),a.lineTo(A,S),a.stroke(),a.closePath()):this.mode===I.SVG&&I.appendHtml('<line x1="'.concat(T,'" y1="').concat(W,'" x2="').concat(A,'" y2="').concat(S,'" stroke-width="').concat(L,'" stroke="').concat(w,'"/>'))}}}},{key:"start",get:function(){return this.__start}},{key:"end",get:function(){return this.__end}}]),O}(),O=function(){function E(t){var e;return s(this,E),(e=a(this,P(E).call(this,"$polygon",t))).__points=[],Array.isArray(e.props.points)&&(e.__points=e.props.points),-1<["TOP_LEFT","TOP_RIGHT","BOTTOM_LEFT","BOTTOM_RIGHT"].indexOf(e.props.origin)?e.__origin=e.props.origin:e.__origin="BOTTOM_LEFT",e}return t(E,w),e(E,[{key:"render",value:function(){M(P(E.prototype),"render",this).call(this);var t=this.x,e=this.y,i=this.width,n=this.height,r=this.style,a=this.ctx,o=this.points,h=this.origin,s=this.dash;if(!(o.length<2)){for(var l=0,u=o.length;l<u;l++)if(!Array.isArray(o[l])||o[l].length<2)return;var c=r.display,d=r.borderTopWidth,f=r.borderLeftWidth,v=r.marginTop,_=r.marginLeft,p=r.paddingTop,y=r.paddingLeft,g=r.stroke,m=r.strokeWidth;if("none"!==c){var x=t+f.value+_.value+y.value,b=e+d.value+v.value+p.value,k=this.__pts=[];if("TOP_LEFT"===h?o.forEach(function(t){k.push([x+t[0]*i,b+t[1]*n])}):"TOP_RIGHT"===h?o.forEach(function(t){k.push([x+i-t[0]*i,b+t[1]*n])}):"BOTTOM_LEFT"===h?o.forEach(function(t){k.push([x+t[0]*i,b+n-t[1]*n])}):"BOTTOM_RIGHT"===h&&o.forEach(function(t){k.push([x+i-t[0]*i,b+n-t[1]*n])}),this.mode===I.CANVAS){a.strokeStyle=g,a.lineWidth=m,a.setLineDash(s),a.beginPath(),a.moveTo(k[0][0],b+k[0][1]);for(var w=1,L=k.length;w<L;w++){var T=k[w];a.lineTo(T[0],T[1])}m&&"transparent"!==g&&a.stroke(),a.closePath()}else if(this.mode===I.SVG){for(var W="",A=0,S=k.length;A<S;A++){var B=k[A];W+="".concat(B[0],",").concat(B[1]," ")}I.appendHtml('<polyline fill="none" points="'.concat(W,'" stroke-width="').concat(m,'" stroke="').concat(g,'"/>'))}}}}},{key:"getPointsByX",value:function(t){for(var e=1/0,i=this.__pts.length,n=[],r=0;r<i;r++){var a=Math.abs(this.__pts[r][0]-t);a<e&&(e=a)}for(var o=0;o<i;o++){Math.abs(this.__pts[o][0]-t)===e&&n.push({index:o,x:this.__pts[o][0],y:this.__pts[o][1]})}return n}},{key:"points",get:function(){return this.__points}},{key:"origin",get:function(){return this.__origin}}]),E}(),C=function(){function S(t){var e;return s(this,S),(e=a(this,P(S).call(this,"$polygon",t))).__points=[],Array.isArray(e.props.points)&&(e.__points=e.props.points),e}return t(S,w),e(S,[{key:"render",value:function(){M(P(S.prototype),"render",this).call(this);var t=this.x,e=this.y,i=this.width,n=this.height,r=this.style,a=this.ctx,o=this.points,h=this.dash;if(!(o.length<3)){for(var s=0,l=o.length;s<l;s++)if(!Array.isArray(o[s])||o[s].length<2)return;var u=r.display,c=r.borderTopWidth,d=r.borderLeftWidth,f=r.marginTop,v=r.marginLeft,_=r.paddingTop,p=r.paddingLeft,y=r.stroke,g=r.strokeWidth;if("none"!==u){var m=t+d.value+v.value+p.value,x=e+c.value+f.value+_.value;if(o.forEach(function(t){t[0]=m+t[0]*i,t[1]=x+t[1]*n}),this.mode===I.CANVAS){a.strokeStyle=y,a.lineWidth=g,a.setLineDash(h),a.beginPath(),a.moveTo(o[0][0],x+o[0][1]);for(var b=1,k=o.length;b<k;b++){var w=o[b];a.lineTo(w[0],w[1])}a.fill(),g&&"transparent"!==y&&a.stroke(),a.closePath()}else if(this.mode===I.SVG){for(var L="",T=0,W=L.length;T<W;T++){var A=L[T];L+="".concat(A[0],",").concat(A[1]," ")}I.appendHtml('<polyline fill="none" points="'.concat(L,'" stroke-width="').concat(g,'" stroke="').concat(y,'"/>'))}}}}},{key:"points",get:function(){return this.__points}}]),S}(),N=.5*Math.PI;function R(t,e,i,n){for(;360<n;)n-=360;for(;n<0;)n+=360;return 0<=n&&n<90?[t+Math.sin(n*Math.PI/180)*i,e-Math.cos(n*Math.PI/180)*i]:90<=n&&n<180?[t+Math.cos((n-90)*Math.PI/180)*i,e+Math.sin((n-90)*Math.PI/180)*i]:180<=n&&n<270?[t-Math.cos((270-n)*Math.PI/180)*i,e+Math.sin((270-n)*Math.PI/180)*i]:[t-Math.sin((360-n)*Math.PI/180)*i,e-Math.cos((360-n)*Math.PI/180)*i]}var H=function(){function B(t){var e;return s(this,B),(e=a(this,P(B).call(this,"$sector",t))).__start=0,e.__end=0,e.props.start&&(e.__start=parseFloat(e.props.start),isNaN(e.start)&&(e.__start=0)),e.props.end&&(e.__end=parseFloat(e.props.end),isNaN(e.end)&&(e.__end=0)),e.__r=1,e.props.r&&(e.__r=parseFloat(e.props.r),isNaN(e.r)&&(e.__r=1)),e}return t(B,w),e(B,[{key:"render",value:function(){M(P(B.prototype),"render",this).call(this);var t=this.x,e=this.y,i=this.width,n=this.height,r=this.style,a=this.ctx,o=this.start,h=this.end,s=this.r,l=this.dash;if(o!==h){var u=r.display,c=r.borderTopWidth,d=r.borderLeftWidth,f=r.marginTop,v=r.marginLeft,_=r.paddingTop,p=r.paddingLeft,y=r.stroke,g=r.strokeWidth,m=r.fill;if("none"!==u){var x=t+d.value+v.value+p.value,b=e+c.value+f.value+_.value;if(x+=.5*i,b+=.5*n,s*=.5*Math.min(i,n),this.mode===I.CANVAS)a.strokeStyle=y,a.lineWidth=g,a.fillStyle=m,a.setLineDash(l),a.beginPath(),a.moveTo(x,b),a.arc(x,b,s,o*Math.PI/180-N,h*Math.PI/180-N),a.fill(),g&&"transparent"!==y&&a.stroke(),a.closePath();else if(this.mode===I.SVG){var k,w,L,T,W=E(R(x,b,s,o),2);k=W[0],w=W[1];var A=E(R(x,b,s,h),2);L=A[0],T=A[1];var S=180<h-o?1:0;I.appendHtml('<path d="M '.concat(x," ").concat(b," L ").concat(k," ").concat(w," A").concat(s,",").concat(s," 0 ").concat(S," 1 ").concat(L,",").concat(T,' z" fill="').concat(m,'" stroke-width="').concat(g,'" stroke="').concat(y,'"/>'))}}}}},{key:"start",get:function(){return this.__start}},{key:"end",get:function(){return this.__end}},{key:"r",get:function(){return this.__r}}]),B}(),V=function(){function m(t){return s(this,m),a(this,P(m).call(this,"$sector",t))}return t(m,w),e(m,[{key:"render",value:function(){M(P(m.prototype),"render",this).call(this);var t=this.x,e=this.y,i=this.width,n=this.height,r=this.style,a=this.ctx,o=this.dash,h=r.display,s=r.borderTopWidth,l=r.borderLeftWidth,u=r.marginTop,c=r.marginLeft,d=r.paddingTop,f=r.paddingLeft,v=r.stroke,_=r.strokeWidth,p=r.fill;if("none"!==h){var y=t+l.value+c.value+f.value,g=e+s.value+u.value+d.value;this.mode===I.CANVAS?(a.strokeStyle=v,a.lineWidth=_,a.fillStyle=p,a.setLineDash(o),a.beginPath(),a.moveTo(y,g),a.lineTo(y+i,g),a.lineTo(y+i,g+n),a.lineTo(y,g+n),a.fill(),_&&"transparent"!==v&&a.stroke(),a.closePath()):this.mode===I.SVG&&I.appendHtml('<rect x="'.concat(t,'" y="').concat(e,'" width="').concat(i,'" height="').concat(n,'" fill="').concat(p,'" stroke-width="').concat(_,'" stroke="').concat(v,'"/>'))}}}]),m}(),G=function(){function x(t){var e;return s(this,x),(e=a(this,P(x).call(this,"$circle",t))).__r=1,e.props.r&&(e.__r=parseFloat(e.props.r),isNaN(e.r)&&(e.__r=1)),e}return t(x,w),e(x,[{key:"render",value:function(){M(P(x.prototype),"render",this).call(this);var t=this.x,e=this.y,i=this.width,n=this.height,r=this.style,a=this.ctx,o=this.r,h=this.dash,s=r.display,l=r.borderTopWidth,u=r.borderLeftWidth,c=r.marginTop,d=r.marginLeft,f=r.paddingTop,v=r.paddingLeft,_=r.stroke,p=r.strokeWidth,y=r.fill;if("none"!==s){var g=t+u.value+d.value+v.value,m=e+l.value+c.value+f.value;g+=.5*i,m+=.5*n,o*=.5*Math.min(i,n),this.mode===I.CANVAS?(a.strokeStyle=_,a.lineWidth=p,a.fillStyle=y,a.setLineDash(h),a.beginPath(),a.moveTo(g,m),a.arc(g,m,o,0,2*Math.PI),a.fill(),p&&"transparent"!==_&&a.stroke(),a.closePath()):this.mode===I.SVG&&I.appendHtml('<circle cx="'.concat(g,'" cy="').concat(m,'" r="').concat(o,'" fill="').concat(y,'" stroke-width="').concat(p,'" stroke="').concat(_,'"/>'))}}},{key:"r",get:function(){return this.__r}}]),x}(),F=function(){function b(t){var e;return s(this,b),(e=a(this,P(b).call(this,"$ellipse",t))).__rx=1,e.props.rx&&(e.__rx=parseFloat(e.props.rx),isNaN(e.rx)&&(e.__rx=1)),e.__ry=1,e.props.ry&&(e.__ry=parseFloat(e.props.ry),isNaN(e.rx)&&(e.__ry=1)),e}return t(b,w),e(b,[{key:"render",value:function(){M(P(b.prototype),"render",this).call(this);var t=this.x,e=this.y,i=this.width,n=this.height,r=this.style,a=this.ctx,o=this.rx,h=this.ry,s=this.dash,l=r.display,u=r.borderTopWidth,c=r.borderLeftWidth,d=r.marginTop,f=r.marginLeft,v=r.paddingTop,_=r.paddingLeft,p=r.stroke,y=r.strokeWidth,g=r.fill;if("none"!==l){var m=t+c.value+f.value+_.value,x=e+u.value+d.value+v.value;m+=.5*i,x+=.5*n,o*=.5*i,h*=.5*n,this.mode===I.CANVAS?(a.strokeStyle=p,a.lineWidth=y,a.fillStyle=g,a.setLineDash(s),a.beginPath(),a.moveTo(m,x),a.ellipse&&a.ellipse(m,x,o,h,0,0,2*Math.PI),a.fill(),y&&"transparent"!==p&&a.stroke(),a.closePath()):this.mode===I.SVG&&I.appendHtml('<ellipse cx="'.concat(m,'" cy="').concat(x,'" rx="').concat(o,'" ry="').concat(h,'" fill="').concat(g,'" stroke-width="').concat(y,'" stroke="').concat(p,'"/>'))}}},{key:"rx",get:function(){return this.__rx}},{key:"ry",get:function(){return this.__ry}}]),b}(),z=function(){function S(t){var e;return s(this,S),(e=a(this,P(S).call(this,"$grid",t))).__nx=0,e.props.nx&&(e.__nx=parseFloat(e.props.nx),isNaN(e.nx)&&(e.__nx=0)),e.__ny=0,e.props.ny&&(e.__ny=parseFloat(e.props.ny),isNaN(e.ny)&&(e.__ny=0)),e}return t(S,w),e(S,[{key:"render",value:function(){M(P(S.prototype),"render",this).call(this);var t=this.x,e=this.y,i=this.width,n=this.height,r=this.style,a=this.ctx,o=this.nx,h=this.ny,s=this.dash;if(!(i<=0||n<=0||o<3&&h<3)){var l=r.display,u=r.borderTopWidth,c=r.borderLeftWidth,d=r.marginTop,f=r.marginLeft,v=r.paddingTop,_=r.paddingLeft,p=r.stroke,y=r.strokeWidth;if("none"!==l){var g=t+c.value+f.value+_.value,m=e+u.value+d.value+v.value,x=g+i,b=m+n,k=[],w=[];if(3<=o)for(var L=i/(o-1),T=0;T<o;T++)w.push(g+T*L);if(3<=h)for(var W=n/(h-1),A=0;A<h;A++)k.push(m+A*W);this.mode===I.CANVAS?(a.strokeStyle=p,a.lineWidth=y,a.setLineDash(s),a.beginPath(),k.forEach(function(t){a.moveTo(g,t),a.lineTo(x,t)}),w.forEach(function(t){a.moveTo(t,m),a.lineTo(t,b)}),y&&"transparent"!==p&&a.stroke(),a.closePath()):(this.mode,I.SVG)}}}},{key:"nx",get:function(){return this.__nx}},{key:"ny",get:function(){return this.__ny}},{key:"dash",get:function(){return this.__dash}}]),S}(),Y={render:function(t,e){if(!(t instanceof A))throw new Error("render root muse be canvas or svg");return e&&t.appendTo(e),t},createVd:function(t,e,i){if(-1<["canvas","svg"].indexOf(t))return new A(t,e,i);if(W.isValid(t))return new W(t,e,i);throw new Error("can not use marker: "+t)},createGm:function(t,e){switch(t){case"$line":return new B(e);case"$polyline":return new O(e);case"$polygon":return new C(e);case"$sector":return new H(e);case"$rect":return new V(e);case"$circle":return new G(e);case"$ellipse":return new F(e);case"$grid":return new z(e)}throw new Error("can not use geom marker: "+t)},createCp:function(t,e){return new t(e)}};return"undefined"!=typeof window&&(window.karas=Y),Y});
//# sourceMappingURL=index.min.js.map
