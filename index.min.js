!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).karas=e()}(this,function(){"use strict";function h(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function e(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}function t(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&i(t,e)}function G(t){return(G=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function i(t,e){return(i=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function r(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function M(t,e,i){return(M="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=G(t)););return t}(t,e);if(n){var a=Object.getOwnPropertyDescriptor(n,e);return a.get?a.get.call(i):a.value}})(t,e,i||t)}var a,o="",V={CANVAS:0,SVG:1,appendHtml:function(t){o+=t},get html(){return o},measure:function(t,e){a||((a=document.createElement("div")).style.position="absolute",a.style.left="99999px",a.style.top="-99999px",a.style.visibility="hidden",document.body.appendChild(a)),a.style.fontSize=e.fontSize+"px",a.innerText=t;var i=window.getComputedStyle(a,null);return parseFloat(i.width)}},l=function(){function t(){h(this,t),this.__x=0,this.__y=0,this.__width=0,this.__height=0,this.__prev=null,this.__next=null,this.__ctx=null,this.__parent=null,this.__style={},this.__baseLine=0,this.__mode=V.CANVAS}return e(t,[{key:"__offsetX",value:function(t){this.__x+=t}},{key:"__offsetY",value:function(t){this.__y+=t}},{key:"x",get:function(){return this.__x}},{key:"y",get:function(){return this.__y}},{key:"width",get:function(){return this.__width}},{key:"height",get:function(){return this.__height}},{key:"outerWidth",get:function(){return this.__width}},{key:"outerHeight",get:function(){return this.__height}},{key:"prev",get:function(){return this.__prev}},{key:"next",get:function(){return this.__next}},{key:"parent",get:function(){return this.__parent}},{key:"style",get:function(){return this.__style}},{key:"ctx",get:function(){return this.__ctx}},{key:"baseLine",get:function(){return this.__baseLine}},{key:"mode",get:function(){return this.__mode}}]),t}(),J=0,K=1,Q=2;var s=function(){function n(t,e){var i;return h(this,n),i=r(this,G(n).call(this)),e=e||[],Array.isArray(e)?(i.props=function(t){for(var e={},i=0,n=t.length;i<n;i++){var a=t[i];if(Array.isArray(a))e[a[0]]=a[1];else for(var r=Object.keys(a),o=r.length-1;0<=o;o--){var h=r[o];e[h]=a[h]}}return e}(e),i.__props=function(t){for(var e=0,i=t.length;e<i;e++){var n=t[e];if(!Array.isArray(n)){for(var a=[],r=Object.keys(n),o=0,h=r.length;o<h;o++){var l=r[o];a.push([l,n[l]])}t.splice.apply(t,[e,1].concat(a))}}return t}(e)):(i.props=e,i.__props=function(t){for(var e=[],i=Object.keys(t),n=0,a=i.length;n<a;n++){var r=i[n];e.push([r,t[r]])}return e}(e)),i.__tagName=t,i.__style=i.props.style||{},i}return t(n,l),e(n,[{key:"__preLay",value:function(t){var e=this.style;"block"===e.display?this.__preLayBlock(t):"flex"===e.display?this.__preLayFlex(t):this.__preLayInline(t);var i=this.parent||this,n=i.width,a=i.height,r=e.position,o=e.top,h=e.right,l=e.bottom,s=e.left;if("relative"===r){if(s.unit!==J){var u=s.unit===K?s.value:s.value*n*.01;this.__offsetX(u)}else if(h.unit!==J){var c=h.unit===K?h.value:h.value*n*.01;this.__offsetX(-c)}if(o.unit!==J){var f=o.unit===K?o.value:o.value*a*.01;this.__offsetY(f)}else if(l.unit!==J){var d=l.unit===K?l.value:l.value*a*.01;this.__offsetY(-d)}}}},{key:"render",value:function(){var t=this.ctx,e=this.style,i=this.x,n=this.y,a=this.width,r=this.height,o=e.backgroundColor,h=e.borderTopWidth,l=e.borderTopColor,s=e.borderRightWidth,u=e.borderRightColor,c=e.borderBottomWidth,f=e.borderBottomColor,d=e.borderLeftWidth,_=e.borderLeftColor,v=e.marginTop,y=e.marginLeft,p=e.paddingTop,g=e.paddingRight,m=e.paddingBottom,x=e.paddingLeft;if(y&&(i+=y.value),v&&(n+=v.value),o){var b=i;d&&(b+=d.value);var w=n;h&&(w+=h.value);var k=a+x.value+g.value,L=r+p.value+m.value;this.mode===V.CANVAS?(t.beginPath(),t.fillStyle=o,t.rect(b,w,k,L),t.fill(),t.closePath()):this.mode===V.SVG&&V.appendHtml('<rect x="'.concat(b,'" y="').concat(w,'" width="').concat(k,'" height="').concat(L,'" fill="').concat(o,'"/>'))}if(h.value){var T=i+d.value,W=n+.5*h.value,B=T+a;x&&(B+=x.value),g&&(B+=g.value),this.mode===V.CANVAS?(t.beginPath(),t.lineWidth=h.value,t.strokeStyle=l,t.moveTo(T,W),t.lineTo(B,W),t.stroke(),t.closePath()):this.mode===V.SVG&&V.appendHtml('<line x1="'.concat(T,'" y1="').concat(W,'" x2="').concat(B,'" y2="').concat(W,'" stroke-width="').concat(h.value,'" stroke="').concat(l,'"/>'))}if(s.value){var A=i+a+d.value+.5*s.value,S=n,O=S+r+h.value+c.value;x&&(A+=x.value),g&&(A+=g.value),p&&(O+=p.value),m&&(O+=m.value),this.mode===V.CANVAS?(t.beginPath(),t.lineWidth=s.value,t.strokeStyle=u,t.moveTo(A,S),t.lineTo(A,O),t.stroke(),t.closePath()):this.mode===V.SVG&&V.appendHtml('<line x1="'.concat(A,'" y1="').concat(S,'" x2="').concat(A,'" y2="').concat(O,'" stroke-width="').concat(s.value,'" stroke="').concat(u,'"/>'))}if(c.value){var R=i+d.value,C=n+r+h.value+.5*c.value,E=R+a;x&&(E+=x.value),g&&(E+=g.value),p&&(C+=p.value),m&&(C+=m.value),this.mode===V.CANVAS?(t.beginPath(),t.lineWidth=c.value,t.strokeStyle=f,t.moveTo(R,C),t.lineTo(E,C),t.stroke(),t.closePath()):this.mode===V.SVG&&V.appendHtml('<line x1="'.concat(R,'" y1="').concat(C,'" x2="').concat(E,'" y2="').concat(C,'" stroke-width="').concat(c.value,'" stroke="').concat(f,'"/>'))}if(d.value){var N=i+.5*d.value,H=n,P=H+r+h.value+c.value;p&&(P+=p.value),m&&(P+=m.value),this.mode===V.CANVAS?(t.beginPath(),t.lineWidth=d.value,t.strokeStyle=_,t.moveTo(N,H),t.lineTo(N,P),t.stroke(),t.closePath()):this.mode===V.SVG&&V.appendHtml('<line x1="'.concat(N,'" y1="').concat(H,'" x2="').concat(N,'" y2="').concat(P,'" stroke-width="').concat(d.value,'" stroke="').concat(_,'"/>'))}}},{key:"tagName",get:function(){return this.__tagName}},{key:"outerWidth",get:function(){var t=this.style,e=t.borderLeftWidth,i=t.borderRightWidth,n=t.marginLeft,a=t.marginRight,r=t.paddingLeft,o=t.paddingRight;return this.width+e.value+i.value+n.value+a.value+r.value+o.value}},{key:"outerHeight",get:function(){var t=this.style,e=t.borderTopWidth,i=t.borderBottomWidth,n=t.marginTop,a=t.marginBottom,r=t.paddingTop,o=t.paddingBottom;return this.height+e.value+i.value+n.value+a.value+r.value+o.value}}]),n}(),u={lhr:1.14990234375,car:1.1171875,blr:.9052734375,mdr:.64599609375,lgr:.03271484375},c={position:"static",display:"block",borderSizing:"content-box",top:"auto",right:"auto",bottom:"auto",left:"auto",marginTop:0,marginRight:0,marginBottom:0,marginLeft:0,paddingTop:0,paddingRight:0,paddingBottom:0,paddingLeft:0,fontSize:16,fontFamily:"arial",color:"#000",fontStyle:"normal",fontWeight:400,lineHeight:"normal",borderTopWidth:0,borderRightWidth:0,borderBottomWidth:0,borderLeftWidth:0,borderTopStyle:"solid",borderRightStyle:"solid",borderBottomStyle:"solid",borderLeftStyle:"solid",verticalAlign:"baseline",width:"auto",height:"auto",flexGrow:0,flexShrink:1,flexBasis:"auto",flexDirection:"row",justifyContent:"flex-start",alignItem:"stretch",textAlign:"left",stroke:"#000",strokeWidth:1},f=[];Object.keys(c).forEach(function(t){var e=c[t];f.push({k:t,v:e})});var d={}.toString;function _(e){return function(t){return d.call(t)==="[object "+e+"]"}}var v=_("Number");function y(t){return p(t)?"":t.toString()}function p(t){return null==t}var g={isObject:_("Object"),isString:_("String"),isFunction:_("Function"),isNumber:v,isBoolean:_("Boolean"),isDate:_("Date"),stringify:y,joinSourceArray:function(t){return function t(e){for(var i="",n=0,a=e.length;n<a;n++){var r=e[n];Array.isArray(r)?i+=t(r):i+=y(r)}return i}(t)},encodeHtml:function(t,e){return e?t.replace(/"/g,"&quot;"):t.replace(/&/g,"&amp;").replace(/</g,"&lt;")},isNil:p};function m(t,e){var i="border".concat(e);if(t[i]){var n=/\b\d+px\b/i.exec(t[i]);n&&(t[i+"Width"]=n[0]);var a=/\bsolid\b/i.exec(t[i]);a&&(t[i+"Style"]=a[0]);var r=/#[0-9a-f]{3,6}/i.exec(t[i]);r&&-1<[4,7].indexOf(r[0].length)&&(t[i+"Color"]=r[0])}}var x={normalize:function(i){if(f.forEach(function(t){i.hasOwnProperty(t.k)||(i[t.k]=t.v)}),i.background){var t=/#[0-9a-f]{3,6}/i.exec(i.background);t&&-1<[4,7].indexOf(t[0].length)&&(i.backgroundColor=t[0])}i.flex&&("none"===i.flex?(i.flexGrow=0,i.flexShrink=0,i.flexBasis="auto"):"auto"===i.flex?(i.flexGrow=1,i.flexShrink=1,i.flexBasis="auto"):/^[\d.]+$/.test(i.flex)?(i.flexGrow=parseFloat(i.flex),i.flexShrink=1,i.flexBasis=0):/^[\d.]+px$/.test(i.flex)||/^[\d.]+%$/.test(i.flex)||(i.flexGrow=0,i.flexShrink=1,i.flexBasis="auto")),i.border&&(i.borderTop=i.borderRight=i.borderBottom=i.borderLeft=i.border),i.margin&&(i.marginTop=i.marginRight=i.marginBottom=i.marginLeft=i.margin),i.padding&&(i.paddingTop=i.paddingRight=i.paddingBottom=i.paddingLeft=i.padding),m(i,"Top"),m(i,"Right"),m(i,"Bottom"),m(i,"Left"),["marginTop","marginRight","marginBottom","marginLeft","paddingTop","paddingRight","paddingBottom","paddingLeft","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","top","right","bottom","left","width","height","flexBasis"].forEach(function(t){var e=i[t];!g.isNil(e)&&e.unit||("auto"===e?i[t]={unit:J}:/%$/.test(e)?(e=parseFloat(e)||0,i[t]={value:e,unit:Q}):(e=parseFloat(e)||0,i[t]={value:e,unit:K}))});var e=i.lineHeight;e="normal"===e?{value:i.fontSize*u.lhr,unit:K}:/px$/.test(e)?(e=parseFloat(e),{value:Math.max(i.fontSize,e),unit:K}):"normal"===(e=parseFloat(e)||"normal")?{value:i.fontSize*u.lhr,unit:K}:{value:e*i.fontSize,unit:K},i.lineHeight=e},setFontStyle:function(t){var e=t.fontStyle,i=t.fontWeight,n=t.fontSize,a=t.fontFamily;return"".concat(e," ").concat(i," ").concat(n,"px/").concat(n,"px ").concat(a)},getBaseLine:function(t){var e=t.fontSize*u.lhr;return.5*(t.lineHeight.value-e)+t.fontSize*u.blr}},b=function(){function o(t,e,i,n,a,r){h(this,o),this.__mode=t,this.__ctx=e,this.__x=i,this.__y=n,this.__content=a,this.__style=r}return e(o,[{key:"render",value:function(){var t=this.ctx,e=this.style,i=this.content,n=this.x,a=this.y;this.mode===V.CANVAS?(t.fillStyle=e.color,t.fillText(i,n,a+x.getBaseLine(e))):this.mode===V.SVG&&V.appendHtml('<text x="'.concat(n,'" y="').concat(a+x.getBaseLine(e),'" fill="').concat(e.color,'" font-size="').concat(e.fontSize,'px">').concat(i,"</text>"))}},{key:"__offsetX",value:function(t){this.__x+=t}},{key:"__offsetY",value:function(t){this.__y+=t}},{key:"ctx",get:function(){return this.__ctx}},{key:"x",get:function(){return this.__x}},{key:"y",get:function(){return this.__y}},{key:"content",get:function(){return this.__content}},{key:"style",get:function(){return this.__style}},{key:"baseLine",get:function(){return x.getBaseLine(this.style)}},{key:"mode",get:function(){return this.__mode}}]),o}(),w={},k=function(){function i(t){var e;return h(this,i),(e=r(this,G(i).call(this))).__content=t.toString(),e.__lineBoxes=[],e.__charWidthList=[],e.__charWidth=0,e.__textWidth=0,e}return t(i,l),e(i,[{key:"__measure",value:function(){this.__charWidthList=[];var t=this.ctx,e=this.content,i=this.style,n=this.charWidthList;this.mode===V.CANVAS&&(t.font=x.setFontStyle(i));for(var a=w[i.fontSize]=w[i.fontSize]||{},r=e.length,o=0,h=0;h<r;h++){var l=e.charAt(h),s=void 0;a.hasOwnProperty(l)?s=a[l]:this.mode===V.CANVAS?s=t.measureText(l).width:this.mode===V.SVG&&(s=V.measure(l,i)),n.push(s),o+=s,this.__charWidth=Math.max(this.charWidth,s)}this.__textWidth=o}},{key:"__preLay",value:function(t,e){var i=t.x,n=t.y,a=t.w;t.h;this.__x=i,this.__y=n;for(var r=i,o=this.ctx,h=this.content,l=this.style,s=this.lineBoxes,u=this.charWidthList,c=0,f=0,d=0,_=h.length;f<_;)if((d+=u[f])===a){var v=new b(this.mode,o,i,n,h.slice(c,f+1),l);s.push(v),r=Math.max(r,i+d),n+=this.style.lineHeight.value,f=(c=f+1)+1,d=0}else if(a<d){f===c&&(f=c+1);var y=new b(this.mode,o,i,n,h.slice(c,f),l);s.push(y),r=Math.max(r,i+d-u[f]),n+=this.style.lineHeight.value,c=f,f+=1,d=0}else f++;if(c<_&&c<f){var p=new b(this.mode,o,i,n,h.slice(c,f),l);s.push(p),r=Math.max(r,i+d),n+=this.style.lineHeight.value}this.__width=r-i,this.__height=n-t.y,e&&(this.__lineBoxes=[])}},{key:"render",value:function(){this.mode===V.CANVAS&&(this.ctx.font=x.setFontStyle(this.style)),this.lineBoxes.forEach(function(t){t.render()})}},{key:"__tryLayInline",value:function(t){return t-this.textWidth}},{key:"__offsetX",value:function(e){M(G(i.prototype),"__offsetX",this).call(this,e),this.lineBoxes.forEach(function(t){t.__offsetX(e)})}},{key:"__offsetY",value:function(e){M(G(i.prototype),"__offsetY",this).call(this,e),this.lineBoxes.forEach(function(t){t.__offsetY(e)})}},{key:"__calMaxAndMinWidth",value:function(){var e=0;return this.charWidthList.forEach(function(t){e=Math.max(e,t)}),{max:this.textWidth,min:e}}},{key:"content",get:function(){return this.__content},set:function(t){this.__content=t}},{key:"lineBoxes",get:function(){return this.__lineBoxes}},{key:"charWidthList",get:function(){return this.__charWidthList}},{key:"charWidth",get:function(){return this.__charWidth}},{key:"textWidth",get:function(){return this.__textWidth}},{key:"baseLine",get:function(){var t=this.lineBoxes[this.lineBoxes.length-1];return t.y-this.y+t.baseLine}}]),i}(),W=function(){function i(t,e){h(this,i),this.__list=[],this.__x=t,this.__y=e,this.__height=0,this.__baseLine=0}return e(i,[{key:"add",value:function(t){this.list.push(t)}},{key:"__calBaseLine",value:function(){var e=0;return this.list.forEach(function(t){e=Math.max(e,t.baseLine)}),e}},{key:"__calHeight",value:function(){var e=0;return this.list.forEach(function(t){e=Math.max(e,t.height)}),e}},{key:"verticalAlign",value:function(){var e=this;this.__height=this.__calHeight(),this.__baseLine=this.__calBaseLine(),1<this.list.length&&this.list.forEach(function(t){t.baseLine!==e.baseLine&&t.__offsetY(e.baseLine-t.baseLine)})}},{key:"list",get:function(){return this.__list}},{key:"x",get:function(){return this.__x}},{key:"y",get:function(){return this.__y}},{key:"height",get:function(){return this.__height}},{key:"baseLine",get:function(){return this.__baseLine}},{key:"size",get:function(){return this.__list.length}}]),i}(),L={$line:!0,$polygon:!0},Z=function(){function i(t,e){return h(this,i),r(this,G(i).call(this,t,e))}return t(i,s),e(i,[{key:"__initStyle",value:function(){x.normalize(this.style)}},{key:"__tryLayInline",value:function(t,e){var i=this.style.width;return i.unit===K?t-i.value:i.unit===Q?t-e*i.value*.01:t}},{key:"__calAutoBasis",value:function(t,e,i){var n=0,a=0,r=0,o=this.style,h=o.width,l=o.height,s=o.borderTopWidth,u=o.borderRightWidth,c=o.borderBottomWidth,f=o.borderLeftWidth,d=t?h:l;if(d.unit!==J&&(n=r+=d.value),t){var _=u.value+f.value;n+=_,r+=_,a+=_}else{var v=s.value+c.value;n+=v,r+=v,a+=v}return{b:n,min:a,max:r}}},{key:"__preLayBlock",value:function(t){var e=t.x,i=t.y,n=t.w,a=t.h;this.__x=e,this.__y=i,this.__width=n;var r,o=this.style,h=o.width,l=o.height,s=o.borderTopWidth,u=o.borderRightWidth,c=o.borderBottomWidth,f=o.borderLeftWidth;if(h&&h.unit!==J)switch(h.unit){case K:n=h.value}if(l&&l.unit!==J)switch(r=!0,l.unit){case K:a=l.value;break;case Q:a*=.01*l.value}e+=f.value,t.x=e,i+=s.value,t.y=i,n-=f.value+u.value,a-=s.value+c.value,this.__width=n,this.__height=r?a:0}},{key:"__preLayFlex",value:function(t){this.__preLayBlock(t)}},{key:"__preLayInline",value:function(t){var e=t.x,i=t.y,n=t.w,a=t.h;this.__x=e,this.__y=i;var r,o,h=this.style,l=h.width,s=h.height,u=h.borderTopWidth,c=h.borderRightWidth,f=h.borderBottomWidth,d=h.borderLeftWidth;if(l&&l.unit!==J)switch(r=!0,l.unit){case K:n=l.value}if(s&&s.unit!==J)switch(o=!0,s.unit){case K:a=s.value}e+=d.value,t.x=e,i+=u.value,t.y=i,n-=d.value+c.value,a-=u.value+f.value,this.__width=r?n:e-t.x,this.__height=o?a:i-t.y}},{key:"render",value:function(){M(G(i.prototype),"render",this).call(this)}},{key:"tagName",get:function(){return this.__tagName}},{key:"baseLine",get:function(){return this.__height}},{key:"origin",get:function(){return this.__origin}},{key:"min",get:function(){return this.__min}},{key:"max",get:function(){return this.__max}}],[{key:"isValid",value:function(t){return L.hasOwnProperty(t)}}]),i}(),T={div:!0,span:!0},B={span:!0},A=function(){function U(t,e,i){var n;return h(this,U),(n=r(this,G(U).call(this,t,e))).__children=i,n.__flowChildren=[],n.__absChildren=[],n.__lineGroups=[],n.__flowY=0,n}return t(U,s),e(U,[{key:"__traverse",value:function(e,t){var i=this,n=[];this.__traverseChildren(this.children,n,e,t);for(var a=n.length-1;0<a;a--){var r=n[a];if(r instanceof k){var o=n[a-1];o instanceof k?(o.content+=r.content,n.splice(a,1)):a--}}if("inline"===this.style.display&&"flex"!==this.parent.style.display)for(var h=n.length-1;0<=h;h--){var l=n[h];if(l instanceof U&&"inline"!==l.style.display)throw new Error("inline can not contain block/flex")}n.forEach(function(t){t.__ctx=e,t.__parent=i,t.__prev=null,t instanceof k||"absolute"!==t.style.position?i.__flowChildren.push(t):i.__absChildren.push(t)}),this.__children=n}},{key:"__traverseChildren",value:function(t,e,i,n){var a=this;if(Array.isArray(t))t.forEach(function(t){a.__traverseChildren(t,e,i,n)});else if(t instanceof U)e.push(t),t.__traverse(i,n),t.__mode=n;else if(t instanceof Z)e.push(t),t.__mode=n;else if(!g.isNil(t)){var r=new k(t);r.__mode=n,e.push(r)}}},{key:"__initStyle",value:function(){var e=this.__style;e.display&&-1!==["flex","block","inline","none"].indexOf(e.display)||(B.hasOwnProperty(this.tagName)?e.display="inline":e.display="block");var t=this.parent;if(t){var i=t.style;["fontSize","fontWeight","fontStyle","lineHeight","wordBreak","color","textAlign"].forEach(function(t){!e.hasOwnProperty(t)&&i.hasOwnProperty(t)&&(e[t]=i[t])})}x.normalize(e),this.children.forEach(function(t){t instanceof U||t instanceof Z?t.__initStyle():(t.__style=e,t.__measure())})}},{key:"__tryLayInline",value:function(t,e){var i=this.flowChildren,n=this.style.width;if(n.unit===K)return t-n.value;if(n.unit===Q)return t-e*n.value*.01;for(var a=0;a<i.length;a++){if(t<0)return t;var r=i[a];t-=r instanceof U||r instanceof Z?r.__tryLayInline(t,e):r.textWidth}return t}},{key:"__offsetX",value:function(e){M(G(U.prototype),"__offsetX",this).call(this,e),this.flowChildren.forEach(function(t){t&&t.__offsetX(e)})}},{key:"__offsetY",value:function(e){M(G(U.prototype),"__offsetY",this).call(this,e),this.flowChildren.forEach(function(t){t&&t.__offsetY(e)})}},{key:"__calAutoBasis",value:function(r,o,h,t){var l=0,s=0,u=0,e=this.flowChildren,i=this.style,n=i.width,a=i.height,c=i.borderTopWidth,f=i.borderRightWidth,d=i.borderBottomWidth,_=i.borderLeftWidth,v=i.marginTop,y=i.marginRight,p=i.marginBottom,g=i.marginLeft,m=i.paddingTop,x=i.paddingRight,b=i.paddingBottom,w=i.paddingLeft,k=r?n:a;if(k.unit===K&&(l=u=k.value,t&&(s=l)),e.forEach(function(t){if(t instanceof U||t instanceof Z){var e=t.__calAutoBasis(r,o,h,!0),i=e.b,n=e.min,a=e.max;l=Math.max(l,i),s=Math.max(s,n),u=Math.max(u,a)}else u=r?(s=Math.max(t.charWidth,s),Math.max(t.textWidth,u)):(t.__preLay({x:0,y:0,w:o,h:h},!0),s=Math.max(s,t.height),Math.max(u,t.height))}),r){var L=f.value+_.value+g.value+y.value+w.value+x.value;l+=L,u+=L,s+=L}else{var T=c.value+d.value+v.value+p.value+m.value+b.value;l+=T,u+=T,s+=T}return{b:l,min:s,max:u}}},{key:"__calAbs",value:function(i){var n=0,t=this.flowChildren,e=this.style,a=e.width,r=e.height,o=e.borderTopWidth,h=e.borderRightWidth,l=e.borderBottomWidth,s=e.borderLeftWidth,u=e.marginTop,c=e.marginRight,f=e.marginBottom,d=e.marginLeft,_=e.paddingTop,v=e.paddingRight,y=e.paddingBottom,p=e.paddingLeft,g=i?a:r;if(g.unit===K&&(n=g.value),t.forEach(function(t){if(t instanceof U||t instanceof Z){var e=t.__calAbs(i);n=Math.max(n,e)}else n=i?Math.max(t.textWidth,n):(t.__preLay({x:0,y:0,w:1/0,h:1/0},!0),Math.max(n,t.height))}),i){var m=h.value+s.value+d.value+c.value+p.value+v.value;n+=m}else{var x=o.value+l.value+u.value+f.value+_.value+y.value;n+=x}return n}},{key:"__preLayBlock",value:function(e){var i=this,n=e.x,a=e.y,r=e.w,o=e.h;this.__x=n,this.__y=a,this.__width=r;var t,h=this.flowChildren,l=this.style,s=l.width,u=l.height,c=l.borderTopWidth,f=l.borderRightWidth,d=l.borderBottomWidth,_=l.borderLeftWidth,v=l.marginTop,y=l.marginRight,p=l.marginBottom,g=l.marginLeft,m=l.paddingTop,x=l.paddingRight,b=l.paddingBottom,w=l.paddingLeft;if(s&&s.unit!==J)switch(s.unit){case K:r=s.value;break;case Q:r*=.01*s.value}if(u&&u.unit!==J)switch(t=!0,u.unit){case K:o=u.value;break;case Q:o*=.01*u.value}n+=_.value+g.value+w.value,e.x=n,a+=c.value+v.value+m.value,e.y=a,r-=_.value+f.value+g.value+y.value+w.value+x.value,o-=c.value+d.value+v.value+p.value+m.value+b.value;var k=new W(n,a);h.forEach(function(t){t instanceof U||t instanceof Z?"inline"===t.style.display?n===e.x?(k.add(t),t.__preLayInline({x:n,y:a,w:r,h:o}),n+=t.outerWidth):(0<=t.__tryLayInline(r-n,r)?t.__preLayInline({x:n,y:a,w:r,h:o}):(i.lineGroups.push(k),k.verticalAlign(),n=e.x,a+=k.height,t.__preLayInline({x:e.x,y:a,w:r,h:o}),k=new W(n,a)),n+=t.outerWidth,k.add(t)):(k.size&&(i.lineGroups.push(k),k.verticalAlign(),a+=k.height,k=new W(e.x,a)),t.__preLay({x:e.x,y:a,w:r,h:o}),n=e.x,a+=t.outerHeight):n===e.x?(k.add(t),t.__preLay({x:n,y:a,w:r,h:o}),n+=t.width):(0<=t.__tryLayInline(r-n,r)?t.__preLay({x:n,y:a,w:r,h:o}):(i.lineGroups.push(k),k.verticalAlign(),n=e.x,a+=k.height,t.__preLay({x:e.x,y:a,w:r,h:o}),k=new W(n,a)),n+=t.width,k.add(t))}),k.size&&(this.lineGroups.push(k),k.verticalAlign(),a+=k.height),this.__width=r,this.__height=t?o:a-e.y,this.__flowY=a}},{key:"__preLayFlex",value:function(t){var f=t.x,d=t.y,_=t.w,v=t.h;this.__x=f,this.__y=d,this.__width=_;var y,e=this.flowChildren,i=this.style,n=i.width,a=i.height,r=i.flexDirection,o=i.borderTopWidth,h=i.borderRightWidth,l=i.borderBottomWidth,s=i.borderLeftWidth,u=i.marginTop,c=i.marginRight,p=i.marginBottom,g=i.marginLeft,m=i.paddingTop,x=i.paddingRight,b=i.paddingBottom,w=i.paddingLeft,k=i.justifyContent;if(n&&n.unit!==J)switch(n.unit){case K:_=n.value;break;case Q:_*=.01*n.value}if(a&&a.unit!==J)switch(y=!0,a.unit){case K:v=a.value;break;case Q:v*=.01*a.value}f+=s.value+g.value+w.value,t.x=f,d+=o.value+u.value+m.value,t.y=d,_-=s.value+h.value+g.value+c.value+w.value+x.value,v-=o.value+l.value+u.value+p.value+m.value+b.value;var L="row"===r;if(!L&&!y)return e.forEach(function(t){if(t instanceof U||t instanceof Z){var e=t.style,i=t.style,n=i.display,a=i.flexDirection,r=i.width;"inline"===n?e.display="block":"flex"===n&&"row"===a&&r.unit===J&&(r.value=_,r.unit=K),t.__preLay({x:f,y:d,w:_,h:v}),d+=t.outerHeight}else t.__preLay({x:f,y:d,w:_,h:v}),d+=t.outerHeight}),this.__width=_,void(this.__height=d-t.y);var T=[],W=[],B=[],A=[],S=0,O=0,R=0,C=0;e.forEach(function(t){if(t instanceof U||t instanceof Z){var e=t.style,i=e.flexGrow,n=e.flexShrink,a=e.flexBasis;T.push(i),W.push(n),S+=i,O+=n;var r=t.__calAutoBasis(L,_,v),o=r.b,h=r.min,l=r.max;a.unit===J?(B.push(l),R+=l):a.unit===K?(o=a.value,B.push(o),R+=o):a.unit===Q&&(o=(L?_:v)*a.value,B.push(o),R+=o),C+=l,A.push(h)}else T.push(0),W.push(1),O+=1,L?(B.push(t.textWidth),R+=t.textWidth,C+=t.textWidth,A.push(t.charWidth)):(t.__preLay({x:0,y:0,w:_,h:v},!0),B.push(t.height),R+=t.height,C+=t.height,A.push(t.height))});var E=0,N=0,H=(L?_:v)<C;e.forEach(function(t,e){var i,n=W[e],a=T[e];if(H){var r=R-(L?_:v);i=n?B[e]-r*n/O:B[e]}else N=(L?_:v)-R,i=a?B[e]+N*a/S:B[e];if(i=Math.max(i,A[e]),t instanceof U||t instanceof Z){var o=t.style,h=t.style,l=h.display,s=h.flexDirection,u=h.width,c=h.height;L?("inline"===l?o.display="block":"flex"===l&&"column"===s&&y&&c.unit===J&&(c.value=v,c.unit=K),t.__preLay({x:f,y:d,w:i,h:v})):("inline"===l?o.display="block":"flex"===l&&"row"===s&&u.unit===J&&(u.value=_,u.unit=K),t.__preLay({x:f,y:d,w:_,h:i})),H&&n?L?t.__width=i:t.__height=i:!H&&a&&(L?t.__width=i:t.__height=i)}else t.__preLay({x:f,y:d,w:L?i:_,h:L?v:i});E=L?(f+=t.outerWidth,Math.max(E,t.outerHeight)):(d+=t.outerHeight,Math.max(E,t.outerWidth))});var P=L?_-f+t.x:v-d+t.y;if(!H&&0===S&&0<N&&0<P){var G=e.length;if("flex-end"===k)for(var M=0;M<G;M++){var V=e[M];L?V.__offsetX(P):V.__offsetY(P)}else if("center"===k)for(var I=.5*P,F=0;F<G;F++){var z=e[F];L?z.__offsetX(I):z.__offsetY(I)}else if("space-between"===k)for(var j=P/(G-1),Y=1;Y<G;Y++){var X=e[Y];L?X.__offsetX(j*Y):X.__offsetY(j*Y)}else if("space-around"===k)for(var $=P/(G+1),D=0;D<G;D++){var q=e[D];L?q.__offsetX($*(D+1)):q.__offsetY($*(D+1))}}L&&(y&&(E=v),d+=E),e.forEach(function(t){var e=t.style;L?t.style.height.unit===J&&(t.__height=E-e.borderTopWidth.value-e.borderBottomWidth.value):t.style.width.unit===J&&(t.__width=E-e.borderRightWidth.value-e.borderLeftWidth.value)}),this.__width=_,this.__height=y?v:d-t.y,this.__flowY=d}},{key:"__preLayInline",value:function(e){var i=this,n=e.x,a=e.y,r=e.w,o=e.h;this.__x=n,this.__y=a;var t,h,l=n,s=this.flowChildren,u=this.style,c=u.width,f=u.height,d=u.borderTopWidth,_=u.borderRightWidth,v=u.borderBottomWidth,y=u.borderLeftWidth,p=u.marginTop,g=u.marginRight,m=u.marginBottom,x=u.marginLeft,b=u.paddingTop,w=u.paddingRight,k=u.paddingBottom,L=u.paddingLeft;if(c&&c.unit!==J)switch(t=!0,c.unit){case K:r=c.value;break;case Q:r*=.01*c.value}if(f&&f.unit!==J)switch(h=!0,f.unit){case K:o=f.value;break;case Q:o*=.01*f.value}n+=y.value+x.value+L.value,e.x=n,a+=d.value+p.value+b.value,e.y=a,r-=y.value+_.value+x.value+g.value+L.value+w.value,o-=d.value+v.value+p.value+m.value+b.value+k.value;var T=new W(n,a);s.forEach(function(t){if(t instanceof U||t instanceof Z){if("absolute"===t.style.position)return void i.absChildren.push(t);if(n===e.x)T.add(t),t.__preLayInline({x:n,y:a,w:r,h:o}),n+=t.outerWidth,l=Math.max(l,n);else 0<=t.__tryLayInline(r-n,r)?t.__preLayInline({x:n,y:a,w:r,h:o}):(i.lineGroups.push(T),T.verticalAlign(),n=e.x,a+=T.height,t.__preLayInline({x:e.x,y:a,w:r,h:o}),T=new W(n,a)),n+=t.outerWidth,l=Math.max(l,n),T.add(t)}else{if(n===e.x)T.add(t),t.__preLay({x:n,y:a,w:r,h:o}),n+=t.width,l=Math.max(l,n);else 0<=t.__tryLayInline(r-n,r)?t.__preLay({x:n,y:a,w:r,h:o}):(i.lineGroups.push(T),T.verticalAlign(),n=e.x,a+=T.height,t.__preLay({x:e.x,y:a,w:r,h:o}),T=new W(n,a)),n+=t.width,l=Math.max(l,n),T.add(t)}}),T.size&&(this.lineGroups.push(T),T.verticalAlign(),a+=T.height),this.__width=t?r:l-e.x,this.__height=h?o:a-e.y,this.__flowY=a}},{key:"__preLayAbs",value:function(e){var v=this.x,y=this.y,p=this.flowY,g=this.width,m=this.height,t=this.children,i=this.absChildren,n=this.style,x=n.marginTop,b=n.marginLeft,a=n.paddingTop,r=n.paddingLeft,o=n.paddingRight,h=n.paddingBottom,w=n.borderTopWidth,k=n.borderLeftWidth,L=g+r.value+o.value,T=m+a.value+h.value;t.forEach(function(t){t instanceof U&&t.__preLayAbs(-1<["absolute","relative"].indexOf(t.style.position)?t:e)}),i.forEach(function(t){var e,i,n,a,r=t.style,o=t.style,h=o.left,l=o.top,s=o.right,u=o.bottom,c=o.width,f=o.height;if(h.unit!==J&&s.unit!==J)e=h.unit===K?v+h.value:v+b.value+k.value+g*h.value*.01,n=s.unit===K?v+b.value+k.value+L-s.value-e:v+b.value+k.value+L-g*s.value*.01-e;else if(h.unit!==J&&c.unit!==J)e=h.unit===K?v+h.value:v+b.value+k.value+g*h.value*.01,n=c.unit===K?c.value:g;else if(s.unit!==J&&c.unit!==J){n=c.unit===K?c.value:g;var d=c.unit===K?c.value:g*c.value*.01;e=s.unit===K?v+b.value+k.value+L-s.value-d:v+b.value+k.value+L-g*s.value*.01-d}else h.unit!==J?(e=h.unit===K?v+h.value:v+b.value+k.value+g*h.value*.01,n=t.__calAbs(!0)):s.unit!==J?(n=t.__calAbs(!0),e=s.unit===K?v+b.value+k.value+L-s.value-n:v+b.value+k.value+L-g*s.value*.01-n):n=c.unit!==J?(e=v+b.value+k.value,c.unit===K?c.value:g):(e=v+b.value+k.value,t.__calAbs(!0));if(l.unit!==J&&u.unit!==J)i=l.unit===K?y+l.value:y+x.value+w.value+m*l.value*.01,a=u.unit===K?y+x.value+w.value+T-u.value-i:y+x.value+w.value+T-m*u.value*.01-i,r.height={value:a,unit:K};else if(l.unit!==J&&f.unit!==J)i=l.unit===K?y+l.value:y+x.value+w.value+m*l.value*.01,a=f.unit===K?f.value:m;else if(u.unit!==J&&f.unit!==J){a=f.unit===K?f.value:m;var _=f.unit===K?f.value:m*f.value*.01;i=u.unit===K?y+x.value+w.value+T-u.value-_:y+x.value+w.value+T-m*u.value*.01-_}else l.unit!==J?(i=l.unit===K?y+l.value:y+x.value+w.value+m*l.value*.01,a=t.__calAbs()):u.unit!==J?(a=t.__calAbs(),i=u.unit===K?y+x.value+w.value+T-u.value-a:y+x.value+w.value+T-m*u.value*.01-a):a=f.unit!==J?(i=p+x.value+w.value,f.unit===K?f.value:m):(i=p+x.value+w.value,t.__calAbs());"inline"===r.display&&(r.display="block"),t.__preLay({x:e,y:i,w:n,h:a})})}},{key:"render",value:function(){M(G(U.prototype),"render",this).call(this);var t=this.flowChildren,e=this.children;t.forEach(function(t){(t instanceof k||"static"===t.style.position)&&t.render()}),e.forEach(function(t){(t instanceof U||t instanceof Z)&&-1<["relative","absolute"].indexOf(t.style.position)&&t.render()})}},{key:"tagName",get:function(){return this.__tagName}},{key:"children",get:function(){return this.__children}},{key:"flowChildren",get:function(){return this.__flowChildren}},{key:"absChildren",get:function(){return this.__absChildren}},{key:"lineGroups",get:function(){return this.__lineGroups}},{key:"baseLine",get:function(){var t=this.lineGroups.length;if(t){var e=this.lineGroups[t-1];return e.y-this.y+e.baseLine}return this.y}},{key:"flowY",get:function(){return this.__flowY}}],[{key:"isValid",value:function(t){return T.hasOwnProperty(t)}}]),U}();var S=function(){function a(t,e,i){var n;return h(this,a),(n=r(this,G(a).call(this,t,e,i))).__node=null,n}return t(a,A),e(a,[{key:"__initProps",value:function(){if(void 0!==this.props.width){var t=parseInt(this.props.width);!isNaN(t)&&0<t&&(this.__width=t)}if(void 0!==this.props.height){var e=parseInt(this.props.height);!isNaN(e)&&0<e&&(this.__height=e)}}},{key:"__genHtml",value:function(){for(var t,e,i,n="<".concat(this.tagName),a=0,r=this.__props.length;a<r;a++){var o=this.__props[a];n+=(t=o[0],e=o[1],void 0,i=Array.isArray(e)?g.joinSourceArray(e):g.stringify(e),"className"===t&&(t="class")," "+t+'="'+g.encodeHtml(i,!0)+'"')}return n+="></".concat(this.tagName,">")}},{key:"appendTo",value:function(t){if(t=function(t){if(g.isString(t)){var e=document.querySelector(t);if(!e)throw new Error("can not find dom of selector: "+t);return e}if(!t)throw new Error("can not find dom: "+t);return t}(t),this.__initProps(),t.nodeName.toUpperCase()===this.tagName.toUpperCase())this.__node=t,this.width&&t.setAttribute("width",this.width),this.height&&t.setAttribute("height",this.height);else{var e=this.__genHtml();t.insertAdjacentHTML("beforeend",e);var i=t.querySelectorAll(this.tagName);this.__node=i[i.length-1]}if(!this.width||!this.height){var n=window.getComputedStyle(t,null);this.width||(this.__width=parseInt(n.getPropertyValue("width")),t.setAttribute("width",this.width)),this.height||(this.__height=parseInt(n.getPropertyValue("height")),t.setAttribute("height",this.height))}var a=this.style;-1===["flex","block"].indexOf(a.display)&&(a.display="block"),"absolute"===a.position&&(a.position="static"),"canvas"===this.tagName?(this.__ctx=this.__node.getContext("2d"),this.__mode=V.CANVAS):"svg"===this.tagName&&(this.__mode=V.SVG),this.__traverse(this.__ctx,this.__mode),a.width=this.width,a.height=this.height,this.__initStyle(),this.__preLay({x:0,y:0,w:this.width,h:this.height}),this.__preLayAbs(this),this.render(),this.mode===V.SVG&&(this.__node.innerHTML=V.html)}},{key:"node",get:function(){return this.__node}}]),a}(),O=function(){function S(t){var e;return h(this,S),(e=r(this,G(S).call(this,"$line",t))).__start=[],e.__end=[],Array.isArray(e.props.start)&&(e.__start=e.props.start),Array.isArray(e.props.end)&&(e.__end=e.props.end),-1<["TOP_LEFT","TOP_RIGHT","BOTTOM_LEFT","BOTTOM_RIGHT"].indexOf(e.props.origin)?e.__origin=e.props.origin:e.__origin="BOTTOM_LEFT",e}return t(S,Z),e(S,[{key:"render",value:function(){M(G(S.prototype),"render",this).call(this);var t=this.x,e=this.y,i=this.width,n=this.height,a=this.style,r=this.ctx,o=this.start,h=this.end,l=this.origin;if(!(o.length<2||h.length<2)){var s,u,c,f,d=a.borderTopWidth,_=a.borderRightWidth,v=a.borderBottomWidth,y=a.borderLeftWidth,p=a.marginTop,g=a.marginRight,m=a.marginBottom,x=a.marginLeft,b=a.paddingTop,w=a.paddingRight,k=a.paddingBottom,L=a.paddingLeft,T=a.stroke,W=a.strokeWidth,B=t+y.value+x.value+L.value,A=e+d.value+p.value+b.value;i-=y.value+_.value+x.value+g.value+L.value+w.value,n-=d.value+v.value+p.value+m.value+b.value+k.value,"TOP_LEFT"===l?(s=B+o[0]*i,u=A+o[1]*n,c=B+h[0]*i,f=A+h[1]*n):"TOP_RIGHT"===l?(s=B+i-o[0]*i,u=A+o[1]*n,c=B+i-h[0]*i,f=A+h[1]*n):"BOTTOM_LEFT"===l?(s=B+o[0]*i,u=A+n-o[1]*n,c=B+h[0]*i,f=A+n-h[1]*n):"BOTTOM_RIGHT"===l&&(s=B+i-o[0]*i,u=A+n-o[1]*n,c=B+i-h[0]*i,f=A+n-h[1]*n),this.mode===V.CANVAS?(r.strokeStyle=T,r.lineWidth=W,r.beginPath(),r.moveTo(s,u),r.lineTo(c,f),r.stroke(),r.closePath()):this.mode===V.SVG&&V.appendHtml('<line x1="'.concat(s,'" y1="').concat(u,'" x2="').concat(c,'" y2="').concat(f,'" stroke-width="').concat(W,'" stroke="').concat(T,'"/>'))}}},{key:"start",get:function(){return this.__start}},{key:"end",get:function(){return this.__end}}]),S}(),R=function(){function P(t){var e;if(h(this,P),(e=r(this,G(P).call(this,"$polygon",t))).__pointList=[],Array.isArray(e.props.pointList)&&(e.__pointList=e.props.pointList),-1<["TOP_LEFT","TOP_RIGHT","BOTTOM_LEFT","BOTTOM_RIGHT"].indexOf(e.props.origin)?e.__origin=e.props.origin:e.__origin="BOTTOM_LEFT",e.props.min?e.__min=parseFloat(e.props.min)||0:e.__min=0,e.props.max){var i=parseFloat(e.props.max);isNaN(i)&&(i=1),e.__max=i}else e.__max=1;return e}return t(P,Z),e(P,[{key:"render",value:function(){M(G(P.prototype),"render",this).call(this);var t=this.x,e=this.y,i=this.width,n=this.height,a=this.style,r=this.ctx,o=this.pointList,h=this.max,l=this.min,s=this.origin;if(!(o.length<2)){for(var u=0,c=o.length;u<c;u++)if(!Array.isArray(o[u])||o[u].length<2)return;var f=a.borderTopWidth,d=a.borderRightWidth,_=a.borderBottomWidth,v=a.borderLeftWidth,y=a.marginTop,p=a.marginRight,g=a.marginBottom,m=a.marginLeft,x=a.paddingTop,b=a.paddingRight,w=a.paddingBottom,k=a.paddingLeft,L=a.stroke,T=a.strokeWidth,W=h-l;if(W<=0)throw new Error("scale can not <= 0: max(".concat(this.max,") - min(").concat(this.min,")"));var B=t+v.value+m.value+k.value,A=e+f.value+y.value+x.value;if(i-=v.value+d.value+m.value+p.value+k.value+b.value,n-=f.value+_.value+y.value+g.value+x.value+w.value,"TOP_LEFT"===s?o.forEach(function(t){t[0]=B+t[0]*i,t[1]=A+(t[1]-l)*n/W}):"TOP_RIGHT"===s?o.forEach(function(t){t[0]=B+i-t[0]*i,t[1]=A+(t[1]-l)*n/W}):"BOTTOM_LEFT"===s?o.forEach(function(t){t[0]=B+t[0]*i,t[1]=A+n-(t[1]-l)*n/W}):"BOTTOM_RIGHT"===s&&o.forEach(function(t){t[0]=B+i-t[0]*i,t[1]=A+n-(t[1]-l)*n/W}),this.mode===V.CANVAS){r.strokeStyle=L,r.lineWidth=T,r.beginPath(),r.moveTo(o[0][0],A+o[0][1]);for(var S=1,O=o.length;S<O;S++){var R=o[S];r.lineTo(R[0],A+R[1])}r.stroke(),r.closePath()}else if(this.mode===V.SVG){for(var C="",E=0,N=o.length;E<N;E++){var H=o[E];C+="".concat(H[0],",").concat(H[1]," ")}V.appendHtml('<polyline fill="none" points="'.concat(C,'" stroke-width="').concat(T,'" stroke="').concat(L,'"/>'))}}}},{key:"pointList",get:function(){return this.__pointList}}]),P}(),C={render:function(t,e){if(!(t instanceof S))throw new Error("render root muse be canvas or svg");return e&&t.appendTo(e),t},createVd:function(t,e,i){if(-1<["canvas","svg"].indexOf(t))return new S(t,e,i);if(A.isValid(t))return new A(t,e,i);throw new Error("can not use marker: "+t)},createGm:function(t,e){if(Z.isValid(t))switch(t){case"$line":return new O(e);case"$polygon":return new R(e)}throw new Error("can not use geom marker: "+t)},createCp:function(t,e,i){}};return"undefined"!=typeof window&&(window.karas=C),C});
//# sourceMappingURL=index.min.js.map
