!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).karas=e()}(this,function(){"use strict";function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function a(t,e,i){return e&&r(t.prototype,e),i&&r(t,i),t}function e(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,r)}return i}function o(n){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?e(a,!0).forEach(function(t){var e,i,r;e=n,r=a[i=t],i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):e(a).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(a,t))})}return n}function t(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&i(t,e)}function C(t){return(C=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function i(t,e){return(i=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function h(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function B(t,e,i){return(B="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=C(t)););return t}(t,e);if(r){var n=Object.getOwnPropertyDescriptor(r,e);return n.get?n.get.call(i):n.value}})(t,e,i||t)}function ui(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if(!(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)))return;var i=[],r=!0,n=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(r=(o=s.next()).done)&&(i.push(o.value),!e||i.length!==e);r=!0);}catch(t){n=!0,a=t}finally{try{r||null==s.return||s.return()}finally{if(n)throw a}}return i}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var n,l=function(){function t(){s(this,t),this.__x=0,this.__y=0,this.__ox=0,this.__oy=0,this.__width=0,this.__height=0,this.__prev=null,this.__next=null,this.__ctx=null,this.__defs=null,this.__parent=null,this.__style={},this.__baseLine=0,this.__virtualDom={}}return a(t,[{key:"__offsetX",value:function(t){this.__ox+=t}},{key:"__offsetY",value:function(t){this.__oy+=t}},{key:"x",get:function(){return this.__x}},{key:"y",get:function(){return this.__y}},{key:"ox",get:function(){return this.__ox}},{key:"oy",get:function(){return this.__oy}},{key:"rx",get:function(){return this.x+this.ox}},{key:"ry",get:function(){return this.y+this.oy}},{key:"width",get:function(){return this.__width}},{key:"height",get:function(){return this.__height}},{key:"outerWidth",get:function(){return this.__width}},{key:"outerHeight",get:function(){return this.__height}},{key:"prev",get:function(){return this.__prev}},{key:"next",get:function(){return this.__next}},{key:"parent",get:function(){return this.__parent}},{key:"root",get:function(){return this.parent?this.parent.root:this}},{key:"style",get:function(){return this.__style}},{key:"ctx",get:function(){return this.__ctx}},{key:"defs",get:function(){return this.__defs}},{key:"baseLine",get:function(){return this.__baseLine}},{key:"virtualDom",get:function(){return this.__virtualDom}}]),t}(),ci={CANVAS:0,SVG:1,measure:function(t,e){n||((n=document.createElement("div")).style.position="absolute",n.style.left="99999px",n.style.top="-99999px",n.style.visibility="hidden",document.body.appendChild(n)),n.style.fontSize=e.fontSize+"px",n.innerText=t;var i=window.getComputedStyle(n,null);return parseFloat(i.width)}},fi=0,di=1,U=2,u={}.toString;function c(e){return function(t){return u.call(t)==="[object "+e+"]"}}var f=c("Number");function d(t){return _(t)?"":t.toString()}function _(t){return null==t}function p(t){if("item"===t.type){var e="";return t.props.forEach(function(t){e+=" ".concat(t[0],'="').concat(t[1],'"')}),"text"===t.tagName?"<text".concat(e,">").concat(t.content,"</text>"):"<".concat(t.tagName).concat(e,"/>")}if("text"===t.type){var i="";return t.children.forEach(function(t){i+=p(t)}),"<g>".concat(i,"</g>")}if("dom"===t.type){var r="<g>";return t.bb.forEach(function(t){r+=p(t)}),r+="</g><g>",t.children.forEach(function(t){r+=p(t)}),"<g>".concat(r+="</g>","</g>")}if("geom"===t.type){var n="<g>";return t.bb.forEach(function(t){n+=p(t)}),n+="</g><g>",t.content.forEach(function(t){n+=p(t)}),"<g>".concat(n+="</g>","</g>")}}function v(t){var e="<".concat(t.k,' id="').concat(t.uuid,'" x1="').concat(t.c[0],'" y1="').concat(t.c[1],'" x2="').concat(t.c[2],'" y2="').concat(t.c[3],'">');return"linearGradient"===t.k&&t.v.forEach(function(t){e+='<stop stop-color="'.concat(t[0],'" offset="').concat(100*t[1],'%"/>')}),e+="</".concat(t.k,">")}var _i={isObject:c("Object"),isString:c("String"),isFunction:c("Function"),isNumber:f,isBoolean:c("Boolean"),isDate:c("Date"),stringify:d,joinSourceArray:function(t){return function t(e){for(var i="",r=0,n=e.length;r<n;r++){var a=e[r];Array.isArray(a)?i+=t(a):i+=d(a)}return i}(t)},encodeHtml:function(t,e){return e?t.replace(/"/g,"&quot;"):t.replace(/&/g,"&amp;").replace(/</g,"&lt;")},isNil:_,joinVirtualDom:function(t,e){var i="<defs>";return e.forEach(function(t){i+=v(t)}),i+="</defs><g>",t.bb.forEach(function(t){i+=p(t)}),i+="</g><g>",t.children.forEach(function(t){i+=p(t)}),i+="</g>"},joinVd:p,joinDef:v,r2d:function(t){return t*Math.PI/180},rgb2int:function(t){var e=[];if("#"===t.charAt(0))3===(t=t.slice(1)).length?(e.push(parseInt(t.charAt(0)+t.charAt(0),16)),e.push(parseInt(t.charAt(1)+t.charAt(1),16)),e.push(parseInt(t.charAt(2)+t.charAt(2),16))):6===t.length&&(e.push(parseInt(t.slice(0,2),16)),e.push(parseInt(t.slice(2,4),16)),e.push(parseInt(t.slice(4),16)));else{var i=t.match(/rgba?\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)(?:\s*,\s*([\d.]+))?\s*\)/i);i&&(e=[parseInt(i[1]),parseInt(i[2]),parseInt(i[3])],i[4]&&(e[3]=parseFloat(i[4])))}return e}};function y(t,e,i,r,n,a,o,s){var h=1,l=1,u=1;t:for(var c=a;n<=c;c--)for(var f=s;o<=f;f--){var d=c+f,_=Math.floor((t+f)/d),p=f;if(_*d<f+t)if(s<(p=(t-_*c)/(_-1)))continue;if(d=c+p,1<e&&c<e){if(c<e%d)continue;if(1<i)if(c<(e+r)%d)continue}if(1<i)if(c<(e+r)%d)continue;0<_&&(h=_,l=c,u=p);break t}return{n:h,ps:l,pd:u}}function pi(t,e,i,r,n,a){var o=n-e,s=r-i,h=i-e,l=n-r;if("dotted"===t)return y(o,h,l,s,a,a,Math.max(1,.25*a),2*a);var u=y(o,h,l,s,a,3*a,Math.max(1,.25*a),2*a),c=u.n,f=u.ps,d=u.pd;return 1===c?y(o,h,l,s,a,a,Math.max(1,.25*a),2*a):{n:c,ps:f,pd:d}}function vi(t,e,r,n,i){if(t===ci.CANVAS)e.forEach(function(t){n.beginPath(),n.fillStyle=r,n.moveTo(t[0],t[1]);for(var e=2,i=t.length;e<i;e+=2)n.lineTo(t[e],t[e+1]);n.fill(),n.closePath()});else if(t===ci.SVG){var a="";e.forEach(function(t){a+="M ".concat(t[0]," ").concat(t[1]);for(var e=2,i=t.length;e<i;e+=2)a+="L ".concat(t[e]," ").concat(t[e+1]," ")});var o={type:"item",tagName:"path",props:[["d",a],["fill",r]]};i.bb.push(o)}}var Q=function(){function r(t,e){var i;return s(this,r),i=h(this,C(r).call(this)),e=e||[],Array.isArray(e)?(i.props=function(t){for(var e={},i=0,r=t.length;i<r;i++){var n=t[i];if(Array.isArray(n))e[n[0]]=n[1];else for(var a=Object.keys(n),o=a.length-1;0<=o;o--){var s=a[o];e[s]=n[s]}}return e}(e),i.__props=function(t){for(var e=0,i=t.length;e<i;e++){var r=t[e];if(!Array.isArray(r)){for(var n=[],a=Object.keys(r),o=0,s=a.length;o<s;o++){var h=a[o];n.push([h,r[h]])}t.splice.apply(t,[e,1].concat(n))}}return t}(e)):(i.props=e,i.__props=function(t){for(var e=[],i=Object.keys(t),r=0,n=i.length;r<n;r++){var a=i[r];e.push([a,t[a]])}return e}(e)),i.__tagName=t,i.__style=i.props.style||{},i.__listener={},i.__props.forEach(function(t){var e=t[0];/^on[a-zA-Z]/.test(e)&&(i.__listener[e.slice(2).toLowerCase()]=t[1])}),i.__mtw=0,i.__mrw=0,i.__mbw=0,i.__mlw=0,i.__ptw=0,i.__prw=0,i.__pbw=0,i.__plw=0,i}return t(r,l),a(r,[{key:"__layout",value:function(t){var e=t.w,i=this.style,r=i.display,n=i.width,a=i.marginTop,o=i.marginRight,s=i.marginBottom,h=i.marginLeft,l=i.paddingTop,u=i.paddingRight,c=i.paddingBottom,f=i.paddingLeft;if("none"!==r){if(n&&n.unit!==fi)switch(n.unit){case di:e=n.value;break;case U:e*=.01*n.value}this.__mlw=this.__mpWidth(h,e),this.__mtw=this.__mpWidth(a,e),this.__mrw=this.__mpWidth(o,e),this.__mbw=this.__mpWidth(s,e),this.__plw=this.__mpWidth(f,e),this.__ptw=this.__mpWidth(l,e),this.__prw=this.__mpWidth(u,e),this.__pbw=this.__mpWidth(c,e),"block"===r?this.__layoutBlock(t):"flex"===r?this.__layoutFlex(t):"inline"===r&&this.__layoutInline(t)}}},{key:"__mpWidth",value:function(t,e){return t.unit===di?t.value:t.unit===U?t.value*e*.01:0}},{key:"render",value:function(t){this.__virtualDom={bb:[]};var e=this.ctx,i=this.style,r=this.width,n=this.height,a=this.mlw,o=this.mtw,s=this.plw,h=this.ptw,l=this.prw,u=this.pbw,c=this.virtualDom,f=i.display,d=i.position,_=i.top,p=i.right,v=i.bottom,y=i.left,g=i.backgroundGradient,w=i.backgroundColor,m=i.borderTopWidth,b=i.borderTopColor,x=i.borderTopStyle,k=i.borderRightWidth,M=i.borderRightColor,W=i.borderRightStyle,A=i.borderBottomWidth,S=i.borderBottomColor,L=i.borderBottomStyle,T=i.borderLeftWidth,N=i.borderLeftColor,E=i.borderLeftStyle,O=i.transform;if("none"!==f){if("relative"===d&&this.parent){var C=this.parent,B=C.width,P=C.height,R=this.parent.style.height;if(y.unit!==fi){var D=y.unit===di?y.value:y.value*B*.01;this.__offsetX(D)}else if(p.unit!==fi){var F=p.unit===di?p.value:p.value*B*.01;this.__offsetX(-F)}if(_.unit!==fi){var I=_.unit===di?_.value:_.value*P*.01*(R.unit===fi?0:1);this.__offsetY(I)}else if(v.unit!==fi){var j=v.unit===di?v.value:v.value*P*.01*(R.unit===fi?0:1);this.__offsetY(-j)}}if(O){var V=O.translateX,G=O.translateY;if(V){var Y=V.unit===di?V.value:V.value*r*.01;this.__offsetX(Y)}if(G){var X=G.unit===di?G.value:G.value*n*.01;this.__offsetY(X)}}var H=this.rx,z=this.ry,$=m.value,Z=k.value,q=A.value,U=T.value,Q=H+a,J=Q+U,K=J+r+s+l,tt=K+Z,et=z+o,it=et+$,rt=it+n+h+u,nt=rt+q;if(g){var at=r+s+l,ot=n+h+u,st=g.k,ht=g.v;if("linear"===st){var lt=180;if("to top"===ht[0])lt=0;else if("to top right"===ht[0])lt=45;else if("to right"===ht[0])lt=90;else if("to bottom right"===ht[0])lt=135;else if("to bottom left"===ht[0])lt=225;else if("to left"===ht[0])lt=270;else if("to top left"===ht[0])lt=315;else{var ut=/([\d.]+)deg/.exec(ht[0]);ut?lt=parseFloat(ut[1]):ht.unshift(lt)}var ct=_i.r2d(lt),ft=Math.abs(at*Math.sin(ct))+Math.abs(ot*Math.cos(ct)),dt=.5*ft;for(360<=lt&&(lt%=360);lt<0;)lt+=360;var _t=J+.5*at,pt=it+.5*ot,vt=K,yt=rt,gt=J,wt=it;if(270<lt){var mt=_i.r2d(360-lt);vt=_t+Math.sin(mt)*dt,yt=pt+Math.cos(mt)*dt,gt=_t-Math.sin(mt)*dt,wt=pt-Math.cos(mt)*dt}else if(180<lt){var bt=_i.r2d(lt-180);vt=_t+Math.sin(bt)*dt,yt=pt-Math.cos(bt)*dt,gt=_t-Math.sin(bt)*dt,wt=pt+Math.cos(bt)*dt}else if(90<lt){var xt=_i.r2d(180-lt);vt=_t-Math.sin(xt)*dt,yt=pt-Math.cos(xt)*dt,gt=_t+Math.sin(xt)*dt,wt=pt+Math.cos(xt)*dt}else if(0<lt){var kt=_i.r2d(lt);vt=_t-Math.sin(kt)*dt,yt=pt+Math.cos(kt)*dt,gt=_t+Math.sin(kt)*dt,wt=pt-Math.cos(kt)*dt}for(var Mt=[],Wt=1,At=ht.length;Wt<At;Wt++){var St=ht[Wt].trim().split(/\s+/);if(1<St.length){var Lt=St[0],Tt=St[1];/%$/.test(Tt)?Mt.push([Lt,.01*parseFloat(Tt)]):Mt.push([Lt,parseFloat(Tt)/ft])}else Mt.push(St[0])}for(var Nt=0,Et=0,Ot=Mt.length;Et<Ot;Et++){var Ct=Mt[Et];if(Array.isArray(Ct))Nt=Ct[1];else{for(var Bt=Et+1,Pt=Nt;Bt<Ot;Bt++){var Rt=Mt[Bt];if(Array.isArray(Rt)){Pt=Rt[1];break}}Bt===Ot&&(Bt=Ot-1,Pt=1);for(var Dt=(Pt-Nt)/(Bt+1-Et),Ft=Et;Ft<Bt;Ft++){var It=Mt[Ft];Mt[Ft]=[It,Nt+Dt*(Ft+1-Et)]}0===Et&&(Mt[0][1]=0),Et=st}}if(t===ci.CANVAS){for(var jt=1,Vt=Mt.length;jt<Vt;jt++){var Gt=Mt[jt],Yt=Mt[jt-1];Gt[1]<Yt[1]&&(Gt[1]=Yt[1])}for(var Xt=0,Ht=Mt.length;Xt<Ht-1;Xt++){if(1<Mt[Xt][1]){Mt.splice(Xt+1);break}}for(var zt=Mt.length-1;0<zt;zt--){if(Mt[zt][1]<0){Mt.splice(0,zt);break}}var $t=Mt.length;if(1===$t)Mt[0][1]=0;else{for(var Zt=!0,qt=!0,Ut=$t-1;0<=Ut;Ut--){var Qt=Mt[Ut][1];0<Qt&&(Zt=!1),Qt<1&&(qt=!1)}if(Zt)Mt.splice(0,$t-1),Mt[0][1]=0;else if(qt)Mt.splice(1),Mt[0][1]=0;else{var Jt=Mt[0],Kt=Mt[$t-1];if(2===$t)!function(t,e,i){var r=_i.rgb2int(t[0]),n=_i.rgb2int(e[0]),a=ui(r,4),o=a[0],s=a[1],h=a[2],l=a[3],u=void 0===l?1:l,c=ui(n,4),f=c[0],d=c[1],_=c[2],p=c[3],v=void 0===p?1:p,y=Math.abs(t[1])*i,g=e[1]*i,w=y/(y+g),m=Math.floor(o+(f-o)*w),b=Math.floor(s+(d-s)*w),x=Math.floor(h+(_-h)*w),k=u+(v-u)*w;t[0]="rgba(".concat(m,",").concat(b,",").concat(x,",").concat(k,")"),t[1]=0,w=(i+y)/(y+g),m=Math.floor(o+(f-o)*w),b=Math.floor(s+(d-s)*w),x=Math.floor(h+(_-h)*w),k=u+(v-u)*w,e[0]="rgba(".concat(m,",").concat(b,",").concat(x,",").concat(k,")"),e[1]=1}(Jt,Kt,ft);else{if(Jt[1]<0){var te=Mt[1],ee=_i.rgb2int(Jt[0]),ie=_i.rgb2int(te[0]),re=function(t,e,i,r,n){var a=ui(t,4),o=a[0],s=a[1],h=a[2],l=a[3],u=void 0===l?1:l,c=ui(i,4),f=c[0],d=c[1],_=c[2],p=c[3],v=void 0===p?1:p,y=Math.abs(e)*n,g=y/(r*n+y);return[Math.floor(o+(f-o)*g),Math.floor(s+(d-s)*g),Math.floor(h+(_-h)*g),u+(v-u)*g]}(ee,Jt[1],ie,te[1],ft);Jt[0]="rgba(".concat(re[0],",").concat(re[1],",").concat(re[2],",").concat(re[3],")"),Jt[1]=0}if(1<Kt[1]){var ne=Mt[$t-2],ae=_i.rgb2int(ne[0]),oe=_i.rgb2int(Kt[0]),se=function(t,e,i,r,n){var a=ui(t,4),o=a[0],s=a[1],h=a[2],l=a[3],u=void 0===l?1:l,c=ui(i,4),f=c[0],d=c[1],_=c[2],p=c[3],v=void 0===p?1:p,y=e*n,g=(n-y)/(r*n-y);return[Math.floor(o+(f-o)*g),Math.floor(s+(d-s)*g),Math.floor(h+(_-h)*g),u+(v-u)*g]}(ae,ne[1],oe,Kt[1],ft);Kt[0]="rgba(".concat(se[0],",").concat(se[1],",").concat(se[2],",").concat(se[3],")"),Kt[1]=1}}}}var he=e.createLinearGradient(vt,yt,gt,wt);Mt.forEach(function(t){he.addColorStop(t[1],t[0])}),e.beginPath(),e.fillStyle=he,e.rect(J,it,at,ot),e.fill(),e.closePath()}else{this.root;var le=this.defs.add({k:"linearGradient",c:[(vt-J)/at,(yt-it)/ot,(gt-J)/at,(wt-it)/ot],v:Mt});c.bb.push({type:"item",tagName:"rect",props:[["x",J],["y",it],["width",at],["height",ot],["fill","url(#".concat(le,")")]]})}}}else if(w&&"transparent"!==w){var ue=r+s+l,ce=n+h+u;t===ci.CANVAS?(e.beginPath(),e.fillStyle=w,e.rect(J,it,ue,ce),e.fill(),e.closePath()):t===ci.SVG&&c.bb.push({type:"item",tagName:"rect",props:[["x",J],["y",it],["width",ue],["height",ce],["fill",w]]})}if(0<$&&"transparent"!==b){var fe=[];if(-1<["dashed","dotted"].indexOf(x)){var de=pi(x,Q,J,K,tt,$),_e=de.n,pe=de.ps,ve=de.pd;if(_e<=1)fe.push([Q,et,tt,et,K,it,J,it]);else for(var ye=Math.atan($/U),ge=Math.atan($/Z),we=0;we<_e;we++){var me=we===_e-1,be=we?Q+pe*we+ve*we:Q,xe=be+pe,ke=void 0,Me=void 0;xe<J?me?fe.push([Q,et,tt,et,K,it,J,it]):(ke=et+(be-Q)*Math.tan(ye),Me=et+(xe-Q)*Math.tan(ye),fe.push([be,et,xe,et,xe,Me,be,ke])):K<be?(ke=et+(tt-be)*Math.tan(ge),Me=et+(tt-xe)*Math.tan(ge),me?fe.push([be,et,tt,et,be,ke]):fe.push([be,et,xe,et,xe,Me,be,ke])):be<J?(ke=et+(be-Q)*Math.tan(ye),me?fe.push([be,et,tt,et,K,it,J,it,be,ke]):K<xe?fe.push([be,et,xe,et,K,it,J,it,be,ke]):fe.push([be,et,xe,et,xe,it,J,it,be,ke])):K<xe?(ke=et+(tt-xe)*Math.tan(ge),be<J?me?fe.push([be,et,tt,et,K,it,J,it,be,ke]):fe.push([be,et,xe,et,xe,ke,K,it,J,it,be,ke]):me?fe.push([be,et,tt,et,K,it,be,it]):fe.push([be,et,xe,et,xe,ke,K,it,be,it])):me?fe.push([be,et,tt,et,K,it,be,it]):fe.push([be,et,xe,et,xe,it,be,it])}}else fe.push([Q,et,tt,et,K,it,J,it]);vi(t,fe,b,e,c)}if(0<Z&&"transparent"!==M){var We=[];if(-1<["dashed","dotted"].indexOf(W)){var Ae=pi(W,et,it,rt,nt,Z),Se=Ae.n,Le=Ae.ps,Te=Ae.pd;if(Se<=1)We.push([K,it,tt,et,tt,nt,K,rt]);else for(var Ne=Math.atan(Z/$),Ee=Math.atan(Z/q),Oe=0;Oe<Se;Oe++){var Ce=Oe===Se-1,Be=Oe?et+Le*Oe+Te*Oe:et,Pe=Be+Le,Re=void 0,De=void 0;Pe<it?Ce?We.push([K,it,tt,et,tt,nt,K,rt]):(Re=tt-(Pe-et)*Math.tan(Ne),De=tt-(Be-et)*Math.tan(Ne),We.push([Re,Pe,De,Be,tt,Be,tt,Pe])):rt<Be?(Re=K+(Be-rt)*Math.tan(Ee),De=K+(Pe-rt)*Math.tan(Ee),Ce?We.push([Re,Be,tt,Be,tt,nt]):We.push([Re,Be,tt,Be,tt,Pe,De,Pe])):Be<it?(Re=K+(it-Be)*Math.tan(Ne),Ce?We.push([K,it,Re,Be,tt,Be,tt,nt,K,nt]):rt<Pe?We.push([K,it,Re,Be,tt,Be,tt,Pe,Re,Pe,K,rt]):We.push([K,it,Re,Be,tt,Be,tt,Pe,K,Pe])):rt<Pe?(Re=K+(Pe-rt)*Math.tan(Ee),Be<it?Ce?We.push([K,it,Re,Be,tt,Be,tt,nt,K,rt]):We.push([K,it,Re,Be,tt,Be,tt,Pe,Re,Pe,K,rt]):Ce?We.push([K,Be,tt,Be,tt,nt,K,rt]):We.push([K,Be,tt,Be,tt,Pe,Re,Pe,K,rt])):Ce?We.push([K,Be,tt,Be,tt,nt,K,rt]):We.push([K,Be,tt,Be,tt,Pe,K,Pe])}}else We.push([K,it,tt,et,tt,nt,K,rt]);vi(t,We,M,e,c)}if(0<q&&"transparent"!==S){var Fe=[];if(-1<["dashed","dotted"].indexOf(L))for(var Ie=pi(L,Q,J,K,tt,q),je=Ie.n,Ve=Ie.ps,Ge=Ie.pd,Ye=Math.atan(q/U),Xe=Math.atan(q/Z),He=0;He<je;He++){var ze=He===je-1,$e=He?Q+Ve*He+Ge*He:Q,Ze=$e+Ve,qe=void 0,Ue=void 0;Ze<J?ze?Fe.push([Q,nt,J,rt,K,rt,tt,nt]):(qe=nt-($e-Q)*Math.tan(Ye),Ue=nt-(Ze-Q)*Math.tan(Ye),Fe.push([$e,qe,Ze,Ue,Ze,nt,$e,nt])):K<$e?(qe=nt-($e-Q)*Math.tan(Xe),Ue=nt-(Ze-Q)*Math.tan(Xe),ze?Fe.push([$e,qe,tt,nt,$e,nt]):Fe.push([$e,qe,Ze,Ue,Ze,nt,$e,nt])):$e<J?(qe=rt+($e-Q)*Math.tan(Ye),ze?Fe.push([$e,qe,J,rt,K,rt,tt,nt,$e,nt]):K<Ze?Fe.push([$e,qe,J,rt,K,rt,Ze,nt,$e,nt]):Fe.push([$e,qe,J,rt,Ze,rt,Ze,nt,$e,nt])):K<Ze?(qe=nt-(tt-Ze)*Math.tan(Xe),$e<J?ze?Fe.push([$e,qe,K,rt,tt,nt,$e,nt]):Fe.push([$e,qe,K,rt,Ze,qe,Ze,nt,$e,nt]):ze?Fe.push([$e,rt,K,rt,tt,nt,$e,nt]):Fe.push([$e,rt,K,rt,Ze,qe,Ze,nt,$e,nt])):ze?Fe.push([$e,rt,K,rt,tt,nt,$e,nt]):Fe.push([$e,rt,Ze,rt,Ze,nt,$e,nt])}else Fe.push([Q,nt,J,rt,K,rt,tt,nt]);vi(t,Fe,S,e,c)}if(0<U&&"transparent"!==N){var Qe=[];if(-1<["dashed","dotted"].indexOf(E)){var Je=pi(E,et,it,rt,nt,U),Ke=Je.n,ti=Je.ps,ei=Je.pd;if(Ke<=1)Qe.push([Q,et,J,it,J,rt,Q,nt]);else for(var ii=Math.atan(U/$),ri=Math.atan(U/q),ni=0;ni<Ke;ni++){var ai=ni===Ke-1,oi=ni?et+ti*ni+ei*ni:et,si=oi+ti,hi=void 0,li=void 0;si<it?ai?Qe.push([Q,et,J,it,J,rt,Q,nt]):(hi=Q+(oi-et)*Math.tan(ii),li=Q+(si-et)*Math.tan(ii),Qe.push([Q,oi,hi,oi,li,si,Q,si])):rt<oi?(hi=Q+(nt-oi)*Math.tan(ri),li=Q+(nt-si)*Math.tan(ri),ai?Qe.push([Q,oi,hi,oi,Q,nt]):Qe.push([Q,oi,hi,oi,li,si,Q,si])):oi<it?(hi=Q+(oi-et)*Math.tan(ii),ai?Qe.push([Q,oi,hi,oi,J,it,J,rt,Q,nt]):rt<si?Qe.push([Q,oi,hi,oi,J,it,J,rt,hi,si,Q,si]):Qe.push([Q,oi,hi,oi,J,it,J,si,Q,si])):rt<si?(hi=Q+(nt-si)*Math.tan(ri),oi<it?ai?Qe.push([Q,oi,hi,oi,J,it,J,rt,Q,nt]):Qe.push([Q,oi,hi,oi,J,it,J,rt,hi,si,Q,si]):ai?Qe.push([Q,oi,J,oi,J,rt,Q,nt]):Qe.push([Q,oi,J,oi,J,rt,hi,si,Q,si])):ai?Qe.push([Q,oi,J,oi,J,rt,Q,nt]):Qe.push([Q,oi,J,oi,J,si,Q,si])}}else Qe.push([Q,et,J,it,J,rt,Q,nt]);vi(t,Qe,N,e,c)}}}},{key:"tagName",get:function(){return this.__tagName}},{key:"mtw",get:function(){return this.__mtw}},{key:"mrw",get:function(){return this.__mrw}},{key:"mbw",get:function(){return this.__mbw}},{key:"mlw",get:function(){return this.__mlw}},{key:"ptw",get:function(){return this.__ptw}},{key:"prw",get:function(){return this.__prw}},{key:"pbw",get:function(){return this.__pbw}},{key:"plw",get:function(){return this.__plw}},{key:"outerWidth",get:function(){var t=this.mlw,e=this.mrw,i=this.plw,r=this.prw,n=this.style,a=n.borderLeftWidth,o=n.borderRightWidth;return this.width+a.value+o.value+t+e+i+r}},{key:"outerHeight",get:function(){var t=this.mtw,e=this.mbw,i=this.ptw,r=this.pbw,n=this.style,a=n.borderTopWidth,o=n.borderBottomWidth;return this.height+a.value+o.value+t+e+i+r}},{key:"listener",get:function(){return this.__listener}}]),r}(),g={lhr:1.14990234375,car:1.1171875,blr:.9052734375,mdr:.64599609375,lgr:.03271484375},w={position:"static",display:"block",borderSizing:"content-box",top:"auto",right:"auto",bottom:"auto",left:"auto",marginTop:0,marginRight:0,marginBottom:0,marginLeft:0,paddingTop:0,paddingRight:0,paddingBottom:0,paddingLeft:0,fontSize:16,fontFamily:"arial",color:"#000",fontStyle:"normal",fontWeight:400,lineHeight:"normal",borderTopWidth:0,borderRightWidth:0,borderBottomWidth:0,borderLeftWidth:0,borderTopColor:"#000",borderRightColor:"#000",borderBottomColor:"#000",borderLeftColor:"#000",borderTopStyle:"solid",borderRightStyle:"solid",borderBottomStyle:"solid",borderLeftStyle:"solid",borderTopLeftRadius:0,borderTopRightRadius:0,borderBottomLeftRadius:0,borderBottomRightRadius:0,verticalAlign:"baseline",width:"auto",height:"auto",flexGrow:0,flexShrink:1,flexBasis:"auto",flexDirection:"row",justifyContent:"flex-start",alignItems:"stretch",textAlign:"left",visibility:"visible",fill:"#000",stroke:"#000",strokeWidth:0,strokeDasharray:[]},m=[];function b(t,e){var i="border".concat(e);if(t[i]){var r=/\b\d+px\b/i.exec(t[i]);r&&(t[i+"Width"]=r[0]);var n=/\b(solid|dashed|dotted)\b/i.exec(t[i]);n&&(t[i+"Style"]=n[1]);var a=/#[0-9a-f]{3,6}/i.exec(t[i]);a&&-1<[4,7].indexOf(a[0].length)?t[i+"Color"]=a[0]:/\btransparent\b/i.test(t[i])?t[i+"Color"]="transparent":(a=/rgba?\(.+\)/i.exec(t[i]))&&(t[i+"Color"]=a[0])}}Object.keys(w).forEach(function(t){var e=w[t];m.push({k:t,v:e})});var x={normalize:function(i){if(m.forEach(function(t){i.hasOwnProperty(t.k)||(i[t.k]=t.v)}),i.background){var t=/\b(\w+)-gradient\((.+)\)/.exec(i.background);if(t)i.backgroundGradient={k:t[1],v:t[2].split(/\s*,\s*/)};else{var e=/#[0-9a-f]{3,6}/i.exec(i.background);e&&-1<[4,7].indexOf(e[0].length)?i.backgroundColor=e[0]:(e=/rgba?\(.+\)/i.exec(i.background))&&(i.backgroundColor=e[0])}}if(i.flex&&("none"===i.flex?(i.flexGrow=0,i.flexShrink=0,i.flexBasis="auto"):"auto"===i.flex?(i.flexGrow=1,i.flexShrink=1,i.flexBasis="auto"):/^[\d.]+$/.test(i.flex)?(i.flexGrow=parseFloat(i.flex),i.flexShrink=1,i.flexBasis=0):/^[\d.]+px$/.test(i.flex)||/^[\d.]+%$/.test(i.flex)||(i.flexGrow=0,i.flexShrink=1,i.flexBasis="auto")),i.border&&(i.borderTop=i.borderRight=i.borderBottom=i.borderLeft=i.border),i.margin){var r=i.margin.toString().match(/([\d.]+(px|%)?)|(auto)/gi);r&&(1===r.length?r[3]=r[2]=r[1]=r[0]:2===r.length?(r[2]=r[0],r[3]=r[1]):3===r.length&&(r[3]=r[1]),i.marginTop=r[0],i.marginRight=r[1],i.marginBottom=r[2],i.marginLeft=r[3])}if(i.padding){var n=i.padding.toString().match(/([\d.]+(px|%)?)|(auto)/gi);n&&(1===n.length?n[3]=n[2]=n[1]=n[0]:2===n.length?(n[2]=n[0],n[3]=n[1]):3===n.length&&(n[3]=n[1]),i.paddingTop=n[0],i.paddingRight=n[1],i.paddingBottom=n[2],i.paddingLeft=n[3])}if(i.borderRadius&&(i.borderTopRightRadius=i.borderTopLeftRadius=i.borderBottomRightRadius=i.borderBottomLeftRadius=i.borderRadius),i.transform){var a=i.transform.toString().match(/\w+\(.+?\)/g);if(a){var d=i.transform={};a.forEach(function(t){var e=t.indexOf("("),i=t.slice(0,e),r=t.slice(e+1,t.length-1);if("matrix"===i){var n=r.split(/\s*,\s*/);if(6<(n=n.map(function(t){return parseFloat(t)})).length)n=n.slice(0,6);else if(n.length<6)for(;n.length<6;)n.push(0);d.matrix=n}else if("matrix3d"===i){var a=r.split(/\s*,\s*/);if(9<(a=a.map(function(t){return parseFloat(t)})).length)a=a.slice(0,9);else if(a.length<9)for(;a.length<9;)a.push(0);d.matrix3d=a}else if("translateX"===i)d.translateX=r;else if("translateY"===i)d.translateY=r;else if("translateZ"===i)d.translateZ=r;else if("translate"===i){var o=r.split(/\s*,\s*/);d.translateX=o[0],d.translateY=o[1]}else if("translate3d"===i){var s=r.split(/\s*,\s*/);d.translateX=s[0],d.translateY=s[1],d.translateZ=s[2]}else if("scaleX"===i)d.scaleX=parseFloat(r)||0;else if("scaleY"===i)d.scaleY=parseFloat(r)||0;else if("scaleZ"===i)d.scaleZ=parseFloat(r)||0;else if("scale"===i){var h=r.split(/\s*,\s*/);d.scaleX=parseFloat(h[0])||0,d.scaleY=parseFloat(h[1])||0}else if("scale3d"===i){var l=r.split(/\s*,\s*/);d.scaleX=parseFloat(l[0])||0,d.scaleY=parseFloat(l[1])||0,d.scaleZ=parseFloat(l[2])||0}else if("rotateX"===i)d.rotateX=parseFloat(r)||0;else if("rotateY"===i)d.rotateY=parseFloat(r)||0;else if("rotateZ"===i)d.rotateZ=parseFloat(r)||0;else if("rotate"===i){var u=r.split(/\s*,\s*/);d.rotateX=parseFloat(u[0])||0,d.rotateY=parseFloat(u[1])||0}else if("rotate3d"===i){var c=r.split(/\s*,\s*/);d.rotateX=parseFloat(c[0])||0,d.rotateY=parseFloat(c[1])||0,d.rotateZ=parseFloat(c[2])||0}else if("skewX"===i)d.skewX=parseFloat(r)||0;else if("skewY"===i)d.skewY=parseFloat(r)||0;else if("skew"===i){var f=r.split(/\s*,\s*/);d.skewX=parseFloat(f[0])||0,d.skewY=parseFloat(f[1])||0}else"perspective"===i&&(d.perspective=parseFloat(r))}),["translateX","translateY","translateZ"].forEach(function(t){var e=d[t];!_i.isNil(e)&&e.unit||(/%$/.test(e)?(e=parseFloat(e)||0,d[t]={value:e,unit:U}):(e=parseFloat(e)||0,d[t]={value:e,unit:di}))})}}b(i,"Top"),b(i,"Right"),b(i,"Bottom"),b(i,"Left"),["marginTop","marginRight","marginBottom","marginLeft","paddingTop","paddingRight","paddingBottom","paddingLeft","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius","top","right","bottom","left","width","height","flexBasis"].forEach(function(t){var e=i[t];!_i.isNil(e)&&e.unit||("auto"===e?i[t]={unit:fi}:/%$/.test(e)?0===t.indexOf("border")?i[t]={value:0,unit:di}:(e=parseFloat(e)||0,i[t]={value:e,unit:U}):(e=parseFloat(e)||0,i[t]={value:e,unit:di}))});var o=i.lineHeight;o="normal"===o?{value:i.fontSize*g.lhr,unit:di}:/px$/.test(o)?(o=parseFloat(o),{value:Math.max(i.fontSize,o),unit:di}):"normal"===(o=parseFloat(o)||"normal")?{value:i.fontSize*g.lhr,unit:di}:{value:o*i.fontSize,unit:di},i.lineHeight=o},setFontStyle:function(t){var e=t.fontStyle,i=t.fontWeight,r=t.fontSize,n=t.fontFamily;return"".concat(e," ").concat(i," ").concat(r,"px/").concat(r,"px ").concat(n)},getBaseLine:function(t){var e=t.fontSize*g.lhr;return.5*(t.lineHeight.value-e)+t.fontSize*g.blr}},k=function(){function o(t,e,i,r,n,a){s(this,o),this.__parent=t,this.__x=e,this.__y=i,this.__width=r,this.__content=n,this.__style=a,this.__virtualDom={}}return a(o,[{key:"render",value:function(t,e){var i=this.style,r=this.content,n=this.x,a=this.y,o=this.parent,s=o.ox,h=o.oy;a+=x.getBaseLine(i),n+=s,a+=h,t===ci.CANVAS?e.fillText(r,n,a):t===ci.SVG&&(this.__virtualDom={type:"item",tagName:"text",props:[["x",n],["y",a],["fill",i.color],["font-size","".concat(i.fontSize,"px")]],content:r})}},{key:"__offsetX",value:function(t){this.__x+=t}},{key:"__offsetY",value:function(t){this.__y+=t}},{key:"x",get:function(){return this.__x}},{key:"y",get:function(){return this.__y}},{key:"width",get:function(){return this.__width}},{key:"content",get:function(){return this.__content}},{key:"style",get:function(){return this.__style}},{key:"baseLine",get:function(){return x.getBaseLine(this.style)}},{key:"virtualDom",get:function(){return this.__virtualDom}},{key:"parent",get:function(){return this.__parent}}]),o}(),M={},W=function(){function i(t){var e;return s(this,i),(e=h(this,C(i).call(this))).__content=t.toString(),e.__lineBoxes=[],e.__charWidthList=[],e.__charWidth=0,e.__textWidth=0,e}return t(i,l),a(i,[{key:"__measure",value:function(){this.__charWidthList=[];var t=this.ctx,e=this.content,i=this.style,r=this.charWidthList,n=this.renderMode;n===ci.CANVAS&&(t.font=x.setFontStyle(i));for(var a=M[i.fontSize]=M[i.fontSize]||{},o=e.length,s=0,h=0;h<o;h++){var l=e.charAt(h),u=void 0;a.hasOwnProperty(l)?u=a[l]:n===ci.CANVAS?u=a[l]=t.measureText(l).width:n===ci.SVG&&(u=a[l]=ci.measure(l,i)),r.push(u),s+=u,this.__charWidth=Math.max(this.charWidth,u)}this.__textWidth=s}},{key:"__layout",value:function(t,e){var i=this,r=t.x,n=t.y,a=t.w;t.h;this.__x=r,this.__y=n;for(var o=r,s=(this.ctx,this.content),h=this.style,l=this.lineBoxes,u=this.charWidthList,c=(this.renderMode,0),f=0,d=0,_=s.length;f<_;)if((d+=u[f])===a){var p=new k(this,r,n,d,s.slice(c,f+1),h);l.push(p),o=Math.max(o,r+d),n+=this.style.lineHeight.value,f=(c=f+1)+1,d=0}else if(a<d){f===c&&(f=c+1);var v=new k(this,r,n,d-u[f],s.slice(c,f),h);l.push(v),o=Math.max(o,r+d-u[f]),n+=this.style.lineHeight.value,c=f,f+=1,d=0}else f++;if(c<_&&c<f){for(d=0,f=c;f<_;f++)d+=u[f];var y=new k(this,r,n,d,s.slice(c,_),h);l.push(y),o=Math.max(o,r+d),n+=h.lineHeight.value}if(this.__width=o-r,this.__height=n-t.y,e)this.__lineBoxes=[];else{var g=h.textAlign;-1<["center","right"].indexOf(g)&&l.forEach(function(t){var e=i.__width-t.width;0<e&&t.__offsetX("center"===g?.5*e:e)})}}},{key:"render",value:function(e){var i=this.ctx,t=this.style;e===ci.CANVAS&&(i.font=x.setFontStyle(t),i.fillStyle=t.color),this.lineBoxes.forEach(function(t){t.render(e,i)}),e===ci.SVG&&(this.__virtualDom={type:"text",children:this.lineBoxes.map(function(t){return t.virtualDom})})}},{key:"__tryLayInline",value:function(t){return t-this.textWidth}},{key:"__calMaxAndMinWidth",value:function(){var e=0;return this.charWidthList.forEach(function(t){e=Math.max(e,t)}),{max:this.textWidth,min:e}}},{key:"content",get:function(){return this.__content},set:function(t){this.__content=t}},{key:"lineBoxes",get:function(){return this.__lineBoxes}},{key:"charWidthList",get:function(){return this.__charWidthList}},{key:"charWidth",get:function(){return this.__charWidth}},{key:"textWidth",get:function(){return this.__textWidth}},{key:"baseLine",get:function(){var t=this.lineBoxes[this.lineBoxes.length-1];return t.y-this.y+t.baseLine}},{key:"renderMode",get:function(){return this.__renderMode}}]),i}(),E=function(){function i(t,e){s(this,i),this.__list=[],this.__x=t,this.__y=e,this.__baseLine=0}return a(i,[{key:"add",value:function(t){this.list.push(t)}},{key:"__calBaseLine",value:function(){var e=0;return this.list.forEach(function(t){e=Math.max(e,t.baseLine)}),e}},{key:"verticalAlign",value:function(){var e=this;this.__baseLine=this.__calBaseLine(),1<this.list.length&&this.list.forEach(function(t){t.baseLine!==e.baseLine&&t.__offsetY(e.baseLine-t.baseLine)})}},{key:"horizonAlign",value:function(e){this.list.forEach(function(t){t.__offsetX(e)})}},{key:"list",get:function(){return this.__list}},{key:"x",get:function(){return this.__x}},{key:"y",get:function(){return this.__y}},{key:"width",get:function(){var e=0;return this.list.forEach(function(t){e+=t.width}),e}},{key:"height",get:function(){var e=0;return this.list.forEach(function(t){e=Math.max(e,t.height)}),e}},{key:"baseLine",get:function(){return this.__baseLine}},{key:"size",get:function(){return this.__list.length}}]),i}(),A={},S=function(){function i(t,e){return s(this,i),h(this,C(i).call(this,t,e))}return t(i,Q),a(i,[{key:"__initStyle",value:function(){x.normalize(this.style)}},{key:"__tryLayInline",value:function(t,e){var i=this.style.width;return i.unit===di?t-i.value:i.unit===U?t-e*i.value*.01:t}},{key:"__calAutoBasis",value:function(t,e,i){var r=0,n=0,a=0,o=this.style,s=o.width,h=o.height,l=o.borderTopWidth,u=o.borderRightWidth,c=o.borderBottomWidth,f=o.borderLeftWidth,d=t?s:h;if(d.unit!==fi&&(r=a+=d.value),t){var _=u.value+f.value;r+=_,a+=_,n+=_}else{var p=l.value+c.value;r+=p,a+=p,n+=p}return{b:r,min:n,max:a}}},{key:"__layoutBlock",value:function(t){var e=t.x,i=t.y,r=t.w,n=t.h;this.__x=e,this.__y=i,this.__width=r;var a,o=this.style,s=o.width,h=o.height,l=o.borderTopWidth,u=o.borderRightWidth,c=o.borderBottomWidth,f=o.borderLeftWidth;if(s&&s.unit!==fi)switch(s.unit){case di:r=s.value}if(h&&h.unit!==fi)switch(a=!0,h.unit){case di:n=h.value;break;case U:n*=.01*h.value}e+=f.value,t.x=e,i+=l.value,t.y=i,r-=f.value+u.value,n-=l.value+c.value,this.__width=r,this.__height=a?n:0}},{key:"__layoutFlex",value:function(t){this.__layoutBlock(t)}},{key:"__layoutInline",value:function(t){var e=t.x,i=t.y,r=t.w,n=t.h;this.__x=e,this.__y=i;var a,o,s=this.style,h=s.width,l=s.height,u=s.borderTopWidth,c=s.borderRightWidth,f=s.borderBottomWidth,d=s.borderLeftWidth;if(h&&h.unit!==fi)switch(a=!0,h.unit){case di:r=h.value}if(l&&l.unit!==fi)switch(o=!0,l.unit){case di:n=l.value}e+=d.value,t.x=e,i+=u.value,t.y=i,r-=d.value+c.value,n-=u.value+f.value,this.__width=a?r:e-t.x,this.__height=o?n:i-t.y}},{key:"__calAbs",value:function(){return 0}},{key:"__emitEvent",value:function(t,e){var i,r=t.event.type,n=t.x,a=t.y,o=t.covers,s=this.listener,h=this.style,l=this.rx,u=this.ry,c=this.outerWidth,f=this.outerHeight;if("none"!==h.display)if(s.hasOwnProperty(r)&&(i=s[r]),e)i&&i(t);else if(l<=n&&u<=a&&n<=l+c&&a<=u+f){for(var d=0,_=o.length;d<_;d++){var p=o[d],v=p.x,y=p.y,g=p.w,w=p.h;if(v<=n&&y<=a&&n<=v+g&&a<=y+w)return}t.target||(t.target=this),o.push({x:n,y:a,w:c,h:f}),i&&i(t)}}},{key:"render",value:function(t){B(C(i.prototype),"render",this).call(this,t),t===ci.SVG&&(this.__virtualDom=o({},B(C(i.prototype),"virtualDom",this),{type:"geom",content:[]}))}},{key:"tagName",get:function(){return this.__tagName}},{key:"baseLine",get:function(){return this.__height}}],[{key:"getImplement",value:function(t){if(!A.hasOwnProperty(t))throw new Error("Geom has not register: ".concat(t));return A[t]}},{key:"register",value:function(t,e){if(A.hasOwnProperty(t))throw new Error("Geom has already register: ".concat(t));A[t]=e}}]),i}(),L={div:!0,span:!0},T={span:!0},N=function(){function u(t,e,i){var r;return s(this,u),(r=h(this,C(u).call(this,t,e))).__children=i,r.__flowChildren=[],r.__absChildren=[],r.__lineGroups=[],r.__flowY=0,r}return t(u,Q),a(u,[{key:"__traverse",value:function(e,i,t){var r=this,n=[];this.__traverseChildren(this.children,n,e,i,t);for(var a=n.length-1;0<a;a--){var o=n[a];if(o instanceof W){var s=n[a-1];s instanceof W?(s.content+=o.content,n.splice(a,1)):a--}}if("inline"===this.style.display&&"flex"!==this.parent.style.display)for(var h=n.length-1;0<=h;h--){var l=n[h];if(l instanceof u&&"inline"!==l.style.display)throw new Error("inline can not contain block/flex")}n.forEach(function(t){t.__ctx=e,t.__defs=i,t.__parent=r,t.__prev=null,t instanceof W||"absolute"!==t.style.position?r.__flowChildren.push(t):r.__absChildren.push(t)}),this.__children=n}},{key:"__traverseChildren",value:function(t,e,i,r,n){var a=this;if(Array.isArray(t))t.forEach(function(t){a.__traverseChildren(t,e,i,r,n)});else if(t instanceof u)e.push(t),t.__traverse(i,r,n);else if(t instanceof S)e.push(t);else if(!_i.isNil(t)){var o=new W(t);o.__renderMode=n,e.push(o)}}},{key:"__initStyle",value:function(){var e=this.__style;e.display&&-1!==["flex","block","inline","none"].indexOf(e.display)||(T.hasOwnProperty(this.tagName)?e.display="inline":e.display="block");var t=this.parent;if(t){var i=t.style;["fontSize","fontWeight","fontStyle","lineHeight","wordBreak","color","textAlign"].forEach(function(t){!e.hasOwnProperty(t)&&i.hasOwnProperty(t)&&(e[t]=i[t])})}x.normalize(e),this.children.forEach(function(t){t instanceof Q?t.__initStyle():(t.__style=e,t.__measure())})}},{key:"__tryLayInline",value:function(t,e){var i=this.flowChildren,r=this.style.width;if(r.unit===di)return t-r.value;if(r.unit===U)return t-e*r.value*.01;for(var n=0;n<i.length;n++){if(t<0)return t;var a=i[n];t-=a instanceof Q?a.__tryLayInline(t,e):a.textWidth}return t}},{key:"__offsetX",value:function(e){B(C(u.prototype),"__offsetX",this).call(this,e),this.flowChildren.forEach(function(t){t&&t.__offsetX(e)})}},{key:"__offsetY",value:function(e){B(C(u.prototype),"__offsetY",this).call(this,e),this.flowChildren.forEach(function(t){t&&t.__offsetY(e)})}},{key:"__calAutoBasis",value:function(a,o,s,t){var h=0,l=0,u=0,e=this.mtw,i=this.mrw,r=this.mbw,n=this.mlw,c=this.ptw,f=this.prw,d=this.pbw,_=this.plw,p=this.flowChildren,v=this.style,y=v.width,g=v.height,w=v.borderTopWidth,m=v.borderRightWidth,b=v.borderBottomWidth,x=v.borderLeftWidth,k=a?y:g;if(k.unit===di&&(h=u=k.value,t&&(l=h)),p.forEach(function(t){if(t instanceof Q){var e=t.__calAutoBasis(a,o,s,!0),i=e.b,r=e.min,n=e.max;h=Math.max(h,i),l=Math.max(l,r),u=Math.max(u,n)}else u=a?(l=Math.max(t.charWidth,l),Math.max(t.textWidth,u)):(t.__layout({x:0,y:0,w:o,h:s},!0),l=Math.max(l,t.height),Math.max(u,t.height))}),a){var M=m.value+x.value+n+i+_+f;h+=M,u+=M,l+=M}else{var W=w.value+b.value+e+r+c+d;h+=W,u+=W,l+=W}return{b:h,min:l,max:u}}},{key:"__calAbs",value:function(i){var r=0,t=this.mtw,e=this.mrw,n=this.mbw,a=this.mlw,o=this.ptw,s=this.prw,h=this.pbw,l=this.plw,u=this.flowChildren,c=this.style,f=c.width,d=c.height,_=c.borderTopWidth,p=c.borderRightWidth,v=c.borderBottomWidth,y=c.borderLeftWidth,g=i?f:d;if(g.unit===di&&(r=g.value),u.forEach(function(t){if(t instanceof Q){var e=t.__calAbs(i);r=Math.max(r,e)}else r=i?Math.max(t.textWidth,r):(t.__layout({x:0,y:0,w:1/0,h:1/0},!0),Math.max(r,t.height))}),i){var w=p.value+y.value+a+e+l+s;r+=w}else{var m=_.value+v.value+t+n+o+h;r+=m}return r}},{key:"__layoutBlock",value:function(e){var i=e.x,r=e.y,n=e.w,a=e.h;this.__x=i,this.__y=r,this.__width=n;var t,o=this.flowChildren,s=this.style,h=this.lineGroups,l=this.mlw,u=this.mtw,c=this.mrw,f=this.mbw,d=this.plw,_=this.ptw,p=this.prw,v=this.pbw,y=s.width,g=s.height,w=s.marginLeft,m=s.marginRight,b=s.borderTopWidth,x=s.borderRightWidth,k=s.borderBottomWidth,M=s.borderLeftWidth,W=s.textAlign;if(y&&y.unit!==fi)switch(y.unit){case di:n=y.value;break;case U:n*=.01*y.value}if(g&&g.unit!==fi)switch(t=!0,g.unit){case di:a=g.value;break;case U:a*=.01*g.value}i+=M.value+l+d,e.x=i,r+=b.value+u+_,e.y=r,y.unit===fi&&(n-=M.value+x.value+l+c+d+p),g.unit===fi&&(a-=b.value+k.value+u+f+_+v);var A=new E(i,r);if(o.forEach(function(t){t instanceof Q?"inline"===t.style.display?i===e.x?(A.add(t),t.__layout({x:i,y:r,w:n,h:a}),i+=t.outerWidth):(0<=t.__tryLayInline(n-i,n)?t.__layout({x:i,y:r,w:n,h:a}):(h.push(A),A.verticalAlign(),i=e.x,r+=A.height,t.__layout({x:e.x,y:r,w:n,h:a}),A=new E(i,r)),i+=t.outerWidth,A.add(t)):(A.size&&(h.push(A),A.verticalAlign(),r+=A.height,A=new E(e.x,r)),t.__layout({x:e.x,y:r,w:n,h:a}),i=e.x,r+=t.outerHeight):i===e.x?(A.add(t),t.__layout({x:i,y:r,w:n,h:a}),i+=t.width):(0<=t.__tryLayInline(n-i,n)?t.__layout({x:i,y:r,w:n,h:a}):(h.push(A),A.verticalAlign(),i=e.x,r+=A.height,t.__layout({x:e.x,y:r,w:n,h:a}),A=new E(i,r)),i+=t.width,A.add(t))}),A.size&&(h.push(A),A.verticalAlign(),r+=A.height),-1<["center","right"].indexOf(W)&&h.forEach(function(t){var e=n-t.width;0<e&&t.horizonAlign("center"===W?.5*e:e)}),this.__width=n,this.__height=t?a:r-e.y,this.__flowY=r,w.unit===fi&&m.unit===fi&&y.unit!==fi){var S=this.outerWidth;S<e.w&&this.__offsetX(.5*(e.w-S))}}},{key:"__layoutFlex",value:function(t){var W=t.x,A=t.y,S=t.w,L=t.h;this.__x=W,this.__y=A,this.__width=S;var e,T,i=this.flowChildren,r=this.style,n=this.mlw,a=this.mtw,o=this.mrw,s=this.mbw,h=this.plw,l=this.ptw,u=this.prw,c=this.pbw,f=r.width,d=r.height,_=r.flexDirection,p=r.borderTopWidth,v=r.borderRightWidth,y=r.borderBottomWidth,g=r.borderLeftWidth,w=r.justifyContent,m=r.alignItems;if(f&&f.unit!==fi)switch(e=!0,f.unit){case di:S=f.value;break;case U:S*=.01*f.value}if(d&&d.unit!==fi)switch(T=!0,d.unit){case di:L=d.value;break;case U:L*=.01*d.value}W+=g.value+n+h,t.x=W,A+=p.value+a+l,t.y=A,f.unit===fi&&(S-=g.value+v.value+n+o+h+u),d.unit===fi&&(L-=p.value+y.value+a+s+l+c);var N="row"===_;if(!N&&!T)return i.forEach(function(t){if(t instanceof Q){var e=t.style,i=t.style,r=i.display,n=i.flexDirection,a=i.width;"inline"===r?e.display="block":"flex"===r&&"row"===n&&a.unit===fi&&(a.value=S,a.unit=di),t.__layout({x:W,y:A,w:S,h:L}),A+=t.outerHeight}else t.__layout({x:W,y:A,w:S,h:L}),A+=t.outerHeight}),this.__width=S,void(this.__height=A-t.y);var E=[],O=[],C=[],B=[],P=0,R=0,D=0,b=0;i.forEach(function(t){if(t instanceof Q){var e=t.style,i=e.flexGrow,r=e.flexShrink,n=e.flexBasis;E.push(i),O.push(r),P+=i,R+=r;var a=t.__calAutoBasis(N,S,L),o=a.b,s=a.min,h=a.max;n.unit===fi?(C.push(h),D+=h):n.unit===di?(o=n.value,C.push(o),D+=o):n.unit===U&&(o=(N?S:L)*n.value,C.push(o),D+=o),b+=h,B.push(s)}else E.push(0),O.push(1),R+=1,N?(C.push(t.textWidth),D+=t.textWidth,b+=t.textWidth,B.push(t.charWidth)):(t.__layout({x:0,y:0,w:S,h:L},!0),C.push(t.height),D+=t.height,b+=t.height,B.push(t.height))});var F=0,I=(N?S:L)<b;i.forEach(function(t,e){var i,r=O[e],n=E[e];if(I){var a=D-(N?S:L);i=r?C[e]-a*r/R:C[e]}else{var o=(N?S:L)-D;i=n?C[e]+o*n/P:C[e]}if(i=Math.max(i,B[e]),t instanceof Q){var s=t.style,h=t.mlw,l=t.mtw,u=t.mrw,c=t.mbw,f=t.plw,d=t.ptw,_=t.prw,p=t.pbw,v=t.style,y=v.display,g=v.flexDirection,w=v.width,m=v.height,b=v.borderTopWidth,x=v.borderRightWidth,k=v.borderBottomWidth,M=v.borderLeftWidth;N?("inline"===y?s.display="block":"flex"===y&&"column"===g&&T&&m.unit===fi&&(m.value=L,m.unit=di),t.__layout({x:W,y:A,w:i,h:L})):("inline"===y?s.display="block":"flex"===y&&"row"===g&&w.unit===fi&&(w.value=S,w.unit=di),t.__layout({x:W,y:A,w:S,h:i})),I&&r?N?t.__width=i-h-u-f-_-M.value-x.value:t.__height=i-l-c-d-p-b.value-k.value:!I&&n&&(N?t.__width=i-h-u-f-_-M.value-x.value:t.__height=i-l-c-d-p-b.value-k.value)}else t.__layout({x:W,y:A,w:N?i:S,h:N?L:i});F=N?(W+=t.outerWidth,Math.max(F,t.outerHeight)):(A+=t.outerHeight,Math.max(F,t.outerWidth))});var x=N?S-W+t.x:L-A+t.y;if(!I&&0===P&&0<x){var k=i.length;if("flex-end"===w)for(var M=0;M<k;M++){var j=i[M];N?j.__offsetX(x):j.__offsetY(x)}else if("center"===w)for(var V=.5*x,G=0;G<k;G++){var Y=i[G];N?Y.__offsetX(V):Y.__offsetY(V)}else if("space-between"===w)for(var X=x/(k-1),H=1;H<k;H++){var z=i[H];N?z.__offsetX(X*H):z.__offsetY(X*H)}else if("space-around"===w)for(var $=x/(k+1),Z=0;Z<k;Z++){var q=i[Z];N?q.__offsetX($*(Z+1)):q.__offsetY($*(Z+1))}}N?(T&&(F=L),A+=F):e&&(F=S),"stretch"===m?i.forEach(function(t){var e=t.style,i=t.mlw,r=t.mtw,n=t.mrw,a=t.mbw,o=t.ptw,s=t.prw,h=t.plw,l=t.pbw;N?e.height.unit===fi&&(t.__height=F-r-a-o-l-e.borderTopWidth.value-e.borderBottomWidth.value):e.width.unit===fi&&(t.__width=F-i-n-h-s-v.value-g.value)}):"center"===m?i.forEach(function(t){var e=F-t.outerHeight;0<e&&t.__offsetY(.5*e)}):"flex-end"===m&&i.forEach(function(t){var e=F-t.outerHeight;0<e&&t.__offsetY(e)}),this.__width=S,this.__height=T?L:A-t.y,this.__flowY=A}},{key:"__layoutInline",value:function(e){var i=this,r=e.x,n=e.y,a=e.w,o=e.h;this.__x=r,this.__y=n;var t,s,h=r,l=this.flowChildren,u=this.style,c=this.lineGroups,f=this.mlw,d=this.mtw,_=this.mrw,p=this.mbw,v=this.plw,y=this.ptw,g=this.prw,w=this.pbw,m=u.width,b=u.height,x=u.marginLeft,k=u.marginRight,M=u.borderTopWidth,W=u.borderRightWidth,A=u.borderBottomWidth,S=u.borderLeftWidth,L=u.textAlign;if(m&&m.unit!==fi)switch(t=!0,m.unit){case di:a=m.value;break;case U:a*=.01*m.value}if(b&&b.unit!==fi)switch(s=!0,b.unit){case di:o=b.value;break;case U:o*=.01*b.value}r+=S.value+f+v,e.x=r,n+=M.value+d+y,e.y=n,m.unit===fi&&(a-=S.value+W.value+f+_+v+g),b.unit===fi&&(o-=M.value+A.value+d+p+y+w);var T=new E(r,n);if(l.forEach(function(t){if(t instanceof Q){if("absolute"===t.style.position)return void i.absChildren.push(t);if(t.style.display="inline",r===e.x)T.add(t),t.__layout({x:r,y:n,w:a,h:o}),r+=t.outerWidth,h=Math.max(h,r);else 0<=t.__tryLayInline(a-r,a)?t.__layout({x:r,y:n,w:a,h:o}):(c.push(T),T.verticalAlign(),r=e.x,n+=T.height,t.__layout({x:e.x,y:n,w:a,h:o}),T=new E(r,n)),r+=t.outerWidth,h=Math.max(h,r),T.add(t)}else{if(r===e.x)T.add(t),t.__layout({x:r,y:n,w:a,h:o}),r+=t.width,h=Math.max(h,r);else 0<=t.__tryLayInline(a-r,a)?t.__layout({x:r,y:n,w:a,h:o}):(c.push(T),T.verticalAlign(),r=e.x,n+=T.height,t.__layout({x:e.x,y:n,w:a,h:o}),T=new E(r,n)),r+=t.width,h=Math.max(h,r),T.add(t)}}),T.size&&(c.push(T),T.verticalAlign(),n+=T.height),-1<["center","right"].indexOf(L)&&c.forEach(function(t){var e=a-t.width;0<e&&t.horizonAlign("center"===L?.5*e:e)}),this.__width=t?a:h-e.x,this.__height=s?o:n-e.y,this.__flowY=n,x.unit===fi&&k.unit===fi&&m.unit!==fi){var N=this.outerWidth;N<e.w&&this.__offsetX(.5*(e.w-N))}}},{key:"__layoutAbs",value:function(e){var y=this.x,g=this.y,w=this.flowY,m=this.width,b=this.height,t=this.children,i=this.absChildren,r=this.style,n=(this.mlw,this.mtw,this.mrw,this.mbw,this.plw),a=this.ptw,o=this.prw,s=this.pbw,x=r.borderTopWidth,k=r.borderLeftWidth,M=m+n+o,W=b+a+s;t.forEach(function(t){t instanceof u&&t.__layoutAbs(-1<["absolute","relative"].indexOf(t.style.position)?t:e)}),i.forEach(function(t){var e,i,r,n,a=t.mtw,o=t.mlw,s=t.style,h=t.style,l=h.left,u=h.top,c=h.right,f=h.bottom,d=h.width,_=h.height;if(l.unit!==fi&&c.unit!==fi)e=l.unit===di?y+o+k.value+l.value:y+o+k.value+m*l.value*.01,r=c.unit===di?y+o+k.value+M-c.value-e:y+o+k.value+M-m*c.value*.01-e;else if(l.unit!==fi&&d.unit!==fi)e=l.unit===di?y+o+k.value+l.value:y+o+k.value+m*l.value*.01,r=d.unit===di?d.value:m;else if(c.unit!==fi&&d.unit!==fi){r=d.unit===di?d.value:m;var p=d.unit===di?d.value:m*d.value*.01;e=c.unit===di?y+o+k.value+M-c.value-p:y+o+k.value+M-m*c.value*.01-p}else l.unit!==fi?(e=l.unit===di?y+l.value:y+o+k.value+m*l.value*.01,r=t.__calAbs(!0)):c.unit!==fi?(r=t.__calAbs(!0),e=c.unit===di?y+o+k.value+M-c.value-r:y+o+k.value+M-m*c.value*.01-r):r=d.unit!==fi?(e=y+o+k.value,d.unit===di?d.value:m):(e=y+o+k.value,t.__calAbs(!0));if(u.unit!==fi&&f.unit!==fi)i=u.unit===di?g+u.value:g+a+x.value+b*u.value*.01,n=f.unit===di?g+a+x.value+W-f.value-i:g+a+x.value+W-b*f.value*.01-i,s.height={value:n,unit:di};else if(u.unit!==fi&&_.unit!==fi)i=u.unit===di?g+u.value:g+a+x.value+b*u.value*.01,n=_.unit===di?_.value:b;else if(f.unit!==fi&&_.unit!==fi){n=_.unit===di?_.value:b;var v=_.unit===di?_.value:b*_.value*.01;i=f.unit===di?g+a+x.value+W-f.value-v:g+a+x.value+W-b*f.value*.01-v}else u.unit!==fi?(i=u.unit===di?g+u.value:g+a+x.value+b*u.value*.01,n=t.__calAbs()):f.unit!==fi?(n=t.__calAbs(),i=f.unit===di?g+a+x.value+W-f.value-n:g+a+x.value+W-b*f.value*.01-n):n=_.unit!==fi?(i=w+a+x.value,_.unit===di?_.value:b):(i=w+a+x.value,t.__calAbs());"inline"===s.display&&(s.display="block"),t.__layout({x:e,y:i,w:r,h:n})})}},{key:"__emitEvent",value:function(t,e){var i=t.event.type,r=t.x,n=t.y,a=t.covers,o=this.listener,s=this.children,h=this.style,l=this.rx,u=this.ry,c=this.outerWidth,f=this.outerHeight;if("none"!==h.display){var d,_;o.hasOwnProperty(i)&&(d=o[i]);for(var p=s.length-1;0<=p;p--){var v=s[p];v instanceof Q&&-1<["absolute","relative"].indexOf(v.style.position)&&v.__emitEvent(t,e)&&(_=!0)}for(var y=s.length-1;0<=y;y--){var g=s[y];g instanceof Q&&-1===["absolute","relative"].indexOf(g.style.position)&&g.__emitEvent(t,e)&&(_=!0)}if(e)d&&d(t);else if(_)a.push({x:r,y:n,w:c,h:f}),d&&d(t);else if(l<=r&&u<=n&&r<=l+c&&n<=u+f){for(var w=0,m=a.length;w<m;w++){var b=a[w],x=b.x,k=b.y,M=b.w,W=b.h;if(x<=r&&k<=n&&r<=x+M&&n<=k+W)return}t.target||(t.target=this),a.push({x:r,y:n,w:c,h:f}),d&&d(t)}}}},{key:"render",value:function(e){B(C(u.prototype),"render",this).call(this,e);var t=this.style,i=this.flowChildren,r=this.children,n=t.display;t.position,t.top,t.right,t.bottom,t.left,t.height;"none"!==n&&(i.forEach(function(t){(t instanceof W||"static"===t.style.position)&&t.render(e)}),r.forEach(function(t){t instanceof Q&&-1<["relative","absolute"].indexOf(t.style.position)&&t.render(e)}),e===ci.SVG&&(this.__virtualDom=o({},B(C(u.prototype),"virtualDom",this),{type:"dom",children:this.children.map(function(t){return t.virtualDom})})))}},{key:"tagName",get:function(){return this.__tagName}},{key:"children",get:function(){return this.__children}},{key:"flowChildren",get:function(){return this.__flowChildren}},{key:"absChildren",get:function(){return this.__absChildren}},{key:"lineGroups",get:function(){return this.__lineGroups}},{key:"baseLine",get:function(){var t=this.lineGroups.length;if(t){var e=this.lineGroups[t-1];return e.y-this.y+e.baseLine}return this.y}},{key:"flowY",get:function(){return this.__flowY}}],[{key:"isValid",value:function(t){return L.hasOwnProperty(t)}}]),u}();function O(t,e,i,r,n){var a=t.childNodes;!function(t,e,i){for(var r=e.length,n=i.length,a=0,o=t.childNodes;a<Math.min(r,n);a++)P(o[a],e[a],i[a])}(a[0],r,n),F(a[1],e.bb,i.bb),D(t,e,i,!0)}function P(t,e,i){if(e.k!==i.k)t.insertAdjacentHTML("afterend",_i.joinDef(i)),t.parentNode.removeChild(t);else{for(var r=0;r<4;r++)e.c[r]!==i.c[r]&&t.setAttribute(["x1","y1","x2","y2"][r],i.c[r]);for(var n=e.v.length,a=i.v.length,o=0,s=t.childNodes;o<Math.min(n,a);o++){var h=e.v[o],l=i.v[o];h[0]!==l[0]&&s[o].setAttribute("stop-color",l[0]),h[1]!==l[1]&&s[o].setAttribute("offset",l[1])}if(o<n)for(;o<n;o++)G(t,s,o);else if(o<a)for(;o<a;o++)V(t,s,o,_i.joinDef(i.v[o]))}}function R(t,e,i){"dom"===e.type?"dom"===i.type?D(t,e,i):"text"===i.type?j(t,i):"geom"===i.type&&function(t,e,i){F(t.firstChild,e.bb,i.bb),j(t.lastChild,i.content)}(t,e,i):"text"===i.type?"dom"===i.type?j(t,i):"text"===i.type?function(t,e,i){for(var r=e.children.length,n=i.children.length,a=0;a<Math.min(r,n);a++)I(t,a,e.children[a],i.children[a],!0);var o=t.childNodes;if(a<r)for(;a<r;a++)G(t,o,a);else if(a<n)for(;a<n;a++)V(t,o,a,_i.joinVd(i.children[a]))}(t,e,i):"geom"===i.type&&j(t,i):"geom"===i.type&&("dom"===i.type?function(t,e,i){F(t.firstChild,e.bb,i.bb),j(t.lastChild,i.children)}(t,e,i):"text"===i.type?j(t,i):"geom"===i.type&&function(t,e,i){F(t.firstChild,e.bb,i.bb);for(var r=e.content.length,n=i.content.length,a=0,o=t.lastChild,s=o.childNodes;a<Math.min(r,n);a++)I(o,a,e.content[a],i.content[a]);if(a<r)for(;a<r;a++)G(o,s,a);else if(a<n)for(;a<n;a++)V(o,s,a,_i.joinVd(i.content[a]))}(t,e,i))}function D(t,e,i,r){r||F(t.firstChild,e.bb,i.bb);for(var n=e.children.length,a=i.children.length,o=0,s=t.lastChild,h=s.childNodes;o<Math.min(n,a);o++)R(h[o],e.children[o],i.children[o]);if(o<n)for(;o<n;o++)G(s,h,o);else if(o<a)for(;o<a;o++)V(s,h,o,_i.joinVd(i.children[o]))}function F(t,e,i){for(var r=e.length,n=i.length,a=0;a<Math.min(r,n);a++)I(t,a,e[a],i[a]);var o=t.childNodes;if(a<r)for(;a<r;a++)G(t,o,a);else if(a<n)for(;a<n;a++)V(t,o,a,_i.joinVd(i[a]))}function I(t,e,i,r,n){var a=t.childNodes;if(i.tagName!==r.tagName)j(a[e],r);else{for(var o={},s=0,h=i.props.length;s<h;s++){var l=ui(i.props[s],2),u=l[0],c=l[1];o[u]=c}for(var f=0,d=r.props.length;f<d;f++){var _=ui(r.props[f],2),p=_[0];c=_[1];o.hasOwnProperty(p)?(o[p]!==c&&a[e].setAttribute(p,c),delete o[p]):a[e].setAttribute(p,c)}for(var v in o)o.hasOwnProperty(v)&&a[e].removeAttribute(v);n&&i.content!==r.content&&(a[e].textContent=r.content)}}function j(t,e){var i;Array.isArray(e)?(i="",e.forEach(function(t){i+=_i.joinVd(t)})):i=_i.joinVd(e),t.insertAdjacentHTML("afterend",i),t.parentNode.removeChild(t)}function V(t,e,i,r){i>=e.length?t.insertAdjacentHTML("beforeend",r):e[i].insertAdjacentHTML("beforebegin",r)}function G(t,e,i){e[i]&&t.removeChild(e[i])}var Y=function(){function e(t){s(this,e),this.id=t++,this.count=0,this.list=[]}return a(e,[{key:"add",value:function(t){return t.uuid="__karas-defs-".concat(this.id,"-").concat(this.count++),this.list.push(t),t.uuid}},{key:"clear",value:function(){this.list=[],this.count=0}},{key:"value",get:function(){return this.list}}],[{key:"getInstance",value:function(t){return new e(t)}}]),e}();var X=1,H=function(){function n(t,e,i){var r;return s(this,n),(r=h(this,C(n).call(this,t,e,i))).__node=null,r}return t(n,N),a(n,[{key:"__initProps",value:function(){if(void 0!==this.props.width){var t=parseInt(this.props.width);!isNaN(t)&&0<t&&(this.__width=t)}if(void 0!==this.props.height){var e=parseInt(this.props.height);!isNaN(e)&&0<e&&(this.__height=e)}}},{key:"__genHtml",value:function(){for(var t,e,i,r="<".concat(this.tagName),n=0,a=this.__props.length;n<a;n++){var o=this.__props[n];r+=(t=o[0],e=o[1],void 0,i=Array.isArray(e)?_i.joinSourceArray(e):_i.stringify(e),"className"===t&&(t="class")," "+t+'="'+_i.encodeHtml(i,!0)+'"')}return r+="></".concat(this.tagName,">")}},{key:"__cb",value:function(t,e){if(!(t.touches&&1<t.touches.length)){var i=this.node.getBoundingClientRect(),r=i.x,n=i.y,a=i.top,o=i.right;r=r||a||0,n=n||o||0;var s=t.touches?t.touches[0]||{}:t;r=s.clientX-r,n=s.clientY-n,this.__emitEvent({event:t,x:r,y:n,covers:[]},e)}}},{key:"__initEvent",value:function(){var i=this,t=this.node;["click","dblclick","mousedown","mousemove","mouseup","touchstart","touchmove","touchend","touchcancel"].forEach(function(e){t.addEventListener(e,function(t){i.__cb(t,-1<["touchend","touchcancel"].indexOf(e))})})}},{key:"appendTo",value:function(t){if(t=function(t){if(_i.isString(t)){var e=document.querySelector(t);if(!e)throw new Error("can not find dom of selector: "+t);return e}if(!t)throw new Error("can not find dom: "+t);return t}(t),this.__initProps(),t.nodeName.toUpperCase()===this.tagName.toUpperCase()?(this.__node=t,this.width&&t.setAttribute("width",this.width),this.height&&t.setAttribute("height",this.height)):(this.__node=t.querySelector(this.tagName),this.__node||(t.innerHTML=this.__genHtml(),this.__node=t.querySelector(this.tagName))),this.__uuid=this.__node.__uuid||X++,this.__defs=Y.getInstance(this.__uuid),this.__defs.clear(),!this.width||!this.height){var e=window.getComputedStyle(t,null);this.width||(this.__width=parseInt(e.getPropertyValue("width")),t.setAttribute("width",this.width)),this.height||(this.__height=parseInt(e.getPropertyValue("height")),t.setAttribute("height",this.height))}var i;"canvas"===this.tagName?(this.__ctx=this.__node.getContext("2d"),this.__ctx.clearRect(0,0,this.width,this.height),i=ci.CANVAS):"svg"===this.tagName&&(i=ci.SVG);var r=this.style;if(-1===["flex","block"].indexOf(r.display)&&(r.display="block"),"absolute"===r.position&&(r.position="static"),this.__traverse(this.__ctx,this.__defs,i),r.width=this.width,r.height=this.height,this.__initStyle(),this.__layout({x:0,y:0,w:this.width,h:this.height}),this.__layoutAbs(this),this.render(i),i===ci.SVG){var n=this.virtualDom,a=this.__defs.value;this.node.__karasInit?O(this.node,this.node.__ovd,n,this.node.__od,a):this.node.innerHTML=_i.joinVirtualDom(n,a),this.node.__ovd=n,this.node.__od=a}this.node.__karasInit||(this.node.__karasInit=!0,this.__initEvent())}},{key:"node",get:function(){return this.__node}}]),n}(),z=function(){function O(t,e){var i;return s(this,O),(i=h(this,C(O).call(this,t,e))).__start=[],i.__end=[],i.__control=[],Array.isArray(i.props.start)&&(i.__start=i.props.start),Array.isArray(i.props.end)&&(i.__end=i.props.end),Array.isArray(i.props.control)&&(i.__control=i.props.control),i}return t(O,S),a(O,[{key:"render",value:function(t){B(C(O.prototype),"render",this).call(this,t);var e=this.rx,i=this.ry,r=this.width,n=this.height,a=this.mlw,o=this.mtw,s=this.plw,h=this.ptw,l=this.style,u=this.ctx,c=this.start,f=this.end,d=this.control,_=this.virtualDom;if(!(c.length<2||f.length<2)){var p=l.display,v=l.borderTopWidth,y=(l.borderRightWidth,l.borderBottomWidth,l.borderLeftWidth),g=l.stroke,w=l.strokeWidth,m=l.strokeDasharray;if("none"!==p){var b,x,k,M,W=e+y.value+a+s,A=i+v.value+o+h,S=W+c[0]*r,L=A+c[1]*n,T=W+f[0]*r,N=A+f[1]*n,E=0;Array.isArray(d[0])&&(E++,b=W+d[0][0]*r,x=A+d[0][1]*n),Array.isArray(d[1])&&(E++,k=W+d[1][0]*r,M=A+d[1][1]*n),t===ci.CANVAS?(u.strokeStyle=g,u.lineWidth=w,u.setLineDash(m),u.beginPath(),u.moveTo(S,L),2===E?u.bezierCurveTo(b,x,k,M,T,N):1===E?u.quadraticCurveTo(b,x,T,N):u.lineTo(T,N),u.stroke(),u.closePath()):t===ci.SVG&&(2===E?_.content.push({type:"item",tagName:"path",props:[["d","M".concat(S," ").concat(L," C").concat(b," ").concat(x," ").concat(k," ").concat(M," ").concat(T," ").concat(N)],["fill","none"],["stroke",g],["stroke-width",w],["stroke-dasharray",m]]}):1===E?_.content.push({type:"item",tagName:"path",props:[["d","M".concat(S," ").concat(L," Q").concat(b," ").concat(x," ").concat(T," ").concat(N)],["fill","none"],["stroke",g],["stroke-width",w],["stroke-dasharray",m]]}):_.content.push({type:"item",tagName:"line",props:[["x1",S],["y1",L],["x2",T],["y2",N],["stroke",g],["stroke-width",w],["stroke-dasharray",m]]}))}}}},{key:"start",get:function(){return this.__start}},{key:"end",get:function(){return this.__end}},{key:"control",get:function(){return this.__control}}]),O}(),$=function(){function O(t,e){var i;return s(this,O),(i=h(this,C(O).call(this,t,e))).__points=[],Array.isArray(i.props.points)&&(i.__points=i.props.points),-1<["TOP_LEFT","TOP_RIGHT","BOTTOM_LEFT","BOTTOM_RIGHT"].indexOf(i.props.origin)?i.__origin=i.props.origin:i.__origin="BOTTOM_LEFT",i}return t(O,S),a(O,[{key:"render",value:function(t){B(C(O.prototype),"render",this).call(this,t);var e=this.rx,i=this.ry,r=this.width,n=this.height,a=this.mlw,o=this.mtw,s=this.plw,h=this.ptw,l=this.style,u=this.ctx,c=this.points,f=this.origin,d=this.virtualDom;if(!(c.length<2)){for(var _=0,p=c.length;_<p;_++)if(!Array.isArray(c[_])||c[_].length<2)return;var v=l.display,y=l.borderTopWidth,g=l.borderLeftWidth,w=l.stroke,m=l.strokeWidth,b=l.strokeDasharray;if("none"!==v){var x=e+g.value+a+s,k=i+y.value+o+h,M=this.__pts=[];if("TOP_LEFT"===f?c.forEach(function(t){M.push([x+t[0]*r,k+t[1]*n])}):"TOP_RIGHT"===f?c.forEach(function(t){M.push([x+r-t[0]*r,k+t[1]*n])}):"BOTTOM_LEFT"===f?c.forEach(function(t){M.push([x+t[0]*r,k+n-t[1]*n])}):"BOTTOM_RIGHT"===f&&c.forEach(function(t){M.push([x+r-t[0]*r,k+n-t[1]*n])}),t===ci.CANVAS){u.strokeStyle=w,u.lineWidth=m,u.setLineDash(b),u.beginPath(),u.moveTo(M[0][0],k+M[0][1]);for(var W=1,A=M.length;W<A;W++){var S=M[W];u.lineTo(S[0],S[1])}m&&"transparent"!==w&&u.stroke(),u.closePath()}else if(t===ci.SVG){for(var L="",T=0,N=M.length;T<N;T++){var E=M[T];L+="".concat(E[0],",").concat(E[1]," ")}d.content.push({type:"item",tagName:"polyline",props:[["points",L],["fill","none"],["stroke",w],["stroke-width",m],["stroke-dasharray",b]]})}}}}},{key:"getPointsByX",value:function(t){for(var e=1/0,i=this.__pts.length,r=[],n=0;n<i;n++){var a=Math.abs(this.__pts[n][0]-t);a<e&&(e=a)}for(var o=0;o<i;o++){Math.abs(this.__pts[o][0]-t)===e&&r.push({index:o,x:this.__pts[o][0],y:this.__pts[o][1]})}return r}},{key:"points",get:function(){return this.__points}},{key:"origin",get:function(){return this.__origin}}]),O}(),Z=function(){function E(t,e){var i;return s(this,E),(i=h(this,C(E).call(this,t,e))).__points=[],Array.isArray(i.props.points)&&(i.__points=i.props.points),i}return t(E,S),a(E,[{key:"render",value:function(t){B(C(E.prototype),"render",this).call(this,t);var e=this.rx,i=this.ry,r=this.width,n=this.height,a=this.mlw,o=this.mtw,s=this.plw,h=this.ptw,l=this.style,u=this.ctx,c=this.points,f=this.virtualDom;if(!(c.length<3)){for(var d=0,_=c.length;d<_;d++)if(!Array.isArray(c[d])||c[d].length<2)return;var p=l.display,v=l.borderTopWidth,y=l.borderLeftWidth,g=l.stroke,w=l.strokeWidth,m=l.strokeDasharray,b=l.fill;if("none"!==p){var x=e+y.value+a+s,k=i+v.value+o+h;if(c.forEach(function(t){t[0]=x+t[0]*r,t[1]=k+t[1]*n}),t===ci.CANVAS){u.strokeStyle=g,u.lineWidth=w,u.fillStyle=b,u.setLineDash(m),u.beginPath(),u.moveTo(c[0][0],k+c[0][1]);for(var M=1,W=c.length;M<W;M++){var A=c[M];u.lineTo(A[0],A[1])}u.fill(),w&&"transparent"!==g&&u.stroke(),u.closePath()}else if(t===ci.SVG){for(var S="",L=0,T=S.length;L<T;L++){var N=S[L];S+="".concat(N[0],",").concat(N[1]," ")}f.content.push({type:"item",tagName:"polygon",props:[["points",S],["fill",b],["stroke",g],["stroke-width",w],["stroke-dasharray",m]]})}}}}},{key:"points",get:function(){return this.__points}}]),E}(),q=.5*Math.PI;function J(t,e,i,r){for(;360<r;)r-=360;for(;r<0;)r+=360;return 0<=r&&r<90?[t+Math.sin(r*Math.PI/180)*i,e-Math.cos(r*Math.PI/180)*i]:90<=r&&r<180?[t+Math.cos((r-90)*Math.PI/180)*i,e+Math.sin((r-90)*Math.PI/180)*i]:180<=r&&r<270?[t-Math.cos((270-r)*Math.PI/180)*i,e+Math.sin((270-r)*Math.PI/180)*i]:[t-Math.sin((360-r)*Math.PI/180)*i,e-Math.cos((360-r)*Math.PI/180)*i]}var K=function(){function E(t,e){var i;return s(this,E),(i=h(this,C(E).call(this,t,e))).__start=0,i.__end=0,i.props.start&&(i.__start=parseFloat(i.props.start),isNaN(i.start)&&(i.__start=0)),i.props.end&&(i.__end=parseFloat(i.props.end),isNaN(i.end)&&(i.__end=0)),i.__r=1,i.props.r&&(i.__r=parseFloat(i.props.r),isNaN(i.r)&&(i.__r=1)),i}return t(E,S),a(E,[{key:"render",value:function(t){B(C(E.prototype),"render",this).call(this,t);var e=this.rx,i=this.ry,r=this.width,n=this.height,a=this.mlw,o=this.mtw,s=this.plw,h=this.ptw,l=this.style,u=this.ctx,c=this.start,f=this.end,d=this.r,_=this.virtualDom;if(c!==f){var p=l.display,v=l.borderTopWidth,y=l.borderLeftWidth,g=l.stroke,w=l.strokeWidth,m=l.strokeDasharray,b=l.fill;if("none"!==p){var x=e+y.value+a+s,k=i+v.value+o+h;if(x+=.5*r,k+=.5*n,d*=.5*Math.min(r,n),t===ci.CANVAS)u.strokeStyle=g,u.lineWidth=w,u.fillStyle=b,u.setLineDash(m),u.beginPath(),u.moveTo(x,k),u.arc(x,k,d,c*Math.PI/180-q,f*Math.PI/180-q),u.fill(),w&&"transparent"!==g&&u.stroke(),u.closePath();else if(t===ci.SVG){var M,W,A,S,L=ui(J(x,k,d,c),2);M=L[0],W=L[1];var T=ui(J(x,k,d,f),2);A=T[0],S=T[1];var N=180<f-c?1:0;_.content.push({type:"item",tagName:"path",props:[["d","M".concat(x," ").concat(k," L").concat(M," ").concat(W," A").concat(d," ").concat(d," 0 ").concat(N," 1 ").concat(A," ").concat(S," z")],["fill",b],["stroke",g],["stroke-width",w],["stroke-dasharray",m]]})}}}}},{key:"start",get:function(){return this.__start}},{key:"end",get:function(){return this.__end}},{key:"r",get:function(){return this.__r}}]),E}(),tt=function(){function b(t,e){return s(this,b),h(this,C(b).call(this,t,e))}return t(b,S),a(b,[{key:"render",value:function(t){B(C(b.prototype),"render",this).call(this,t);var e=this.rx,i=this.ry,r=this.width,n=this.height,a=this.mlw,o=this.mtw,s=this.plw,h=this.ptw,l=this.style,u=this.ctx,c=this.virtualDom,f=l.display,d=l.borderTopWidth,_=l.borderLeftWidth,p=l.stroke,v=l.strokeWidth,y=l.strokeDasharray,g=l.fill;if("none"!==f){var w=e+_.value+a+s,m=i+d.value+o+h;t===ci.CANVAS?(u.strokeStyle=p,u.lineWidth=v,u.fillStyle=g,u.setLineDash(y),u.beginPath(),u.moveTo(w,m),u.lineTo(w+r,m),u.lineTo(w+r,m+n),u.lineTo(w,m+n),u.fill(),v&&"transparent"!==p&&u.stroke(),u.closePath()):t===ci.SVG&&c.content.push({type:"item",tagName:"rect",props:[["x",e],["y",i],["width",r],["height",n],["fill",g],["stroke",p],["stroke-width",v],["stroke-dasharray",y]]})}}}]),b}(),et=function(){function x(t,e){var i;return s(this,x),(i=h(this,C(x).call(this,t,e))).__r=1,i.props.r&&(i.__r=parseFloat(i.props.r),isNaN(i.r)&&(i.__r=1)),i}return t(x,S),a(x,[{key:"render",value:function(t){B(C(x.prototype),"render",this).call(this,t);var e=this.rx,i=this.ry,r=this.width,n=this.height,a=this.mlw,o=this.mtw,s=this.plw,h=this.ptw,l=this.style,u=this.ctx,c=this.r,f=this.virtualDom,d=l.display,_=l.borderTopWidth,p=l.borderLeftWidth,v=l.stroke,y=l.strokeWidth,g=l.strokeDasharray,w=l.fill;if("none"!==d){var m=e+p.value+a+s,b=i+_.value+o+h;m+=.5*r,b+=.5*n,c*=.5*Math.min(r,n),t===ci.CANVAS?(u.strokeStyle=v,u.lineWidth=y,u.fillStyle=w,u.setLineDash(g),u.beginPath(),u.arc(m,b,c,0,2*Math.PI),"transparent"!==w&&u.fill(),y&&"transparent"!==v&&u.stroke(),u.closePath()):t===ci.SVG&&f.content.push({type:"item",tagName:"circle",props:[["cx",m],["cy",b],["r",c],["fill",w],["stroke",v],["stroke-width",y],["stroke-dasharray",g]]})}}},{key:"r",get:function(){return this.__r}}]),x}(),it=function(){function k(t,e){var i;return s(this,k),(i=h(this,C(k).call(this,t,e))).__rx=1,i.props.rx&&(i.__rx=parseFloat(i.props.rx),isNaN(i.rx)&&(i.__rx=1)),i.__ry=1,i.props.ry&&(i.__ry=parseFloat(i.props.ry),isNaN(i.rx)&&(i.__ry=1)),i}return t(k,S),a(k,[{key:"render",value:function(t){B(C(k.prototype),"render",this).call(this,t);var e=this.rx,i=this.ry,r=this.width,n=this.height,a=this.mlw,o=this.mtw,s=this.plw,h=this.ptw,l=this.style,u=this.ctx,c=this.rx,f=this.ry,d=this.virtualDom,_=l.display,p=l.borderTopWidth,v=l.borderLeftWidth,y=l.stroke,g=l.strokeWidth,w=l.strokeDasharray,m=l.fill;if("none"!==_){var b=e+v.value+a+s,x=i+p.value+o+h;b+=.5*r,x+=.5*n,c*=.5*r,f*=.5*n,t===ci.CANVAS?(u.strokeStyle=y,u.lineWidth=g,u.fillStyle=m,u.setLineDash(w),u.beginPath(),u.moveTo(b,x),u.ellipse&&u.ellipse(b,x,c,f,0,0,2*Math.PI),u.fill(),g&&"transparent"!==y&&u.stroke(),u.closePath()):t===ci.SVG&&d.content.push({type:"item",tagName:"ellipse",props:[["cx",b],["cy",x],["rx",c],["ry",f],["fill",m],["stroke",y],["stroke-width",g],["stroke-dasharray",w]]})}}},{key:"rx",get:function(){return this.__rx}},{key:"ry",get:function(){return this.__ry}}]),k}(),rt=function(){function N(t,e){var i;return s(this,N),(i=h(this,C(N).call(this,t,e))).__nx=0,i.props.nx&&(i.__nx=parseFloat(i.props.nx),isNaN(i.nx)&&(i.__nx=0)),i.__ny=0,i.props.ny&&(i.__ny=parseFloat(i.props.ny),isNaN(i.ny)&&(i.__ny=0)),i}return t(N,S),a(N,[{key:"render",value:function(t){B(C(N.prototype),"render",this).call(this,t);var e=this.rx,i=this.ry,r=this.width,n=this.height,a=this.mlw,o=this.mtw,s=this.plw,h=this.ptw,l=this.style,u=this.ctx,c=this.nx,f=this.ny,d=this.virtualDom;if(!(r<=0||n<=0||c<3&&f<3)){var _=l.display,p=l.borderTopWidth,v=l.borderLeftWidth,y=l.stroke,g=l.strokeWidth,w=l.strokeDasharray;if("none"!==_){var m=e+v.value+a+s,b=i+p.value+o+h,x=m+r,k=b+n,M=[],W=[];if(3<=c)for(var A=r/(c-1),S=0;S<c;S++)W.push(m+S*A);if(3<=f)for(var L=n/(f-1),T=0;T<f;T++)M.push(b+T*L);t===ci.CANVAS?(u.strokeStyle=y,u.lineWidth=g,u.setLineDash(w),u.beginPath(),M.forEach(function(t){u.moveTo(m,t),u.lineTo(x,t)}),W.forEach(function(t){u.moveTo(t,b),u.lineTo(t,k)}),g&&"transparent"!==y&&u.stroke(),u.closePath()):t===ci.SVG&&(M.forEach(function(t){d.content.push({type:"item",tagName:"line",props:[["x1",m],["y1",t],["x2",x],["y2",t],["stroke",y],["stroke-width",g],["stroke-dasharray",w]]})}),W.forEach(function(t){d.content.push({type:"item",tagName:"line",props:[["x1",t],["y1",b],["x2",t],["y2",k],["stroke",y],["stroke-width",g],["stroke-dasharray",w]]})}))}}}},{key:"nx",get:function(){return this.__nx}},{key:"ny",get:function(){return this.__ny}},{key:"dash",get:function(){return this.__dash}}]),N}();S.register("$line",z),S.register("$polyline",$),S.register("$polygon",Z),S.register("$sector",K),S.register("$rect",tt),S.register("$circle",et),S.register("$ellipse",it),S.register("$grid",rt);var nt={render:function(t,e){if(!(t instanceof H))throw new Error("render root muse be canvas or svg");return e&&t.appendTo(e),t},createVd:function(t,e,i){if(-1<["canvas","svg"].indexOf(t))return new H(t,e,i);if(N.isValid(t))return new N(t,e,i);throw new Error("can not use marker: "+t)},createGm:function(t,e){return new(S.getImplement(t))(t,e)},createCp:function(t,e){return new t(e)},Geom:S,mode:ci};return"undefined"!=typeof window&&(window.karas=nt),nt});
//# sourceMappingURL=index.min.js.map
