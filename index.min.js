!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).karas=e()}(this,function(){"use strict";function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function e(t,e,i){return e&&r(t.prototype,e),i&&r(t,i),t}function i(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,r)}return i}function n(n){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(a,!0).forEach(function(t){var e,i,r;e=n,r=a[i=t],i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):i(a).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(a,t))})}return n}function t(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&a(t,e)}function R(t){return(R=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function a(t,e){return(a=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function s(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function H(t,e,i){return(H="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=R(t)););return t}(t,e);if(r){var n=Object.getOwnPropertyDescriptor(r,e);return n.get?n.get.call(i):n.value}})(t,e,i||t)}function M(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if(!(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)))return;var i=[],r=!0,n=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(r=(o=s.next()).done)&&(i.push(o.value),!e||i.length!==e);r=!0);}catch(t){n=!0,a=t}finally{try{r||null==s.return||s.return()}finally{if(n)throw a}}return i}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var h,l=function(){function t(){o(this,t),this.__x=0,this.__y=0,this.__width=0,this.__height=0,this.__prev=null,this.__next=null,this.__ctx=null,this.__parent=null,this.__style={},this.__baseLine=0,this.__virtualDom={}}return e(t,[{key:"__offsetX",value:function(t){this.__x+=t}},{key:"__offsetY",value:function(t){this.__y+=t}},{key:"x",get:function(){return this.__x}},{key:"y",get:function(){return this.__y}},{key:"width",get:function(){return this.__width}},{key:"height",get:function(){return this.__height}},{key:"outerWidth",get:function(){return this.__width}},{key:"outerHeight",get:function(){return this.__height}},{key:"prev",get:function(){return this.__prev}},{key:"next",get:function(){return this.__next}},{key:"parent",get:function(){return this.__parent}},{key:"style",get:function(){return this.__style}},{key:"ctx",get:function(){return this.__ctx}},{key:"baseLine",get:function(){return this.__baseLine}},{key:"virtualDom",get:function(){return this.__virtualDom}}]),t}(),q=0,U=1,c=function(t,e){h||((h=document.createElement("div")).style.position="absolute",h.style.left="99999px",h.style.top="-99999px",h.style.visibility="hidden",document.body.appendChild(h)),h.style.fontSize=e.fontSize+"px",h.innerText=t;var i=window.getComputedStyle(h,null);return parseFloat(i.width)},Q=0,Z=1,J=2;var K=function(){function r(t,e){var i;return o(this,r),i=s(this,R(r).call(this)),e=e||[],Array.isArray(e)?(i.props=function(t){for(var e={},i=0,r=t.length;i<r;i++){var n=t[i];if(Array.isArray(n))e[n[0]]=n[1];else for(var a=Object.keys(n),o=a.length-1;0<=o;o--){var s=a[o];e[s]=n[s]}}return e}(e),i.__props=function(t){for(var e=0,i=t.length;e<i;e++){var r=t[e];if(!Array.isArray(r)){for(var n=[],a=Object.keys(r),o=0,s=a.length;o<s;o++){var h=a[o];n.push([h,r[h]])}t.splice.apply(t,[e,1].concat(n))}}return t}(e)):(i.props=e,i.__props=function(t){for(var e=[],i=Object.keys(t),r=0,n=i.length;r<n;r++){var a=i[r];e.push([a,t[a]])}return e}(e)),i.__tagName=t,i.__style=i.props.style||{},i.__listener={},i.__props.forEach(function(t){var e=t[0];/^on[a-zA-Z]/.test(e)&&(i.__listener[e.slice(2).toLowerCase()]=t[1])}),i.__mtw=0,i.__mrw=0,i.__mbw=0,i.__mlw=0,i.__ptw=0,i.__prw=0,i.__pbw=0,i.__plw=0,i}return t(r,l),e(r,[{key:"__layout",value:function(t){var e=t.w,i=this.style,r=this.style,n=r.display,a=r.width,o=r.marginTop,s=r.marginRight,h=r.marginBottom,l=r.marginLeft,u=r.paddingTop,c=r.paddingRight,f=r.paddingBottom,d=r.paddingLeft;if("none"!==n){if(a&&a.unit!==Q)switch(a.unit){case Z:e=a.value;break;case J:e*=.01*a.value}this.__mlw=this.__mpWidth(l,e),this.__mtw=this.__mpWidth(o,e),this.__mrw=this.__mpWidth(s,e),this.__mbw=this.__mpWidth(h,e),this.__plw=this.__mpWidth(d,e),this.__ptw=this.__mpWidth(u,e),this.__prw=this.__mpWidth(c,e),this.__pbw=this.__mpWidth(f,e),"block"===n?this.__layoutBlock(t):"flex"===n?this.__layoutFlex(t):"inline"===n&&this.__layoutInline(t);var _=this.parent||this,v=_.width,p=_.height,y=i.position,g=i.top,m=i.right,w=i.bottom,b=i.left;if("relative"===y){if(b.unit!==Q){var x=b.unit===Z?b.value:b.value*v*.01;this.__offsetX(x)}else if(m.unit!==Q){var k=m.unit===Z?m.value:m.value*v*.01;this.__offsetX(-k)}if(g.unit!==Q){var W=g.unit===Z?g.value:g.value*p*.01;this.__offsetY(W)}else if(w.unit!==Q){var L=w.unit===Z?w.value:w.value*p*.01;this.__offsetY(-L)}}}}},{key:"__mpWidth",value:function(t,e){return t.unit===Z?t.value:t.unit===J?t.value*e*.01:0}},{key:"render",value:function(t){this.__virtualDom={bb:[]};var e=this.ctx,i=this.style,r=this.x,n=this.y,a=this.width,o=this.height,s=this.mlw,h=this.mtw,l=this.plw,u=this.ptw,c=this.prw,f=this.pbw,d=this.virtualDom,_=i.display,v=i.backgroundColor,p=i.borderTopWidth,y=i.borderTopColor,g=i.borderTopStyle,m=i.borderRightWidth,w=i.borderRightColor,b=i.borderRightStyle,x=i.borderBottomWidth,k=i.borderBottomColor,W=i.borderBottomStyle,L=i.borderLeftWidth,T=i.borderLeftColor,A=i.borderLeftStyle;if("none"!==_){if(r+=s,n+=h,v){var E=r;L&&(E+=L.value);var O=n;p&&(O+=p.value);var S=a+l+c,P=o+u+f;t===q?(e.beginPath(),e.fillStyle=v,e.rect(E,O,S,P),e.fill(),e.closePath()):t===U&&d.bb.push({type:"item",tagName:"rect",props:[["x",E],["y",O],["width",S],["height",P],["fill",v]]})}if(p.value){var M=r+L.value,B=n+.5*p.value,D=M+a;if(D+=l+c,t===q)e.beginPath(),e.lineWidth=p.value,e.strokeStyle=y,"dashed"===g?e.setLineDash([3*p.value,2*p.value]):"dotted"===g?e.setLineDash([p.value,p.value]):e.setLineDash([]),e.moveTo(M,B),e.lineTo(D,B),e.stroke(),e.closePath();else if(t===U){var N={type:"item",tagName:"line",props:[["x1",M],["y1",B],["x2",D],["y2",B],["stroke-width",p.value],["stroke",y]]};"dashed"===g?N.props.push(["stroke-dasharray","".concat(3*p.value,", ").concat(2*p.value)]):"dotted"===g&&N.props.push(["stroke-dasharray","".concat(p.value,", ").concat(p.value)]),d.bb.push(N)}}if(m.value){var C=r+a+L.value+.5*m.value,j=n,I=j+o+p.value+x.value;if(C+=l+c,I+=u+f,t===q)e.beginPath(),e.lineWidth=m.value,e.strokeStyle=w,"dashed"===b?e.setLineDash([3*m.value,2*m.value]):"dotted"===b?e.setLineDash([m.value,2*m.value]):e.setLineDash([]),e.moveTo(C,j),e.lineTo(C,I),e.stroke(),e.closePath();else if(t===U){var R={type:"item",tagName:"line",props:[["x1",C],["y1",j],["x2",C],["y2",I],["stroke-width",m.value],["stroke",w]]};"dashed"===b?R.props.push(["stroke-dasharray","".concat(3*m.value,", ").concat(2*m.value)]):"dotted"===g&&R.props.push(["stroke-dasharray","".concat(m.value,", ").concat(m.value)]),d.bb.push(R)}}if(x.value){var H=r+L.value,z=n+o+p.value+.5*x.value,F=H+a;if(F+=l+c,z+=u+f,t===q)e.beginPath(),e.lineWidth=x.value,e.strokeStyle=k,"dashed"===W?e.setLineDash([3*x.value,2*x.value]):"dotted"===W?e.setLineDash([x.value,2*x.value]):e.setLineDash([]),e.moveTo(H,z),e.lineTo(F,z),e.stroke(),e.closePath();else if(t===U){var Y={type:"item",tagName:"line",props:[["x1",H],["y1",z],["x2",F],["y2",z],["stroke-width",x.value],["stroke",k]]};"dashed"===W?Y.props.push(["stroke-dasharray","".concat(3*x.value,", ").concat(2*x.value)]):"dotted"===W&&Y.props.push(["stroke-dasharray","".concat(x.value,", ").concat(x.value)]),d.bb.push(Y)}}if(L.value){var G=r+.5*L.value,X=n,$=X+o+p.value+x.value;if($+=u+f,t===q)e.beginPath(),e.lineWidth=L.value,e.strokeStyle=T,"dashed"===A?e.setLineDash([3*L.value,2*L.value]):"dotted"===A?e.setLineDash([L.value,2*L.value]):e.setLineDash([]),e.moveTo(G,X),e.lineTo(G,$),e.stroke(),e.closePath();else if(t===U){var V={type:"item",tagName:"line",props:[["x1",G],["y1",X],["x2",G],["y2",$],["stroke-width",L.value],["stroke",T]]};"dashed"===A?V.props.push(["stroke-dasharray","".concat(3*L.value,", ").concat(2*L.value)]):"dotted"===A&&V.props.push(["stroke-dasharray","".concat(L.value,", ").concat(L.value)]),d.bb.push(V)}}}}},{key:"tagName",get:function(){return this.__tagName}},{key:"mtw",get:function(){return this.__mtw}},{key:"mrw",get:function(){return this.__mrw}},{key:"mbw",get:function(){return this.__mbw}},{key:"mlw",get:function(){return this.__mlw}},{key:"ptw",get:function(){return this.__ptw}},{key:"prw",get:function(){return this.__prw}},{key:"pbw",get:function(){return this.__pbw}},{key:"plw",get:function(){return this.__plw}},{key:"outerWidth",get:function(){var t=this.mlw,e=this.mrw,i=this.plw,r=this.prw,n=this.style,a=n.borderLeftWidth,o=n.borderRightWidth;return this.width+a.value+o.value+t+e+i+r}},{key:"outerHeight",get:function(){var t=this.mtw,e=this.mbw,i=this.ptw,r=this.pbw,n=this.style,a=n.borderTopWidth,o=n.borderBottomWidth;return this.height+a.value+o.value+t+e+i+r}},{key:"listener",get:function(){return this.__listener}}]),r}(),u={lhr:1.14990234375,car:1.1171875,blr:.9052734375,mdr:.64599609375,lgr:.03271484375},f={position:"static",display:"block",borderSizing:"content-box",top:"auto",right:"auto",bottom:"auto",left:"auto",marginTop:0,marginRight:0,marginBottom:0,marginLeft:0,paddingTop:0,paddingRight:0,paddingBottom:0,paddingLeft:0,fontSize:16,fontFamily:"arial",color:"#000",fontStyle:"normal",fontWeight:400,lineHeight:"normal",borderTopWidth:0,borderRightWidth:0,borderBottomWidth:0,borderLeftWidth:0,borderTopStyle:"solid",borderRightStyle:"solid",borderBottomStyle:"solid",borderLeftStyle:"solid",verticalAlign:"baseline",width:"auto",height:"auto",flexGrow:0,flexShrink:1,flexBasis:"auto",flexDirection:"row",justifyContent:"flex-start",alignItems:"stretch",textAlign:"left",visibility:"visible",fill:"#000",stroke:"#000",strokeWidth:0,strokeDasharray:[]},d=[];Object.keys(f).forEach(function(t){var e=f[t];d.push({k:t,v:e})});var _={}.toString;function v(e){return function(t){return _.call(t)==="[object "+e+"]"}}var p=v("Number");function y(t){return g(t)?"":t.toString()}function g(t){return null==t}var m={isObject:v("Object"),isString:v("String"),isFunction:v("Function"),isNumber:p,isBoolean:v("Boolean"),isDate:v("Date"),stringify:y,joinSourceArray:function(t){return function t(e){for(var i="",r=0,n=e.length;r<n;r++){var a=e[r];Array.isArray(a)?i+=t(a):i+=y(a)}return i}(t)},encodeHtml:function(t,e){return e?t.replace(/"/g,"&quot;"):t.replace(/&/g,"&amp;").replace(/</g,"&lt;")},isNil:g,joinVirtualDom:function e(t){if("item"===t.type){var i="";return t.props.forEach(function(t){i+=" ".concat(t[0],'="').concat(t[1],'"')}),"text"===t.tagName?"<text".concat(i,">").concat(t.content,"</text>"):"<".concat(t.tagName).concat(i,"/>")}if("text"===t.type){var r="";return t.children.forEach(function(t){r+=e(t)}),"<g>".concat(r,"</g>")}if("dom"===t.type){var n="<g>";return t.bb.forEach(function(t){n+=e(t)}),n+="</g><g>",t.children.forEach(function(t){n+=e(t)}),"<g>".concat(n+="</g>","</g>")}if("geom"===t.type){var a="<g>";return t.bb.forEach(function(t){a+=e(t)}),a+="</g><g>",t.content.forEach(function(t){a+=e(t)}),"<g>".concat(a+="</g>","</g>")}}};function w(t,e){var i="border".concat(e);if(t[i]){var r=/\b\d+px\b/i.exec(t[i]);r&&(t[i+"Width"]=r[0]);var n=/\b(solid|dashed|dotted)\b/i.exec(t[i]);n&&(t[i+"Style"]=n[1]);var a=/#[0-9a-f]{3,6}/i.exec(t[i]);a&&-1<[4,7].indexOf(a[0].length)&&(t[i+"Color"]=a[0])}}var b={normalize:function(i){if(d.forEach(function(t){i.hasOwnProperty(t.k)||(i[t.k]=t.v)}),i.background){var t=/#[0-9a-f]{3,6}/i.exec(i.background);t&&-1<[4,7].indexOf(t[0].length)&&(i.backgroundColor=t[0])}i.flex&&("none"===i.flex?(i.flexGrow=0,i.flexShrink=0,i.flexBasis="auto"):"auto"===i.flex?(i.flexGrow=1,i.flexShrink=1,i.flexBasis="auto"):/^[\d.]+$/.test(i.flex)?(i.flexGrow=parseFloat(i.flex),i.flexShrink=1,i.flexBasis=0):/^[\d.]+px$/.test(i.flex)||/^[\d.]+%$/.test(i.flex)||(i.flexGrow=0,i.flexShrink=1,i.flexBasis="auto")),i.border&&(i.borderTop=i.borderRight=i.borderBottom=i.borderLeft=i.border),i.margin&&(i.marginTop=i.marginRight=i.marginBottom=i.marginLeft=i.margin),i.padding&&(i.paddingTop=i.paddingRight=i.paddingBottom=i.paddingLeft=i.padding),w(i,"Top"),w(i,"Right"),w(i,"Bottom"),w(i,"Left"),["marginTop","marginRight","marginBottom","marginLeft","paddingTop","paddingRight","paddingBottom","paddingLeft","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","top","right","bottom","left","width","height","flexBasis"].forEach(function(t){var e=i[t];!m.isNil(e)&&e.unit||("auto"===e?i[t]={unit:Q}:/%$/.test(e)?(e=parseFloat(e)||0,i[t]={value:e,unit:J}):(e=parseFloat(e)||0,i[t]={value:e,unit:Z}))});var e=i.lineHeight;e="normal"===e?{value:i.fontSize*u.lhr,unit:Z}:/px$/.test(e)?(e=parseFloat(e),{value:Math.max(i.fontSize,e),unit:Z}):"normal"===(e=parseFloat(e)||"normal")?{value:i.fontSize*u.lhr,unit:Z}:{value:e*i.fontSize,unit:Z},i.lineHeight=e},setFontStyle:function(t){var e=t.fontStyle,i=t.fontWeight,r=t.fontSize,n=t.fontFamily;return"".concat(e," ").concat(i," ").concat(r,"px/").concat(r,"px ").concat(n)},getBaseLine:function(t){var e=t.fontSize*u.lhr;return.5*(t.lineHeight.value-e)+t.fontSize*u.blr}},x=function(){function a(t,e,i,r,n){o(this,a),this.__x=t,this.__y=e,this.__width=i,this.__content=r,this.__style=n,this.__virtualDom={}}return e(a,[{key:"render",value:function(t,e){var i=this.style,r=this.content,n=this.x,a=this.y;a+=b.getBaseLine(i),t===q?e.fillText(r,n,a):t===U&&(this.__virtualDom={type:"item",tagName:"text",props:[["x",n],["y",a],["fill",i.color],["font-size","".concat(i.fontSize,"px")]],content:r})}},{key:"__offsetX",value:function(t){this.__x+=t}},{key:"__offsetY",value:function(t){this.__y+=t}},{key:"x",get:function(){return this.__x}},{key:"y",get:function(){return this.__y}},{key:"width",get:function(){return this.__width}},{key:"content",get:function(){return this.__content}},{key:"style",get:function(){return this.__style}},{key:"baseLine",get:function(){return b.getBaseLine(this.style)}},{key:"virtualDom",get:function(){return this.__virtualDom}}]),a}(),k={},W=function(){function i(t){var e;return o(this,i),(e=s(this,R(i).call(this))).__content=t.toString(),e.__lineBoxes=[],e.__charWidthList=[],e.__charWidth=0,e.__textWidth=0,e}return t(i,l),e(i,[{key:"__measure",value:function(){this.__charWidthList=[];var t=this.ctx,e=this.content,i=this.style,r=this.charWidthList,n=this.renderMode;n===q&&(t.font=b.setFontStyle(i));for(var a=k[i.fontSize]=k[i.fontSize]||{},o=e.length,s=0,h=0;h<o;h++){var l=e.charAt(h),u=void 0;a.hasOwnProperty(l)?u=a[l]:n===q?u=a[l]=t.measureText(l).width:n===U&&(u=a[l]=c(l,i)),r.push(u),s+=u,this.__charWidth=Math.max(this.charWidth,u)}this.__textWidth=s}},{key:"__layout",value:function(t,e){var i=this,r=t.x,n=t.y,a=t.w;t.h;this.__x=r,this.__y=n;for(var o=r,s=(this.ctx,this.content),h=this.style,l=this.lineBoxes,u=this.charWidthList,c=(this.renderMode,0),f=0,d=0,_=s.length;f<_;)if((d+=u[f])===a){var v=new x(r,n,d,s.slice(c,f+1),h);l.push(v),o=Math.max(o,r+d),n+=this.style.lineHeight.value,f=(c=f+1)+1,d=0}else if(a<d){f===c&&(f=c+1);var p=new x(r,n,d-u[f],s.slice(c,f),h);l.push(p),o=Math.max(o,r+d-u[f]),n+=this.style.lineHeight.value,c=f,f+=1,d=0}else f++;if(c<_&&c<f){for(d=0,f=c;f<_;f++)d+=u[f];var y=new x(r,n,d,s.slice(c,_),h);l.push(y),o=Math.max(o,r+d),n+=h.lineHeight.value}if(this.__width=o-r,this.__height=n-t.y,e)this.__lineBoxes=[];else{var g=h.textAlign;-1<["center","right"].indexOf(g)&&l.forEach(function(t){var e=i.__width-t.width;0<e&&t.__offsetX("center"===g?.5*e:e)})}}},{key:"render",value:function(e){var i=this.ctx,t=this.style;e===q&&(i.font=b.setFontStyle(t),i.fillStyle=t.color),this.lineBoxes.forEach(function(t){t.render(e,i)}),e===U&&(this.__virtualDom={type:"text",children:this.lineBoxes.map(function(t){return t.virtualDom})})}},{key:"__tryLayInline",value:function(t){return t-this.textWidth}},{key:"__offsetX",value:function(e){H(R(i.prototype),"__offsetX",this).call(this,e),this.lineBoxes.forEach(function(t){t.__offsetX(e)})}},{key:"__offsetY",value:function(e){H(R(i.prototype),"__offsetY",this).call(this,e),this.lineBoxes.forEach(function(t){t.__offsetY(e)})}},{key:"__calMaxAndMinWidth",value:function(){var e=0;return this.charWidthList.forEach(function(t){e=Math.max(e,t)}),{max:this.textWidth,min:e}}},{key:"content",get:function(){return this.__content},set:function(t){this.__content=t}},{key:"lineBoxes",get:function(){return this.__lineBoxes}},{key:"charWidthList",get:function(){return this.__charWidthList}},{key:"charWidth",get:function(){return this.__charWidth}},{key:"textWidth",get:function(){return this.__textWidth}},{key:"baseLine",get:function(){var t=this.lineBoxes[this.lineBoxes.length-1];return t.y-this.y+t.baseLine}},{key:"renderMode",get:function(){return this.__renderMode}}]),i}(),E=function(){function i(t,e){o(this,i),this.__list=[],this.__x=t,this.__y=e,this.__baseLine=0}return e(i,[{key:"add",value:function(t){this.list.push(t)}},{key:"__calBaseLine",value:function(){var e=0;return this.list.forEach(function(t){e=Math.max(e,t.baseLine)}),e}},{key:"verticalAlign",value:function(){var e=this;this.__baseLine=this.__calBaseLine(),1<this.list.length&&this.list.forEach(function(t){t.baseLine!==e.baseLine&&t.__offsetY(e.baseLine-t.baseLine)})}},{key:"horizonAlign",value:function(e){this.list.forEach(function(t){t.__offsetX(e)})}},{key:"list",get:function(){return this.__list}},{key:"x",get:function(){return this.__x}},{key:"y",get:function(){return this.__y}},{key:"width",get:function(){var e=0;return this.list.forEach(function(t){e+=t.width}),e}},{key:"height",get:function(){var e=0;return this.list.forEach(function(t){e=Math.max(e,t.height)}),e}},{key:"baseLine",get:function(){return this.__baseLine}},{key:"size",get:function(){return this.__list.length}}]),i}(),L={},T=function(){function i(t,e){return o(this,i),s(this,R(i).call(this,t,e))}return t(i,K),e(i,[{key:"__initStyle",value:function(){b.normalize(this.style)}},{key:"__tryLayInline",value:function(t,e){var i=this.style.width;return i.unit===Z?t-i.value:i.unit===J?t-e*i.value*.01:t}},{key:"__calAutoBasis",value:function(t,e,i){var r=0,n=0,a=0,o=this.style,s=o.width,h=o.height,l=o.borderTopWidth,u=o.borderRightWidth,c=o.borderBottomWidth,f=o.borderLeftWidth,d=t?s:h;if(d.unit!==Q&&(r=a+=d.value),t){var _=u.value+f.value;r+=_,a+=_,n+=_}else{var v=l.value+c.value;r+=v,a+=v,n+=v}return{b:r,min:n,max:a}}},{key:"__layoutBlock",value:function(t){var e=t.x,i=t.y,r=t.w,n=t.h;this.__x=e,this.__y=i,this.__width=r;var a,o=this.style,s=o.width,h=o.height,l=o.borderTopWidth,u=o.borderRightWidth,c=o.borderBottomWidth,f=o.borderLeftWidth;if(s&&s.unit!==Q)switch(s.unit){case Z:r=s.value}if(h&&h.unit!==Q)switch(a=!0,h.unit){case Z:n=h.value;break;case J:n*=.01*h.value}e+=f.value,t.x=e,i+=l.value,t.y=i,r-=f.value+u.value,n-=l.value+c.value,this.__width=r,this.__height=a?n:0}},{key:"__layoutFlex",value:function(t){this.__layoutBlock(t)}},{key:"__layoutInline",value:function(t){var e=t.x,i=t.y,r=t.w,n=t.h;this.__x=e,this.__y=i;var a,o,s=this.style,h=s.width,l=s.height,u=s.borderTopWidth,c=s.borderRightWidth,f=s.borderBottomWidth,d=s.borderLeftWidth;if(h&&h.unit!==Q)switch(a=!0,h.unit){case Z:r=h.value}if(l&&l.unit!==Q)switch(o=!0,l.unit){case Z:n=l.value}e+=d.value,t.x=e,i+=u.value,t.y=i,r-=d.value+c.value,n-=u.value+f.value,this.__width=a?r:e-t.x,this.__height=o?n:i-t.y}},{key:"__calAbs",value:function(){return 0}},{key:"__emitEvent",value:function(t,e){var i,r=t.event.type,n=t.x,a=t.y,o=t.covers,s=this.listener,h=this.style,l=this.x,u=this.y,c=this.outerWidth,f=this.outerHeight;if("none"!==h.display)if(s.hasOwnProperty(r)&&(i=s[r]),e)i&&i(t);else if(l<=n&&u<=a&&n<=l+c&&a<=u+f){for(var d=0,_=o.length;d<_;d++){var v=o[d],p=v.x,y=v.y,g=v.w,m=v.h;if(p<=n&&y<=a&&n<=p+g&&a<=y+m)return}t.target||(t.target=this),o.push({x:l,y:u,w:c,h:f}),i&&i(t)}}},{key:"render",value:function(t){H(R(i.prototype),"render",this).call(this,t),t===U&&(this.__virtualDom=n({},H(R(i.prototype),"virtualDom",this),{type:"geom",content:[]}))}},{key:"tagName",get:function(){return this.__tagName}},{key:"baseLine",get:function(){return this.__height}}],[{key:"getImplement",value:function(t){if(!L.hasOwnProperty(t))throw new Error("Geom has not register: ".concat(t));return L[t]}},{key:"register",value:function(t,e){if(L.hasOwnProperty(t))throw new Error("Geom has already register: ".concat(t));L[t]=e}}]),i}(),A={div:!0,span:!0},O={span:!0},S=function(){function l(t,e,i){var r;return o(this,l),(r=s(this,R(l).call(this,t,e))).__children=i,r.__flowChildren=[],r.__absChildren=[],r.__lineGroups=[],r.__flowY=0,r}return t(l,K),e(l,[{key:"__traverse",value:function(e,t){var i=this,r=[];this.__traverseChildren(this.children,r,e,t);for(var n=r.length-1;0<n;n--){var a=r[n];if(a instanceof W){var o=r[n-1];o instanceof W?(o.content+=a.content,r.splice(n,1)):n--}}if("inline"===this.style.display&&"flex"!==this.parent.style.display)for(var s=r.length-1;0<=s;s--){var h=r[s];if(h instanceof l&&"inline"!==h.style.display)throw new Error("inline can not contain block/flex")}r.forEach(function(t){t.__ctx=e,t.__parent=i,t.__prev=null,t instanceof W||"absolute"!==t.style.position?i.__flowChildren.push(t):i.__absChildren.push(t)}),this.__children=r}},{key:"__traverseChildren",value:function(t,e,i,r){var n=this;if(Array.isArray(t))t.forEach(function(t){n.__traverseChildren(t,e,i,r)});else if(t instanceof l)e.push(t),t.__traverse(i,r);else if(t instanceof T)e.push(t);else if(!m.isNil(t)){var a=new W(t);a.__renderMode=r,e.push(a)}}},{key:"__initStyle",value:function(){var e=this.__style;e.display&&-1!==["flex","block","inline","none"].indexOf(e.display)||(O.hasOwnProperty(this.tagName)?e.display="inline":e.display="block");var t=this.parent;if(t){var i=t.style;["fontSize","fontWeight","fontStyle","lineHeight","wordBreak","color","textAlign"].forEach(function(t){!e.hasOwnProperty(t)&&i.hasOwnProperty(t)&&(e[t]=i[t])})}b.normalize(e),this.children.forEach(function(t){t instanceof K?t.__initStyle():(t.__style=e,t.__measure())})}},{key:"__tryLayInline",value:function(t,e){var i=this.flowChildren,r=this.style.width;if(r.unit===Z)return t-r.value;if(r.unit===J)return t-e*r.value*.01;for(var n=0;n<i.length;n++){if(t<0)return t;var a=i[n];t-=a instanceof K?a.__tryLayInline(t,e):a.textWidth}return t}},{key:"__offsetX",value:function(e){H(R(l.prototype),"__offsetX",this).call(this,e),this.flowChildren.forEach(function(t){t&&t.__offsetX(e)})}},{key:"__offsetY",value:function(e){H(R(l.prototype),"__offsetY",this).call(this,e),this.flowChildren.forEach(function(t){t&&t.__offsetY(e)})}},{key:"__calAutoBasis",value:function(a,o,s,t){var h=0,l=0,u=0,e=this.mtw,i=this.mrw,r=this.mbw,n=this.mlw,c=this.ptw,f=this.prw,d=this.pbw,_=this.plw,v=this.flowChildren,p=this.style,y=p.width,g=p.height,m=p.borderTopWidth,w=p.borderRightWidth,b=p.borderBottomWidth,x=p.borderLeftWidth,k=a?y:g;if(k.unit===Z&&(h=u=k.value,t&&(l=h)),v.forEach(function(t){if(t instanceof K){var e=t.__calAutoBasis(a,o,s,!0),i=e.b,r=e.min,n=e.max;h=Math.max(h,i),l=Math.max(l,r),u=Math.max(u,n)}else u=a?(l=Math.max(t.charWidth,l),Math.max(t.textWidth,u)):(t.__layout({x:0,y:0,w:o,h:s},!0),l=Math.max(l,t.height),Math.max(u,t.height))}),a){var W=w.value+x.value+n+i+_+f;h+=W,u+=W,l+=W}else{var L=m.value+b.value+e+r+c+d;h+=L,u+=L,l+=L}return{b:h,min:l,max:u}}},{key:"__calAbs",value:function(i){var r=0,t=this.mtw,e=this.mrw,n=this.mbw,a=this.mlw,o=this.ptw,s=this.prw,h=this.pbw,l=this.plw,u=this.flowChildren,c=this.style,f=c.width,d=c.height,_=c.borderTopWidth,v=c.borderRightWidth,p=c.borderBottomWidth,y=c.borderLeftWidth,g=i?f:d;if(g.unit===Z&&(r=g.value),u.forEach(function(t){if(t instanceof K){var e=t.__calAbs(i);r=Math.max(r,e)}else r=i?Math.max(t.textWidth,r):(t.__layout({x:0,y:0,w:1/0,h:1/0},!0),Math.max(r,t.height))}),i){var m=v.value+y.value+a+e+l+s;r+=m}else{var w=_.value+p.value+t+n+o+h;r+=w}return r}},{key:"__layoutBlock",value:function(e){var i=e.x,r=e.y,n=e.w,a=e.h;this.__x=i,this.__y=r,this.__width=n;var t,o=this.flowChildren,s=this.style,h=this.lineGroups,l=this.mlw,u=this.mtw,c=this.mrw,f=this.mbw,d=this.plw,_=this.ptw,v=this.prw,p=this.pbw,y=s.width,g=s.height,m=s.borderTopWidth,w=s.borderRightWidth,b=s.borderBottomWidth,x=s.borderLeftWidth,k=s.textAlign;if(y&&y.unit!==Q)switch(y.unit){case Z:n=y.value;break;case J:n*=.01*y.value}if(g&&g.unit!==Q)switch(t=!0,g.unit){case Z:a=g.value;break;case J:a*=.01*g.value}i+=x.value+l+d,e.x=i,r+=m.value+u+_,e.y=r,y.unit===Q&&(n-=x.value+w.value+l+c+d+v),a-=m.value+b.value+u+f+_+p;var W=new E(i,r);o.forEach(function(t){t instanceof K?"inline"===t.style.display?i===e.x?(W.add(t),t.__layout({x:i,y:r,w:n,h:a}),i+=t.outerWidth):(0<=t.__tryLayInline(n-i,n)?t.__layout({x:i,y:r,w:n,h:a}):(h.push(W),W.verticalAlign(),i=e.x,r+=W.height,t.__layout({x:e.x,y:r,w:n,h:a}),W=new E(i,r)),i+=t.outerWidth,W.add(t)):(W.size&&(h.push(W),W.verticalAlign(),r+=W.height,W=new E(e.x,r)),t.__layout({x:e.x,y:r,w:n,h:a}),i=e.x,r+=t.outerHeight):i===e.x?(W.add(t),t.__layout({x:i,y:r,w:n,h:a}),i+=t.width):(0<=t.__tryLayInline(n-i,n)?t.__layout({x:i,y:r,w:n,h:a}):(h.push(W),W.verticalAlign(),i=e.x,r+=W.height,t.__layout({x:e.x,y:r,w:n,h:a}),W=new E(i,r)),i+=t.width,W.add(t))}),W.size&&(h.push(W),W.verticalAlign(),r+=W.height),-1<["center","right"].indexOf(k)&&h.forEach(function(t){var e=n-t.width;0<e&&t.horizonAlign("center"===k?.5*e:e)}),this.__width=n,this.__height=t?a:r-e.y,this.__flowY=r}},{key:"__layoutFlex",value:function(t){var L=t.x,T=t.y,A=t.w,E=t.h;this.__x=L,this.__y=T,this.__width=A;var e,O,i=this.flowChildren,r=this.style,n=this.mlw,a=this.mtw,o=this.mrw,s=this.mbw,h=this.plw,l=this.ptw,u=this.prw,c=this.pbw,f=r.width,d=r.height,_=r.flexDirection,v=r.borderTopWidth,p=r.borderRightWidth,y=r.borderBottomWidth,g=r.borderLeftWidth,m=r.justifyContent,w=r.alignItems;if(f&&f.unit!==Q)switch(e=!0,f.unit){case Z:A=f.value;break;case J:A*=.01*f.value}if(d&&d.unit!==Q)switch(O=!0,d.unit){case Z:E=d.value;break;case J:E*=.01*d.value}L+=g.value+n+h,t.x=L,T+=v.value+a+l,t.y=T,f.unit===Q&&(A-=g.value+p.value+n+o+h+u),E-=v.value+y.value+a+s+l+c;var S="row"===_;if(!S&&!O)return i.forEach(function(t){if(t instanceof K){var e=t.style,i=t.style,r=i.display,n=i.flexDirection,a=i.width;"inline"===r?e.display="block":"flex"===r&&"row"===n&&a.unit===Q&&(a.value=A,a.unit=Z),t.__layout({x:L,y:T,w:A,h:E}),T+=t.outerHeight}else t.__layout({x:L,y:T,w:A,h:E}),T+=t.outerHeight}),this.__width=A,void(this.__height=T-t.y);var P=[],M=[],B=[],D=[],N=0,C=0,j=0,b=0;i.forEach(function(t){if(t instanceof K){var e=t.style,i=e.flexGrow,r=e.flexShrink,n=e.flexBasis;P.push(i),M.push(r),N+=i,C+=r;var a=t.__calAutoBasis(S,A,E),o=a.b,s=a.min,h=a.max;n.unit===Q?(B.push(h),j+=h):n.unit===Z?(o=n.value,B.push(o),j+=o):n.unit===J&&(o=(S?A:E)*n.value,B.push(o),j+=o),b+=h,D.push(s)}else P.push(0),M.push(1),C+=1,S?(B.push(t.textWidth),j+=t.textWidth,b+=t.textWidth,D.push(t.charWidth)):(t.__layout({x:0,y:0,w:A,h:E},!0),B.push(t.height),j+=t.height,b+=t.height,D.push(t.height))});var I=0,R=(S?A:E)<b;i.forEach(function(t,e){var i,r=M[e],n=P[e];if(R){var a=j-(S?A:E);i=r?B[e]-a*r/C:B[e]}else{var o=(S?A:E)-j;i=n?B[e]+o*n/N:B[e]}if(i=Math.max(i,D[e]),t instanceof K){var s=t.style,h=t.mlw,l=t.mtw,u=t.mrw,c=t.mbw,f=t.plw,d=t.ptw,_=t.prw,v=t.pbw,p=t.style,y=p.display,g=p.flexDirection,m=p.width,w=p.height,b=p.borderTopWidth,x=p.borderRightWidth,k=p.borderBottomWidth,W=p.borderLeftWidth;S?("inline"===y?s.display="block":"flex"===y&&"column"===g&&O&&w.unit===Q&&(w.value=E,w.unit=Z),t.__layout({x:L,y:T,w:i,h:E})):("inline"===y?s.display="block":"flex"===y&&"row"===g&&m.unit===Q&&(m.value=A,m.unit=Z),t.__layout({x:L,y:T,w:A,h:i})),R&&r?S?t.__width=i-h-u-f-_-W.value-x.value:t.__height=i-l-c-d-v-b.value-k.value:!R&&n&&(S?t.__width=i-h-u-f-_-W.value-x.value:t.__height=i-l-c-d-v-b.value-k.value)}else t.__layout({x:L,y:T,w:S?i:A,h:S?E:i});I=S?(L+=t.outerWidth,Math.max(I,t.outerHeight)):(T+=t.outerHeight,Math.max(I,t.outerWidth))});var x=S?A-L+t.x:E-T+t.y;if(!R&&0===N&&0<x){var k=i.length;if("flex-end"===m)for(var W=0;W<k;W++){var H=i[W];S?H.__offsetX(x):H.__offsetY(x)}else if("center"===m)for(var z=.5*x,F=0;F<k;F++){var Y=i[F];S?Y.__offsetX(z):Y.__offsetY(z)}else if("space-between"===m)for(var G=x/(k-1),X=1;X<k;X++){var $=i[X];S?$.__offsetX(G*X):$.__offsetY(G*X)}else if("space-around"===m)for(var V=x/(k+1),q=0;q<k;q++){var U=i[q];S?U.__offsetX(V*(q+1)):U.__offsetY(V*(q+1))}}S?(O&&(I=E),T+=I):e&&(I=A),"stretch"===w?i.forEach(function(t){var e=t.style,i=t.mlw,r=t.mtw,n=t.mrw,a=t.mbw,o=t.ptw,s=t.prw,h=t.plw,l=t.pbw;S?e.height.unit===Q&&(t.__height=I-r-a-o-l-e.borderTopWidth.value-e.borderBottomWidth.value):e.width.unit===Q&&(t.__width=I-i-n-h-s-p.value-g.value)}):"center"===w?i.forEach(function(t){var e=I-t.outerHeight;0<e&&t.__offsetY(.5*e)}):"flex-end"===w&&i.forEach(function(t){var e=I-t.outerHeight;0<e&&t.__offsetY(e)}),this.__width=A,this.__height=O?E:T-t.y,this.__flowY=T}},{key:"__layoutInline",value:function(e){var i=this,r=e.x,n=e.y,a=e.w,o=e.h;this.__x=r,this.__y=n;var t,s,h=r,l=this.flowChildren,u=this.style,c=this.lineGroups,f=this.mlw,d=this.mtw,_=this.mrw,v=this.mbw,p=this.plw,y=this.ptw,g=this.prw,m=this.pbw,w=u.width,b=u.height,x=u.borderTopWidth,k=u.borderRightWidth,W=u.borderBottomWidth,L=u.borderLeftWidth,T=u.textAlign;if(w&&w.unit!==Q)switch(t=!0,w.unit){case Z:a=w.value;break;case J:a*=.01*w.value}if(b&&b.unit!==Q)switch(s=!0,b.unit){case Z:o=b.value;break;case J:o*=.01*b.value}r+=L.value+f+p,e.x=r,n+=x.value+d+y,e.y=n,w.unit===Q&&(a-=L.value+k.value+f+_+p+g),o-=x.value+W.value+d+v+y+m;var A=new E(r,n);l.forEach(function(t){if(t instanceof K){if("absolute"===t.style.position)return void i.absChildren.push(t);if(t.style.display="inline",r===e.x)A.add(t),t.__layout({x:r,y:n,w:a,h:o}),r+=t.outerWidth,h=Math.max(h,r);else 0<=t.__tryLayInline(a-r,a)?t.__layout({x:r,y:n,w:a,h:o}):(c.push(A),A.verticalAlign(),r=e.x,n+=A.height,t.__layout({x:e.x,y:n,w:a,h:o}),A=new E(r,n)),r+=t.outerWidth,h=Math.max(h,r),A.add(t)}else{if(r===e.x)A.add(t),t.__layout({x:r,y:n,w:a,h:o}),r+=t.width,h=Math.max(h,r);else 0<=t.__tryLayInline(a-r,a)?t.__layout({x:r,y:n,w:a,h:o}):(c.push(A),A.verticalAlign(),r=e.x,n+=A.height,t.__layout({x:e.x,y:n,w:a,h:o}),A=new E(r,n)),r+=t.width,h=Math.max(h,r),A.add(t)}}),A.size&&(c.push(A),A.verticalAlign(),n+=A.height),-1<["center","right"].indexOf(T)&&c.forEach(function(t){var e=a-t.width;0<e&&t.horizonAlign("center"===T?.5*e:e)}),this.__width=t?a:h-e.x,this.__height=s?o:n-e.y,this.__flowY=n}},{key:"__layoutAbs",value:function(e){var y=this.x,g=this.y,m=this.flowY,w=this.width,b=this.height,t=this.children,i=this.absChildren,r=this.style,n=(this.mlw,this.mtw,this.mrw,this.mbw,this.plw),a=this.ptw,o=this.prw,s=this.pbw,x=r.borderTopWidth,k=r.borderLeftWidth,W=w+n+o,L=b+a+s;t.forEach(function(t){t instanceof l&&t.__layoutAbs(-1<["absolute","relative"].indexOf(t.style.position)?t:e)}),i.forEach(function(t){var e,i,r,n,a=t.mtw,o=t.mlw,s=t.style,h=t.style,l=h.left,u=h.top,c=h.right,f=h.bottom,d=h.width,_=h.height;if(l.unit!==Q&&c.unit!==Q)e=l.unit===Z?y+o+k.value+l.value:y+o+k.value+w*l.value*.01,r=c.unit===Z?y+o+k.value+W-c.value-e:y+o+k.value+W-w*c.value*.01-e;else if(l.unit!==Q&&d.unit!==Q)e=l.unit===Z?y+o+k.value+l.value:y+o+k.value+w*l.value*.01,r=d.unit===Z?d.value:w;else if(c.unit!==Q&&d.unit!==Q){r=d.unit===Z?d.value:w;var v=d.unit===Z?d.value:w*d.value*.01;e=c.unit===Z?y+o+k.value+W-c.value-v:y+o+k.value+W-w*c.value*.01-v}else l.unit!==Q?(e=l.unit===Z?y+l.value:y+o+k.value+w*l.value*.01,r=t.__calAbs(!0)):c.unit!==Q?(r=t.__calAbs(!0),e=c.unit===Z?y+o+k.value+W-c.value-r:y+o+k.value+W-w*c.value*.01-r):r=d.unit!==Q?(e=y+o+k.value,d.unit===Z?d.value:w):(e=y+o+k.value,t.__calAbs(!0));if(u.unit!==Q&&f.unit!==Q)i=u.unit===Z?g+u.value:g+a+x.value+b*u.value*.01,n=f.unit===Z?g+a+x.value+L-f.value-i:g+a+x.value+L-b*f.value*.01-i,s.height={value:n,unit:Z};else if(u.unit!==Q&&_.unit!==Q)i=u.unit===Z?g+u.value:g+a+x.value+b*u.value*.01,n=_.unit===Z?_.value:b;else if(f.unit!==Q&&_.unit!==Q){n=_.unit===Z?_.value:b;var p=_.unit===Z?_.value:b*_.value*.01;i=f.unit===Z?g+a+x.value+L-f.value-p:g+a+x.value+L-b*f.value*.01-p}else u.unit!==Q?(i=u.unit===Z?g+u.value:g+a+x.value+b*u.value*.01,n=t.__calAbs()):f.unit!==Q?(n=t.__calAbs(),i=f.unit===Z?g+a+x.value+L-f.value-n:g+a+x.value+L-b*f.value*.01-n):n=_.unit!==Q?(i=m+a+x.value,_.unit===Z?_.value:b):(i=m+a+x.value,t.__calAbs());"inline"===s.display&&(s.display="block"),t.__layout({x:e,y:i,w:r,h:n})})}},{key:"__emitEvent",value:function(t,e){var i=t.event.type,r=t.x,n=t.y,a=t.covers,o=this.listener,s=this.children,h=this.style,l=this.x,u=this.y,c=this.outerWidth,f=this.outerHeight;if("none"!==h.display){var d,_;o.hasOwnProperty(i)&&(d=o[i]);for(var v=s.length-1;0<=v;v--){var p=s[v];p instanceof K&&-1<["absolute","relative"].indexOf(p.style.position)&&p.__emitEvent(t,e)&&(_=!0)}for(var y=s.length-1;0<=y;y--){var g=s[y];g instanceof K&&-1===["absolute","relative"].indexOf(g.style.position)&&g.__emitEvent(t,e)&&(_=!0)}if(e)d&&d(t);else if(_)a.push({x:l,y:u,w:c,h:f}),d&&d(t);else if(l<=r&&u<=n&&r<=l+c&&n<=u+f){for(var m=0,w=a.length;m<w;m++){var b=a[m],x=b.x,k=b.y,W=b.w,L=b.h;if(x<=r&&k<=n&&r<=x+W&&n<=k+L)return}t.target||(t.target=this),a.push({x:l,y:u,w:c,h:f}),d&&d(t)}}}},{key:"render",value:function(e){H(R(l.prototype),"render",this).call(this,e);var t=this.style.display,i=this.flowChildren,r=this.children;"none"!==t&&(i.forEach(function(t){(t instanceof W||"static"===t.style.position)&&t.render(e)}),r.forEach(function(t){t instanceof K&&-1<["relative","absolute"].indexOf(t.style.position)&&t.render(e)}),e===U&&(this.__virtualDom=n({},H(R(l.prototype),"virtualDom",this),{type:"dom",children:this.children.map(function(t){return t.virtualDom})})))}},{key:"tagName",get:function(){return this.__tagName}},{key:"children",get:function(){return this.__children}},{key:"flowChildren",get:function(){return this.__flowChildren}},{key:"absChildren",get:function(){return this.__absChildren}},{key:"lineGroups",get:function(){return this.__lineGroups}},{key:"baseLine",get:function(){var t=this.lineGroups.length;if(t){var e=this.lineGroups[t-1];return e.y-this.y+e.baseLine}return this.y}},{key:"flowY",get:function(){return this.__flowY}}],[{key:"isValid",value:function(t){return A.hasOwnProperty(t)}}]),l}();function P(t,e,i){"dom"===e.type?"dom"===i.type?function(t,e,i){B(t.firstChild,e.bb,i.bb);for(var r=e.children.length,n=i.children.length,a=0,o=t.lastChild,s=o.childNodes;a<Math.min(r,n);a++)P(s[a],e.children[a],i.children[a]);if(a<r)for(;a<r;a++)j(o,s,a);else if(a<n)for(;a<n;a++)C(o,s,a,i.children[a])}(t,e,i):"text"===i.type?N(t,i):"geom"===i.type&&function(t,e,i){B(t.firstChild,e.bb,i.bb),N(t.lastChild,i.content)}(t,e,i):"text"===i.type?"dom"===i.type?N(t,i):"text"===i.type?function(t,e,i){for(var r=e.children.length,n=i.children.length,a=0;a<Math.min(r,n);a++)D(t,a,e.children[a],i.children[a],!0);var o=t.childNodes;if(a<r)for(;a<r;a++)j(t,o,a);else if(a<n)for(;a<n;a++)C(t,o,a,i.children[a])}(t,e,i):"geom"===i.type&&N(t,i):"geom"===i.type&&("dom"===i.type?function(t,e,i){B(t.firstChild,e.bb,i.bb),N(t.lastChild,i.children)}(t,e,i):"text"===i.type?N(t,i):"geom"===i.type&&function(t,e,i){B(t.firstChild,e.bb,i.bb);for(var r=e.content.length,n=i.content.length,a=0,o=t.lastChild,s=o.childNodes;a<Math.min(r,n);a++)D(o,a,e.content[a],i.content[a]);if(a<r)for(;a<r;a++)j(o,s,a);else if(a<n)for(;a<n;a++)C(o,s,a,i.content[a])}(t,e,i))}function B(t,e,i){for(var r=e.length,n=i.length,a=0;a<Math.min(r,n);a++)D(t,a,e[a],i[a]);var o=t.childNodes;if(a<r)for(;a<r;a++)j(t,o,a);else if(a<n)for(;a<n;a++)C(t,o,a,i[a])}function D(t,e,i,r,n){var a=t.childNodes;if(i.tagName!==r.tagName)N(a[e],r);else{for(var o={},s=0,h=i.props.length;s<h;s++){var l=M(i.props[s],2),u=l[0],c=l[1];o[u]=c}for(var f=0,d=r.props.length;f<d;f++){var _=M(r.props[f],2),v=_[0];c=_[1];o.hasOwnProperty(v)?(o[v]!==c&&a[e].setAttribute(v,c),delete o[v]):a[e].setAttribute(v,c)}for(var p in o)o.hasOwnProperty(p)&&a[e].removeAttribute(p);n&&i.content!==r.content&&(a[e].textContent=r.content)}}function N(t,e){var i;Array.isArray(e)?(i="",e.forEach(function(t){i+=m.joinVirtualDom(t)})):i=m.joinVirtualDom(e),t.insertAdjacentHTML("afterend",i),t.parentNode.removeChild(t)}function C(t,e,i,r){var n=m.joinVirtualDom(r);i>=e.length?t.insertAdjacentHTML("beforeend",n):e[i].insertAdjacentHTML("beforebegin",n)}function j(t,e,i){e[i]&&t.removeChild(e[i])}var I=function(){function n(t,e,i){var r;return o(this,n),(r=s(this,R(n).call(this,t,e,i))).__node=null,r}return t(n,S),e(n,[{key:"__initProps",value:function(){if(void 0!==this.props.width){var t=parseInt(this.props.width);!isNaN(t)&&0<t&&(this.__width=t)}if(void 0!==this.props.height){var e=parseInt(this.props.height);!isNaN(e)&&0<e&&(this.__height=e)}}},{key:"__genHtml",value:function(){for(var t,e,i,r="<".concat(this.tagName),n=0,a=this.__props.length;n<a;n++){var o=this.__props[n];r+=(t=o[0],e=o[1],void 0,i=Array.isArray(e)?m.joinSourceArray(e):m.stringify(e),"className"===t&&(t="class")," "+t+'="'+m.encodeHtml(i,!0)+'"')}return r+="></".concat(this.tagName,">")}},{key:"__cb",value:function(t,e){if(!(t.touches&&1<t.touches.length)){var i=this.node.getBoundingClientRect(),r=i.x,n=i.y,a=i.top,o=i.right;r=r||a||0,n=n||o||0;var s=t.touches?t.touches[0]||{}:t;r=s.clientX-r,n=s.clientY-n,this.__emitEvent({event:t,x:r,y:n,covers:[]},e)}}},{key:"__initEvent",value:function(){var i=this,t=this.node;["click","dblclick","mousedown","mousemove","mouseup","touchstart","touchmove","touchend","touchcancel"].forEach(function(e){t.addEventListener(e,function(t){i.__cb(t,-1<["touchend","touchcancel"].indexOf(e))})})}},{key:"appendTo",value:function(t){if(t=function(t){if(m.isString(t)){var e=document.querySelector(t);if(!e)throw new Error("can not find dom of selector: "+t);return e}if(!t)throw new Error("can not find dom: "+t);return t}(t),this.__initProps(),t.nodeName.toUpperCase()===this.tagName.toUpperCase()?(this.__node=t,this.width&&t.setAttribute("width",this.width),this.height&&t.setAttribute("height",this.height)):(this.__node=t.querySelector(this.tagName),this.__node||(t.innerHTML=this.__genHtml(),this.__node=t.querySelector(this.tagName))),!this.width||!this.height){var e=window.getComputedStyle(t,null);this.width||(this.__width=parseInt(e.getPropertyValue("width")),t.setAttribute("width",this.width)),this.height||(this.__height=parseInt(e.getPropertyValue("height")),t.setAttribute("height",this.height))}var i;"canvas"===this.tagName?(this.__ctx=this.__node.getContext("2d"),this.__ctx.clearRect(0,0,this.width,this.height),i=q):"svg"===this.tagName&&(i=U);var r=this.style;if(-1===["flex","block"].indexOf(r.display)&&(r.display="block"),"absolute"===r.position&&(r.position="static"),this.__traverse(this.__ctx,i),r.width=this.width,r.height=this.height,this.__initStyle(),this.__layout({x:0,y:0,w:this.width,h:this.height}),this.__layoutAbs(this),this.render(i),i===U){var n=this.virtualDom;this.node.__karasInit?P(this.node.firstChild,this.node.__ovd,n):this.node.innerHTML=m.joinVirtualDom(n),this.node.__ovd=n}this.node.__karasInit||(this.node.__karasInit=!0,this.__initEvent())}},{key:"node",get:function(){return this.__node}}]),n}(),z=function(){function I(t,e){var i;return o(this,I),(i=s(this,R(I).call(this,t,e))).__start=[],i.__end=[],i.__control=[],Array.isArray(i.props.start)&&(i.__start=i.props.start),Array.isArray(i.props.end)&&(i.__end=i.props.end),Array.isArray(i.props.control)&&(i.__control=i.props.control),i}return t(I,T),e(I,[{key:"render",value:function(t){H(R(I.prototype),"render",this).call(this,t);var e=this.x,i=this.y,r=this.width,n=this.height,a=this.style,o=this.ctx,s=this.start,h=this.end,l=this.control,u=this.virtualDom;if(!(s.length<2||h.length<2)){var c=a.display,f=a.borderTopWidth,d=a.borderRightWidth,_=a.borderBottomWidth,v=a.borderLeftWidth,p=a.marginTop,y=a.marginRight,g=a.marginBottom,m=a.marginLeft,w=a.paddingTop,b=a.paddingRight,x=a.paddingBottom,k=a.paddingLeft,W=a.stroke,L=a.strokeWidth,T=a.strokeDasharray;if("none"!==c){var A=e+v.value+m.value+k.value,E=i+f.value+p.value+w.value;r-=v.value+d.value+m.value+y.value+k.value+b.value,n-=f.value+_.value+p.value+g.value+w.value+x.value;var O,S,P,M,B=A+s[0]*r,D=E+s[1]*n,N=A+h[0]*r,C=E+h[1]*n,j=0;Array.isArray(l[0])&&(j++,O=A+l[0][0]*r,S=E+l[0][1]*n),Array.isArray(l[1])&&(j++,P=A+l[1][0]*r,M=E+l[1][1]*n),t===q?(o.strokeStyle=W,o.lineWidth=L,o.setLineDash(T),o.beginPath(),o.moveTo(B,D),2===j?o.bezierCurveTo(O,S,P,M,N,C):1===j?o.quadraticCurveTo(O,S,N,C):o.lineTo(N,C),o.stroke(),o.closePath()):t===U&&(2===j?u.content.push({type:"item",tagName:"path",props:[["d","M".concat(B," ").concat(D," C").concat(O," ").concat(S," ").concat(P," ").concat(M," ").concat(N," ").concat(C)],["fill","none"],["stroke",W],["stroke-width",L],["stroke-dasharray",T]]}):1===j?u.content.push({type:"item",tagName:"path",props:[["d","M".concat(B," ").concat(D," Q").concat(O," ").concat(S," ").concat(N," ").concat(C)],["fill","none"],["stroke",W],["stroke-width",L],["stroke-dasharray",T]]}):u.content.push({type:"item",tagName:"line",props:[["x1",B],["y1",D],["x2",N],["y2",C],["stroke",W],["stroke-width",L],["stroke-dasharray",T]]}))}}}},{key:"start",get:function(){return this.__start}},{key:"end",get:function(){return this.__end}},{key:"control",get:function(){return this.__control}}]),I}(),F=function(){function M(t,e){var i;return o(this,M),(i=s(this,R(M).call(this,t,e))).__points=[],Array.isArray(i.props.points)&&(i.__points=i.props.points),-1<["TOP_LEFT","TOP_RIGHT","BOTTOM_LEFT","BOTTOM_RIGHT"].indexOf(i.props.origin)?i.__origin=i.props.origin:i.__origin="BOTTOM_LEFT",i}return t(M,T),e(M,[{key:"render",value:function(t){H(R(M.prototype),"render",this).call(this,t);var e=this.x,i=this.y,r=this.width,n=this.height,a=this.style,o=this.ctx,s=this.points,h=this.origin,l=this.virtualDom;if(!(s.length<2)){for(var u=0,c=s.length;u<c;u++)if(!Array.isArray(s[u])||s[u].length<2)return;var f=a.display,d=a.borderTopWidth,_=a.borderLeftWidth,v=a.marginTop,p=a.marginLeft,y=a.paddingTop,g=a.paddingLeft,m=a.stroke,w=a.strokeWidth,b=a.strokeDasharray;if("none"!==f){var x=e+_.value+p.value+g.value,k=i+d.value+v.value+y.value,W=this.__pts=[];if("TOP_LEFT"===h?s.forEach(function(t){W.push([x+t[0]*r,k+t[1]*n])}):"TOP_RIGHT"===h?s.forEach(function(t){W.push([x+r-t[0]*r,k+t[1]*n])}):"BOTTOM_LEFT"===h?s.forEach(function(t){W.push([x+t[0]*r,k+n-t[1]*n])}):"BOTTOM_RIGHT"===h&&s.forEach(function(t){W.push([x+r-t[0]*r,k+n-t[1]*n])}),t===q){o.strokeStyle=m,o.lineWidth=w,o.setLineDash(b),o.beginPath(),o.moveTo(W[0][0],k+W[0][1]);for(var L=1,T=W.length;L<T;L++){var A=W[L];o.lineTo(A[0],A[1])}w&&"transparent"!==m&&o.stroke(),o.closePath()}else if(t===U){for(var E="",O=0,S=W.length;O<S;O++){var P=W[O];E+="".concat(P[0],",").concat(P[1]," ")}l.content.push({type:"item",tagName:"polyline",props:[["points",E],["fill","none"],["stroke",m],["stroke-width",w],["stroke-dasharray",b]]})}}}}},{key:"getPointsByX",value:function(t){for(var e=1/0,i=this.__pts.length,r=[],n=0;n<i;n++){var a=Math.abs(this.__pts[n][0]-t);a<e&&(e=a)}for(var o=0;o<i;o++){Math.abs(this.__pts[o][0]-t)===e&&r.push({index:o,x:this.__pts[o][0],y:this.__pts[o][1]})}return r}},{key:"points",get:function(){return this.__points}},{key:"origin",get:function(){return this.__origin}}]),M}(),Y=function(){function P(t,e){var i;return o(this,P),(i=s(this,R(P).call(this,t,e))).__points=[],Array.isArray(i.props.points)&&(i.__points=i.props.points),i}return t(P,T),e(P,[{key:"render",value:function(t){H(R(P.prototype),"render",this).call(this,t);var e=this.x,i=this.y,r=this.width,n=this.height,a=this.style,o=this.ctx,s=this.points,h=this.virtualDom;if(!(s.length<3)){for(var l=0,u=s.length;l<u;l++)if(!Array.isArray(s[l])||s[l].length<2)return;var c=a.display,f=a.borderTopWidth,d=a.borderLeftWidth,_=a.marginTop,v=a.marginLeft,p=a.paddingTop,y=a.paddingLeft,g=a.stroke,m=a.strokeWidth,w=a.strokeDasharray,b=a.fill;if("none"!==c){var x=e+d.value+v.value+y.value,k=i+f.value+_.value+p.value;if(s.forEach(function(t){t[0]=x+t[0]*r,t[1]=k+t[1]*n}),t===q){o.strokeStyle=g,o.lineWidth=m,o.fillStyle=b,o.setLineDash(w),o.beginPath(),o.moveTo(s[0][0],k+s[0][1]);for(var W=1,L=s.length;W<L;W++){var T=s[W];o.lineTo(T[0],T[1])}o.fill(),m&&"transparent"!==g&&o.stroke(),o.closePath()}else if(t===U){for(var A="",E=0,O=A.length;E<O;E++){var S=A[E];A+="".concat(S[0],",").concat(S[1]," ")}h.content.push({type:"item",tagName:"polygon",props:[["points",A],["fill",b],["stroke",g],["stroke-width",m],["stroke-dasharray",w]]})}}}}},{key:"points",get:function(){return this.__points}}]),P}(),G=.5*Math.PI;function X(t,e,i,r){for(;360<r;)r-=360;for(;r<0;)r+=360;return 0<=r&&r<90?[t+Math.sin(r*Math.PI/180)*i,e-Math.cos(r*Math.PI/180)*i]:90<=r&&r<180?[t+Math.cos((r-90)*Math.PI/180)*i,e+Math.sin((r-90)*Math.PI/180)*i]:180<=r&&r<270?[t-Math.cos((270-r)*Math.PI/180)*i,e+Math.sin((270-r)*Math.PI/180)*i]:[t-Math.sin((360-r)*Math.PI/180)*i,e-Math.cos((360-r)*Math.PI/180)*i]}var $=function(){function P(t,e){var i;return o(this,P),(i=s(this,R(P).call(this,t,e))).__start=0,i.__end=0,i.props.start&&(i.__start=parseFloat(i.props.start),isNaN(i.start)&&(i.__start=0)),i.props.end&&(i.__end=parseFloat(i.props.end),isNaN(i.end)&&(i.__end=0)),i.__r=1,i.props.r&&(i.__r=parseFloat(i.props.r),isNaN(i.r)&&(i.__r=1)),i}return t(P,T),e(P,[{key:"render",value:function(t){H(R(P.prototype),"render",this).call(this,t);var e=this.x,i=this.y,r=this.width,n=this.height,a=this.style,o=this.ctx,s=this.start,h=this.end,l=this.r,u=this.virtualDom;if(s!==h){var c=a.display,f=a.borderTopWidth,d=a.borderLeftWidth,_=a.marginTop,v=a.marginLeft,p=a.paddingTop,y=a.paddingLeft,g=a.stroke,m=a.strokeWidth,w=a.strokeDasharray,b=a.fill;if("none"!==c){var x=e+d.value+v.value+y.value,k=i+f.value+_.value+p.value;if(x+=.5*r,k+=.5*n,l*=.5*Math.min(r,n),t===q)o.strokeStyle=g,o.lineWidth=m,o.fillStyle=b,o.setLineDash(w),o.beginPath(),o.moveTo(x,k),o.arc(x,k,l,s*Math.PI/180-G,h*Math.PI/180-G),o.fill(),m&&"transparent"!==g&&o.stroke(),o.closePath();else if(t===U){var W,L,T,A,E=M(X(x,k,l,s),2);W=E[0],L=E[1];var O=M(X(x,k,l,h),2);T=O[0],A=O[1];var S=180<h-s?1:0;u.content.push({type:"item",tagName:"path",props:[["d","M".concat(x," ").concat(k," L").concat(W," ").concat(L," A").concat(l," ").concat(l," 0 ").concat(S," 1 ").concat(T," ").concat(A," z")],["fill",b],["stroke",g],["stroke-width",m],["stroke-dasharray",w]]})}}}}},{key:"start",get:function(){return this.__start}},{key:"end",get:function(){return this.__end}},{key:"r",get:function(){return this.__r}}]),P}(),V=function(){function b(t,e){return o(this,b),s(this,R(b).call(this,t,e))}return t(b,T),e(b,[{key:"render",value:function(t){H(R(b.prototype),"render",this).call(this,t);var e=this.x,i=this.y,r=this.width,n=this.height,a=this.style,o=this.ctx,s=this.virtualDom,h=a.display,l=a.borderTopWidth,u=a.borderLeftWidth,c=a.marginTop,f=a.marginLeft,d=a.paddingTop,_=a.paddingLeft,v=a.stroke,p=a.strokeWidth,y=a.strokeDasharray,g=a.fill;if("none"!==h){var m=e+u.value+f.value+_.value,w=i+l.value+c.value+d.value;t===q?(o.strokeStyle=v,o.lineWidth=p,o.fillStyle=g,o.setLineDash(y),o.beginPath(),o.moveTo(m,w),o.lineTo(m+r,w),o.lineTo(m+r,w+n),o.lineTo(m,w+n),o.fill(),p&&"transparent"!==v&&o.stroke(),o.closePath()):t===U&&s.content.push({type:"item",tagName:"rect",props:[["x",e],["y",i],["width",r],["height",n],["fill",g],["stroke",v],["stroke-width",p],["stroke-dasharray",y]]})}}}]),b}(),tt=function(){function x(t,e){var i;return o(this,x),(i=s(this,R(x).call(this,t,e))).__r=1,i.props.r&&(i.__r=parseFloat(i.props.r),isNaN(i.r)&&(i.__r=1)),i}return t(x,T),e(x,[{key:"render",value:function(t){H(R(x.prototype),"render",this).call(this,t);var e=this.x,i=this.y,r=this.width,n=this.height,a=this.style,o=this.ctx,s=this.r,h=this.virtualDom,l=a.display,u=a.borderTopWidth,c=a.borderLeftWidth,f=a.marginTop,d=a.marginLeft,_=a.paddingTop,v=a.paddingLeft,p=a.stroke,y=a.strokeWidth,g=a.strokeDasharray,m=a.fill;if("none"!==l){var w=e+c.value+d.value+v.value,b=i+u.value+f.value+_.value;w+=.5*r,b+=.5*n,s*=.5*Math.min(r,n),t===q?(o.strokeStyle=p,o.lineWidth=y,o.fillStyle=m,o.setLineDash(g),o.beginPath(),o.arc(w,b,s,0,2*Math.PI),"transparent"!==m&&o.fill(),y&&"transparent"!==p&&o.stroke(),o.closePath()):t===U&&h.content.push({type:"item",tagName:"circle",props:[["cx",w],["cy",b],["r",s],["fill",m],["stroke",p],["stroke-width",y],["stroke-dasharray",g]]})}}},{key:"r",get:function(){return this.__r}}]),x}(),et=function(){function k(t,e){var i;return o(this,k),(i=s(this,R(k).call(this,t,e))).__rx=1,i.props.rx&&(i.__rx=parseFloat(i.props.rx),isNaN(i.rx)&&(i.__rx=1)),i.__ry=1,i.props.ry&&(i.__ry=parseFloat(i.props.ry),isNaN(i.rx)&&(i.__ry=1)),i}return t(k,T),e(k,[{key:"render",value:function(t){H(R(k.prototype),"render",this).call(this,t);var e=this.x,i=this.y,r=this.width,n=this.height,a=this.style,o=this.ctx,s=this.rx,h=this.ry,l=this.virtualDom,u=a.display,c=a.borderTopWidth,f=a.borderLeftWidth,d=a.marginTop,_=a.marginLeft,v=a.paddingTop,p=a.paddingLeft,y=a.stroke,g=a.strokeWidth,m=a.strokeDasharray,w=a.fill;if("none"!==u){var b=e+f.value+_.value+p.value,x=i+c.value+d.value+v.value;b+=.5*r,x+=.5*n,s*=.5*r,h*=.5*n,t===q?(o.strokeStyle=y,o.lineWidth=g,o.fillStyle=w,o.setLineDash(m),o.beginPath(),o.moveTo(b,x),o.ellipse&&o.ellipse(b,x,s,h,0,0,2*Math.PI),o.fill(),g&&"transparent"!==y&&o.stroke(),o.closePath()):t===U&&l.content.push({type:"item",tagName:"ellipse",props:[["cx",b],["cy",x],["rx",s],["ry",h],["fill",w],["stroke",y],["stroke-width",g],["stroke-dasharray",m]]})}}},{key:"rx",get:function(){return this.__rx}},{key:"ry",get:function(){return this.__ry}}]),k}(),it=function(){function S(t,e){var i;return o(this,S),(i=s(this,R(S).call(this,t,e))).__nx=0,i.props.nx&&(i.__nx=parseFloat(i.props.nx),isNaN(i.nx)&&(i.__nx=0)),i.__ny=0,i.props.ny&&(i.__ny=parseFloat(i.props.ny),isNaN(i.ny)&&(i.__ny=0)),i}return t(S,T),e(S,[{key:"render",value:function(t){H(R(S.prototype),"render",this).call(this,t);var e=this.x,i=this.y,r=this.width,n=this.height,a=this.style,o=this.ctx,s=this.nx,h=this.ny,l=this.virtualDom;if(!(r<=0||n<=0||s<3&&h<3)){var u=a.display,c=a.borderTopWidth,f=a.borderLeftWidth,d=a.marginTop,_=a.marginLeft,v=a.paddingTop,p=a.paddingLeft,y=a.stroke,g=a.strokeWidth,m=a.strokeDasharray;if("none"!==u){var w=e+f.value+_.value+p.value,b=i+c.value+d.value+v.value,x=w+r,k=b+n,W=[],L=[];if(3<=s)for(var T=r/(s-1),A=0;A<s;A++)L.push(w+A*T);if(3<=h)for(var E=n/(h-1),O=0;O<h;O++)W.push(b+O*E);t===q?(o.strokeStyle=y,o.lineWidth=g,o.setLineDash(m),o.beginPath(),W.forEach(function(t){o.moveTo(w,t),o.lineTo(x,t)}),L.forEach(function(t){o.moveTo(t,b),o.lineTo(t,k)}),g&&"transparent"!==y&&o.stroke(),o.closePath()):t===U&&(W.forEach(function(t){l.content.push({type:"item",tagName:"line",props:[["x1",w],["y1",t],["x2",x],["y2",t],["stroke",y],["stroke-width",g],["stroke-dasharray",m]]})}),L.forEach(function(t){l.content.push({type:"item",tagName:"line",props:[["x1",t],["y1",b],["x2",t],["y2",k],["stroke",y],["stroke-width",g],["stroke-dasharray",m]]})}))}}}},{key:"nx",get:function(){return this.__nx}},{key:"ny",get:function(){return this.__ny}},{key:"dash",get:function(){return this.__dash}}]),S}();T.register("$line",z),T.register("$polyline",F),T.register("$polygon",Y),T.register("$sector",$),T.register("$rect",V),T.register("$circle",tt),T.register("$ellipse",et),T.register("$grid",it);var rt={render:function(t,e){if(!(t instanceof I))throw new Error("render root muse be canvas or svg");return e&&t.appendTo(e),t},createVd:function(t,e,i){if(-1<["canvas","svg"].indexOf(t))return new I(t,e,i);if(S.isValid(t))return new S(t,e,i);throw new Error("can not use marker: "+t)},createGm:function(t,e){return new(T.getImplement(t))(t,e)},createCp:function(t,e){return new t(e)},Geom:T};return"undefined"!=typeof window&&(window.karas=rt),rt});
//# sourceMappingURL=index.min.js.map
