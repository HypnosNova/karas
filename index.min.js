!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).karas=e()}(this,function(){"use strict";function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function t(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&i(t,e)}function p(t){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function i(t,e){return(i=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function h(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function g(t,e,i){return(g="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=p(t)););return t}(t,e);if(n){var r=Object.getOwnPropertyDescriptor(n,e);return r.get?r.get.call(i):r.value}})(t,e,i||t)}var a=function(){function e(t){o(this,e),t=t||[],Array.isArray(t)?(this.props=function(t){for(var e={},i=0,n=t.length;i<n;i++){var r=t[i];if(Array.isArray(r))e[r[0]]=r[1];else for(var h=Object.keys(r),o=h.length-1;0<=o;o--){var a=h[o];e[a]=r[a]}}return e}(t),this.__props=function(t){for(var e=0,i=t.length;e<i;e++){var n=t[e];if(!Array.isArray(n)){for(var r=[],h=Object.keys(n),o=0,a=h.length;o<a;o++){var s=h[o];r.push([s,n[s]])}t.splice.apply(t,[e,1].concat(r))}}return t}(t)):(this.props=t,this.__props=function(t){for(var e=[],i=Object.keys(t),n=0,r=i.length;n<r;n++){var h=i[n];e.push([h,t[h]])}return e}(t)),this.__x=0,this.__y=0,this.__width=0,this.__height=0,this.__prev=null,this.__next=null,this.__ctx=null,this.__parent=null,this.__style=this.props.style||{},this.__baseLine=0}return t(e,[{key:"x",get:function(){return this.__x}},{key:"y",get:function(){return this.__y}},{key:"width",get:function(){return this.__width}},{key:"height",get:function(){return this.__height}},{key:"prev",get:function(){return this.__prev}},{key:"next",get:function(){return this.__next}},{key:"parent",get:function(){return this.__parent}},{key:"style",get:function(){return this.__style}},{key:"ctx",get:function(){return this.__ctx}},{key:"baseLine",get:function(){return this.__baseLine}}]),e}(),N=0,F=1,$=2,s={lhr:1.14990234375,car:1.1171875,blr:.9052734375,mdr:.64599609375,lgr:.03271484375},l={display:"block",borderSizing:"content-box",marginTop:0,marginRight:0,marginBottom:0,marginLeft:0,paddingTop:0,paddingRight:0,paddingBottom:0,paddingLeft:0,fontSize:16,fontFamily:"arial",color:"#000",fontStyle:"normal",fontWeight:400,lineHeight:"normal",borderTopWidth:0,borderRightWidth:0,borderBottomWidth:0,borderLeftWidth:0,borderTopStyle:"solid",borderRightStyle:"solid",borderBottomStyle:"solid",borderLeftStyle:"solid",verticalAlign:"baseline",width:"auto",height:"auto",flexGrow:0,flexShrink:1,flexBasis:"auto",flexDirection:"row",justifyContent:"flex-start",alignItem:"stretch",textAlign:"left",stroke:"#000",strokeWidth:1},u=[];Object.keys(l).forEach(function(t){var e=l[t];u.push({k:t,v:e})});var f={}.toString;function e(e){return function(t){return f.call(t)==="[object "+e+"]"}}var c=e("Number");function _(t){return d(t)?"":t.toString()}function d(t){return null==t}var y={isObject:e("Object"),isString:e("String"),isFunction:e("Function"),isNumber:c,isBoolean:e("Boolean"),isDate:e("Date"),stringify:_,joinSourceArray:function(t){return function t(e){for(var i="",n=0,r=e.length;n<r;n++){var h=e[n];Array.isArray(h)?i+=t(h):i+=_(h)}return i}(t)},encodeHtml:function(t,e){return e?t.replace(/"/g,"&quot;"):t.replace(/&/g,"&amp;").replace(/</g,"&lt;")},isNil:d};function v(t,e){var i="border".concat(e);if(t[i]){var n=/\b\d+px\b/i.exec(t[i]);n&&(t[i+"Width"]=n[0]);var r=/\bsolid\b/i.exec(t[i]);r&&(t[i+"Style"]=r[0]);var h=/#[0-9a-f]{3,6}/i.exec(t[i]);h&&-1<[4,7].indexOf(h[0].length)&&(t[i+"Color"]=h[0])}}var x={normalize:function(i){if(u.forEach(function(t){i.hasOwnProperty(t.k)||(i[t.k]=t.v)}),i.background){var t=/#[0-9a-f]{3,6}/i.exec(i.background);t&&-1<[4,7].indexOf(t[0].length)&&(i.backgroundColor=t[0])}i.flex&&("none"===i.flex?(i.flexGrow=0,i.flexShrink=0,i.flexBasis="auto"):"auto"===i.flex?(i.flexGrow=1,i.flexShrink=1,i.flexBasis="auto"):/^[\d.]+$/.test(i.flex)?(i.flexGrow=parseFloat(i.flex),i.flexShrink=1,i.flexBasis=0):/^[\d.]+px$/.test(i.flex)||/^[\d.]+%$/.test(i.flex)||(i.flexGrow=0,i.flexShrink=1,i.flexBasis="auto")),i.border&&(i.borderTop=i.borderRight=i.borderBottom=i.borderLeft=i.border),v(i,"Top"),v(i,"Right"),v(i,"Bottom"),v(i,"Left"),["marginTop","marginRight","marginDown","marginLeft","paddingTop","paddingRight","paddingDown","paddingLeft","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","width","height","flexBasis"].forEach(function(t){var e=i[t];!y.isNil(e)&&e.unit||("auto"===e?i[t]={unit:N}:/%$/.test(e)?(e=parseFloat(e)||0,i[t]=e<=0?{value:0,unit:F}:{value:e,unit:$}):(e=parseFloat(e)||0,i[t]={value:Math.max(e,0),unit:F}))});var e=i.lineHeight;e="normal"===e?{value:i.fontSize*s.lhr,unit:F}:/px$/.test(e)?(e=parseFloat(e),{value:Math.max(i.fontSize,e),unit:F}):"normal"===(e=parseFloat(e)||"normal")?{value:i.fontSize*s.lhr,unit:F}:{value:e*i.fontSize,unit:F},i.lineHeight=e},setFontStyle:function(t){var e=t.fontStyle,i=t.fontWeight,n=t.fontSize,r=t.fontFamily;return"".concat(e," ").concat(i," ").concat(n,"px/").concat(n,"px ").concat(r)},getBaseLine:function(t){var e=t.fontSize*s.lhr;return.5*(t.lineHeight.value-e)+t.fontSize*s.blr}},b=function(){function h(t,e,i,n,r){o(this,h),this.__ctx=t,this.__x=e,this.__y=i,this.__content=n,this.__style=r}return t(h,[{key:"render",value:function(){this.ctx.fillStyle=this.style.color,this.ctx.fillText(this.content,this.x,this.y+x.getBaseLine(this.style))}},{key:"__offsetX",value:function(t){this.__x+=t}},{key:"__offsetY",value:function(t){this.__y+=t}},{key:"ctx",get:function(){return this.__ctx}},{key:"x",get:function(){return this.__x}},{key:"y",get:function(){return this.__y}},{key:"content",get:function(){return this.__content}},{key:"style",get:function(){return this.__style}},{key:"baseLine",get:function(){return x.getBaseLine(this.style)}}]),h}(),w={},k=function(){function i(t){var e;return o(this,i),(e=h(this,p(i).call(this))).__content=t.toString(),e.__lineBoxes=[],e.__charWidthList=[],e.__charWidth=0,e.__textWidth=0,e}return r(i,a),t(i,[{key:"__measure",value:function(){this.__charWidthList=[];var t=this.ctx,e=this.content,i=this.style,n=this.charWidthList;t.font=x.setFontStyle(i);for(var r=w[i.fontSize]=w[i.fontSize]||{},h=e.length,o=0,a=0;a<h;a++){var s=e.charAt(a),l=r.hasOwnProperty(s)?r[s]:t.measureText(s).width;n.push(l),o+=l,this.__charWidth=Math.max(this.charWidth,l)}this.__textWidth=o}},{key:"__preLay",value:function(t,e){var i=t.x,n=t.y,r=t.w;t.h;this.__x=i,this.__y=n;for(var h=i,o=this.ctx,a=this.content,s=this.style,l=this.lineBoxes,u=this.charWidthList,f=0,c=0,_=0,d=a.length;c<d;)if((_+=u[c])===r){var y=new b(o,i,n,a.slice(f,c+1),s);l.push(y),h=Math.max(h,i+_),n+=this.style.lineHeight.value,c=(f=c+1)+1,_=0}else if(r<_){c===f&&(c=f+1);var v=new b(o,i,n,a.slice(f,c),s);l.push(v),h=Math.max(h,i+_-u[c]),n+=this.style.lineHeight.value,f=c,c+=1,_=0}else c++;if(f<d&&f<c){var p=new b(o,i,n,a.slice(f,c),s);l.push(p),h=Math.max(h,i+_),n+=this.style.lineHeight.value}this.__width=h-i,this.__height=n-t.y,e&&(this.__lineBoxes=[])}},{key:"render",value:function(){this.ctx.font=x.setFontStyle(this.style),this.lineBoxes.forEach(function(t){t.render()})}},{key:"__tryLayInline",value:function(t){return this.ctx.font=x.setFontStyle(this.style),t-this.ctx.measureText(this.content).width}},{key:"__offsetX",value:function(e){this.__x+=e,this.lineBoxes.forEach(function(t){t.__offsetX(e)})}},{key:"__offsetY",value:function(e){this.__y+=e,this.lineBoxes.forEach(function(t){t.__offsetY(e)})}},{key:"__calMaxAndMinWidth",value:function(){var e=0;return this.charWidthList.forEach(function(t){e=Math.max(e,t)}),{max:this.textWidth,min:e}}},{key:"content",get:function(){return this.__content},set:function(t){this.__content=t}},{key:"lineBoxes",get:function(){return this.__lineBoxes}},{key:"charWidthList",get:function(){return this.__charWidthList}},{key:"charWidth",get:function(){return this.__charWidth}},{key:"textWidth",get:function(){return this.__textWidth}},{key:"baseLine",get:function(){var t=this.lineBoxes[this.lineBoxes.length-1];return t.y-this.y+t.baseLine}},{key:"outerWidth",get:function(){return this.__width}},{key:"outerHeight",get:function(){return this.__height}}]),i}(),m=function(){function i(t,e){o(this,i),this.__list=[],this.__x=t,this.__y=e,this.__height=0,this.__baseLine=0}return t(i,[{key:"add",value:function(t){this.list.push(t)}},{key:"__calBaseLine",value:function(){var e=0;return this.list.forEach(function(t){e=Math.max(e,t.baseLine)}),e}},{key:"__calHeight",value:function(){var e=0;return this.list.forEach(function(t){e=Math.max(e,t.height)}),e}},{key:"verticalAlign",value:function(){var e=this;this.__height=this.__calHeight(),this.__baseLine=this.__calBaseLine(),1<this.list.length&&this.list.forEach(function(t){t.baseLine!==e.baseLine&&t.__offsetY(e.baseLine-t.baseLine)})}},{key:"list",get:function(){return this.__list}},{key:"x",get:function(){return this.__x}},{key:"y",get:function(){return this.__y}},{key:"height",get:function(){return this.__height}},{key:"baseLine",get:function(){return this.__baseLine}},{key:"size",get:function(){return this.__list.length}}]),i}(),W={$line:!0,$polygon:!0},Y=function(){function e(t){return o(this,e),h(this,p(e).call(this,t))}return r(e,a),t(e,[{key:"__initStyle",value:function(){x.normalize(this.style)}},{key:"__calAutoBasis",value:function(t,e,i){var n=0,r=0,h=0,o=this.style,a=o.width,s=o.height,l=o.borderTopWidth,u=o.borderRightWidth,f=o.borderBottomWidth,c=o.borderLeftWidth,_=t?a:s;if(_.unit!==N&&(n=h+=_.value),t){var d=u.value+c.value;n+=d,h+=d,r+=d}else{var y=l.value+f.value;n+=y,h+=y,r+=y}return{b:n,min:r,max:h}}},{key:"__preLay",value:function(t){var e=this.style;"block"===e.display?this.__preLayBlock(t):"flex"===e.display?this.__preLayFlex(t):this.__preLayInline(t)}},{key:"__preLayInline",value:function(t){var e=t.x,i=t.y,n=t.w,r=t.h;this.__x=e,this.__y=i;var h,o,a=this.style,s=a.width,l=a.height,u=a.borderTopWidth,f=a.borderRightWidth,c=a.borderBottomWidth,_=a.borderLeftWidth;if(s&&s.unit!==N)switch(h=!0,s.unit){case F:n=s.value}if(l&&l.unit!==N)switch(o=!0,l.unit){case F:r=l.value}e+=_.value,t.x=e,i+=u.value,t.y=i,n-=_.value+f.value,r-=u.value+c.value,this.__width=h?n:e-t.x,this.__height=o?r:i-t.y}},{key:"render",value:function(){var t=this.ctx,e=this.style,i=this.x,n=this.y,r=this.width,h=this.height,o=e.backgroundColor,a=e.borderTopWidth,s=e.borderTopColor,l=e.borderRightWidth,u=e.borderRightColor,f=e.borderBottomWidth,c=e.borderBottomColor,_=e.borderLeftWidth,d=e.borderLeftColor;if(o&&(t.beginPath(),t.fillStyle=o,t.rect(this.x,this.y,this.width,this.height),t.fill(),t.closePath()),a.value){t.beginPath(),t.lineWidth=a.value,t.strokeStyle=s;var y=n+.5*a.value;t.moveTo(i+_.value,y),t.lineTo(i+_.value+r,y),t.stroke(),t.closePath()}if(l.value){t.beginPath(),t.lineWidth=l.value,t.strokeStyle=u;var v=i+r+_.value+.5*l.value;t.moveTo(v,n),t.lineTo(v,n+h+a.value+f.value),t.stroke(),t.closePath()}if(f.value){t.beginPath(),t.lineWidth=f.value,t.strokeStyle=c;var p=n+h+a.value+.5*f.value;t.moveTo(i+_.value,p),t.lineTo(i+_.value+r,p),t.stroke(),t.closePath()}_.value&&(t.beginPath(),t.lineWidth=_.value,t.strokeStyle=d,t.moveTo(i+.5*_.value,n),t.lineTo(i+.5*_.value,n+h+a.value+f.value),t.stroke(),t.closePath())}},{key:"tagName",get:function(){return this.__tagName}},{key:"baseLine",get:function(){return 0}},{key:"outerWidth",get:function(){var t=this.style,e=t.borderLeftWidth,i=t.borderRightWidth;return this.width+e.value+i.value}},{key:"outerHeight",get:function(){var t=this.style,e=t.borderTopWidth,i=t.borderBottomWidth;return this.height+e.value+i.value}}],[{key:"isValid",value:function(t){return W.hasOwnProperty(t)}}]),e}(),L={div:!0,span:!0},S={span:!0},B=function(){function G(t,e,i){var n;return o(this,G),(n=h(this,p(G).call(this,e))).__tagName=t,n.__children=i,n.__lineGroups=[],n}return r(G,a),t(G,[{key:"__traverse",value:function(e){var i=this,t=[];this.__traverseChildren(this.children,t,e);for(var n=t.length-1;0<n;n--){var r=t[n];if(r instanceof k){var h=t[n-1];h instanceof k?(h.content+=r.content,t.splice(n,1)):n--}}if("inline"===this.style.display&&"flex"!==this.parent.style.display)for(var o=t.length-1;0<=o;o--){var a=t[o];if(a instanceof G&&"inline"!==a.style.display)throw new Error("inline can not contain block")}t.forEach(function(t){t.__ctx=e,t.__parent=i,t.__prev=null}),this.__children=t}},{key:"__traverseChildren",value:function(t,e,i){var n=this;Array.isArray(t)?t.forEach(function(t){n.__traverseChildren(t,e,i)}):t instanceof G?(e.push(t),t.__traverse(i)):t instanceof Y?e.push(t):y.isNil(t)||e.push(new k(t))}},{key:"__initStyle",value:function(){var e=this.__style;e.display&&-1!==["flex","block","inline"].indexOf(e.display)||(S.hasOwnProperty(this.tagName)?e.display="inline":e.display="block");var t=this.parent;if(t){var i=t.style;["fontSize","fontWeight","fontStyle","lineHeight","wordBreak","color","textAlign"].forEach(function(t){!e.hasOwnProperty(t)&&i.hasOwnProperty(t)&&(e[t]=i[t])})}x.normalize(e),this.children.forEach(function(t){t instanceof G?t.__initStyle():t instanceof Y?t.__initStyle():(t.__style=e,t.__measure())})}},{key:"__tryLayInline",value:function(t){for(var e=this.children,i=0;i<e.length;i++){if(t<0)return t;var n=e[i];n instanceof G||n instanceof Y?t=n.__tryLayInline(t):t-=n.textWidth}return t}},{key:"__offsetX",value:function(e){this.__x+=e,this.children.forEach(function(t){t&&t.__offsetX(e)})}},{key:"__offsetY",value:function(e){this.__y+=e,this.children.forEach(function(t){t&&t.__offsetY(e)})}},{key:"__calAutoBasis",value:function(h,o,a,t){var s=0,l=0,u=0,e=this.children,i=this.style,n=i.width,r=i.height,f=i.borderTopWidth,c=i.borderRightWidth,_=i.borderBottomWidth,d=i.borderLeftWidth,y=h?n:r;if(y.unit!==N&&(s=u+=y.value,t&&(l=s)),e.forEach(function(t){if(t instanceof G||t instanceof Y){var e=t.__calAutoBasis(h,o,a,!0),i=e.b,n=e.min,r=e.max;s=Math.max(s,i),l=Math.max(l,n),u=Math.max(u,r)}else u=h?(l=Math.max(t.charWidth,l),Math.max(t.textWidth,u)):(t.__preLay({x:0,y:0,w:o,h:a},!0),l=Math.max(l,t.height),Math.max(u,t.height))}),h){var v=c.value+d.value;s+=v,u+=v,l+=v}else{var p=f.value+_.value;s+=p,u+=p,l+=p}return{b:s,min:l,max:u}}},{key:"__preLay",value:function(t){var e=this.style;"block"===e.display?this.__preLayBlock(t):"flex"===e.display?this.__preLayFlex(t):this.__preLayInline(t)}},{key:"__preLayBlock",value:function(e){var i=this,n=e.x,r=e.y,h=e.w,o=e.h;this.__x=n,this.__y=r,this.__width=h;var t,a=this.children,s=this.style,l=s.width,u=s.height,f=s.borderTopWidth,c=s.borderRightWidth,_=s.borderBottomWidth,d=s.borderLeftWidth;if(l&&l.unit!==N)switch(l.unit){case F:h=l.value}if(u&&u.unit!==N)switch(t=!0,u.unit){case F:o=u.value;break;case $:o*=.01*u.value}n+=d.value,e.x=n,r+=f.value,e.y=r,h-=d.value+c.value,o-=f.value+_.value;var y=new m(n,r);a.forEach(function(t){if(t instanceof G)"inline"===t.style.display?n===e.x?(y.add(t),t.__preLayInline({x:n,y:r,w:h,h:o}),n+=t.outerWidth):(0<=t.__tryLayInline(h-n)?t.__preLayInline({x:n,y:r,w:h}):(i.lineGroups.push(y),y.verticalAlign(),n=e.x,r+=y.height,t.__preLayInline({x:e.x,y:r,w:h}),y=new m(n,r)),n+=t.outerWidth,y.add(t)):(y.size&&(i.lineGroups.push(y),y.verticalAlign(),r+=y.height,y=new m(e.x,r)),t.__preLay({x:e.x,y:r,w:h,h:o}),n=e.x,r+=t.outerHeight);else if(t instanceof Y)y.size&&(i.lineGroups.push(y),y.verticalAlign(),r+=y.height,y=new m(e.x,r)),t.__preLay({x:e.x,y:r,w:h}),n=e.x,r+=t.outerHeight;else{if(n===e.x)y.add(t),t.__preLay({x:n,y:r,w:h,h:o}),n+=t.width;else 0<=t.__tryLayInline(h-n)?t.__preLay({x:n,y:r,w:h,h:o}):(i.lineGroups.push(y),y.verticalAlign(),n=e.x,r+=y.height,t.__preLay({x:e.x,y:r,w:h,h:o}),y=new m(n,r)),n+=t.width,y.add(t)}}),y.size&&(this.lineGroups.push(y),y.verticalAlign(),r+=y.height),this.__width=h,this.__height=t?o:r-e.y}},{key:"__preLayFlex",value:function(c){var _=c.x,d=c.y,y=c.w,v=c.h;this.__x=_,this.__y=d,this.__width=y;var p,t=this.children,e=this.style,i=e.width,n=e.height,r=e.flexDirection,h=e.borderTopWidth,o=e.borderRightWidth,a=e.borderBottomWidth,s=e.borderLeftWidth,l=e.justifyContent;if(i&&i.unit!==N)switch(i.unit){case F:y=i.value}if(n&&n.unit!==N)switch(p=!0,n.unit){case F:v=n.value;break;case $:v*=.01*n.value}_+=s.value,c.x=_,d+=h.value,c.y=d,y-=s.value+o.value,v-=h.value+a.value;var g="row"===r;if(!g&&!p)return t.forEach(function(t){if(t instanceof G||t instanceof Y){var e=t.style,i=t.style,n=i.display,r=i.flexDirection,h=i.width;i.height;"inline"===n?e.display="block":"flex"===n&&"row"===r&&h.unit===N&&(h.value=y,h.unit=F),t.__preLay({x:_,y:d,w:y,h:v}),d+=t.outerHeight}else t.__preLay({x:_,y:d,w:y,h:v}),d+=t.outerHeight}),this.__width=y,void(this.__height=d-c.y);var x=[],b=[],w=[],k=[],m=0,W=0,L=0,u=0;t.forEach(function(t){if(t instanceof G||t instanceof Y){var e=t.style,i=e.flexGrow,n=e.flexShrink,r=e.flexBasis;x.push(i),b.push(n),m+=i,W+=n;var h=t.__calAutoBasis(g,y,v),o=h.b,a=h.min,s=h.max;r.unit===N?(w.push(s),L+=s):r.unit===F?(o=r.value,w.push(o),L+=o):r.unit===$&&(o=(g?y:v)*r.value,w.push(o),L+=o),u+=s,k.push(a)}else x.push(0),b.push(1),W+=1,g?(w.push(t.textWidth),L+=t.textWidth,u+=t.textWidth,k.push(t.charWidth)):(t.__preLay({x:0,y:0,w:y,h:v},!0),w.push(t.height),L+=t.height,u+=t.height,k.push(t.height))});var S=0,B=0,T=(g?y:v)<u;if(t.forEach(function(t,e){var i,n=b[e],r=x[e];if(T){var h=L-(g?y:v);i=n?w[e]-h*n/W:w[e]}else B=(g?y:v)-L,i=r?w[e]+B*r/m:w[e];if(i=Math.max(i,k[e]),t instanceof G||t instanceof Y){var o=t.style,a=t.style,s=a.display,l=a.flexDirection,u=a.width,f=a.height;g?("block"===s?o.display="inline":"flex"===s&&"column"===l&&p&&f.unit===N&&(f.value=v,f.unit=F),t.__preLay({x:_,y:d,w:i,h:v})):("inline"===s?o.display="block":"flex"===s&&"row"===l&&u.unit===N&&(u.value=y,u.unit=F),t.__preLay({x:_,y:d,w:y,h:i})),T&&n?g?t.__width=i:t.__height=i:!T&&r&&(g?t.__width=i:t.__height=i)}else t.__preLay({x:_,y:d,w:g?i:y,h:g?v:i});S=g?(_+=t.outerWidth,Math.max(S,t.outerHeight)):(d+=t.outerHeight,_=c.x,Math.max(S,t.outerWidth))}),!T&&0===m&&0<B){var f=t.length;if("flex-end"===l)for(var A=0;A<f;A++){var P=t[A];g?P.__offsetX(B):P.__offsetY(B)}else if("center"===l)for(var E=.5*B,O=0;O<f;O++){var M=t[O];g?M.__offsetX(E):M.__offsetY(E)}else if("space-between"===l)for(var R=B/(f-1),H=1;H<f;H++){var C=t[H];g?C.__offsetX(R*H):C.__offsetY(R*H)}else if("space-around"===l)for(var j=B/(f+1),I=0;I<f;I++){var z=t[I];g?z.__offsetX(j*(I+1)):z.__offsetY(j*(I+1))}}g&&(p&&(S=v),d+=S),t.forEach(function(t){var e=t.style;g?t.style.height.unit===N&&(t.__height=S-e.borderTopWidth.value-e.borderBottomWidth.value):t.style.width.unit===N&&(t.__width=S-e.borderRightWidth.value-e.borderLeftWidth.value)}),this.__width=y,this.__height=p?v:d-c.y}},{key:"__preLayInline",value:function(e){var i=this,n=e.x,r=e.y,h=e.w,o=e.h;this.__x=n,this.__y=r;var t,a,s=n,l=this.children,u=this.style,f=u.width,c=u.height,_=u.borderTopWidth,d=u.borderRightWidth,y=u.borderBottomWidth,v=u.borderLeftWidth;if(f&&f.unit!==N)switch(t=!0,f.unit){case F:h=f.value}if(c&&c.unit!==N)switch(a=!0,c.unit){case F:o=c.value}n+=v.value,e.x=n,r+=_.value,e.y=r,h-=v.value+d.value,o-=_.value+y.value;var p=new m(n,r);l.forEach(function(t){t instanceof G?n===e.x?(p.add(t),t.__preLayInline({x:n,y:r,w:h}),n+=t.outerWidth,s=Math.max(s,n)):(0<=t.__tryLayInline(h-n)?t.__preLayInline({x:n,y:r,w:h}):(i.lineGroups.push(p),p.verticalAlign(),n=e.x,r+=p.height,t.__preLayInline({x:e.x,y:r,w:h}),p=new m(n,r)),n+=t.outerWidth,s=Math.max(s,n),p.add(t)):n===e.x?(p.add(t),t.__preLay({x:n,y:r,w:h,h:o}),n+=t.width,s=Math.max(s,n)):(0<=t.__tryLayInline(h-n)?t.__preLay({x:n,y:r,w:h,h:o}):(i.lineGroups.push(p),p.verticalAlign(),n=e.x,r+=p.height,t.__preLay({x:e.x,y:r,w:h,h:o}),p=new m(n,r)),n+=t.width,s=Math.max(s,n),p.add(t))}),p.size&&(this.lineGroups.push(p),p.verticalAlign(),r+=p.height),this.__width=t?h:s-e.x,this.__height=a?o:r-e.y}},{key:"render",value:function(){var t=this.ctx,e=this.style,i=this.children,n=this.x,r=this.y,h=this.width,o=this.height,a=e.backgroundColor,s=e.borderTopWidth,l=e.borderTopColor,u=e.borderRightWidth,f=e.borderRightColor,c=e.borderBottomWidth,_=e.borderBottomColor,d=e.borderLeftWidth,y=e.borderLeftColor;if(a&&(t.beginPath(),t.fillStyle=a,t.rect(this.x,this.y,this.width,this.height),t.fill(),t.closePath()),s.value){t.beginPath(),t.lineWidth=s.value,t.strokeStyle=l;var v=r+.5*s.value;t.moveTo(n+d.value,v),t.lineTo(n+d.value+h,v),t.stroke(),t.closePath()}if(u.value){t.beginPath(),t.lineWidth=u.value,t.strokeStyle=f;var p=n+h+d.value+.5*u.value;t.moveTo(p,r),t.lineTo(p,r+o+s.value+c.value),t.stroke(),t.closePath()}if(c.value){t.beginPath(),t.lineWidth=c.value,t.strokeStyle=_;var g=r+o+s.value+.5*c.value;t.moveTo(n+d.value,g),t.lineTo(n+d.value+h,g),t.stroke(),t.closePath()}d.value&&(t.beginPath(),t.lineWidth=d.value,t.strokeStyle=y,t.moveTo(n+.5*d.value,r),t.lineTo(n+.5*d.value,r+o+s.value+c.value),t.stroke(),t.closePath()),i.forEach(function(t){t&&t.render()})}},{key:"tagName",get:function(){return this.__tagName}},{key:"children",get:function(){return this.__children}},{key:"lineGroups",get:function(){return this.__lineGroups}},{key:"baseLine",get:function(){var t=this.lineGroups.length;if(t){var e=this.lineGroups[t-1];return e.y-this.y+e.baseLine}return this.y}},{key:"outerWidth",get:function(){var t=this.style,e=t.borderLeftWidth,i=t.borderRightWidth;return this.width+e.value+i.value}},{key:"outerHeight",get:function(){var t=this.style,e=t.borderTopWidth,i=t.borderBottomWidth;return this.height+e.value+i.value}}],[{key:"isValid",value:function(t){return L.hasOwnProperty(t)}}]),G}();var T=function(){function n(t,e){var i;return o(this,n),(i=h(this,p(n).call(this,"canvas",t,e))).__node=null,i}return r(n,B),t(n,[{key:"initProps",value:function(){if(void 0!==this.props.width){var t=parseInt(this.props.width);!isNaN(t)&&0<t&&(this.__width=t)}if(void 0!==this.props.height){var e=parseInt(this.props.height);!isNaN(e)&&0<e&&(this.__height=e)}}},{key:"genHtml",value:function(){for(var t,e,i,n="<canvas",r=0,h=this.__props.length;r<h;r++){var o=this.__props[r];n+=(t=o[0],e=o[1],void 0,i=Array.isArray(e)?y.joinSourceArray(e):y.stringify(e),"className"===t&&(t="class")," "+t+'="'+y.encodeHtml(i,!0)+'"')}return n+="></canvas>"}},{key:"appendTo",value:function(t){if(t=function(t){if(y.isString(t)){var e=document.querySelector(t);if(!e)throw new Error("can not find dom of selector: "+t);return e}if(!t)throw new Error("can not find dom: "+t);return t}(t),this.initProps(),"CANVAS"===t.nodeName.toUpperCase())this.__node=t,this.width&&t.setAttribute("width",this.width),this.height&&t.setAttribute("height",this.height);else{var e=this.genHtml();t.insertAdjacentHTML("beforeend",e);var i=t.querySelectorAll("canvas");this.__node=i[i.length-1]}if(!this.width||!this.height){var n=window.getComputedStyle(t,null);this.width||(this.__width=parseInt(n.getPropertyValue("width")),t.setAttribute("width",this.width)),this.height||(this.__height=parseInt(n.getPropertyValue("height")),t.setAttribute("height",this.height))}var r=this.style;-1===["flex","block","none"].indexOf(r.display)&&(r.display="block"),this.__ctx=this.__node.getContext("2d"),this.__traverse(this.__ctx),r.width=this.width,r.height=this.height,this.__initStyle(),this.__preLay({x:0,y:0,w:this.width,h:this.height}),this.render()}},{key:"node",get:function(){return this.__node}}]),n}(),A=function(){function d(t){var e;return o(this,d),(e=h(this,p(d).call(this,t))).__tagName="$line",e.__start=[0,0],e.__end=[1,1],Array.isArray(e.props.start)&&(e.__start=e.props.start),Array.isArray(e.props.end)&&(e.__end=e.props.end),e}return r(d,Y),t(d,[{key:"render",value:function(){g(p(d.prototype),"render",this).call(this);var t=this.x,e=this.y,i=this.width,n=this.height,r=this.style,h=this.ctx,o=this.start,a=this.end,s=r.borderTopWidth,l=r.borderLeftWidth,u=r.stroke,f=r.strokeWidth,c=t+l.value,_=e+s.value;h.strokeStyle=u,h.lineWidth=f,h.beginPath(),h.moveTo(c+o[0]*i,_+o[1]*n),h.lineTo(c+a[0]*i,_+a[1]*n),h.stroke(),h.closePath()}},{key:"start",get:function(){return this.__start}},{key:"end",get:function(){return this.__end}}]),d}(),P=function(){function v(t){var e;return o(this,v),(e=h(this,p(v).call(this,t))).__tagName="$polygon",e.__pointList=[],Array.isArray(e.props.pointList)&&(e.__pointList=e.props.pointList),e}return r(v,Y),t(v,[{key:"render",value:function(){g(p(v.prototype),"render",this).call(this);var t=this.x,e=this.y,i=this.width,n=this.height,r=this.style,h=this.ctx,o=this.pointList,a=r.borderTopWidth,s=r.borderLeftWidth,l=r.stroke,u=r.strokeWidth,f=t+s.value,c=e+a.value;h.strokeStyle=l,h.lineWidth=u,h.beginPath(),h.moveTo(f+o[0][0]*i,c+o[0][1]*n);for(var _=1,d=o.length;_<d;_++){var y=o[_];h.lineTo(f+y[0]*i,c+y[1]*n)}h.stroke(),h.closePath()}},{key:"pointList",get:function(){return this.__pointList}}]),v}(),E={render:function(t,e){if(!t instanceof T)throw new Error("render root muse be canvas");return e&&t.appendTo(e),t},createVd:function(t,e,i){if("canvas"===t)return new T(e,i);if(B.isValid(t))return new B(t,e,i);throw new Error("can not use marker: "+t)},createGm:function(t,e){if(Y.isValid(t))switch(t){case"$line":return new A(e);case"$polygon":return new P(e)}throw new Error("can not use geom marker: "+t)},createCp:function(t,e,i){}};return"undefined"!=typeof window&&(window.karas=E),E});
//# sourceMappingURL=index.min.js.map
