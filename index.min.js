!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).karas=e()}(this,function(){"use strict";function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function e(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}function t(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&i(t,e)}function I(t){return(I=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function i(t,e){return(i=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function a(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function F(t,e,i){return(F="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=I(t)););return t}(t,e);if(n){var r=Object.getOwnPropertyDescriptor(n,e);return r.get?r.get.call(i):r.value}})(t,e,i||t)}var r,h,s=function(){function t(){o(this,t),this.__x=0,this.__y=0,this.__width=0,this.__height=0,this.__prev=null,this.__next=null,this.__ctx=null,this.__parent=null,this.__style={},this.__baseLine=0}return e(t,[{key:"__offsetX",value:function(t){this.__x+=t}},{key:"__offsetY",value:function(t){this.__y+=t}},{key:"x",get:function(){return this.__x}},{key:"y",get:function(){return this.__y}},{key:"width",get:function(){return this.__width}},{key:"height",get:function(){return this.__height}},{key:"outerWidth",get:function(){return this.__width}},{key:"outerHeight",get:function(){return this.__height}},{key:"prev",get:function(){return this.__prev}},{key:"next",get:function(){return this.__next}},{key:"parent",get:function(){return this.__parent}},{key:"style",get:function(){return this.__style}},{key:"ctx",get:function(){return this.__ctx}},{key:"baseLine",get:function(){return this.__baseLine}}]),t}(),l=0,G={setCanvas:function(){l=0},setSvg:function(){l=1,h=""},isCanvas:function(){return 0===l},isSvg:function(){return 1===l},appendHtml:function(t){h+=t},get html(){return h},get measure(){return r||((r=document.createElement("div")).style.position="absolute",r.style.left="99999px",r.style.top="-99999px",r.style.visibility="hidden",document.body.appendChild(r)),r}};var u=function(){function n(t,e){var i;return o(this,n),i=a(this,I(n).call(this)),e=e||[],Array.isArray(e)?(i.props=function(t){for(var e={},i=0,n=t.length;i<n;i++){var r=t[i];if(Array.isArray(r))e[r[0]]=r[1];else for(var a=Object.keys(r),o=a.length-1;0<=o;o--){var h=a[o];e[h]=r[h]}}return e}(e),i.__props=function(t){for(var e=0,i=t.length;e<i;e++){var n=t[e];if(!Array.isArray(n)){for(var r=[],a=Object.keys(n),o=0,h=a.length;o<h;o++){var s=a[o];r.push([s,n[s]])}t.splice.apply(t,[e,1].concat(r))}}return t}(e)):(i.props=e,i.__props=function(t){for(var e=[],i=Object.keys(t),n=0,r=i.length;n<r;n++){var a=i[n];e.push([a,t[a]])}return e}(e)),i.__tagName=t,i.__style=i.props.style||{},i}return t(n,s),e(n,[{key:"__preLay",value:function(t){var e=this.style;if("absolute"===e.position)this.raParent;"block"===e.display?this.__preLayBlock(t):"flex"===e.display?this.__preLayFlex(t):this.__preLayInline(t)}},{key:"render",value:function(){var t=this.ctx,e=this.style,i=this.x,n=this.y,r=this.width,a=this.height,o=(this.outerWidth,this.outerHeight,e.backgroundColor),h=e.borderTopWidth,s=e.borderTopColor,l=e.borderRightWidth,u=e.borderRightColor,c=e.borderBottomWidth,f=e.borderBottomColor,_=e.borderLeftWidth,d=e.borderLeftColor,v=e.marginTop,y=e.marginLeft,g=e.paddingTop,p=e.paddingRight,x=e.paddingBottom,m=e.paddingLeft;if(y&&(i+=y.value),v&&(n+=v.value),o){var b=i;_&&(b+=_.value);var w=n;h&&(w+=h.value);var k=r+m.value+p.value,L=a+g.value+x.value;G.isCanvas()?(t.beginPath(),t.fillStyle=o,t.rect(b,w,k,L),t.fill(),t.closePath()):G.isSvg()&&G.appendHtml('<rect x="'.concat(b,'" y="').concat(w,'" width="').concat(k,'" height="').concat(L,'" fill="').concat(o,'"/>'))}if(h.value){var T=i+_.value,W=n+.5*h.value,B=T+r;m&&(B+=m.value),p&&(B+=p.value),G.isCanvas()?(t.beginPath(),t.lineWidth=h.value,t.strokeStyle=s,t.moveTo(T,W),t.lineTo(B,W),t.stroke(),t.closePath()):G.appendHtml('<line x1="'.concat(T,'" y1="').concat(W,'" x2="').concat(B,'" y2="').concat(W,'" stroke-width="').concat(h.value,'" stroke="').concat(s,'"/>'))}if(l.value){var S=i+r+_.value+.5*l.value,O=n,R=O+a+h.value+c.value;m&&(S+=m.value),p&&(S+=p.value),g&&(R+=g.value),x&&(R+=x.value),G.isCanvas()?(t.beginPath(),t.lineWidth=l.value,t.strokeStyle=u,t.moveTo(S,O),t.lineTo(S,R),t.stroke(),t.closePath()):G.appendHtml('<line x1="'.concat(S,'" y1="').concat(O,'" x2="').concat(S,'" y2="').concat(R,'" stroke-width="').concat(l.value,'" stroke="').concat(u,'"/>'))}if(c.value){var E=i+_.value,A=n+a+h.value+.5*c.value,P=E+r;m&&(P+=m.value),p&&(P+=p.value),g&&(A+=g.value),x&&(A+=x.value),G.isCanvas()?(t.beginPath(),t.lineWidth=c.value,t.strokeStyle=f,t.moveTo(E,A),t.lineTo(P,A),t.stroke(),t.closePath()):G.appendHtml('<line x1="'.concat(E,'" y1="').concat(A,'" x2="').concat(P,'" y2="').concat(A,'" stroke-width="').concat(c.value,'" stroke="').concat(f,'"/>'))}if(_.value){var H=i+.5*_.value,M=n,C=M+a+h.value+c.value;g&&(C+=g.value),x&&(C+=x.value),G.isCanvas()?(t.beginPath(),t.lineWidth=_.value,t.strokeStyle=d,t.moveTo(H,M),t.lineTo(H,C),t.stroke(),t.closePath()):G.appendHtml('<line x1="'.concat(H,'" y1="').concat(M,'" x2="').concat(H,'" y2="').concat(C,'" stroke-width="').concat(_.value,'" stroke="').concat(d,'"/>'))}}},{key:"tagName",get:function(){return this.__tagName}},{key:"outerWidth",get:function(){var t=this.style,e=t.borderLeftWidth,i=t.borderRightWidth,n=t.marginLeft,r=t.marginRight,a=t.paddingLeft,o=t.paddingRight;return this.width+e.value+i.value+n.value+r.value+a.value+o.value}},{key:"outerHeight",get:function(){var t=this.style,e=t.borderTopWidth,i=t.borderBottomWidth,n=t.marginTop,r=t.marginBottom,a=t.paddingTop,o=t.paddingBottom;return this.height+e.value+i.value+n.value+r.value+a.value+o.value}},{key:"raParent",get:function(){for(var t=this.parent;t.parent&&!(-1<["relative","absolute"].indexOf(t.style.position));)t=t.parent;return t}}]),n}(),J=0,K=1,Q=2,c={lhr:1.14990234375,car:1.1171875,blr:.9052734375,mdr:.64599609375,lgr:.03271484375},f={position:"static",display:"block",borderSizing:"content-box",marginTop:0,marginRight:0,marginBottom:0,marginLeft:0,paddingTop:0,paddingRight:0,paddingBottom:0,paddingLeft:0,fontSize:16,fontFamily:"arial",color:"#000",fontStyle:"normal",fontWeight:400,lineHeight:"normal",borderTopWidth:0,borderRightWidth:0,borderBottomWidth:0,borderLeftWidth:0,borderTopStyle:"solid",borderRightStyle:"solid",borderBottomStyle:"solid",borderLeftStyle:"solid",verticalAlign:"baseline",width:"auto",height:"auto",flexGrow:0,flexShrink:1,flexBasis:"auto",flexDirection:"row",justifyContent:"flex-start",alignItem:"stretch",textAlign:"left",stroke:"#000",strokeWidth:1},_=[];Object.keys(f).forEach(function(t){var e=f[t];_.push({k:t,v:e})});var d={}.toString;function v(e){return function(t){return d.call(t)==="[object "+e+"]"}}var y=v("Number");function g(t){return p(t)?"":t.toString()}function p(t){return null==t}var x={isObject:v("Object"),isString:v("String"),isFunction:v("Function"),isNumber:y,isBoolean:v("Boolean"),isDate:v("Date"),stringify:g,joinSourceArray:function(t){return function t(e){for(var i="",n=0,r=e.length;n<r;n++){var a=e[n];Array.isArray(a)?i+=t(a):i+=g(a)}return i}(t)},encodeHtml:function(t,e){return e?t.replace(/"/g,"&quot;"):t.replace(/&/g,"&amp;").replace(/</g,"&lt;")},isNil:p};function m(t,e){var i="border".concat(e);if(t[i]){var n=/\b\d+px\b/i.exec(t[i]);n&&(t[i+"Width"]=n[0]);var r=/\bsolid\b/i.exec(t[i]);r&&(t[i+"Style"]=r[0]);var a=/#[0-9a-f]{3,6}/i.exec(t[i]);a&&-1<[4,7].indexOf(a[0].length)&&(t[i+"Color"]=a[0])}}var b={normalize:function(i){if(_.forEach(function(t){i.hasOwnProperty(t.k)||(i[t.k]=t.v)}),i.background){var t=/#[0-9a-f]{3,6}/i.exec(i.background);t&&-1<[4,7].indexOf(t[0].length)&&(i.backgroundColor=t[0])}i.flex&&("none"===i.flex?(i.flexGrow=0,i.flexShrink=0,i.flexBasis="auto"):"auto"===i.flex?(i.flexGrow=1,i.flexShrink=1,i.flexBasis="auto"):/^[\d.]+$/.test(i.flex)?(i.flexGrow=parseFloat(i.flex),i.flexShrink=1,i.flexBasis=0):/^[\d.]+px$/.test(i.flex)||/^[\d.]+%$/.test(i.flex)||(i.flexGrow=0,i.flexShrink=1,i.flexBasis="auto")),i.border&&(i.borderTop=i.borderRight=i.borderBottom=i.borderLeft=i.border),i.margin&&(i.marginTop=i.marginRight=i.marginBottom=i.marginLeft=i.margin),i.padding&&(i.paddingTop=i.paddingRight=i.paddingBottom=i.paddingLeft=i.padding),m(i,"Top"),m(i,"Right"),m(i,"Bottom"),m(i,"Left"),["marginTop","marginRight","marginBottom","marginLeft","paddingTop","paddingRight","paddingBottom","paddingLeft","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","width","height","flexBasis"].forEach(function(t){var e=i[t];!x.isNil(e)&&e.unit||("auto"===e?i[t]={unit:J}:/%$/.test(e)?(e=parseFloat(e)||0,i[t]=e<=0?{value:0,unit:K}:{value:e,unit:Q}):(e=parseFloat(e)||0,i[t]={value:Math.max(e,0),unit:K}))});var e=i.lineHeight;e="normal"===e?{value:i.fontSize*c.lhr,unit:K}:/px$/.test(e)?(e=parseFloat(e),{value:Math.max(i.fontSize,e),unit:K}):"normal"===(e=parseFloat(e)||"normal")?{value:i.fontSize*c.lhr,unit:K}:{value:e*i.fontSize,unit:K},i.lineHeight=e},setFontStyle:function(t){var e=t.fontStyle,i=t.fontWeight,n=t.fontSize,r=t.fontFamily;return"".concat(e," ").concat(i," ").concat(n,"px/").concat(n,"px ").concat(r)},getBaseLine:function(t){var e=t.fontSize*c.lhr;return.5*(t.lineHeight.value-e)+t.fontSize*c.blr}},w=function(){function a(t,e,i,n,r){o(this,a),this.__ctx=t,this.__x=e,this.__y=i,this.__content=n,this.__style=r}return e(a,[{key:"render",value:function(){var t=this.ctx,e=this.style,i=this.content,n=this.x,r=this.y;G.isCanvas()?(t.fillStyle=e.color,t.fillText(i,n,r+b.getBaseLine(e))):G.isSvg()&&G.appendHtml('<text x="'.concat(n,'" y="').concat(r+b.getBaseLine(e),'" fill="').concat(e.color,'" font-size="').concat(e.fontSize,'px">').concat(i,"</text>"))}},{key:"__offsetX",value:function(t){this.__x+=t}},{key:"__offsetY",value:function(t){this.__y+=t}},{key:"ctx",get:function(){return this.__ctx}},{key:"x",get:function(){return this.__x}},{key:"y",get:function(){return this.__y}},{key:"content",get:function(){return this.__content}},{key:"style",get:function(){return this.__style}},{key:"baseLine",get:function(){return b.getBaseLine(this.style)}}]),a}(),k={},L=function(){function i(t){var e;return o(this,i),(e=a(this,I(i).call(this))).__content=t.toString(),e.__lineBoxes=[],e.__charWidthList=[],e.__charWidth=0,e.__textWidth=0,e}return t(i,s),e(i,[{key:"__measure",value:function(){this.__charWidthList=[];var t=this.ctx,e=this.content,i=this.style,n=this.charWidthList;G.isCanvas()&&(t.font=b.setFontStyle(i));for(var r=k[i.fontSize]=k[i.fontSize]||{},a=e.length,o=0,h=0;h<a;h++){var s=e.charAt(h),l=void 0;if(r.hasOwnProperty(s))l=r[s];else if(G.isCanvas())l=t.measureText(s).width;else if(G.isSvg()){var u=G.measure;u.style.fontSize=i.fontSize+"px",u.innerText=s;var c=window.getComputedStyle(u,null);l=parseFloat(c.width)}n.push(l),o+=l,this.__charWidth=Math.max(this.charWidth,l)}this.__textWidth=o}},{key:"__preLay",value:function(t,e){var i=t.x,n=t.y,r=t.w;t.h;this.__x=i,this.__y=n;for(var a=i,o=this.ctx,h=this.content,s=this.style,l=this.lineBoxes,u=this.charWidthList,c=0,f=0,_=0,d=h.length;f<d;)if((_+=u[f])===r){var v=new w(o,i,n,h.slice(c,f+1),s);l.push(v),a=Math.max(a,i+_),n+=this.style.lineHeight.value,f=(c=f+1)+1,_=0}else if(r<_){f===c&&(f=c+1);var y=new w(o,i,n,h.slice(c,f),s);l.push(y),a=Math.max(a,i+_-u[f]),n+=this.style.lineHeight.value,c=f,f+=1,_=0}else f++;if(c<d&&c<f){var g=new w(o,i,n,h.slice(c,f),s);l.push(g),a=Math.max(a,i+_),n+=this.style.lineHeight.value}this.__width=a-i,this.__height=n-t.y,e&&(this.__lineBoxes=[])}},{key:"render",value:function(){G.isCanvas()&&(this.ctx.font=b.setFontStyle(this.style)),this.lineBoxes.forEach(function(t){t.render()})}},{key:"__tryLayInline",value:function(t){return this.ctx.font=b.setFontStyle(this.style),t-this.ctx.measureText(this.content).width}},{key:"__offsetX",value:function(e){F(I(i.prototype),"__offsetX",this).call(this,e),this.lineBoxes.forEach(function(t){t.__offsetX(e)})}},{key:"__offsetY",value:function(e){F(I(i.prototype),"__offsetY",this).call(this,e),this.lineBoxes.forEach(function(t){t.__offsetY(e)})}},{key:"__calMaxAndMinWidth",value:function(){var e=0;return this.charWidthList.forEach(function(t){e=Math.max(e,t)}),{max:this.textWidth,min:e}}},{key:"content",get:function(){return this.__content},set:function(t){this.__content=t}},{key:"lineBoxes",get:function(){return this.__lineBoxes}},{key:"charWidthList",get:function(){return this.__charWidthList}},{key:"charWidth",get:function(){return this.__charWidth}},{key:"textWidth",get:function(){return this.__textWidth}},{key:"baseLine",get:function(){var t=this.lineBoxes[this.lineBoxes.length-1];return t.y-this.y+t.baseLine}}]),i}(),W=function(){function i(t,e){o(this,i),this.__list=[],this.__x=t,this.__y=e,this.__height=0,this.__baseLine=0}return e(i,[{key:"add",value:function(t){this.list.push(t)}},{key:"__calBaseLine",value:function(){var e=0;return this.list.forEach(function(t){e=Math.max(e,t.baseLine)}),e}},{key:"__calHeight",value:function(){var e=0;return this.list.forEach(function(t){e=Math.max(e,t.height)}),e}},{key:"verticalAlign",value:function(){var e=this;this.__height=this.__calHeight(),this.__baseLine=this.__calBaseLine(),1<this.list.length&&this.list.forEach(function(t){t.baseLine!==e.baseLine&&t.__offsetY(e.baseLine-t.baseLine)})}},{key:"list",get:function(){return this.__list}},{key:"x",get:function(){return this.__x}},{key:"y",get:function(){return this.__y}},{key:"height",get:function(){return this.__height}},{key:"baseLine",get:function(){return this.__baseLine}},{key:"size",get:function(){return this.__list.length}}]),i}(),T={$line:!0,$polygon:!0},Z=function(){function i(t,e){return o(this,i),a(this,I(i).call(this,t,e))}return t(i,u),e(i,[{key:"__initStyle",value:function(){b.normalize(this.style)}},{key:"__tryLayInline",value:function(t,e){var i=this.style.width;return i.unit===K?t-i.value:i.unit===Q?t-e*i.value*.01:t}},{key:"__calAutoBasis",value:function(t,e,i){var n=0,r=0,a=0,o=this.style,h=o.width,s=o.height,l=o.borderTopWidth,u=o.borderRightWidth,c=o.borderBottomWidth,f=o.borderLeftWidth,_=t?h:s;if(_.unit!==J&&(n=a+=_.value),t){var d=u.value+f.value;n+=d,a+=d,r+=d}else{var v=l.value+c.value;n+=v,a+=v,r+=v}return{b:n,min:r,max:a}}},{key:"__preLayBlock",value:function(t){var e=t.x,i=t.y,n=t.w,r=t.h;this.__x=e,this.__y=i,this.__width=n;var a,o=this.style,h=o.width,s=o.height,l=o.borderTopWidth,u=o.borderRightWidth,c=o.borderBottomWidth,f=o.borderLeftWidth;if(h&&h.unit!==J)switch(h.unit){case K:n=h.value}if(s&&s.unit!==J)switch(a=!0,s.unit){case K:r=s.value;break;case Q:r*=.01*s.value}e+=f.value,t.x=e,i+=l.value,t.y=i,n-=f.value+u.value,r-=l.value+c.value,this.__width=n,this.__height=a?r:0}},{key:"__preLayFlex",value:function(t){this.__preLayBlock(t)}},{key:"__preLayInline",value:function(t){var e=t.x,i=t.y,n=t.w,r=t.h;this.__x=e,this.__y=i;var a,o,h=this.style,s=h.width,l=h.height,u=h.borderTopWidth,c=h.borderRightWidth,f=h.borderBottomWidth,_=h.borderLeftWidth;if(s&&s.unit!==J)switch(a=!0,s.unit){case K:n=s.value}if(l&&l.unit!==J)switch(o=!0,l.unit){case K:r=l.value}e+=_.value,t.x=e,i+=u.value,t.y=i,n-=_.value+c.value,r-=u.value+f.value,this.__width=a?n:e-t.x,this.__height=o?r:i-t.y}},{key:"render",value:function(){F(I(i.prototype),"render",this).call(this)}},{key:"tagName",get:function(){return this.__tagName}},{key:"baseLine",get:function(){return this.__height}},{key:"origin",get:function(){return this.__origin}},{key:"min",get:function(){return this.__min}},{key:"max",get:function(){return this.__max}}],[{key:"isValid",value:function(t){return T.hasOwnProperty(t)}}]),i}(),B={div:!0,span:!0},S={span:!0},O=function(){function U(t,e,i){var n;return o(this,U),(n=a(this,I(U).call(this,t,e))).__children=i,n.__lineGroups=[],n}return t(U,u),e(U,[{key:"__traverse",value:function(e){var i=this,t=[];this.__traverseChildren(this.children,t,e);for(var n=t.length-1;0<n;n--){var r=t[n];if(r instanceof L){var a=t[n-1];a instanceof L?(a.content+=r.content,t.splice(n,1)):n--}}if("inline"===this.style.display&&"flex"!==this.parent.style.display)for(var o=t.length-1;0<=o;o--){var h=t[o];if(h instanceof U&&"inline"!==h.style.display)throw new Error("inline can not contain block/flex")}t.forEach(function(t){t.__ctx=e,t.__parent=i,t.__prev=null}),this.__children=t}},{key:"__traverseChildren",value:function(t,e,i){var n=this;Array.isArray(t)?t.forEach(function(t){n.__traverseChildren(t,e,i)}):t instanceof U?(e.push(t),t.__traverse(i)):t instanceof Z?e.push(t):x.isNil(t)||e.push(new L(t))}},{key:"__initStyle",value:function(){var e=this.__style;e.display&&-1!==["flex","block","inline","none"].indexOf(e.display)||(S.hasOwnProperty(this.tagName)?e.display="inline":e.display="block");var t=this.parent;if(t){var i=t.style;["fontSize","fontWeight","fontStyle","lineHeight","wordBreak","color","textAlign"].forEach(function(t){!e.hasOwnProperty(t)&&i.hasOwnProperty(t)&&(e[t]=i[t])})}b.normalize(e),this.children.forEach(function(t){t instanceof U||t instanceof Z?t.__initStyle():(t.__style=e,t.__measure())})}},{key:"__tryLayInline",value:function(t,e){var i=this.children,n=this.style.width;if(n.unit===K)return t-n.value;if(n.unit===Q)return t-e*n.value*.01;for(var r=0;r<i.length;r++){if(t<0)return t;var a=i[r];t-=a instanceof U||a instanceof Z?a.__tryLayInline(t,e):a.textWidth}return t}},{key:"__offsetX",value:function(e){F(I(U.prototype),"__offsetX",this).call(this,e),this.children.forEach(function(t){t&&t.__offsetX(e)})}},{key:"__offsetY",value:function(e){F(I(U.prototype),"__offsetY",this).call(this,e),this.children.forEach(function(t){t&&t.__offsetY(e)})}},{key:"__calAutoBasis",value:function(a,o,h,t){var s=0,l=0,u=0,e=this.children,i=this.style,n=i.width,r=i.height,c=i.borderTopWidth,f=i.borderRightWidth,_=i.borderBottomWidth,d=i.borderLeftWidth,v=i.marginTop,y=i.marginRight,g=(i.marginBottom,i.marginLeft),p=i.paddingTop,x=i.paddingRight,m=i.paddingBottom,b=i.paddingLeft,w=a?n:r;if(w.unit===K&&(s=u+=w.value,t&&(l=s)),e.forEach(function(t){if(t instanceof U||t instanceof Z){var e=t.__calAutoBasis(a,o,h,!0),i=e.b,n=e.min,r=e.max;s=Math.max(s,i),l=Math.max(l,n),u=Math.max(u,r)}else u=a?(l=Math.max(t.charWidth,l),Math.max(t.textWidth,u)):(t.__preLay({x:0,y:0,w:o,h:h},!0),l=Math.max(l,t.height),Math.max(u,t.height))}),a){var k=f.value+d.value+g.value+y.value+b.value+x.value;s+=k,u+=k,l+=k}else{var L=c.value+_.value+v.value+y.value+p.value+m.value;s+=L,u+=L,l+=L}return{b:s,min:l,max:u}}},{key:"__preLayBlock",value:function(e){var i=this,n=e.x,r=e.y,a=e.w,o=e.h;this.__x=n,this.__y=r,this.__width=a;var t,h=this.children,s=this.style,l=s.width,u=s.height,c=s.borderTopWidth,f=s.borderRightWidth,_=s.borderBottomWidth,d=s.borderLeftWidth,v=s.marginTop,y=s.marginRight,g=s.marginBottom,p=s.marginLeft,x=s.paddingTop,m=s.paddingRight,b=s.paddingBottom,w=s.paddingLeft;if(l&&l.unit!==J)switch(l.unit){case K:a=l.value;break;case Q:a*=.01*l.value}if(u&&u.unit!==J)switch(t=!0,u.unit){case K:o=u.value;break;case Q:o*=.01*u.value}n+=d.value+p.value+w.value,e.x=n,r+=c.value+v.value+x.value,e.y=r,a-=d.value+f.value+p.value+y.value+w.value+m.value,o-=c.value+_.value+v.value+g.value+x.value+b.value;var k=new W(n,r);h.forEach(function(t){t instanceof U||t instanceof Z?"inline"===t.style.display?n===e.x?(k.add(t),t.__preLayInline({x:n,y:r,w:a,h:o}),n+=t.outerWidth):(0<=t.__tryLayInline(a-n,a)?t.__preLayInline({x:n,y:r,w:a,h:o}):(i.lineGroups.push(k),k.verticalAlign(),n=e.x,r+=k.height,t.__preLayInline({x:e.x,y:r,w:a,h:o}),k=new W(n,r)),n+=t.outerWidth,k.add(t)):(k.size&&(i.lineGroups.push(k),k.verticalAlign(),r+=k.height,k=new W(e.x,r)),t.__preLay({x:e.x,y:r,w:a,h:o}),n=e.x,r+=t.outerHeight):n===e.x?(k.add(t),t.__preLay({x:n,y:r,w:a,h:o}),n+=t.width):(0<=t.__tryLayInline(a-n,a)?t.__preLay({x:n,y:r,w:a,h:o}):(i.lineGroups.push(k),k.verticalAlign(),n=e.x,r+=k.height,t.__preLay({x:e.x,y:r,w:a,h:o}),k=new W(n,r)),n+=t.width,k.add(t))}),k.size&&(this.lineGroups.push(k),k.verticalAlign(),r+=k.height),this.__width=a,this.__height=t?o:r-e.y}},{key:"__preLayFlex",value:function(t){var f=t.x,_=t.y,d=t.w,v=t.h;this.__x=f,this.__y=_,this.__width=d;var y,e=this.children,i=this.style,n=i.width,r=i.height,a=i.flexDirection,o=i.borderTopWidth,h=i.borderRightWidth,s=i.borderBottomWidth,l=i.borderLeftWidth,u=i.marginTop,c=i.marginRight,g=i.marginBottom,p=i.marginLeft,x=i.paddingTop,m=i.paddingRight,b=i.paddingBottom,w=i.paddingLeft,k=i.justifyContent;if(n&&n.unit!==J)switch(n.unit){case K:d=n.value;break;case Q:d*=.01*n.value}if(r&&r.unit!==J)switch(y=!0,r.unit){case K:v=r.value;break;case Q:v*=.01*r.value}f+=l.value+p.value+w.value,t.x=f,_+=o.value+u.value+x.value,t.y=_,d-=l.value+h.value+p.value+c.value+w.value+m.value,v-=o.value+s.value+u.value+g.value+x.value+b.value;var L="row"===a;if(!L&&!y)return e.forEach(function(t){if(t instanceof U||t instanceof Z){var e=t.style,i=t.style,n=i.display,r=i.flexDirection,a=i.width;i.height;"inline"===n?e.display="block":"flex"===n&&"row"===r&&a.unit===J&&(a.value=d,a.unit=K),t.__preLay({x:f,y:_,w:d,h:v}),_+=t.outerHeight}else t.__preLay({x:f,y:_,w:d,h:v}),_+=t.outerHeight}),this.__width=d,void(this.__height=_-t.y);var T=[],W=[],B=[],S=[],O=0,R=0,E=0,A=0;e.forEach(function(t){if(t instanceof U||t instanceof Z){var e=t.style,i=e.flexGrow,n=e.flexShrink,r=e.flexBasis;T.push(i),W.push(n),O+=i,R+=n;var a=t.__calAutoBasis(L,d,v),o=a.b,h=a.min,s=a.max;r.unit===J?(B.push(s),E+=s):r.unit===K?(o=r.value,B.push(o),E+=o):r.unit===Q&&(o=(L?d:v)*r.value,B.push(o),E+=o),A+=s,S.push(h)}else T.push(0),W.push(1),R+=1,L?(B.push(t.textWidth),E+=t.textWidth,A+=t.textWidth,S.push(t.charWidth)):(t.__preLay({x:0,y:0,w:d,h:v},!0),B.push(t.height),E+=t.height,A+=t.height,S.push(t.height))});var P=0,H=0,M=(L?d:v)<A;e.forEach(function(t,e){var i,n=W[e],r=T[e];if(M){var a=E-(L?d:v);i=n?B[e]-a*n/R:B[e]}else H=(L?d:v)-E,i=r?B[e]+H*r/O:B[e];if(i=Math.max(i,S[e]),t instanceof U||t instanceof Z){var o=t.style,h=t.style,s=h.display,l=h.flexDirection,u=h.width,c=h.height;L?("inline"===s?o.display="block":"flex"===s&&"column"===l&&y&&c.unit===J&&(c.value=v,c.unit=K),t.__preLay({x:f,y:_,w:i,h:v})):("inline"===s?o.display="block":"flex"===s&&"row"===l&&u.unit===J&&(u.value=d,u.unit=K),t.__preLay({x:f,y:_,w:d,h:i})),M&&n?L?t.__width=i:t.__height=i:!M&&r&&(L?t.__width=i:t.__height=i)}else t.__preLay({x:f,y:_,w:L?i:d,h:L?v:i});P=L?(f+=t.outerWidth,Math.max(P,t.outerHeight)):(_+=t.outerHeight,Math.max(P,t.outerWidth))});var C=L?d-f+t.x:v-_+t.y;if(!M&&0===O&&0<H&&0<C){var I=e.length;if("flex-end"===k)for(var F=0;F<I;F++){var G=e[F];L?G.__offsetX(C):G.__offsetY(C)}else if("center"===k)for(var N=.5*C,z=0;z<I;z++){var j=e[z];L?j.__offsetX(N):j.__offsetY(N)}else if("space-between"===k)for(var Y=C/(I-1),X=1;X<I;X++){var $=e[X];L?$.__offsetX(Y*X):$.__offsetY(Y*X)}else if("space-around"===k)for(var D=C/(I+1),V=0;V<I;V++){var q=e[V];L?q.__offsetX(D*(V+1)):q.__offsetY(D*(V+1))}}L&&(y&&(P=v),_+=P),e.forEach(function(t){var e=t.style;L?t.style.height.unit===J&&(t.__height=P-e.borderTopWidth.value-e.borderBottomWidth.value):t.style.width.unit===J&&(t.__width=P-e.borderRightWidth.value-e.borderLeftWidth.value)}),this.__width=d,this.__height=y?v:_-t.y}},{key:"__preLayInline",value:function(e){var i=this,n=e.x,r=e.y,a=e.w,o=e.h;this.__x=n,this.__y=r;var t,h,s=n,l=this.children,u=this.style,c=u.width,f=u.height,_=u.borderTopWidth,d=u.borderRightWidth,v=u.borderBottomWidth,y=u.borderLeftWidth,g=u.marginTop,p=u.marginRight,x=u.marginBottom,m=u.marginLeft,b=u.paddingTop,w=u.paddingRight,k=u.paddingBottom,L=u.paddingLeft;if(c&&c.unit!==J)switch(t=!0,c.unit){case K:a=c.value;break;case Q:a*=.01*c.value}if(f&&f.unit!==J)switch(h=!0,f.unit){case K:o=f.value;break;case Q:o*=.01*f.value}n+=y.value+m.value+L.value,e.x=n,r+=_.value+g.value+b.value,e.y=r,a-=y.value+d.value+m.value+p.value+L.value+w.value,o-=_.value+v.value+g.value+x.value+b.value+k.value;var T=new W(n,r);l.forEach(function(t){t instanceof U||t instanceof Z?n===e.x?(T.add(t),t.__preLayInline({x:n,y:r,w:a,h:o}),n+=t.outerWidth,s=Math.max(s,n)):(0<=t.__tryLayInline(a-n,a)?t.__preLayInline({x:n,y:r,w:a,h:o}):(i.lineGroups.push(T),T.verticalAlign(),n=e.x,r+=T.height,t.__preLayInline({x:e.x,y:r,w:a,h:o}),T=new W(n,r)),n+=t.outerWidth,s=Math.max(s,n),T.add(t)):n===e.x?(T.add(t),t.__preLay({x:n,y:r,w:a,h:o}),n+=t.width,s=Math.max(s,n)):(0<=t.__tryLayInline(a-n,a)?t.__preLay({x:n,y:r,w:a,h:o}):(i.lineGroups.push(T),T.verticalAlign(),n=e.x,r+=T.height,t.__preLay({x:e.x,y:r,w:a,h:o}),T=new W(n,r)),n+=t.width,s=Math.max(s,n),T.add(t))}),T.size&&(this.lineGroups.push(T),T.verticalAlign(),r+=T.height),this.__width=t?a:s-e.x,this.__height=h?o:r-e.y}},{key:"render",value:function(){F(I(U.prototype),"render",this).call(this),this.children.forEach(function(t){t&&t.render()})}},{key:"tagName",get:function(){return this.__tagName}},{key:"children",get:function(){return this.__children}},{key:"lineGroups",get:function(){return this.__lineGroups}},{key:"baseLine",get:function(){var t=this.lineGroups.length;if(t){var e=this.lineGroups[t-1];return e.y-this.y+e.baseLine}return this.y}}],[{key:"isValid",value:function(t){return B.hasOwnProperty(t)}}]),U}();var R=function(){function r(t,e,i){var n;return o(this,r),(n=a(this,I(r).call(this,t,e,i))).__node=null,n}return t(r,O),e(r,[{key:"__initProps",value:function(){if(void 0!==this.props.width){var t=parseInt(this.props.width);!isNaN(t)&&0<t&&(this.__width=t)}if(void 0!==this.props.height){var e=parseInt(this.props.height);!isNaN(e)&&0<e&&(this.__height=e)}}},{key:"__genHtml",value:function(){for(var t,e,i,n="<".concat(this.tagName),r=0,a=this.__props.length;r<a;r++){var o=this.__props[r];n+=(t=o[0],e=o[1],void 0,i=Array.isArray(e)?x.joinSourceArray(e):x.stringify(e),"className"===t&&(t="class")," "+t+'="'+x.encodeHtml(i,!0)+'"')}return n+="></".concat(this.tagName,">")}},{key:"appendTo",value:function(t){if(t=function(t){if(x.isString(t)){var e=document.querySelector(t);if(!e)throw new Error("can not find dom of selector: "+t);return e}if(!t)throw new Error("can not find dom: "+t);return t}(t),this.__initProps(),t.nodeName.toUpperCase()===this.tagName.toUpperCase())this.__node=t,this.width&&t.setAttribute("width",this.width),this.height&&t.setAttribute("height",this.height);else{var e=this.__genHtml();t.insertAdjacentHTML("beforeend",e);var i=t.querySelectorAll(this.tagName);this.__node=i[i.length-1]}if(!this.width||!this.height){var n=window.getComputedStyle(t,null);this.width||(this.__width=parseInt(n.getPropertyValue("width")),t.setAttribute("width",this.width)),this.height||(this.__height=parseInt(n.getPropertyValue("height")),t.setAttribute("height",this.height))}var r=this.style;-1===["flex","block"].indexOf(r.display)&&(r.display="block"),"canvas"===this.tagName?(this.__ctx=this.__node.getContext("2d"),G.setCanvas()):"svg"===this.tagName&&G.setSvg(),this.__traverse(this.__ctx),r.width=this.width,r.height=this.height,this.__initStyle(),this.__preLay({x:0,y:0,w:this.width,h:this.height}),this.render(),G.isSvg()&&(this.__node.innerHTML=G.html)}},{key:"node",get:function(){return this.__node}}]),r}(),E=function(){function O(t){var e;return o(this,O),(e=a(this,I(O).call(this,"$line",t))).__start=[],e.__end=[],Array.isArray(e.props.start)&&(e.__start=e.props.start),Array.isArray(e.props.end)&&(e.__end=e.props.end),-1<["TOP_LEFT","TOP_RIGHT","BOTTOM_LEFT","BOTTOM_RIGHT"].indexOf(e.props.origin)?e.__origin=e.props.origin:e.__origin="BOTTOM_LEFT",e}return t(O,Z),e(O,[{key:"render",value:function(){F(I(O.prototype),"render",this).call(this);var t=this.x,e=this.y,i=this.width,n=this.height,r=this.style,a=this.ctx,o=this.start,h=this.end,s=this.origin;if(!(o.length<2||h.length<2)){var l,u,c,f,_=r.borderTopWidth,d=r.borderRightWidth,v=r.borderBottomWidth,y=r.borderLeftWidth,g=r.marginTop,p=r.marginRight,x=r.marginBottom,m=r.marginLeft,b=r.paddingTop,w=r.paddingRight,k=r.paddingBottom,L=r.paddingLeft,T=r.stroke,W=r.strokeWidth,B=t+y.value+m.value+L.value,S=e+_.value+g.value+b.value;i-=y.value+d.value+m.value+p.value+L.value+w.value,n-=_.value+v.value+g.value+x.value+b.value+k.value,"TOP_LEFT"===s?(l=B+o[0]*i,u=S+o[1]*n,c=B+h[0]*i,f=S+h[1]*n):"TOP_RIGHT"===s?(l=B+i-o[0]*i,u=S+o[1]*n,c=B+i-h[0]*i,f=S+h[1]*n):"BOTTOM_LEFT"===s?(l=B+o[0]*i,u=S+n-o[1]*n,c=B+h[0]*i,f=S+n-h[1]*n):"BOTTOM_RIGHT"===s&&(l=B+i-o[0]*i,u=S+n-o[1]*n,c=B+i-h[0]*i,f=S+n-h[1]*n),G.isCanvas()?(a.strokeStyle=T,a.lineWidth=W,a.beginPath(),a.moveTo(l,u),a.lineTo(c,f),a.stroke(),a.closePath()):G.isSvg()&&G.appendHtml('<line x1="'.concat(l,'" y1="').concat(u,'" x2="').concat(c,'" y2="').concat(f,'" stroke-width="').concat(W,'" stroke="').concat(T,'"/>'))}}},{key:"start",get:function(){return this.__start}},{key:"end",get:function(){return this.__end}}]),O}(),A=function(){function C(t){var e;if(o(this,C),(e=a(this,I(C).call(this,"$polygon",t))).__pointList=[],Array.isArray(e.props.pointList)&&(e.__pointList=e.props.pointList),-1<["TOP_LEFT","TOP_RIGHT","BOTTOM_LEFT","BOTTOM_RIGHT"].indexOf(e.props.origin)?e.__origin=e.props.origin:e.__origin="BOTTOM_LEFT",e.props.min?e.__min=parseFloat(e.props.min)||0:e.__min=0,e.props.max){var i=parseFloat(e.props.max);isNaN(i)&&(i=1),e.__max=i}else e.__max=1;return e}return t(C,Z),e(C,[{key:"render",value:function(){F(I(C.prototype),"render",this).call(this);var t=this.x,e=this.y,i=this.width,n=this.height,r=this.style,a=this.ctx,o=this.pointList,h=this.max,s=this.min,l=this.origin;if(!(o.length<2)){for(var u=0,c=o.length;u<c;u++)if(!Array.isArray(o[u])||o[u].length<2)return;var f=r.borderTopWidth,_=r.borderRightWidth,d=r.borderBottomWidth,v=r.borderLeftWidth,y=r.marginTop,g=r.marginRight,p=r.marginBottom,x=r.marginLeft,m=r.paddingTop,b=r.paddingRight,w=r.paddingBottom,k=r.paddingLeft,L=r.stroke,T=r.strokeWidth,W=h-s;if(W<=0)throw new Error("scale can not <= 0: max(".concat(this.max,") - min(").concat(this.min,")"));var B=t+v.value+x.value+k.value,S=e+f.value+y.value+m.value;if(i-=v.value+_.value+x.value+g.value+k.value+b.value,n-=f.value+d.value+y.value+p.value+m.value+w.value,"TOP_LEFT"===l?o.forEach(function(t){t[0]=B+t[0]*i,t[1]=S+(t[1]-s)*n/W}):"TOP_RIGHT"===l?o.forEach(function(t){t[0]=B+i-t[0]*i,t[1]=S+(t[1]-s)*n/W}):"BOTTOM_LEFT"===l?o.forEach(function(t){t[0]=B+t[0]*i,t[1]=S+n-(t[1]-s)*n/W}):"BOTTOM_RIGHT"===l&&o.forEach(function(t){t[0]=B+i-t[0]*i,t[1]=S+n-(t[1]-s)*n/W}),G.isCanvas()){a.strokeStyle=L,a.lineWidth=T,a.beginPath(),a.moveTo(o[0][0],S+o[0][1]);for(var O=1,R=o.length;O<R;O++){var E=o[O];a.lineTo(E[0],S+E[1])}a.stroke(),a.closePath()}else if(G.isSvg()){for(var A="",P=0,H=o.length;P<H;P++){var M=o[P];A+="".concat(M[0],",").concat(M[1]," ")}G.appendHtml('<polyline fill="none" points="'.concat(A,'" stroke-width="').concat(T,'" stroke="').concat(L,'"/>'))}}}},{key:"pointList",get:function(){return this.__pointList}}]),C}(),P={render:function(t,e){if(!(t instanceof R))throw new Error("render root muse be canvas or svg");return e&&t.appendTo(e),t},createVd:function(t,e,i){if(-1<["canvas","svg"].indexOf(t))return new R(t,e,i);if(O.isValid(t))return new O(t,e,i);throw new Error("can not use marker: "+t)},createGm:function(t,e){if(Z.isValid(t))switch(t){case"$line":return new E(e);case"$polygon":return new A(e)}throw new Error("can not use geom marker: "+t)},createCp:function(t,e,i){}};return"undefined"!=typeof window&&(window.karas=P),P});
//# sourceMappingURL=index.min.js.map
