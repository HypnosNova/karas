!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n(require("homunculus")):"function"==typeof define&&define.amd?define(["homunculus"],n):(e=e||self).yurine=n(e.homunculus)}(this,function(t){"use strict";function r(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function s(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,n,t){return n&&s(e.prototype,n),t&&s(e,t),e}var o,i,c=(t=t&&t.hasOwnProperty("default")?t.default:t).getClass("token","js"),u=t.getClass("token","csx"),l=(t.getClass("node","csx"),{});function f(e,n){return i=o="",function n(e,t){if(e instanceof u||e instanceof c){if(e.isVirtual())return;for(e.ignore=!0,i="";(e=e.next())&&!e.isVirtual()&&l.hasOwnProperty(e.type());){var r=e.content();o+=r,i+=r,!t&&"\n"==r||(e.ignore=!0)}}else e.isToken()?n(e.token(),t):e.leaves().forEach(function(e){n(e,t)})}(e,n),{res:o,append:i}}l[u.LINE]=l[u.COMMENT]=l[u.BLANK]=!0,f.S=l;var p=t.getClass("Node","es6"),h=t.getClass("Token");function v(e,n){return function n(e,t){var r=e.name()===p.TOKEN;var s=r&&e.token().type()===h.VIRTUAL;if(r){var a=e.token();s?";"===a.content()&&(t.s+=";",t.word=!1):(t.word&&-1<[h.ID,h.NUMBER,h.KEYWORD].indexOf(a.type())&&(t.s+=" "),"}"===a.content()&&";"===t.s.charAt(t.s.length-1)&&(t.s=t.s.replace(/;$/,"")),t.s+=a.content(),t.word=-1<[h.ID,h.NUMBER,h.KEYWORD].indexOf(a.type()))}else e.leaves().forEach(function(e){n(e,t)});return t}(e,{s:"",word:n}).s}t.getClass("token","csx");var k=t.getClass("node","csx");function d(e,n){var t,r="",s=e.leaf(1);if(s.isToken())t=s.token().content();else if(s.name()===k.CSXMemberExpression){t=s.first().token().content();for(var a=1,o=s.size();a<o;a++)t+=s.leaf(a).token().content()}var i=/^[A-Z]/.test(t);i?(r+="karas.createCp(",r+=t):(/^\$/.test(t)?r+="karas.createGm(":r+="karas.createVd(",r+='"'+t+'"'),r+=",{";for(var c=2,u=e.size();c<u-1;c++){var l=e.leaf(c);switch(2!==c&&(r+=","),l.name()){case k.CSXBindAttribute:case k.CSXAttribute:r+=C(l);break;case k.CSXSpreadAttribute:r+=v(l.leaf(2))}}return r+="}",n&&i&&(r+=',[],"'+t+'"'),{res:r,isCp:i,name:t}}function C(e){var n="";n+='"'+e.first().token().content()+'":';var t=e.last();return t.isToken()?n+=t=t.token().content():n+=m(t),n}function m(e){return(new E).parse(e).replace(/^(\s*){/,"$1").replace(/}(\s*)$/,"$1")}function g(e){var n="";switch(e.name()){case k.CSXElement:n+=function(e){var n="",t=d(e.first());n+=t.res,n+=",[";for(var r=!1,s=1,a=e.size();s<a-1;s++){var o=e.leaf(s);switch(o.name()){case k.CSXChild:r&&(n+=",",r=!1),n+=m(o),r=!0;break;case k.TOKEN:var i=o.token().content();/^\s+$/.test(i)?o.prev().name()===k.CSXOpeningElement&&o.next().name()===k.CSXClosingElement?n+='"'+i.replace(/"/g,'\\"').replace(/\r/g,"\\r").replace(/\n/g,"\\n\\\n")+'"':n+=i:(r&&(n+=",",r=!1),n+='"'+i.replace(/"/g,'\\"').replace(/\r/g,"\\r").replace(/\n/g,"\\n\\\n")+'"',r=!0);break;default:r&&(n+=",",r=!1),n+=g(o),r=!0}}return n+="]",t.isCp&&t.name&&(n+=',"'+t.name+'"'),n+=")",e.last().name()===k.CSXClosingElement&&(n+=f(e.last(),!0).res),n}(e);break;case k.CSXSelfClosingElement:n+=d(e,!0).res,n+=")"}return n}var y=t.getClass("node","csx"),E=function(){function e(){r(this,e),this.res=""}return a(e,[{key:"parse",value:function(e){return this.recursion(e,!1),this.res}},{key:"recursion",value:function(e){var n=this;if(e.isToken()){var t=e.token();if(t.isVirtual())return;for(t.ignore||(this.res+=t.content());t.next()&&!(t=t.next()).isVirtual()&&f.S.hasOwnProperty(t.type());)t.ignore||(this.res+=t.content())}else{switch(e.name()){case y.CSXElement:case y.CSXSelfClosingElement:return void(this.res+=g(e))}e.leaves().forEach(function(e){n.recursion(e)})}}}]),e}();return new(function(){function n(){r(this,n),this.parser=null,this.node=null}return a(n,[{key:"parse",value:function(e){return this.parser=t.getParser("csx"),this.node=this.parser.parse(e),(new E).parse(this.node)}},{key:"tokens",value:function(){return this.ast?this.parser.lexer.tokens():null}},{key:"ast",value:function(){return this.node}}],[{key:"parse",value:function(e){return(new n).parse(e)}}]),n}())});
//# sourceMappingURL=index.min.js.map
