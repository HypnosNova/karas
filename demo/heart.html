<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=0"/>
  <title>heart</title>
  <link href="style.css" media="all" rel="stylesheet"/>
  <style>
    textarea{width:80%;padding:5px;height:300px;background:#252;border:1px solid #333;color:#FFF;font-size:13px;font-family:Consolas,momospace,"宋体","Courier New";border-radius:5px;}
    #btn{vertical-align:top}
  </style>
</head>
<body>
<div class="pre">仅仅替换变量太多单一，也可传入函数。
试着修改下方的fill颜色和数量num，体验下变化。fill可以是个颜色数值，还可以是函数返回。
<div>
<textarea id="ta" autocomplete="off">{
  "vars": {
    "fill": function() {
      var r = Math.floor(Math.random() * 255);
      var b = Math.floor(Math.random() * 255);
      var b = Math.floor(Math.random() * 255);
      var a = Math.random().toFixed(2);
      return `rgba(${r}, ${b}, ${b}, ${a})`;
    },
    "num": 1
  }
}</textarea>
  <input id="btn" type="button" value="ok"/>
</div>
<!--<div id="example"></div>-->
<div id="example2"></div>
<script src="../index.js"></script>
<script>
  var data = {
      "tagName": "div",
      "props": {
        "style": {
          "position": "absolute",
          "left": 0,
          "top": 0,
          "width": 100,
          "height": 180
        }
      },
      "children": [
        {
          "tagName": "$polygon",
          "props": {
            "points": [
              [
                0.7790406218539965,
                0.7609308110869705
              ],
              [
                0.6431854782730245,
                0.90843594271339
              ],
              [
                0.5799425660221756,
                0.9687206491966925
              ],
              [
                0.4206641206245459,
                0.9687206491966925
              ],
              [
                0.35742120928891313,
                0.907794615696789
              ],
              [
                0.22098048194986328,
                0.7602894840703694
              ],
              [
                0.09625140597675043,
                0.5941858789859118
              ],
              [
                0.00021587282996971894,
                0.3196980682362343
              ],
              [
                0.09039558029378197,
                0.07086332311550907
              ],
              [
                0.5003033433233594,
                0.10628316556145165
              ],
              [
                0.9102111063529398,
                0.07086332311550905
              ],
              [
                0.9998052318891066,
                0.318415414203032
              ],
              [
                0.9037696987423263,
                0.5935445519693108
              ]
            ],
            "controls": [
              [
                0.7351219333502057,
                0.8122369443495546,
                0.6894464963178298,
                0.8622604235789363
              ],
              [
                0.615077517374338,
                0.936012989392146,
                0.5934109640862653,
                0.9571767689119093
              ],
              [
                0.5336780856853558,
                1.010426450267772,
                0.4669286009613657,
                1.010426450267772
              ],
              [
                0.4077813054033179,
                0.9565354428976477,
                0.38552916927238357,
                0.9360129893921462
              ],
              [
                0.31116019032889175,
                0.8616190965623353,
                0.2648991713688703,
                0.812236943347215
              ],
              [
                0.17591878409849698,
                0.7081743210076599,
                0.13424071742052598,
                0.6526710065306592
              ],
              [
                0.03957316461519425,
                0.5154673942300633,
                0.00608101655603705,
                0.41974046798901
              ],
              [
                -0.0029952139574324346,
                0.22655828977780104,
                0.029737015102220325,
                0.1362395683674403
              ],
              [
                0.2023762893791428,
                -0.04916707648818483,
                0.37879025960247464,
                -0.0020571278651032557
              ],
              [
                0.6217267883427169,
                -0.0023541434932445996,
                0.7983444057259423,
                -0.04945389631243274
              ],
              [
                0.9703487896455237,
                0.13604418562156362,
                1.0028376116119853,
                0.22581207795420488
              ],
              [
                0.9941305643470844,
                0.41869783626030654,
                0.960623977432487,
                0.514689789084833
              ],
              [
                0.8658777109035839,
                0.6525149036777792,
                0.8241957219444587,
                0.7084520787015158
              ]
            ],
            "style": {
              "position": "absolute",
              "left": 35,
              "top": 145,
              "display": "none",
              "width": 32,
              "height": 26.66666666666667,
              "scaleX": 1,
              "scaleY": 1,
              "fill": "rgba(255,85,0,1)",
              "strokeWidth": 0,
              "var-fill": {
                "id": "fill"
              }
            }
          },
          "animate": [
            {
              "value": [
                {
                  "display": "block",
                  "offset": 0
                },
                {
                  "offset": 1,
                  "display": "block"
                }
              ],
              "options": {
                "duration": 666.6666666666666,
                "endDelay": 250
              }
            },
            {
              "value": [
                {
                  "offset": 0,
                  "left": 34,
                  "top": 153,
                  "easing": "cubic-bezier(0.01,0.3933,0.4833,0.9867)"
                },
                {
                  "offset": 1,
                  "left": 10,
                  "top": 10
                }
              ],
              "options": {
                "duration": 666.6666666666666,
                "endDelay": 250
              }
            },
            {
              "value": [
                {
                  "offset": 0,
                  "rotateZ": 0
                },
                {
                  "offset": 1,
                  "rotateZ": 40.959834355249455
                }
              ],
              "options": {
                "duration": 666.6666666666666,
                "endDelay": 250
              }
            },
            {
              "value": [
                {
                  "offset": 0,
                  "translateX": 0,
                  "translateY": 0,
                  "easing": "cubic-bezier(0.4633,0,0.5367,0.9867)"
                },
                {
                  "offset": 0.225,
                  "translateX": 20,
                  "translateY": 0,
                  "easing": "cubic-bezier(0.4833,0.0067,0.5367,0.9933)"
                },
                {
                  "offset": 0.525,
                  "translateX": -10,
                  "translateY": 0,
                  "easing": "cubic-bezier(0.39,0.0067,0.59,0.9867)"
                },
                {
                  "offset": 1,
                  "translateX": 0,
                  "translateY": 0
                }
              ],
              "options": {
                "duration": 666.6666666666666,
                "endDelay": 250
              }
            },
            {
              "value": [
                {
                  "offset": 0,
                  "scaleX": 1,
                  "scaleY": 1
                },
                {
                  "offset": 1,
                  "scaleX": 0.6,
                  "scaleY": 0.6
                }
              ],
              "options": {
                "duration": 666.6666666666666,
                "endDelay": 250
              }
            },
            {
              "value": [
                {
                  "offset": 0
                },
                {
                  "offset": 1,
                  "opacity": 0
                }
              ],
              "options": {
                "delay": 500,
                "duration": 166.66666666666666,
                "endDelay": 250
              }
            }
          ]
        }
      ]
    };
  var ta = document.getElementById('ta');
  var input = document.getElementById('btn');
  function exec(s) {
    var json = eval('(' + s.replace(/\r?\n/g, '') + ')');
    var num = json.vars.num || 1;
    var children = [data];
    for(var i = 1; i < num; i++) {
      var clone = karas.util.clone(data);
      clone.props.style.left = Math.random() * 260;
      clone.props.style.top = Math.random() * 180;
      children.push(clone);
    }
    // karas.parse({
    //   tagName: 'canvas',
    //   props: {
    //     width: 360,
    //     height: 360,
    //   },
    //   children: children,
    // }, '#example', json);
    karas.parse({
      tagName: 'svg',
      props: {
        width: 360,
        height: 360,
      },
      children: children,
    }, '#example2', json);
  }
  input.onclick = function() {
    exec(ta.value);
    // location.hash = encodeURIComponent(ta.value);
  };
  function hashChange(first) {
    var s = location.hash.replace(/^#/, '');
    if(s) {
      s = decodeURIComponent(s);
      ta.value = s;
      exec(s);
    }
    else if(first) {
      exec(ta.value);
    }
  }
  hashChange(true);
  // window.onhashchange = hashChange;
</script>
</body>
</html>
